<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0d86aa92c5843d055886.css" id="gatsby-global-css">/*!
 * ress.css • v2.0.4
 * MIT License
 * github.com/filipelinhares/ress
 */html{box-sizing:border-box;-webkit-text-size-adjust:100%;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4}*,:after,:before{background-repeat:no-repeat;box-sizing:inherit}:after,:before{text-decoration:inherit;vertical-align:inherit}*{padding:0;margin:0}hr{overflow:visible;height:0}details,main{display:block}summary{display:list-item}small{font-size:80%}[hidden]{display:none}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}a{background-color:transparent}a:active,a:hover{outline-width:0}code,kbd,pre,samp{font-family:monospace,monospace}pre{font-size:1em}b,strong{font-weight:bolder}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}input{border-radius:0}[disabled]{cursor:default}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}textarea{overflow:auto;resize:vertical}button,input,optgroup,select,textarea{font:inherit}optgroup{font-weight:700}button{overflow:visible}button,select{text-transform:none}[role=button],[type=button],[type=reset],[type=submit],button{cursor:pointer;color:inherit}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button:-moz-focusring{outline:1px dotted ButtonText}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}button,input,select,textarea{background-color:transparent;border-style:none}select{-moz-appearance:none;-webkit-appearance:none}select::-ms-expand{display:none}select::-ms-value{color:currentColor}legend{border:0;color:inherit;display:table;white-space:normal;max-width:100%}::-webkit-file-upload-button{-webkit-appearance:button;color:inherit;font:inherit}img{border-style:none}progress{vertical-align:baseline}svg:not([fill]){fill:currentColor}@media screen{[hidden~=screen]{display:inherit}[hidden~=screen]:not(:active):not(:focus):not(:target){position:absolute!important;clip:rect(0 0 0 0)!important}}[aria-busy=true]{cursor:progress}[aria-controls]{cursor:pointer}[aria-disabled]{cursor:default}</style><meta name="generator" content="Gatsby 2.30.1"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">LYSE本を読む - On Blahfe</title><link data-react-helmet="true" rel="canonical" href="https://nabinno.github.io/posts/65"/><meta data-react-helmet="true" name="google-site-verification" content=""/><meta data-react-helmet="true" name="description" content="Elixirの存在を知ったのが2014年7月14日。それからおよそ3年経つというのに一向に理解した気になれないでいます。特にSLAナイン・ナインはなぜその数値なのか腑に落ちないでいました。今回『Learn You Some Erlang f"/><meta data-react-helmet="true" property="og:url" content="https://nabinno.github.io/posts/65"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="LYSE本を読む - On Blahfe"/><meta data-react-helmet="true" property="og:description" content="Elixirの存在を知ったのが2014年7月14日。それからおよそ3年経つというのに一向に理解した気になれないでいます。特にSLAナイン・ナインはなぜその数値なのか腑に落ちないでいました。今回『Learn You Some Erlang f"/><meta data-react-helmet="true" property="og:image" content="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/fd6db392-06fd-4926-8372-7bbad7407464.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@nabinno"/><meta data-react-helmet="true" name="twitter:title" content="LYSE本を読む - On Blahfe"/><meta data-react-helmet="true" name="twitter:description" content="Elixirの存在を知ったのが2014年7月14日。それからおよそ3年経つというのに一向に理解した気になれないでいます。特にSLAナイン・ナインはなぜその数値なのか腑に落ちないでいました。今回『Learn You Some Erlang f"/><meta data-react-helmet="true" name="twitter:image" content="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/fd6db392-06fd-4926-8372-7bbad7407464.png"/><link rel="icon" href="/favicon-32x32.png?v=381a3661ec5793ff376970a2019b6518" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=381a3661ec5793ff376970a2019b6518"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-7a7e64c679eaacb6bc0d.js"/><link as="script" rel="preload" href="/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/app-1609d7d465ccd6a5a330.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-d1e204551af284801370.js"/><link as="script" rel="preload" href="/component---src-templates-posts-tsx-01adf45b9f8003118fcd.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-557e62df0f80429a7567.js"/><link as="fetch" rel="preload" href="/page-data/posts/65/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="ly78bw">.css-ly78bw{font-family:-apple-system-body,'Source Han Mono',BlinkMacSystemFont,'Helvetica Neue','Hiragino Sans','Hiragino Kaku Gothic ProN','Noto Sans Japanese','游ゴシック  Medium','Yu Gothic Medium','メイリオ',meiryo,sans-serif;}@media screen and (-webkit-min-device-pixel-ratio:2),screen and (min-resolution:2dppx){.css-ly78bw{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;}}</style><div class="css-ly78bw e1j2fp1f0"><div><style data-emotion-css="10061d2">.css-10061d2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width:980px){.css-10061d2{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-10061d2 e1rphn8v0"><style data-emotion-css="1ur9eye">.css-1ur9eye{max-width:620px;width:100%;margin:20px auto;}</style><div style="margin-top:32px" class="css-1ur9eye e1rphn8v1"><style data-emotion-css="1igky03">.css-1igky03{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-right:auto;margin-bottom:1.75rem;}</style><h1 class="css-1igky03"><style data-emotion-css="1a6yofc">.css-1a6yofc{color:rgba(26,32,44,0.88);-webkit-text-decoration:none;text-decoration:none;font-family:Montserrat,sans-serif;font-weight:900;font-size:1.4427rem;line-height:1.1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:16px;margin:-16px;}.css-1a6yofc:hover{background-color:rgba(255,255,255,0.1);}</style><a class="css-1a6yofc" href="/">On Blahfe</a></h1><style data-emotion-css="kvk3sk">.css-kvk3sk{padding:0 12px;}@media (min-width:600px){.css-kvk3sk{padding:0;}}</style><div class="css-kvk3sk epep3293"><style data-emotion-css="19sxenz">.css-19sxenz{display:block;margin-bottom:4px;font-weight:600;-webkit-letter-spacing:0.5px;-moz-letter-spacing:0.5px;-ms-letter-spacing:0.5px;letter-spacing:0.5px;opacity:0.6;font-size:15px;}</style><time class="css-19sxenz">2017.04.29</time><style data-emotion-css="1b1c2m5">.css-1b1c2m5{font-size:24px;line-height:1.4;font-weight:700;margin-bottom:4px;color:#1a202c;font-family:-apple-system,'Source Han Mono','BlinkMacSystemFont','Helvetica Neue','Hiragino Sans','游ゴシック Medium','YuGothic','Hiragino Kaku Gothic ProN','メイリオ','Meiryo,sans-serif';}@media (min-width:600px){.css-1b1c2m5{font-size:30px;}}</style><h1 class="css-1b1c2m5 epep3291">LYSE本を読む</h1><style data-emotion-css="3bor06">.css-3bor06{display:inline-block;background-color:white;border:1px solid #eee;color:rgba(0,0,0,0.6);padding:6px 12px;margin-right:8px;font-weight:bold;font-size:12px;border-radius:4px;-webkit-text-decoration:none;text-decoration:none;background-image:linear-gradient( 45deg,#58463C 0px,#80695F 100% );color:white;margin-bottom:4px;text-transform:capitalize;-webkit-letter-spacing:0.2px;-moz-letter-spacing:0.2px;-ms-letter-spacing:0.2px;letter-spacing:0.2px;}.css-3bor06:hover{border-color:#ccc;color:rgba(0,0,0,0.8);}.css-3bor06:before{content:'#';}.css-3bor06:hover{border-color:inherit;color:white;}.css-3bor06:before{content:'';}</style><a class="css-3bor06 epep3292" href="/categories/blog/backend">blog/backend</a><style data-emotion-css="1qp0zyo">.css-1qp0zyo{display:inline-block;background-color:white;border:1px solid #eee;color:rgba(0,0,0,0.6);padding:6px 12px;margin-right:8px;font-weight:bold;font-size:12px;border-radius:4px;-webkit-text-decoration:none;text-decoration:none;}.css-1qp0zyo:hover{border-color:#ccc;color:rgba(0,0,0,0.8);}.css-1qp0zyo:before{content:'#';}</style><a style="margin-top:4px;margin-bottom:8px" class="css-1qp0zyo evhx4tm0" href="/tags/erlang">erlang</a><a style="margin-top:4px;margin-bottom:8px" class="css-1qp0zyo evhx4tm0" href="/tags/elixir">elixir</a><style data-emotion-css="1f03b13">.css-1f03b13{margin-top:24px;margin-bottom:4.375rem;line-height:1.8;font-size:15px;word-break:break-all;color:rgba(26,32,44,0.88);}.css-1f03b13 .hidden{display:none;}.css-1f03b13 pre{display:block;padding:10.5px;margin:0 0 11px;font-size:13px;line-height:1.6;word-break:break-all;word-wrap:break-word;color:#4a5568;background-color:#3e4149;border:1px solid #ccc;border-radius:4px;}.css-1f03b13 pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0;}.css-1f03b13 h1{font-size:200%;border-bottom:3px solid rgba(0,0,0,0.1);padding-bottom:10px;margin:30px 0;margin-bottom:10px;}.css-1f03b13 h1 .emoji{width:36px;height:36px;}.css-1f03b13 h1 a{color:#0a9b94;}.css-1f03b13 h1 a:hover{color:#1a202c;}.css-1f03b13 h2{font-size:160%;margin:30px 0 16px;font-weight:900;border-bottom:3px solid rgba(0,0,0,0.1);padding-bottom:4px;position:relative;}.css-1f03b13 h2:before{position:absolute;content:' ';width:100px;bottom:-3px;height:3px;background-color:#80695F;}.css-1f03b13 h2 .emoji{width:28px;height:28px;}.css-1f03b13 h2 a{color:#0a9b94;}.css-1f03b13 h2 a:hover{color:#1a202c;}.css-1f03b13 h3{margin:24px 0;margin-bottom:10px;font-size:130%;font-weight:900;}.css-1f03b13 h3 .emoji{width:22px;height:22px;}.css-1f03b13 h4{font-size:120%;font-weight:900;}.css-1f03b13 .markdown > ul,.css-1f03b13 .markdown > ol{margin:16px 0;}.css-1f03b13 ul,.css-1f03b13 ol{padding-left:40px;}.css-1f03b13 li{margin:4px 0;}.css-1f03b13 li > p{margin:0;}.css-1f03b13 dt{margin-top:14px;margin-bottom:4px;}.css-1f03b13 dd{padding:0 14px;margin-bottom:4px;}.css-1f03b13 p{margin:16px 0;}.css-1f03b13 p img{margin-bottom:0;}.css-1f03b13 blockquote{font-size:100%;color:rgba(60,74,96,0.7);border-left:5px solid rgba(0,0,0,0.1);margin-bottom:30px;padding:0 20px;}.css-1f03b13 blockquote p{margin:10px 0 !important;}.css-1f03b13 code{color:#3c4a60;white-space:pre-wrap;border-radius:4px;background-color:rgba(0,0,0,0.05);}.css-1f03b13 pre{border:none;}.css-1f03b13 pre code{background:#f6f6f6;}.css-1f03b13 a{color:#58463C;}.css-1f03b13 a:hover{color:#80695F;}.css-1f03b13 .code-block .highlight{border-radius:4px;}.css-1f03b13 .code-block__copy-button{position:absolute;top:0;right:0;display:none;background-color:white;border:1px solid rgba(0,0,0,0.1);padding:2px 7px;font-size:10px;font-family:'Source Han Mono','Lato',Emoji,Arial,'ヒラギノ角ゴPro W3','Hiragino Kaku Gothic Pro','メイリオ',Meiryo,'ＭＳ Ｐゴシック',sans-serif;}.css-1f03b13 .code-block__copy-button i{color:rgba(60,74,96,0.3);}.css-1f03b13 .code-block__copy-button:hover{background-color:#f6f6f6;border:1px solid rgba(0,0,0,0.2);}.css-1f03b13 .code-block__copy-label::after{content:'Copy';}.css-1f03b13 .code-block__copy-label.copied::after{content:'Copied';}.css-1f03b13 .code-block .highlight{position:relative;}.css-1f03b13 .code-block:hover .code-block__copy-button{display:block;}.css-1f03b13 table{border:1px solid rgba(0,0,0,0.1);width:100%;border-collapse:collapse;border-spacing:0;margin:20px 0;margin-bottom:30px;}.css-1f03b13 table tr:nth-child(odd) td{background-color:#f9f9f9;}.css-1f03b13 table tr th,.css-1f03b13 table tr td{padding:8px;line-height:1.6;vertical-align:top;border:1px solid rgba(0,0,0,0.1);}.css-1f03b13 strong{font-weight:700;}.css-1f03b13 img{max-width:100%;border:1px solid #eee;border-radius:4px;}.css-1f03b13 .anchor{-webkit-transition-duration:0;transition-duration:0;display:none;margin-left:-20px;width:20px;height:20px;font-size:20px;text-align:right;padding-top:8px;}.css-1f03b13 .anchor i:hover{color:#08837d;}.css-1f03b13 .anchor .fa-pencil{-webkit-transform:rotateY(180deg);-webkit-transform:rotateY(180deg);-ms-transform:rotateY(180deg);transform:rotateY(180deg);}.css-1f03b13 h1,.css-1f03b13 h2,.css-1f03b13 h3,.css-1f03b13 h4{-webkit-font-smoothing:antialiased;}.css-1f03b13 h1:hover .anchor,.css-1f03b13 h2:hover .anchor,.css-1f03b13 h3:hover .anchor{display:inline-block;}.css-1f03b13 h2 .anchor{padding-top:5px;font-size:18px;}.css-1f03b13 h2 .anchor i{top:4px;}.css-1f03b13 h3 .anchor{padding-top:3px;font-size:15px;}.css-1f03b13 h3 .anchor i{top:4px;}.css-1f03b13 .emoji{border:none;height:19px;width:19px;}.css-1f03b13 iframe{max-width:100%;}.css-1f03b13 hr{border-top-color:rgba(33,37,41,0.12);display:block;border-top-width:1px;border-top-style:solid;margin:32px 0;}.css-1f03b13 .code-filename{border-top-left-radius:4px;border-top-right-radius:4px;position:relative;top:auto;right:auto;bottom:auto;left:auto;top:4px;display:inline-block;padding:3px 10px;background-color:#3e4149;color:#fff;font-size:85%;line-height:1.5;margin-bottom:-10px;}.css-1f03b13 .code-filename i{color:rgba(60,74,96,0.3);}@media (max-width:900px){.css-1f03b13 video{width:100%;}}.css-1f03b13 .highlight code table td{padding:5px;}.css-1f03b13 .highlight code table pre{margin:0;}.css-1f03b13 .highlight code .c,.css-1f03b13 .highlight code .cd{color:#75715e;font-style:italic;}.css-1f03b13 .highlight code .cm{color:#75715e;font-style:italic;}.css-1f03b13 .highlight code .c1{color:#75715e;font-style:italic;}.css-1f03b13 .highlight code .cp{color:#75715e;font-weight:bold;}.css-1f03b13 .highlight code .cs{color:#75715e;font-weight:bold;font-style:italic;}.css-1f03b13 .highlight code .err{color:#960050;background-color:#1e0010;}.css-1f03b13 .highlight code .gi{color:#ffffff;background-color:#324932;}.css-1f03b13 .highlight code .gd{color:#ffffff;background-color:#493131;}.css-1f03b13 .highlight code .ge{color:#000000;font-style:italic;}.css-1f03b13 .highlight code .gr{color:#aa0000;}.css-1f03b13 .highlight code .gt{color:#aa0000;}.css-1f03b13 .highlight code .gh{color:#999999;}.css-1f03b13 .highlight code .go{color:#888888;}.css-1f03b13 .highlight code .gp{color:#555555;}.css-1f03b13 .highlight code .gs{font-weight:bold;}.css-1f03b13 .highlight code .gu{color:#aaaaaa;}.css-1f03b13 .highlight code .k,.css-1f03b13 .highlight code .kv{color:#66d9ef;font-weight:bold;}.css-1f03b13 .highlight code .kc{color:#66d9ef;font-weight:bold;}.css-1f03b13 .highlight code .kd{color:#66d9ef;font-weight:bold;}.css-1f03b13 .highlight code .kp{color:#66d9ef;font-weight:bold;}.css-1f03b13 .highlight code .kr{color:#66d9ef;font-weight:bold;}.css-1f03b13 .highlight code .kt{color:#66d9ef;font-weight:bold;}.css-1f03b13 .highlight code .kn{color:#f92672;font-weight:bold;}.css-1f03b13 .highlight code .ow{color:#f92672;font-weight:bold;}.css-1f03b13 .highlight code .o{color:#f92672;font-weight:bold;}.css-1f03b13 .highlight code .mf{color:#ae81ff;}.css-1f03b13 .highlight code .mh{color:#ae81ff;}.css-1f03b13 .highlight code .il{color:#ae81ff;}.css-1f03b13 .highlight code .mi{color:#ae81ff;}.css-1f03b13 .highlight code .mo{color:#ae81ff;}.css-1f03b13 .highlight code .m,.css-1f03b13 .highlight code .mb,.css-1f03b13 .highlight code .mx{color:#ae81ff;}.css-1f03b13 .highlight code .se{color:#ae81ff;}.css-1f03b13 .highlight code .sb{color:#e6db74;}.css-1f03b13 .highlight code .sc{color:#e6db74;}.css-1f03b13 .highlight code .sd{color:#e6db74;}.css-1f03b13 .highlight code .s2{color:#e6db74;}.css-1f03b13 .highlight code .sh{color:#e6db74;}.css-1f03b13 .highlight code .si{color:#e6db74;}.css-1f03b13 .highlight code .sx{color:#e6db74;}.css-1f03b13 .highlight code .sr{color:#e6db74;}.css-1f03b13 .highlight code .s1{color:#e6db74;}.css-1f03b13 .highlight code .ss{color:#e6db74;}.css-1f03b13 .highlight code .s{color:#e6db74;}.css-1f03b13 .highlight code .na{color:#a6e22e;}.css-1f03b13 .highlight code .nc{color:#a6e22e;font-weight:bold;}.css-1f03b13 .highlight code .nd{color:#a6e22e;font-weight:bold;}.css-1f03b13 .highlight code .ne{color:#a6e22e;font-weight:bold;}.css-1f03b13 .highlight code .nf{color:#a6e22e;font-weight:bold;}.css-1f03b13 .highlight code .no{color:#66d9ef;}.css-1f03b13 .highlight code .bp{color:#f8f8f2;}.css-1f03b13 .highlight code .nb{color:#f8f8f2;}.css-1f03b13 .highlight code .ni{color:#f8f8f2;}.css-1f03b13 .highlight code .nn{color:#f8f8f2;}.css-1f03b13 .highlight code .vc{color:#f8f8f2;}.css-1f03b13 .highlight code .vg{color:#f8f8f2;}.css-1f03b13 .highlight code .vi{color:#f8f8f2;}.css-1f03b13 .highlight code .nv{color:#f8f8f2;}.css-1f03b13 .highlight code .w{color:#f8f8f2;}.css-1f03b13 .highlight code .nl{color:#f8f8f2;font-weight:bold;}.css-1f03b13 .highlight code .nt{color:#f92672;}.css-1f03b13 .highlight code{color:#f8f8f2;background-color:#3e4149;}.css-1f03b13 h1,.css-1f03b13 h2,.css-1f03b13 h3,.css-1f03b13 h4,.css-1f03b13 h5,.css-1f03b13 h6{font-weight:700;}.css-1f03b13 .footnotes{margin-top:4.375rem;padding:20px 0;background-color:#efefef;}</style><div class="css-1f03b13 e1a9pvvr0"><p data-sourcepos="1:1-1:479">Elixirの存在を知ったのが<a href="https://b.hatena.ne.jp/entry/s/plataformatec.com/" target="_blank" rel="noopener noreferrer">2014年7月14日</a>。それからおよそ3年経つというのに一向に理解した気になれないでいます。特にSLAナイン・ナインはなぜその数値なのか腑に落ちないでいました。今回<a href="https://learnyousomeerlang.com/" target="_blank" rel="noopener noreferrer">『Learn You Some Erlang for Great Good!（通称LYSE本）』</a>を読むことで積年の謎を解明してみようと臨みました。</p>
<h1 data-sourcepos="3:1-3:9" id="1-0-0" name="1-0-0">
<a class="anchor" id="PROBLEM" name="PROBLEM" href="#PROBLEM" data-position="1-0-0"><i class="fa fa-link"></i><span class="hidden" data-text="PROBLEM"> &gt; PROBLEM</span></a>PROBLEM</h1>
<ul data-sourcepos="4:1-7:0">
<li data-sourcepos="4:1-4:95">Elixirをさわりはじめてしばらく経つけどふかく理解した気になれない</li>
<li data-sourcepos="5:1-5:147">Phoenixやほかのフレームワークに頼られないケースが出てきたとき自由な発想ができるようになっておきたい</li>
<li data-sourcepos="6:1-7:0">巷でいわれているSLAナイン・ナイン（99.9999999%）などの実際がどうなのか腹落ちしてない</li>
</ul>
<h1 data-sourcepos="8:1-8:6" id="2-0-0" name="2-0-0">
<a class="anchor" id="TLDR" name="TLDR" href="#TLDR" data-position="2-0-0"><i class="fa fa-link"></i><span class="hidden" data-text="TLDR"> &gt; TLDR</span></a>TLDR</h1>
<ul data-sourcepos="9:1-18:0">
<li data-sourcepos="9:1-18:0">下記Erlang機能を中心に高いSLAを提供する素地をなしている
<ul data-sourcepos="10:5-18:0">
<li data-sourcepos="10:5-15:47">分散システム Erlang Port Mapper Daemon（EPMD）
<ul data-sourcepos="11:9-15:47">
<li data-sourcepos="11:9-11:214">他の言語・フレームワークが「分散コンピューティングの落とし穴」「CAP定理」にどのように対応している比較すると、Erlangの特徴がより見えてくる。</li>
<li data-sourcepos="12:9-15:47">EMPDの特徴
<ul data-sourcepos="13:13-15:47">
<li data-sourcepos="13:13-13:65">耐障害性（スケーリングはやや弱い）</li>
<li data-sourcepos="14:13-14:35">マルチプロセス</li>
<li data-sourcepos="15:13-15:47">ネットワークの障害監視</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="16:5-16:87">ライフサイクル、再起動戦略を備えたライブラリ（分散OTP）</li>
<li data-sourcepos="17:5-18:0">CPシステムでNoSQLデータベース「Mnesia」</li>
</ul>
</li>
</ul>
<h1 data-sourcepos="19:1-19:10" id="3-0-0" name="3-0-0">
<a class="anchor" id="SOLUTION" name="SOLUTION" href="#SOLUTION" data-position="3-0-0"><i class="fa fa-link"></i><span class="hidden" data-text="SOLUTION"> &gt; SOLUTION</span></a>SOLUTION</h1>
<p data-sourcepos="20:1-20:380">というわけで、「LYSE本」を読むことにしました。各セクションにはElixirに関係ありそうな箇所を抜粋しています。長い長いメモになるので、TLDRだけで済ませて問題ありません。結論、輪郭は見えてきましたがまだその探求の入り口に来たに過ぎないのだということは理解しました。</p>
<h2 data-sourcepos="22:1-22:19" id="3-1-0" name="3-1-0">
<a class="anchor" id="1-3 Erlang概要" name="1-3%20Erlang%E6%A6%82%E8%A6%81" href="#1-3%20Erlang%E6%A6%82%E8%A6%81" data-position="3-1-0"><i class="fa fa-link"></i><span class="hidden" data-text="1-3 Erlang概要"> &gt; 1-3 Erlang概要</span></a>1-3 Erlang概要</h2>
<h3 data-sourcepos="23:1-23:26" id="3-1-1" name="3-1-1">
<a class="anchor" id="1.2 Erlangって何？" name="1.2%20Erlang%E3%81%A3%E3%81%A6%E4%BD%95%EF%BC%9F" href="#1.2%20Erlang%E3%81%A3%E3%81%A6%E4%BD%95%EF%BC%9F" data-position="3-1-1"><i class="fa fa-link"></i><span class="hidden" data-text="1.2 Erlangって何？"> &gt; 1.2 Erlangって何？</span></a>1.2 Erlangって何？</h3>
<ul data-sourcepos="24:1-49:0">
<li data-sourcepos="24:1-25:159">関数型言語
<ul data-sourcepos="25:5-25:159">
<li data-sourcepos="25:5-25:159">純粋主義（参照透過性、破壊的データを避けるなど）に従いつつ、実世界で問題が発生した場合はそれを取り払う</li>
</ul>
</li>
<li data-sourcepos="26:1-35:100">アクターモデル
<ul data-sourcepos="27:5-35:100">
<li data-sourcepos="27:5-27:21">同時並行性</li>
<li data-sourcepos="28:5-28:18">高可用性</li>
<li data-sourcepos="29:5-31:24">Ex:
<ul data-sourcepos="30:9-31:24">
<li data-sourcepos="30:9-30:31">Blue-Green deployment</li>
<li data-sourcepos="31:9-31:24">Log management</li>
</ul>
</li>
<li data-sourcepos="32:5-35:100">Policy:
<ul data-sourcepos="33:9-35:100">
<li data-sourcepos="33:9-35:100">Let it crash - クラッシュするならさせておけ
<ul data-sourcepos="34:13-35:100">
<li data-sourcepos="34:13-34:78"><a href="http://ferd.ca/the-zen-of-erlang.html" target="_blank" rel="noopener noreferrer">As bad as anything else</a></li>
<li data-sourcepos="35:13-35:100"><a href="http://qiita.com/soranoba/items/fce095f25c851dd34a6b" target="_blank" rel="noopener noreferrer">let it crashが生んだ誤解</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="36:1-43:40">開発環境
<ul data-sourcepos="37:5-43:40">
<li data-sourcepos="37:5-38:14">クロスプラットフォーム
<ul data-sourcepos="38:9-38:14">
<li data-sourcepos="38:9-38:14">BEAM</li>
</ul>
</li>
<li data-sourcepos="39:5-43:40">開発ツール
<ul data-sourcepos="40:9-43:40">
<li data-sourcepos="40:9-40:25">コンパイラ</li>
<li data-sourcepos="41:9-41:22">デバッガ</li>
<li data-sourcepos="42:9-42:28">プロファイラ</li>
<li data-sourcepos="43:9-43:40">テストフレームワーク</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="44:1-49:0">ライブラリ
<ul data-sourcepos="45:5-49:0">
<li data-sourcepos="45:5-45:30">OTPフレームワーク</li>
<li data-sourcepos="46:5-46:21">Webサーバー</li>
<li data-sourcepos="47:5-47:33">パーサジェネレータ</li>
<li data-sourcepos="48:5-49:0">Mnesiaデータベース</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="50:1-50:37" id="3-1-2" name="3-1-2">
<a class="anchor" id="1.3 Don&amp;#39;t drink too much Kool-Aid" name="1.3%20Don&amp;#39;t%20drink%20too%20much%20Kool-Aid" href="#1.3%20Don&amp;#39;t%20drink%20too%20much%20Kool-Aid" data-position="3-1-2"><i class="fa fa-link"></i><span class="hidden" data-text="1.3 Don&amp;#39;t drink too much Kool-Aid"> &gt; 1.3 Don't drink too much Kool-Aid</span></a>1.3 Don't drink too much Kool-Aid</h3>
<ul data-sourcepos="51:1-67:0">
<li data-sourcepos="51:1-52:111">軽量プロセスによるスケール
<ul data-sourcepos="52:5-52:111">
<li data-sourcepos="52:5-52:111">タスクを細かく分けすぎる＝むやみに並行処理させると処理速度に影響がでる</li>
</ul>
</li>
<li data-sourcepos="53:1-54:63">CPUコア数によるスケール
<ul data-sourcepos="54:5-54:63">
<li data-sourcepos="54:5-54:63">すべてを同時に稼働させることができない</li>
</ul>
</li>
<li data-sourcepos="55:1-67:0">技術領域
<ul data-sourcepos="56:5-67:0">
<li data-sourcepos="56:5-59:39">適切でない技術領域
<ul data-sourcepos="57:9-59:39">
<li data-sourcepos="57:9-57:22">画像処理</li>
<li data-sourcepos="58:9-58:22">信号処理</li>
<li data-sourcepos="59:9-59:39">OSのデバイスドライバ</li>
</ul>
</li>
<li data-sourcepos="60:5-67:0">適切な技術領域
<ul data-sourcepos="61:9-67:0">
<li data-sourcepos="61:9-61:63">巨大なサーバソフトウェア - QMS, MapReduce</li>
<li data-sourcepos="62:9-62:31">多言語との接続</li>
<li data-sourcepos="63:9-63:46">高レベルプロトコルの実装</li>
<li data-sourcepos="64:9-67:0">Ex:
<ul data-sourcepos="65:13-67:0">
<li data-sourcepos="65:13-65:68">IANOというUNICTチームが作成したロボット</li>
<li data-sourcepos="66:13-67:0">Wings 3D</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="68:1-68:33" id="3-1-3" name="3-1-3">
<a class="anchor" id="3.2. 変化できない変数" name="3.2.%20%E5%A4%89%E5%8C%96%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A4%89%E6%95%B0" href="#3.2.%20%E5%A4%89%E5%8C%96%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A4%89%E6%95%B0" data-position="3-1-3"><i class="fa fa-link"></i><span class="hidden" data-text="3.2. 変化できない変数"> &gt; 3.2. 変化できない変数</span></a>3.2. 変化できない変数</h3>
<ul data-sourcepos="69:1-73:0">
<li data-sourcepos="69:1-73:0">パターンマッチング（= 演算子）
<ul data-sourcepos="70:5-73:0">
<li data-sourcepos="70:5-73:0">比較の役割も果たしている
<ul data-sourcepos="71:9-73:0">
<li data-sourcepos="71:9-71:52">値が違っていたらエラーを出す</li>
<li data-sourcepos="72:9-73:0">値が同じだったら当該の値を返す</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="code-block" data-sourcepos="74:1-78:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="o">&gt;</span> <span class="mi">47</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">+</span> <span class="mi">2</span><span class="p">.</span>
<span class="o">&gt;</span> <span class="mi">47</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">+</span> <span class="mi">3</span><span class="p">.</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">no</span> <span class="n">match</span> <span class="k">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="n">value</span> <span class="mi">48</span>
</code></pre></div>
</div>
<ul data-sourcepos="80:1-82:0">
<li data-sourcepos="80:1-82:0">アンダースコア変数（_）
<ul data-sourcepos="81:5-82:0">
<li data-sourcepos="81:5-82:0">使用はできるが値の格納はできない</li>
</ul>
</li>
</ul>
<div class="code-block" data-sourcepos="83:1-88:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="o">&gt;</span> <span class="p">_</span> <span class="o">=</span> <span class="mi">14</span><span class="o">+</span><span class="mi">3</span><span class="p">.</span>
<span class="mi">17</span>
<span class="o">&gt;</span> <span class="p">_.</span>
<span class="o">*</span> <span class="mi">1</span><span class="p">:</span> <span class="n">variable</span> <span class="n">'_'</span> <span class="n">is</span> <span class="n">unbound</span>
</code></pre></div>
</div>
<h3 data-sourcepos="90:1-90:18" id="3-1-4" name="3-1-4">
<a class="anchor" id="3.3. アトム" name="3.3.%20%E3%82%A2%E3%83%88%E3%83%A0" href="#3.3.%20%E3%82%A2%E3%83%88%E3%83%A0" data-position="3-1-4"><i class="fa fa-link"></i><span class="hidden" data-text="3.3. アトム"> &gt; 3.3. アトム</span></a>3.3. アトム</h3>
<ul data-sourcepos="91:1-94:0">
<li data-sourcepos="91:1-94:0">アトムと予約語
<ul data-sourcepos="92:5-94:0">
<li data-sourcepos="92:5-94:0">いくつかのアトムは予約語
<ul data-sourcepos="93:9-94:0">
<li data-sourcepos="93:9-94:0"><code>after and andalso band begin bnot bor bsl bsr bxor case catch cond div end fun if let not of or orelse query receive rem try when xor false true</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="95:1-95:42" id="3-1-5" name="3-1-5">
<a class="anchor" id="3.4. ブール代数と比較演算子" name="3.4.%20%E3%83%96%E3%83%BC%E3%83%AB%E4%BB%A3%E6%95%B0%E3%81%A8%E6%AF%94%E8%BC%83%E6%BC%94%E7%AE%97%E5%AD%90" href="#3.4.%20%E3%83%96%E3%83%BC%E3%83%AB%E4%BB%A3%E6%95%B0%E3%81%A8%E6%AF%94%E8%BC%83%E6%BC%94%E7%AE%97%E5%AD%90" data-position="3-1-5"><i class="fa fa-link"></i><span class="hidden" data-text="3.4. ブール代数と比較演算子"> &gt; 3.4. ブール代数と比較演算子</span></a>3.4. ブール代数と比較演算子</h3>
<ul data-sourcepos="96:1-99:0">
<li data-sourcepos="96:1-96:66">false trueはアトムなので数値の代替にはならない</li>
<li data-sourcepos="97:1-99:0">アトムなどのほかの型も比較対象になる
<ul data-sourcepos="98:5-99:0">
<li data-sourcepos="98:5-99:0"><code>number &lt; atom &lt; reference &lt; fun &lt; port &lt; pid &lt; tuple &lt; list &lt; bit string</code></li>
</ul>
</li>
</ul>
<div class="code-block" data-sourcepos="100:1-105:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="o">&gt;</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">false</span><span class="p">.</span>
<span class="n">false</span>
<span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">false</span><span class="p">.</span>
<span class="n">true</span>
</code></pre></div>
</div>
<h3 data-sourcepos="107:1-107:25" id="3-1-6" name="3-1-6">
<a class="anchor" id="3.8. ビット構文!" name="3.8.%20%E3%83%93%E3%83%83%E3%83%88%E6%A7%8B%E6%96%87!" href="#3.8.%20%E3%83%93%E3%83%83%E3%83%88%E6%A7%8B%E6%96%87!" data-position="3-1-6"><i class="fa fa-link"></i><span class="hidden" data-text="3.8. ビット構文!"> &gt; 3.8. ビット構文!</span></a>3.8. ビット構文!</h3>
<ul data-sourcepos="108:1-121:0">
<li data-sourcepos="108:1-108:71">Erlangはおもいデータを数値処理するにはむいてない</li>
<li data-sourcepos="109:1-114:59">一方、数値処理が必要ないアプリケーションの中では速い
<ul data-sourcepos="110:5-114:59">
<li data-sourcepos="110:5-114:59">次のような処理にむいている
<ul data-sourcepos="111:9-114:59">
<li data-sourcepos="111:9-112:122">イベントに反応する
<ul data-sourcepos="112:13-112:122">
<li data-sourcepos="112:13-112:122">イベントをミリ秒単位でしょりできリアルタイムアプリケーションに適している</li>
</ul>
</li>
<li data-sourcepos="113:9-114:59">メッセージングパッシング
<ul data-sourcepos="114:13-114:59">
<li data-sourcepos="114:13-114:59">アトムをつかうと軽く処理できる</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="115:1-121:0">軽量なビット文字列
<ul data-sourcepos="116:5-121:0">
<li data-sourcepos="116:5-118:97">Pros
<ul data-sourcepos="117:9-118:97">
<li data-sourcepos="117:9-117:72">リストで表現する文字列は1文字につき1ノード</li>
<li data-sourcepos="118:9-118:97">ビット文字列はC言語の配列のようなもの - <code>&lt;&lt;"this is a bit string!"&gt;&gt;</code>
</li>
</ul>
</li>
<li data-sourcepos="119:5-121:0">Cons
<ul data-sourcepos="120:9-121:0">
<li data-sourcepos="120:9-121:0">パターンマッチなどの捜査の際に単純さが失われる</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="122:1-122:34" id="3-2-0" name="3-2-0">
<a class="anchor" id="4-5 パターンマッチング" name="4-5%20%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%9E%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0" href="#4-5%20%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%9E%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0" data-position="3-2-0"><i class="fa fa-link"></i><span class="hidden" data-text="4-5 パターンマッチング"> &gt; 4-5 パターンマッチング</span></a>4-5 パターンマッチング</h2>
<p data-sourcepos="123:1-123:318">4-5章からIDEがないとreplなどに時間がとられるので整備しておこう。Emacsなら<a href="http://erlang.org/doc/man/erlang.el.html" target="_blank" rel="noopener noreferrer">erlang.el</a>がある。インデント、フィルコメント、コメントアウト、OTPなどのscafold、Eshell、コンパイル等ひととおりそろっている。</p>
<h3 data-sourcepos="125:1-125:109" id="3-2-1" name="3-2-1">
<a class="anchor" id="5.5. 関数呼び出しによるパターンマッチガードはcase文よりも優れているのか？" name="5.5.%20%E9%96%A2%E6%95%B0%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%AB%E3%82%88%E3%82%8B%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%9E%E3%83%83%E3%83%81%E3%82%AC%E3%83%BC%E3%83%89%E3%81%AFcase%E6%96%87%E3%82%88%E3%82%8A%E3%82%82%E5%84%AA%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B%EF%BC%9F" href="#5.5.%20%E9%96%A2%E6%95%B0%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%AB%E3%82%88%E3%82%8B%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%9E%E3%83%83%E3%83%81%E3%82%AC%E3%83%BC%E3%83%89%E3%81%AFcase%E6%96%87%E3%82%88%E3%82%8A%E3%82%82%E5%84%AA%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B%EF%BC%9F" data-position="3-2-1"><i class="fa fa-link"></i><span class="hidden" data-text="5.5. 関数呼び出しによるパターンマッチガードはcase文よりも優れているのか？"> &gt; 5.5. 関数呼び出しによるパターンマッチガードはcase文よりも優れているのか？</span></a>5.5. 関数呼び出しによるパターンマッチガードはcase文よりも優れているのか？</h3>
<p data-sourcepos="126:1-126:51">まず、パフォーマンス上かわらない。</p>
<p data-sourcepos="128:1-128:63">つぎに、引数が複数あるときは関数をつかう。</p>
<div class="code-block" data-sourcepos="130:1-142:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="nf">beach</span><span class="p">(</span><span class="nv">Temperature</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">case</span> <span class="nv">Temperature</span> <span class="k">of</span>
        <span class="p">{</span><span class="n">celsius</span><span class="p">,</span> <span class="nv">N</span><span class="p">}</span> <span class="k">when</span> <span class="nv">N</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">andalso</span> <span class="nv">N</span> <span class="o">=&lt;</span> <span class="mi">45</span> <span class="o">-&gt;</span>
            <span class="n">'favorable'</span><span class="p">;</span>
        <span class="p">{</span><span class="n">kelvin</span><span class="p">,</span> <span class="nv">N</span><span class="p">}</span> <span class="k">when</span> <span class="nv">N</span> <span class="o">&gt;=</span> <span class="mi">293</span> <span class="ow">andalso</span> <span class="nv">N</span> <span class="o">=&lt;</span> <span class="mi">318</span> <span class="o">-&gt;</span>
            <span class="n">'scientifically favorable'</span><span class="p">;</span>
        <span class="p">{</span><span class="n">fahrenheit</span><span class="p">,</span> <span class="nv">N</span><span class="p">}</span> <span class="k">when</span> <span class="nv">N</span> <span class="o">&gt;=</span> <span class="mi">68</span> <span class="ow">andalso</span> <span class="nv">N</span> <span class="o">=&lt;</span> <span class="mi">113</span> <span class="o">-&gt;</span>
            <span class="n">'favorable in the US'</span><span class="p">;</span>
        <span class="p">_</span> <span class="o">-&gt;</span>
            <span class="n">'avoid beach'</span>
    <span class="k">end</span><span class="p">.</span>
</code></pre></div>
</div>
<p data-sourcepos="144:1-144:99">上記のようだと可読性がさがる、冗長的。以下のように関数でまとめる。</p>
<div class="code-block" data-sourcepos="146:1-155:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="nf">beachf</span><span class="p">({</span><span class="n">celsius</span><span class="p">,</span> <span class="nv">N</span><span class="p">})</span> <span class="k">when</span> <span class="nv">N</span> <span class="o">&gt;=</span> <span class="mi">20</span> <span class="ow">andalso</span> <span class="nv">N</span> <span class="o">=&lt;</span> <span class="mi">45</span> <span class="o">-&gt;</span>
    <span class="n">'favorable'</span><span class="p">;</span>
<span class="nf">beachf</span><span class="p">({</span><span class="n">kelvin</span><span class="p">,</span> <span class="nv">N</span><span class="p">})</span> <span class="k">when</span> <span class="nv">N</span> <span class="o">&gt;=</span><span class="mi">293</span> <span class="ow">andalso</span> <span class="nv">N</span> <span class="o">=&lt;</span> <span class="mi">318</span> <span class="o">-&gt;</span>
    <span class="n">'scientifically favorable'</span><span class="p">;</span>
<span class="nf">beachf</span><span class="p">({</span><span class="n">fahrenheit</span><span class="p">,</span> <span class="nv">N</span><span class="p">})</span> <span class="k">when</span> <span class="nv">N</span> <span class="o">&gt;=</span> <span class="mi">68</span> <span class="ow">andalso</span> <span class="nv">N</span> <span class="o">=&lt;</span> <span class="mi">113</span> <span class="o">-&gt;</span>
    <span class="n">'favorable in the US'</span><span class="p">;</span>
<span class="nf">beachf</span><span class="p">(_)</span> <span class="o">-&gt;</span>
    <span class="n">'avoid beach'</span><span class="p">.</span>
</code></pre></div>
</div>
<p data-sourcepos="157:1-157:82">ただし、引数が評価関数の対象の場合はcase文が向いている。</p>
<div class="code-block" data-sourcepos="159:1-167:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="nf">prepend</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="p">[])</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nv">X</span><span class="p">];</span>
<span class="nf">prepend</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Set</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">case</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">member</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Set</span><span class="p">)</span> <span class="k">of</span>
        <span class="n">true</span>  <span class="o">-&gt;</span> <span class="nv">Set</span><span class="p">;</span>
        <span class="n">false</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nv">X</span> <span class="p">|</span> <span class="nv">Set</span><span class="p">]</span>
    <span class="k">end</span><span class="p">.</span>
</code></pre></div>
</div>
<h2 data-sourcepos="169:1-169:14" id="3-3-0" name="3-3-0">
<a class="anchor" id="6-11 文法" name="6-11%20%E6%96%87%E6%B3%95" href="#6-11%20%E6%96%87%E6%B3%95" data-position="3-3-0"><i class="fa fa-link"></i><span class="hidden" data-text="6-11 文法"> &gt; 6-11 文法</span></a>6-11 文法</h2>
<ul data-sourcepos="170:1-179:0">
<li data-sourcepos="170:1-179:0">今回は標準文法について
<ul data-sourcepos="171:5-179:0">
<li data-sourcepos="171:5-179:0">Erlangの特徴はざっと次の通り
<ul data-sourcepos="172:9-179:0">
<li data-sourcepos="172:9-173:193">型変換の関数が素朴
<ul data-sourcepos="173:13-173:193">
<li data-sourcepos="173:13-173:193">
<code>erlang:&lt;type&gt;_to_&lt;type&gt;</code> という形式をとっているため、型が追加されるたびに変換用関数を <code>BIF (built-in function)</code> に追加しなければいけない</li>
</ul>
</li>
<li data-sourcepos="174:9-174:72">再帰、無名関数、エラーは普通、Ruby, JSっぽい</li>
<li data-sourcepos="175:9-175:76">レコードによってインターフェイスを定義できる</li>
<li data-sourcepos="176:9-179:0">データ構造にキーバリューストア、セット、配列、有効グラフ、キューがある
<ul data-sourcepos="177:13-179:0">
<li data-sourcepos="177:13-179:0">ただ配列は、他の手続き型言語の配列とは逆に、一定時間での挿入や検索ができない
<ul data-sourcepos="178:17-179:0">
<li data-sourcepos="178:17-179:0">Erlangでなされるプログラミングスタイルでは配列や行列と結びつける必要がなく、実際にはめったに使われないため</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="180:1-180:13" id="3-3-1" name="3-3-1">
<a class="anchor" id="7. 再帰" name="7.%20%E5%86%8D%E5%B8%B0" href="#7.%20%E5%86%8D%E5%B8%B0" data-position="3-3-1"><i class="fa fa-link"></i><span class="hidden" data-text="7. 再帰"> &gt; 7. 再帰</span></a>7. 再帰</h3>
<ul data-sourcepos="181:1-193:0">
<li data-sourcepos="181:1-189:16">
<code>lists</code> モジュール
<ul data-sourcepos="182:5-189:16">
<li data-sourcepos="182:5-182:14"><code>sort/1</code></li>
<li data-sourcepos="183:5-183:14"><code>join/2</code></li>
<li data-sourcepos="184:5-184:14"><code>last/1</code></li>
<li data-sourcepos="185:5-185:17"><code>flatten/1</code></li>
<li data-sourcepos="186:5-186:13"><code>all/1</code></li>
<li data-sourcepos="187:5-187:17"><code>reverse/1</code></li>
<li data-sourcepos="188:5-188:13"><code>map/2</code></li>
<li data-sourcepos="189:5-189:16"><code>filter/2</code></li>
</ul>
</li>
<li data-sourcepos="190:1-193:0">
<code>gb_tree</code> モジュール
<ul data-sourcepos="191:5-193:0">
<li data-sourcepos="191:5-191:16"><code>lookup/2</code></li>
<li data-sourcepos="192:5-193:0"><code>map/2</code></li>
</ul>
</li>
</ul>
<h3 data-sourcepos="194:1-194:21" id="3-3-2" name="3-3-2">
<a class="anchor" id="8.2. 無名関数" name="8.2.%20%E7%84%A1%E5%90%8D%E9%96%A2%E6%95%B0" href="#8.2.%20%E7%84%A1%E5%90%8D%E9%96%A2%E6%95%B0" data-position="3-3-2"><i class="fa fa-link"></i><span class="hidden" data-text="8.2. 無名関数"> &gt; 8.2. 無名関数</span></a>8.2. 無名関数</h3>
<div class="code-block" data-sourcepos="195:1-200:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="o">&gt;</span> <span class="p">(</span><span class="k">fun</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="k">end</span><span class="p">)().</span>
<span class="n">a</span>
<span class="o">&gt;</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">X</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">X</span> <span class="ow">rem</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">end</span><span class="p">,</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)).</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</div>
<h3 data-sourcepos="202:1-202:16" id="3-3-3" name="3-3-3">
<a class="anchor" id="9. エラー" name="9.%20%E3%82%A8%E3%83%A9%E3%83%BC" href="#9.%20%E3%82%A8%E3%83%A9%E3%83%BC" data-position="3-3-3"><i class="fa fa-link"></i><span class="hidden" data-text="9. エラー"> &gt; 9. エラー</span></a>9. エラー</h3>
<h4 data-sourcepos="203:1-203:32">コンパイル時エラー</h4>
<table data-sourcepos="205:1-217:233">
<thead>
<tr data-sourcepos="205:1-205:209">
<th data-sourcepos="205:2-205:11">type</th>
<th data-sourcepos="205:13-205:98">error</th>
<th data-sourcepos="205:100-205:208">description</th>
</tr>
</thead>
<tbody>
<tr data-sourcepos="207:1-207:236">
<td data-sourcepos="207:2-207:11">Module</td>
<td data-sourcepos="207:13-207:98">Module name 'madule' does not match file name 'module'</td>
<td data-sourcepos="207:100-207:235">
<code>-module</code> 属性内に書いたモジュール名がファイル名と一致していない</td>
</tr>
<tr data-sourcepos="208:1-208:256">
<td data-sourcepos="208:2-208:11">Function</td>
<td data-sourcepos="208:13-208:98">Warning: function somefunction/0 is unused</td>
<td data-sourcepos="208:100-208:255">関数を公開していない、あるいはその関数が使われている場所が間違った関数名やアリティになっている</td>
</tr>
<tr data-sourcepos="209:1-209:253">
<td data-sourcepos="209:2-209:11">Function</td>
<td data-sourcepos="209:13-209:98">function somefunction/1 undefined</td>
<td data-sourcepos="209:100-209:252">関数が存在していない: <code> -export</code> 属性内あるいは関数を宣言するときに間違った関数名やアリティを書いてる</td>
</tr>
<tr data-sourcepos="210:1-210:234">
<td data-sourcepos="210:2-210:11">Function</td>
<td data-sourcepos="210:13-210:98">head mismatch</td>
<td data-sourcepos="210:100-210:233">関数定義を他の関数での先頭の節の間に差し込んでいる</td>
</tr>
<tr data-sourcepos="211:1-211:257">
<td data-sourcepos="211:2-211:11">Syntax</td>
<td data-sourcepos="211:13-211:98">syntax error before: 'SomeCharacterOrWord'</td>
<td data-sourcepos="211:100-211:256">Ex: 括弧の閉じ忘れやタプルやおかしな式接尾辞、予約語・おかしな文字コードにエンコードされたUnicode文字の使用</td>
</tr>
<tr data-sourcepos="212:1-212:216">
<td data-sourcepos="212:2-212:11">Syntax</td>
<td data-sourcepos="212:13-212:98">syntax error before:</td>
<td data-sourcepos="212:100-212:215">行末がおかしい</td>
</tr>
<tr data-sourcepos="213:1-213:209">
<td data-sourcepos="213:2-213:11">Variable</td>
<td data-sourcepos="213:13-213:98">Warning: this expression will fail with a 'badarith' exception</td>
<td data-sourcepos="213:100-213:208">Ex: <code>llama + 5</code>
</td>
</tr>
<tr data-sourcepos="214:1-214:261">
<td data-sourcepos="214:2-214:11">Variable</td>
<td data-sourcepos="214:13-214:98">Warning: a term is constructed, but never used</td>
<td data-sourcepos="214:100-214:260">関数の中に、リス作成、タプル宣言、どんな変数にも束縛されていない無名関数・自身を返す無名関数の宣言がある</td>
</tr>
<tr data-sourcepos="215:1-215:222">
<td data-sourcepos="215:2-215:11">Variable</td>
<td data-sourcepos="215:13-215:98">Warning: variable 'Var' is unused</td>
<td data-sourcepos="215:100-215:221">使わない変数を宣言している</td>
</tr>
<tr data-sourcepos="216:1-216:239">
<td data-sourcepos="216:2-216:11">Variable</td>
<td data-sourcepos="216:13-216:98">Warning: this clause cannot match because a previous clause at line 4 always matches</td>
<td data-sourcepos="216:100-216:238">モジュール内で定義された関数が <code>catch-all</code> 節のあとに特定の節を持っている</td>
</tr>
<tr data-sourcepos="217:1-217:233">
<td data-sourcepos="217:2-217:11">Variable</td>
<td data-sourcepos="217:13-217:98">variable 'A' unsafe in 'case'</td>
<td data-sourcepos="217:100-217:232">
<code>case ... of</code> の中で宣言されている変数を、その外側で使っている</td>
</tr>
</tbody>
</table>
<h4 data-sourcepos="219:1-219:47">ランタイムエラー (exception error)</h4>
<table data-sourcepos="220:1-230:159">
<thead>
<tr data-sourcepos="220:1-220:152">
<th data-sourcepos="220:2-220:18">type</th>
<th data-sourcepos="220:20-220:80">error</th>
<th data-sourcepos="220:82-220:151">description</th>
</tr>
</thead>
<tbody>
<tr data-sourcepos="222:1-222:186">
<td data-sourcepos="222:2-222:18">function clause</td>
<td data-sourcepos="222:20-222:80">no function clause matching somefunction</td>
<td data-sourcepos="222:82-222:185">関数内のすべてのガード節で失敗、あるいはすべてのパターンマッチで失敗</td>
</tr>
<tr data-sourcepos="223:1-223:179">
<td data-sourcepos="223:2-223:18">case clause</td>
<td data-sourcepos="223:20-223:80">no case clause matching 'value'</td>
<td data-sourcepos="223:82-223:178">条件の書き忘れ、誤った種類のデータ送信、 <code>catch-all</code> 節が必要な場合</td>
</tr>
<tr data-sourcepos="224:1-224:167">
<td data-sourcepos="224:2-224:18">if clause</td>
<td data-sourcepos="224:20-224:80">no true branch found when evaluating an if expression</td>
<td data-sourcepos="224:82-224:166">条件の書き忘れ、 <code>catch-all</code> 節が必要な場合</td>
</tr>
<tr data-sourcepos="225:1-225:172">
<td data-sourcepos="225:2-225:18">badmatch</td>
<td data-sourcepos="225:20-225:80">no match of right hand side value</td>
<td data-sourcepos="225:82-225:171">無理なパターンマッチ、変数束縛の繰り返し</td>
</tr>
<tr data-sourcepos="226:1-226:162">
<td data-sourcepos="226:2-226:18">badarg</td>
<td data-sourcepos="226:20-226:80">bad argument</td>
<td data-sourcepos="226:82-226:161">誤った引数の呼び出し</td>
</tr>
<tr data-sourcepos="227:1-227:162">
<td data-sourcepos="227:2-227:18">undef</td>
<td data-sourcepos="227:20-227:80">undefined function somefunction</td>
<td data-sourcepos="227:82-227:161">未定義関数の呼び出し</td>
</tr>
<tr data-sourcepos="228:1-228:159">
<td data-sourcepos="228:2-228:18">badarith</td>
<td data-sourcepos="228:20-228:80">bad argument in an arithmetic expression</td>
<td data-sourcepos="228:82-228:158">誤った算術演算</td>
</tr>
<tr data-sourcepos="229:1-229:167">
<td data-sourcepos="229:2-229:18">badfun</td>
<td data-sourcepos="229:20-229:80">bad function</td>
<td data-sourcepos="229:82-229:166">変数を関数として呼び出した場合</td>
</tr>
<tr data-sourcepos="230:1-230:159">
<td data-sourcepos="230:2-230:18">badarity</td>
<td data-sourcepos="230:20-230:80">interpreted function with arity 1 called with two arguments</td>
<td data-sourcepos="230:82-230:158">誤ったアリティ</td>
</tr>
</tbody>
</table>
<h4 data-sourcepos="232:1-232:17">例外処理</h4>
<div class="code-block" data-sourcepos="233:1-238:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">1</span><span class="o">&gt;</span> <span class="nn">erlang</span><span class="p">:</span><span class="nf">error</span><span class="p">(</span><span class="n">badarith</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span> <span class="n">in</span> <span class="n">an</span> <span class="n">arithmetic</span> <span class="n">expression</span>
<span class="mi">2</span><span class="o">&gt;</span> <span class="nn">erlang</span><span class="p">:</span><span class="nf">error</span><span class="p">(</span><span class="n">custom_error</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">custom_error</span>
</code></pre></div>
</div>
<h3 data-sourcepos="240:1-240:21" id="3-3-4" name="3-3-4">
<a class="anchor" id="11.2 レコード" name="11.2%20%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89" href="#11.2%20%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89" data-position="3-3-4"><i class="fa fa-link"></i><span class="hidden" data-text="11.2 レコード"> &gt; 11.2 レコード</span></a>11.2 レコード</h3>
<div class="code-block" data-sourcepos="241:1-243:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">robot</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="n">industrial</span><span class="p">,</span> <span class="n">hobbies</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="p">[]}).</span>
</code></pre></div>
</div>
<div class="code-block" data-sourcepos="245:1-259:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">5</span><span class="o">&gt;</span> <span class="nv">Crusher</span> <span class="o">=</span> <span class="nl">#robot</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"Crusher"</span><span class="p">,</span> <span class="n">hobbies</span><span class="o">=</span><span class="p">[</span><span class="s">"Crushing people"</span><span class="p">,</span><span class="s">"petting cats"</span><span class="p">]}.</span>
<span class="nl">#robot</span><span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Crusher"</span><span class="p">,</span><span class="n">type</span> <span class="o">=</span> <span class="n">industrial</span><span class="p">,</span>
       <span class="n">hobbies</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Crushing people"</span><span class="p">,</span><span class="s">"petting cats"</span><span class="p">],</span>
       <span class="n">details</span> <span class="o">=</span> <span class="p">[]}</span>
<span class="mi">6</span><span class="o">&gt;</span> <span class="nv">Crusher</span><span class="nl">#robot.hobbies</span><span class="p">.</span> <span class="c">%% 参照
</span><span class="p">[</span><span class="s">"Crushing people"</span><span class="p">,</span><span class="s">"petting cats"</span><span class="p">]</span>
<span class="mi">7</span><span class="o">&gt;</span> <span class="nv">NestedBot</span> <span class="o">=</span> <span class="nl">#robot</span><span class="p">{</span><span class="n">details</span><span class="o">=</span><span class="nl">#robot</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"erNest"</span><span class="p">}}.</span>
<span class="nl">#robot</span><span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">type</span> <span class="o">=</span> <span class="n">industrial</span><span class="p">,</span>
       <span class="n">hobbies</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span>
       <span class="n">details</span> <span class="o">=</span> <span class="nl">#robot</span><span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s">"erNest"</span><span class="p">,</span><span class="n">type</span> <span class="o">=</span> <span class="n">industrial</span><span class="p">,</span>
       <span class="n">hobbies</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">details</span> <span class="o">=</span> <span class="p">[]}}</span>
<span class="mi">8</span><span class="o">&gt;</span> <span class="nv">NestedBot</span><span class="nl">#robot.details#robot.name</span><span class="p">.</span> <span class="c">%% ネスト参照
</span><span class="s">"erNest"</span>
</code></pre></div>
</div>
<h3 data-sourcepos="261:1-261:37" id="3-3-5" name="3-3-5">
<a class="anchor" id="11.3. キーバリューストア" name="11.3.%20%E3%82%AD%E3%83%BC%E3%83%90%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%88%E3%82%A2" href="#11.3.%20%E3%82%AD%E3%83%BC%E3%83%90%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%88%E3%82%A2" data-position="3-3-5"><i class="fa fa-link"></i><span class="hidden" data-text="11.3. キーバリューストア"> &gt; 11.3. キーバリューストア</span></a>11.3. キーバリューストア</h3>
<p data-sourcepos="262:1-262:79">キーバリューストアは4つのモジュールで提供されている。</p>
<table data-sourcepos="264:1-269:336">
<thead>
<tr data-sourcepos="264:1-264:258">
<th data-sourcepos="264:2-264:13">module</th>
<th data-sourcepos="264:15-264:98">methods</th>
<th data-sourcepos="264:100-264:257">description</th>
</tr>
</thead>
<tbody>
<tr data-sourcepos="266:1-266:272">
<td data-sourcepos="266:2-266:13"><code>proplist</code></td>
<td data-sourcepos="266:15-266:98">
<code>get_value/2</code>, <code>get_all_values/2</code>, <code>lookup/2</code>, <code>lookup_all/2</code>
</td>
<td data-sourcepos="266:100-266:271">少量データ向け, 緩いデータ構造</td>
</tr>
<tr data-sourcepos="267:1-267:272">
<td data-sourcepos="267:2-267:13"><code>orddict</code></td>
<td data-sourcepos="267:15-267:98">
<code>store/3</code>, <code>find/2</code>, <code>fetch/2</code>, <code>erase/2</code>
</td>
<td data-sourcepos="267:100-267:271">少量データ向け（75要素くらい）</td>
</tr>
<tr data-sourcepos="268:1-268:277">
<td data-sourcepos="268:2-268:13"><code>dict</code></td>
<td data-sourcepos="268:15-268:98">
<code>store/3</code>, <code>find/2</code>, <code>fetch/2</code>, <code>erase/2</code>, <code>map/2</code>, <code>fold/2</code>
</td>
<td data-sourcepos="268:100-268:276">大量データ向け、<code>ordict</code> と同じインターフェイス</td>
</tr>
<tr data-sourcepos="269:1-269:336">
<td data-sourcepos="269:2-269:13"><code>gb_trees</code></td>
<td data-sourcepos="269:15-269:98">
<code>enter/2</code>, <code>lookup/2</code>, <code>delete_any/2</code>, <code>insert/3</code>, <code>get/2</code>, <code>update/3</code>, <code>delete/2</code>
</td>
<td data-sourcepos="269:100-269:335">大量データ向け、データ構造の入出力がわかるスマートモードとわからないネイティブモードがあるため状況に応じて安全性とパフォーマンスのバランスを取ることができる</td>
</tr>
</tbody>
</table>
<h3 data-sourcepos="271:1-271:18" id="3-3-6" name="3-3-6">
<a class="anchor" id="11.5.セット" name="11.5.%E3%82%BB%E3%83%83%E3%83%88" href="#11.5.%E3%82%BB%E3%83%83%E3%83%88" data-position="3-3-6"><i class="fa fa-link"></i><span class="hidden" data-text="11.5.セット"> &gt; 11.5.セット</span></a>11.5.セット</h3>
<p data-sourcepos="272:1-272:73">セット（集合）は4つのモジュールで提供されている。</p>
<table data-sourcepos="274:1-279:255">
<thead>
<tr data-sourcepos="274:1-274:223">
<th data-sourcepos="274:2-274:12">module</th>
<th data-sourcepos="274:14-274:101">methods</th>
<th data-sourcepos="274:103-274:222">description</th>
</tr>
</thead>
<tbody>
<tr data-sourcepos="276:1-276:240">
<td data-sourcepos="276:2-276:12"><code>ordsets</code></td>
<td data-sourcepos="276:14-276:101">
<code>new/0</code>, <code>is_element/2</code>, <code>add_element/2</code>, <code>del_element/2</code>, <code>union/1</code>, <code>intersection/1</code>
</td>
<td data-sourcepos="276:103-276:239">少量セット向け、遅いが可読性が高い</td>
</tr>
<tr data-sourcepos="277:1-277:242">
<td data-sourcepos="277:2-277:12"><code>sets</code></td>
<td data-sourcepos="277:14-277:101">-</td>
<td data-sourcepos="277:103-277:241">大量セット向け、<code>ordsets</code> と同じインターフェイス</td>
</tr>
<tr data-sourcepos="278:1-278:282">
<td data-sourcepos="278:2-278:12"><code>gb_sets</code></td>
<td data-sourcepos="278:14-278:101">-</td>
<td data-sourcepos="278:103-278:281">大量セット向け、スマートモード・ネイティブモードがあるため状況に応じ安全性とパフォーマンスのバランスを取ることができる</td>
</tr>
<tr data-sourcepos="279:1-279:255">
<td data-sourcepos="279:2-279:12"><code>sofs</code></td>
<td data-sourcepos="279:14-279:101">-</td>
<td data-sourcepos="279:103-279:254">一意な要素の集合だけではなく、数学的な概念として集合が必要な場合</td>
</tr>
</tbody>
</table>
<h3 data-sourcepos="281:1-281:25" id="3-3-7" name="3-3-7">
<a class="anchor" id="11.6. 有効グラフ" name="11.6.%20%E6%9C%89%E5%8A%B9%E3%82%B0%E3%83%A9%E3%83%95" href="#11.6.%20%E6%9C%89%E5%8A%B9%E3%82%B0%E3%83%A9%E3%83%95" data-position="3-3-7"><i class="fa fa-link"></i><span class="hidden" data-text="11.6. 有効グラフ"> &gt; 11.6. 有効グラフ</span></a>11.6. 有効グラフ</h3>
<p data-sourcepos="282:1-282:67">有効グラフは2つのモジュールで提供されている。</p>
<table data-sourcepos="284:1-287:87">
<thead>
<tr data-sourcepos="284:1-284:66">
<th data-sourcepos="284:2-284:18">module</th>
<th data-sourcepos="284:20-284:65">description</th>
</tr>
</thead>
<tbody>
<tr data-sourcepos="286:1-286:88">
<td data-sourcepos="286:2-286:18"><code>digraph</code></td>
<td data-sourcepos="286:20-286:87">生成、変更、エッジ・辺の操作、経路・周の検索</td>
</tr>
<tr data-sourcepos="287:1-287:87">
<td data-sourcepos="287:2-287:18"><code>digraph_utils</code></td>
<td data-sourcepos="287:20-287:86">グラフの誘導、木のテスト、隣接ノードの検索</td>
</tr>
</tbody>
</table>
<h3 data-sourcepos="289:1-289:19" id="3-3-8" name="3-3-8">
<a class="anchor" id="11.7. キュー" name="11.7.%20%E3%82%AD%E3%83%A5%E3%83%BC" href="#11.7.%20%E3%82%AD%E3%83%A5%E3%83%BC" data-position="3-3-8"><i class="fa fa-link"></i><span class="hidden" data-text="11.7. キュー"> &gt; 11.7. キュー</span></a>11.7. キュー</h3>
<p data-sourcepos="290:1-290:23"><code>queue</code> モジュール</p>
<table data-sourcepos="292:1-296:88">
<thead>
<tr data-sourcepos="292:1-292:75">
<th data-sourcepos="292:2-292:15">api</th>
<th data-sourcepos="292:17-292:45">methods</th>
<th data-sourcepos="292:47-292:74">description</th>
</tr>
</thead>
<tbody>
<tr data-sourcepos="294:1-294:84">
<td data-sourcepos="294:2-294:15">Original API</td>
<td data-sourcepos="294:17-294:45">
<code>new/0</code>, <code>in/2</code>, <code>out/1</code>
</td>
<td data-sourcepos="294:47-294:83">キューの作成・削除</td>
</tr>
<tr data-sourcepos="295:1-295:84">
<td data-sourcepos="295:2-295:15">Extended API</td>
<td data-sourcepos="295:17-295:45">
<code>get/1</code>, <code>peek/1</code>, <code>drop/1</code>
</td>
<td data-sourcepos="295:47-295:83">キューの中身の確認</td>
</tr>
<tr data-sourcepos="296:1-296:88">
<td data-sourcepos="296:2-296:15">Okasaki API</td>
<td data-sourcepos="296:17-296:45">-</td>
<td data-sourcepos="296:47-296:87">関数型データ構造にもとづく</td>
</tr>
</tbody>
</table>
<h2 data-sourcepos="298:1-298:30" id="3-4-0" name="3-4-0">
<a class="anchor" id="12-13 並列性について" name="12-13%20%E4%B8%A6%E5%88%97%E6%80%A7%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" href="#12-13%20%E4%B8%A6%E5%88%97%E6%80%A7%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" data-position="3-4-0"><i class="fa fa-link"></i><span class="hidden" data-text="12-13 並列性について"> &gt; 12-13 並列性について</span></a>12-13 並列性について</h2>
<h3 data-sourcepos="299:1-299:30" id="3-4-1" name="3-4-1">
<a class="anchor" id="12.2.1. 並列性の概念" name="12.2.1.%20%E4%B8%A6%E5%88%97%E6%80%A7%E3%81%AE%E6%A6%82%E5%BF%B5" href="#12.2.1.%20%E4%B8%A6%E5%88%97%E6%80%A7%E3%81%AE%E6%A6%82%E5%BF%B5" data-position="3-4-1"><i class="fa fa-link"></i><span class="hidden" data-text="12.2.1. 並列性の概念"> &gt; 12.2.1. 並列性の概念</span></a>12.2.1. 並列性の概念</h3>
<ul data-sourcepos="300:1-323:0">
<li data-sourcepos="300:1-305:13">Erlangの開発の背景
<ul data-sourcepos="301:5-305:13">
<li data-sourcepos="301:5-302:139">大抵の人は並行ソフトウェアを書くことにうんざりしてる
<ul data-sourcepos="302:9-302:139">
<li data-sourcepos="302:9-302:139">並行の解決策のほとんどがロックやミューテックスと呼ばれる小さな理論を扱うことに終始する</li>
</ul>
</li>
<li data-sourcepos="303:5-305:13">通信業界では並行性・並列性をめざす文化があった
<ul data-sourcepos="304:9-305:13">
<li data-sourcepos="304:9-304:14">PLEX</li>
<li data-sourcepos="305:9-305:13">AXE</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="306:1-317:59">満たすべき要求
<ul data-sourcepos="307:5-317:59">
<li data-sourcepos="307:5-311:65">スケーラビリティ
<ul data-sourcepos="308:9-311:65">
<li data-sourcepos="308:9-308:40">リニアスケールが可能</li>
<li data-sourcepos="309:9-311:65">実装方針
<ul data-sourcepos="310:13-311:65">
<li data-sourcepos="310:13-310:35">小さなプロセス</li>
<li data-sourcepos="311:13-311:65">プロセスに共有メモリの使用を禁じる</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="312:5-317:59">フォールトレランス (交換機上の何千ものユーザをサポートすること)
<ul data-sourcepos="313:9-317:59">
<li data-sourcepos="313:9-313:34">クラッシュが可能</li>
<li data-sourcepos="314:9-314:52">クラッシュ後リスタートが可能</li>
<li data-sourcepos="315:9-317:59">実装方針
<ul data-sourcepos="316:13-317:59">
<li data-sourcepos="316:13-316:20">分散</li>
<li data-sourcepos="317:13-317:59">非同期メッセージングパッシング</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="318:1-323:0">実装
<ul data-sourcepos="319:5-323:0">
<li data-sourcepos="319:5-323:0">並列・並行に最適化されたVM
<ul data-sourcepos="320:9-323:0">
<li data-sourcepos="320:9-320:93">コア1つに対してスケジューラとして1つのスケジューラを起動</li>
<li data-sourcepos="321:9-321:118">実行キューにあるタスクが多すぎた場合、他スレッドのスケジューラに移される</li>
<li data-sourcepos="322:9-323:0">過負荷なプロセスに対して送れるメッセージ量を制御</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="324:1-324:67" id="3-4-2" name="3-4-2">
<a class="anchor" id="12.3. すべてが線形にスケールするわけではない" name="12.3.%20%E3%81%99%E3%81%B9%E3%81%A6%E3%81%8C%E7%B7%9A%E5%BD%A2%E3%81%AB%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%82%8F%E3%81%91%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84" href="#12.3.%20%E3%81%99%E3%81%B9%E3%81%A6%E3%81%8C%E7%B7%9A%E5%BD%A2%E3%81%AB%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%82%8F%E3%81%91%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84" data-position="3-4-2"><i class="fa fa-link"></i><span class="hidden" data-text="12.3. すべてが線形にスケールするわけではない"> &gt; 12.3. すべてが線形にスケールするわけではない</span></a>12.3. すべてが線形にスケールするわけではない</h3>
<ul data-sourcepos="325:1-328:0">
<li data-sourcepos="325:1-328:0">アムダールの法則
<ul data-sourcepos="326:5-328:0">
<li data-sourcepos="326:5-326:58">50%並行にしたコードは2倍ほど速くなる</li>
<li data-sourcepos="327:5-328:0">95%並行にしたコードは20倍ほど速くなる</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="329:1-329:27" id="3-5-0" name="3-5-0">
<a class="anchor" id="14 プロセス間通信" name="14%20%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1" href="#14%20%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1" data-position="3-5-0"><i class="fa fa-link"></i><span class="hidden" data-text="14 プロセス間通信"> &gt; 14 プロセス間通信</span></a>14 プロセス間通信</h2>
<ul data-sourcepos="330:1-335:0">
<li data-sourcepos="330:1-335:0">今回は2つのプロセス間通信のプロセス管理について
<ul data-sourcepos="331:5-335:0">
<li data-sourcepos="331:5-335:0">片方のプロセスがエラーになっても、もう片方のプロセスが死なないようにする
<ul data-sourcepos="332:9-335:0">
<li data-sourcepos="332:9-333:74">プロセスがエラーになったものはクラッシュさせる
<ul data-sourcepos="333:13-333:74">
<li data-sourcepos="333:13-333:74">クラッシュしたプロセスをリスタートさせる</li>
</ul>
</li>
<li data-sourcepos="334:9-335:0">また、そのクラッシュ情報をもう片方にメッセージとして送る</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="336:1-336:28" id="3-5-1" name="3-5-1">
<a class="anchor" id="エラーとプロセス" name="%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9" href="#%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9" data-position="3-5-1"><i class="fa fa-link"></i><span class="hidden" data-text="エラーとプロセス"> &gt; エラーとプロセス</span></a>エラーとプロセス</h3>
<p data-sourcepos="337:1-337:49">以下、3つの関数をつかい実装する。</p>
<ol data-sourcepos="339:1-342:0">
<li data-sourcepos="339:1-339:122">
<code>erlang:exit(Pid, Why)</code> - <code>Pid</code> に対して自分が異常終了で死んだとつたえる。自身は死なない。</li>
<li data-sourcepos="340:1-340:267">
<code>erlang:process_flag(trap_exit, Value)</code> - <code>Value</code> が true ならシステムプロセスとなり、 false ならシステムプロセスでなくなる。デフォルトは false。この関数によりクラッシュしたプロセスをリスタートさせる</li>
<li data-sourcepos="341:1-342:0">
<code>erlang:register(Atom, Pid)</code> と <code>erlang:make_ref()</code> - <code>register/2</code> で予測不可能な <code>Pid</code> を <code>Atom</code> として登録し、<code>make_ref/0</code> で生成された <code>Reference</code> をもとにメッセージ送信をおこなう。なお、ここで生成される <code>Reference</code> は同一Erlang VM上、あるいはクラスタリングしたVM上のみでユニークになる。</li>
</ol>
<div class="code-block" data-sourcepos="343:1-382:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="nf">start_critic2</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nb">spawn</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="n">restarter</span><span class="p">,</span> <span class="p">[]).</span>

<span class="nf">restarter</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nb">process_flag</span><span class="p">(</span><span class="n">trap_exit</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
    <span class="nv">Pid</span> <span class="o">=</span> <span class="nb">spawn_link</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="n">critic2</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="nb">register</span><span class="p">(</span><span class="n">critic2</span><span class="p">,</span> <span class="nv">Pid</span><span class="p">),</span>
    <span class="k">receive</span>
        <span class="p">{</span><span class="n">'EXIT'</span><span class="p">,</span> <span class="nv">Pid</span><span class="p">,</span> <span class="n">normal</span><span class="p">}</span> <span class="o">-&gt;</span>   <span class="c">% not a crash
</span>            <span class="n">ok</span><span class="p">;</span>
        <span class="p">{</span><span class="n">'EXIT'</span><span class="p">,</span> <span class="nv">Pid</span><span class="p">,</span> <span class="n">shutdown</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="c">% manual termination, not a crash
</span>            <span class="n">ok</span><span class="p">;</span>
        <span class="p">{</span><span class="n">'EXIT'</span><span class="p">,</span> <span class="nv">Pid</span><span class="p">,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
            <span class="nf">restarter</span><span class="p">()</span>
    <span class="k">end</span><span class="p">.</span>

<span class="nf">judge2</span><span class="p">(</span><span class="nv">Band</span><span class="p">,</span> <span class="nv">Album</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Ref</span> <span class="o">=</span> <span class="nf">make_ref</span><span class="p">(),</span>
    <span class="n">critic2</span> <span class="o">!</span> <span class="p">{</span><span class="nf">self</span><span class="p">(),</span> <span class="nv">Ref</span><span class="p">,</span> <span class="p">{</span><span class="nv">Band</span><span class="p">,</span> <span class="nv">Album</span><span class="p">}},</span>
    <span class="k">receive</span>
        <span class="p">{</span><span class="nv">Ref</span><span class="p">,</span> <span class="nv">Criticism</span><span class="p">}</span> <span class="o">-&gt;</span>
            <span class="nv">Criticism</span>
    <span class="k">after</span> <span class="mi">2000</span> <span class="o">-&gt;</span>
            <span class="n">timeout</span>
    <span class="k">end</span><span class="p">.</span>

<span class="nf">critic2</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">receive</span>
        <span class="p">{</span><span class="nv">From</span><span class="p">,</span> <span class="nv">Ref</span><span class="p">,</span> <span class="p">{</span><span class="s">"Rage Against the Turing Machine"</span><span class="p">,</span> <span class="s">"Unit Testify"</span><span class="p">}}</span> <span class="o">-&gt;</span>
            <span class="nv">From</span> <span class="o">!</span> <span class="p">{</span><span class="nv">Ref</span><span class="p">,</span> <span class="s">"They are great!"</span><span class="p">};</span>
        <span class="p">{</span><span class="nv">From</span><span class="p">,</span> <span class="nv">Ref</span><span class="p">,</span> <span class="p">{</span><span class="s">"System of a Downtime"</span><span class="p">,</span> <span class="s">"Memoize"</span><span class="p">}}</span> <span class="o">-&gt;</span>
            <span class="nv">From</span> <span class="o">!</span> <span class="p">{</span><span class="nv">Ref</span><span class="p">,</span> <span class="s">"They're not Johnny Crash but they're good."</span><span class="p">};</span>
        <span class="p">{</span><span class="nv">From</span><span class="p">,</span> <span class="nv">Ref</span><span class="p">,</span> <span class="p">{</span><span class="s">"Johnny Crash"</span><span class="p">,</span> <span class="s">"The Token Ring of Fire"</span><span class="p">}}</span> <span class="o">-&gt;</span>
            <span class="nv">From</span> <span class="o">!</span> <span class="p">{</span><span class="nv">Ref</span><span class="p">,</span> <span class="s">"Simply incredible."</span><span class="p">};</span>
        <span class="p">{</span><span class="nv">From</span><span class="p">,</span> <span class="nv">Ref</span><span class="p">,</span> <span class="p">{_</span><span class="nv">Band</span><span class="p">,</span> <span class="p">_</span><span class="nv">Album</span><span class="p">}}</span> <span class="o">-&gt;</span>
            <span class="nv">From</span> <span class="o">!</span> <span class="p">{</span><span class="nv">Ref</span><span class="p">,</span> <span class="s">"They are terrible!"</span><span class="p">}</span>
    <span class="k">end</span><span class="p">,</span>
    <span class="nf">critic2</span><span class="p">().</span>
</code></pre></div>
</div>
<div class="code-block" data-sourcepos="384:1-395:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">27</span><span class="o">&gt;</span> <span class="nn">functions</span><span class="p">:</span><span class="nf">start_critic2</span><span class="p">().</span>
<span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">125</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="mi">28</span><span class="o">&gt;</span> <span class="nn">functions</span><span class="p">:</span><span class="nf">judge2</span><span class="p">(</span><span class="s">"The Doors"</span><span class="p">,</span> <span class="s">"Light my Firewall"</span><span class="p">).</span>
<span class="s">"They are terrible!"</span>
<span class="mi">29</span><span class="o">&gt;</span> <span class="nb">exit</span><span class="p">(</span><span class="nb">whereis</span><span class="p">(</span><span class="n">critic2</span><span class="p">),</span> <span class="n">kill</span><span class="p">).</span>
<span class="n">true</span>
<span class="mi">30</span><span class="o">&gt;</span> <span class="nb">whereis</span><span class="p">(</span><span class="n">critic2</span><span class="p">).</span>
<span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">129</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="mi">31</span><span class="o">&gt;</span> <span class="nn">functions</span><span class="p">:</span><span class="nf">judge2</span><span class="p">(</span><span class="s">"The Doors"</span><span class="p">,</span> <span class="s">"Light my Firewall"</span><span class="p">).</span>
<span class="s">"They are terrible!"</span>
</code></pre></div>
</div>
<h2 data-sourcepos="397:1-397:45" id="3-6-0" name="3-6-0">
<a class="anchor" id="15 アプリケーションを作成する" name="15%20%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" href="#15%20%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" data-position="3-6-0"><i class="fa fa-link"></i><span class="hidden" data-text="15 アプリケーションを作成する"> &gt; 15 アプリケーションを作成する</span></a>15 アプリケーションを作成する</h2>
<h3 data-sourcepos="398:1-398:46" id="3-6-1" name="3-6-1">
<a class="anchor" id="リマインダーアプリケーション" name="%E3%83%AA%E3%83%9E%E3%82%A4%E3%83%B3%E3%83%80%E3%83%BC%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3" href="#%E3%83%AA%E3%83%9E%E3%82%A4%E3%83%B3%E3%83%80%E3%83%BC%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3" data-position="3-6-1"><i class="fa fa-link"></i><span class="hidden" data-text="リマインダーアプリケーション"> &gt; リマインダーアプリケーション</span></a>リマインダーアプリケーション</h3>
<ul data-sourcepos="399:1-478:0">
<li data-sourcepos="399:1-411:88">仕様
<ul data-sourcepos="400:5-411:88">
<li data-sourcepos="400:5-401:106">イベントを追加
<ul data-sourcepos="401:9-401:106">
<li data-sourcepos="401:9-401:106">イベントには締切り（警告する時間）、イベント名、詳細が含まれます</li>
</ul>
</li>
<li data-sourcepos="402:5-402:45">イベントの時間が来たら警告</li>
<li data-sourcepos="403:5-403:54">イベント名でイベントをキャンセル</li>
<li data-sourcepos="404:5-408:115">永続的なディスク保存先を持たない
<ul data-sourcepos="405:9-408:115">
<li data-sourcepos="405:9-407:278">注
<ul data-sourcepos="406:13-407:278">
<li data-sourcepos="406:13-406:122">これは今回見ようとしているのアーキテクチャの概念を示すのに必要ありません</li>
<li data-sourcepos="407:13-407:278">これは実際のアプリケーションを作るなら全然ダメなことですが、代わりにもし実装したくなったらその機能はどこに挿入されるかを示して、ちょっとだけその実装の手助けになる関数も示します</li>
</ul>
</li>
<li data-sourcepos="408:9-408:115">永続化保存先がないとした場合、実行中にコードを更新しなければいけません</li>
</ul>
</li>
<li data-sourcepos="409:5-411:88">ソフトウェアとのやりとりはコマンドライン経由で
<ul data-sourcepos="410:9-411:88">
<li data-sourcepos="410:9-411:88">あとでこれは拡張できる
<ul data-sourcepos="411:13-411:88">
<li data-sourcepos="411:13-411:88">たとえばGUI、Webページアクセス、IMソフト、メールなど</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="412:1-436:71">ユースケース
<ul data-sourcepos="413:5-436:71">
<li data-sourcepos="413:5-421:58">Client
<ul data-sourcepos="414:9-421:58">
<li data-sourcepos="414:9-417:68">イベントサーバをサブスクライブして、メッセージとして通知を受ける
<ul data-sourcepos="415:13-417:68">
<li data-sourcepos="415:13-415:167">こうすることで、すべてイベントサーバをサブスクライブしている多くのクライアントを設計するのが簡単になる</li>
<li data-sourcepos="416:13-417:68">各クライアントは潜在的に、前述した異なるゲートウェイとなる
<ul data-sourcepos="417:17-417:68">
<li data-sourcepos="417:17-417:68">GUI、Webページ、IMソフト、メールなど</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="418:9-418:88">サーバにイベントを詳細情報とともに追加するように依頼</li>
<li data-sourcepos="419:9-419:73">サーバにイベントをキャンセルするように依頼</li>
<li data-sourcepos="420:9-420:67">サーバを（落ちたかどうか知る為に）監視</li>
<li data-sourcepos="421:9-421:58">必要があればイベントサーバを終了</li>
</ul>
</li>
<li data-sourcepos="422:5-436:71">Event Server
<ul data-sourcepos="423:9-436:71">
<li data-sourcepos="423:9-431:74">メソッド
<ul data-sourcepos="424:13-431:74">
<li data-sourcepos="424:13-424:71">クライアントからのサブスクライブを受取</li>
<li data-sourcepos="425:13-425:98">イベントプロセスから出された通知を各サブスクライバに転送</li>
<li data-sourcepos="426:13-427:55">イベントを追加するためにメッセージを受取
<ul data-sourcepos="427:17-427:55">
<li data-sourcepos="427:17-427:55">必要なX, Y, Zプロセスを起動</li>
</ul>
</li>
<li data-sourcepos="428:13-429:51">イベントキャンセルのメッセージを受取
<ul data-sourcepos="429:17-429:51">
<li data-sourcepos="429:17-429:51">イベントプロセスを殺す</li>
</ul>
</li>
<li data-sourcepos="430:13-430:53">クライアントから終了できる</li>
<li data-sourcepos="431:13-431:74">シェルから自分自身のコードを再読込出来る</li>
</ul>
</li>
<li data-sourcepos="432:9-436:71">Process X, Y, Z
<ul data-sourcepos="433:13-436:71">
<li data-sourcepos="433:13-434:99">発報が待たれる通知を表す
<ul data-sourcepos="434:17-434:99">
<li data-sourcepos="434:17-434:99">天気にはイベントサーバにリンクされたタイマーに過ぎない</li>
</ul>
</li>
<li data-sourcepos="435:13-435:80">時間が来たらイベントサーバにメッセージを送る</li>
<li data-sourcepos="436:13-436:71">キャンセルのメッセージを受け取って死ぬ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="437:1-478:0">実装
<ul data-sourcepos="438:5-478:0">
<li data-sourcepos="438:5-478:0">ディレクトリ構成
<ul data-sourcepos="439:9-478:0">
<li data-sourcepos="439:9-439:17"><code>ebin/</code></li>
<li data-sourcepos="440:9-440:20"><code>include/</code></li>
<li data-sourcepos="441:9-441:17"><code>priv/</code></li>
<li data-sourcepos="442:9-470:24">
<code>src/</code><ul data-sourcepos="443:13-470:24">
<li data-sourcepos="443:13-450:24">
<code>event.erl</code> - event module
<ul data-sourcepos="444:17-450:24">
<li data-sourcepos="444:17-444:24">loop/1</li>
<li data-sourcepos="445:17-445:29">normalize/1</li>
<li data-sourcepos="446:17-446:25">start/2</li>
<li data-sourcepos="447:17-447:30">start_link/2</li>
<li data-sourcepos="448:17-448:26">cancel/1</li>
<li data-sourcepos="449:17-449:30">time_to_go/1</li>
<li data-sourcepos="450:17-450:24">init/3</li>
</ul>
</li>
<li data-sourcepos="451:13-465:24">
<code>evserv.erl</code> - event server
<ul data-sourcepos="452:17-465:24">
<li data-sourcepos="452:17-452:24">loop/1</li>
<li data-sourcepos="453:17-453:34">valid_datetime/1</li>
<li data-sourcepos="454:17-454:30">valid_time/1</li>
<li data-sourcepos="455:17-455:30">valid_time/3</li>
<li data-sourcepos="456:17-456:35">send_to_clients/2</li>
<li data-sourcepos="457:17-457:25">start/0</li>
<li data-sourcepos="458:17-458:30">start_link/0</li>
<li data-sourcepos="459:17-459:29">terminate/0</li>
<li data-sourcepos="460:17-460:29">subscribe/1</li>
<li data-sourcepos="461:17-461:29">add_event/3</li>
<li data-sourcepos="462:17-462:30">add_event2/3</li>
<li data-sourcepos="463:17-463:26">cancel/1</li>
<li data-sourcepos="464:17-464:26">listen/1</li>
<li data-sourcepos="465:17-465:24">init/0</li>
</ul>
</li>
<li data-sourcepos="466:13-470:24">
<code>sup.erl</code> - supervisor
<ul data-sourcepos="467:17-470:24">
<li data-sourcepos="467:17-467:25">start/2</li>
<li data-sourcepos="468:17-468:30">start_link/2</li>
<li data-sourcepos="469:17-469:24">init/1</li>
<li data-sourcepos="470:17-470:24">loop/1</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="471:9-478:0">
<code>Emakefile</code><div class="code-block" data-sourcepos="472:13-477:15"><div class="highlight"><pre class="highlight plaintext"><code>{'src/*', [debug_info,
           {i, "src"},
           {i, "include"},
           {outdir, "ebin"}]}.
</code></pre></div></div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="code-block" data-sourcepos="479:1-492:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>sh</div>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>erl <span class="nt">-make</span> <span class="o">&amp;&amp;</span> erl <span class="nt">-pa</span> ebin/
Erlang/OTP 19 <span class="o">[</span>erts-8.1] <span class="o">[</span><span class="nb">source</span><span class="o">]</span> <span class="o">[</span>64-bit] <span class="o">[</span>smp:2:2] <span class="o">[</span>async-threads:10] <span class="o">[</span>kernel-poll:false]

Eshell V8.1  <span class="o">(</span>abort with ^G<span class="o">)</span>
1&gt; evserv:start<span class="o">()</span><span class="nb">.</span>
&lt;0.59.0&gt;
2&gt; evserv:subscribe<span class="o">(</span>self<span class="o">())</span><span class="nb">.</span>
<span class="o">{</span>ok,#Ref&lt;0.0.2.84&gt;<span class="o">}</span>
3&gt; evserv:add_event<span class="o">(</span><span class="s2">"Hey there3"</span>, <span class="s2">"test"</span>, <span class="o">{</span> <span class="o">{</span>2017, 7, 9<span class="o">}</span>, <span class="o">{</span>1, 23, 59<span class="o">}</span> <span class="o">})</span><span class="nb">.</span>
ok
4&gt; evserv:listen<span class="o">(</span>2000<span class="o">)</span><span class="nb">.</span>
<span class="o">[{</span><span class="k">done</span>,<span class="s2">"Hey there3"</span>,<span class="s2">"test"</span><span class="o">}]</span>
</code></pre></div>
</div>
<h3 data-sourcepos="494:1-494:8" id="3-6-2" name="3-6-2">
<a class="anchor" id="TIPS" name="TIPS" href="#TIPS" data-position="3-6-2"><i class="fa fa-link"></i><span class="hidden" data-text="TIPS"> &gt; TIPS</span></a>TIPS</h3>
<ul data-sourcepos="495:1-496:0">
<li data-sourcepos="495:1-496:0">Erlangのタイムアウト値はミリ秒でおよそ50日に制限されている</li>
</ul>
<h2 data-sourcepos="497:1-497:9" id="3-7-0" name="3-7-0">
<a class="anchor" id="16 OTP" name="16%20OTP" href="#16%20OTP" data-position="3-7-0"><i class="fa fa-link"></i><span class="hidden" data-text="16 OTP"> &gt; 16 OTP</span></a>16 OTP</h2>
<h3 data-sourcepos="498:1-498:22" id="3-7-1" name="3-7-1">
<a class="anchor" id="OTPとはなにか" name="OTP%E3%81%A8%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B" href="#OTP%E3%81%A8%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B" data-position="3-7-1"><i class="fa fa-link"></i><span class="hidden" data-text="OTPとはなにか"> &gt; OTPとはなにか</span></a>OTPとはなにか</h3>
<ul data-sourcepos="499:1-519:0">
<li data-sourcepos="499:1-501:21">Erlangの特徴
<ul data-sourcepos="500:5-501:21">
<li data-sourcepos="500:5-500:21">並列・分散</li>
<li data-sourcepos="501:5-501:21">エラー処理</li>
</ul>
</li>
<li data-sourcepos="502:1-506:21">組込関数
<ul data-sourcepos="503:5-506:21">
<li data-sourcepos="503:5-503:15">リンク</li>
<li data-sourcepos="504:5-504:18">モニター</li>
<li data-sourcepos="505:5-505:24">タイムアウト</li>
<li data-sourcepos="506:5-506:21">終了の補足</li>
</ul>
</li>
<li data-sourcepos="507:1-519:0">OTP
<ul data-sourcepos="508:5-519:0">
<li data-sourcepos="508:5-514:20">下記のようなバグになりやすい箇所をモジュールとして吸収
<ul data-sourcepos="509:9-514:20">
<li data-sourcepos="509:9-509:31">プロセスの順番</li>
<li data-sourcepos="510:9-511:71">競合条件をどのように避けるか
<ul data-sourcepos="511:13-511:71">
<li data-sourcepos="511:13-511:71">プロセスはいつでも死ぬ可能性があること</li>
</ul>
</li>
<li data-sourcepos="512:9-512:46">ホットコードローディング</li>
<li data-sourcepos="513:9-513:34">名前付きプロセス</li>
<li data-sourcepos="514:9-514:20">Supervisor</li>
</ul>
</li>
<li data-sourcepos="515:5-519:0">Pros
<ul data-sourcepos="516:9-519:0">
<li data-sourcepos="516:9-516:70">バグを解決するための時間を大幅に減らせる</li>
<li data-sourcepos="517:9-517:64">個々のモジュールのテストが行いやすい</li>
<li data-sourcepos="518:9-519:0">個々のモジュールの最適化が利用者全員の恩恵となる</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="520:1-520:16" id="3-8-0" name="3-8-0">
<a class="anchor" id="17 gen_server" name="17%20gen_server" href="#17%20gen_server" data-position="3-8-0"><i class="fa fa-link"></i><span class="hidden" data-text="17 gen_server"> &gt; 17 gen_server</span></a>17 gen_server</h2>
<p data-sourcepos="521:1-521:244">今回はよくつかわれるビヘイビア <code>gen_server</code> 。この汎用化によって、メンテナンス、コードの単純化、テストの簡易化へとつながる。下記に <code>gen_server</code> のコールバックの概要を記す。</p>
<h3 data-sourcepos="523:1-523:34" id="3-8-1" name="3-8-1">
<a class="anchor" id="クライアントとサーバ" name="%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%A8%E3%82%B5%E3%83%BC%E3%83%90" href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%A8%E3%82%B5%E3%83%BC%E3%83%90" data-position="3-8-1"><i class="fa fa-link"></i><span class="hidden" data-text="クライアントとサーバ"> &gt; クライアントとサーバ</span></a>クライアントとサーバ</h3>
<ul data-sourcepos="524:1-583:0">
<li data-sourcepos="524:1-583:0">gen_server
<ul data-sourcepos="525:5-583:0">
<li data-sourcepos="525:5-531:18">init/1
<ul data-sourcepos="526:9-531:18">
<li data-sourcepos="526:9-531:18">Return
<ul data-sourcepos="527:11-531:18">
<li data-sourcepos="527:11-527:23">{ok, State}</li>
<li data-sourcepos="528:11-528:32">{ok, State, TimeOut}</li>
<li data-sourcepos="529:11-529:34">{ok, State, hibernate}</li>
<li data-sourcepos="530:11-530:26">{stop, Reason}</li>
<li data-sourcepos="531:11-531:18">ignore</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="532:5-543:38">handle_call/3
<ul data-sourcepos="533:9-543:38">
<li data-sourcepos="533:9-534:34">Params
<ul data-sourcepos="534:13-534:34">
<li data-sourcepos="534:13-534:34">Request, From, State</li>
</ul>
</li>
<li data-sourcepos="535:9-543:38">Return
<ul data-sourcepos="536:13-543:38">
<li data-sourcepos="536:13-536:38">{reply, Reply, NewState}</li>
<li data-sourcepos="537:13-537:47">{reply, Reply, NewState, Timeout}</li>
<li data-sourcepos="538:13-538:49">{reply, Reply, NewState, hibernate}</li>
<li data-sourcepos="539:13-539:33">{noreply, NewState}</li>
<li data-sourcepos="540:13-540:42">{noreply, NewState, Timeout}</li>
<li data-sourcepos="541:13-541:44">{noreply, NewState, hibernate}</li>
<li data-sourcepos="542:13-542:45">{stop, Reason, Reply, NewState}</li>
<li data-sourcepos="543:13-543:38">{stop, Reason, NewState}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="544:5-551:38">handle_cast/2
<ul data-sourcepos="545:9-551:38">
<li data-sourcepos="545:9-546:28">Params
<ul data-sourcepos="546:13-546:28">
<li data-sourcepos="546:13-546:28">Message, State</li>
</ul>
</li>
<li data-sourcepos="547:9-551:38">Return
<ul data-sourcepos="548:13-551:38">
<li data-sourcepos="548:13-548:33">{noreply, NewState}</li>
<li data-sourcepos="549:13-549:42">{noreply, NewState, Timeout}</li>
<li data-sourcepos="550:13-550:44">{noreply, NewState, hibernate}</li>
<li data-sourcepos="551:13-551:38">{stop, Reason, NewState}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="552:5-564:38">handle_info/2
<ul data-sourcepos="553:9-564:38">
<li data-sourcepos="553:9-557:33">Callback case
<ul data-sourcepos="554:13-557:33">
<li data-sourcepos="554:13-554:31">bang operator (!)</li>
<li data-sourcepos="555:13-555:21">TimeOut</li>
<li data-sourcepos="556:13-556:32">モニター通知</li>
<li data-sourcepos="557:13-557:33">'EXIT' シグナル</li>
</ul>
</li>
<li data-sourcepos="558:9-559:28">Params
<ul data-sourcepos="559:13-559:28">
<li data-sourcepos="559:13-559:28">Message, State</li>
</ul>
</li>
<li data-sourcepos="560:9-564:38">Return
<ul data-sourcepos="561:13-564:38">
<li data-sourcepos="561:13-561:33">{noreply, NewState}</li>
<li data-sourcepos="562:13-562:42">{noreply, NewState, Timeout}</li>
<li data-sourcepos="563:13-563:44">{noreply, NewState, hibernate}</li>
<li data-sourcepos="564:13-564:38">{stop, Reason, NewState}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="565:5-575:54">terminate/2
<ul data-sourcepos="566:9-575:54">
<li data-sourcepos="566:9-570:78">Callback case
<ul data-sourcepos="567:13-570:78">
<li data-sourcepos="567:13-569:49">handle_* 関数の返値
<ul data-sourcepos="568:17-569:49">
<li data-sourcepos="568:17-568:42">{stop, Reason, NewState}</li>
<li data-sourcepos="569:17-569:49">{stop, Reason, Reply, NewState}</li>
</ul>
</li>
<li data-sourcepos="570:13-570:78">親が死んで、gen_serverが終了を補足していた場合</li>
</ul>
</li>
<li data-sourcepos="571:9-572:27">Params
<ul data-sourcepos="572:13-572:27">
<li data-sourcepos="572:13-572:27">Reason, State</li>
</ul>
</li>
<li data-sourcepos="573:9-575:54">Return
<ul data-sourcepos="574:13-575:54">
<li data-sourcepos="574:13-574:32">
<code>init/1</code> の反対</li>
<li data-sourcepos="575:13-575:54">VMがETS (erlang term storage) を削除</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="576:5-583:0">code_change/3
<ul data-sourcepos="577:9-583:0">
<li data-sourcepos="577:9-583:0">Params
<ul data-sourcepos="578:13-583:0">
<li data-sourcepos="578:13-579:33">PreviousVersion
<ul data-sourcepos="579:17-579:33">
<li data-sourcepos="579:17-579:33">{down, Version}</li>
</ul>
</li>
<li data-sourcepos="580:13-581:32">State
<ul data-sourcepos="581:17-581:32">
<li data-sourcepos="581:17-581:32">{ok, NewState}</li>
</ul>
</li>
<li data-sourcepos="582:13-583:0">Extra</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="584:1-584:13" id="3-9-0" name="3-9-0">
<a class="anchor" id="18 gen_fsm" name="18%20gen_fsm" href="#18%20gen_fsm" data-position="3-9-0"><i class="fa fa-link"></i><span class="hidden" data-text="18 gen_fsm"> &gt; 18 gen_fsm</span></a>18 gen_fsm</h2>
<p data-sourcepos="585:1-585:297">今回は有限ステートマシン (finite state machine)。ビヘイビア <code>gen_fsm</code> をとりあげる。このビヘイビアは <code>gen_server</code> に基本似た挙動をするが、呼び出しやメッセージ投入をあつかうのではなく同期や非同期のイベントをあつう。</p>
<h3 data-sourcepos="587:1-587:37" id="3-9-1" name="3-9-1">
<a class="anchor" id="18.1. 有限ステートマシン" name="18.1.%20%E6%9C%89%E9%99%90%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3" href="#18.1.%20%E6%9C%89%E9%99%90%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3" data-position="3-9-1"><i class="fa fa-link"></i><span class="hidden" data-text="18.1. 有限ステートマシン"> &gt; 18.1. 有限ステートマシン</span></a>18.1. 有限ステートマシン</h3>
<ul data-sourcepos="588:1-655:0">
<li data-sourcepos="588:1-588:49">状態遷移図 (state diagram) による記述</li>
<li data-sourcepos="589:1-589:35">シーケンス図による記述</li>
<li data-sourcepos="590:1-647:41">gen_fsm
<ul data-sourcepos="591:5-647:41">
<li data-sourcepos="591:5-596:28">init/1
<ul data-sourcepos="592:9-596:28">
<li data-sourcepos="592:9-596:28">Return
<ul data-sourcepos="593:13-596:28">
<li data-sourcepos="593:13-593:35">{ok, StateName, Data}</li>
<li data-sourcepos="594:13-594:44">{ok, StateName, Data, Timeout}</li>
<li data-sourcepos="595:13-595:46">{ok, StateName, Data, hibernate}</li>
<li data-sourcepos="596:13-596:28">{stop, Reason}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="597:5-605:34">StateName/2
<ul data-sourcepos="598:9-605:34">
<li data-sourcepos="598:9-598:31">非同期イベント</li>
<li data-sourcepos="599:9-600:30">Params
<ul data-sourcepos="600:13-600:30">
<li data-sourcepos="600:13-600:30">Event, StateData</li>
</ul>
</li>
<li data-sourcepos="601:9-605:34">Return
<ul data-sourcepos="602:13-605:34">
<li data-sourcepos="602:13-602:50">{next_state, NextStateName, NewData}</li>
<li data-sourcepos="603:13-603:59">{next_state, NextStateName, NewData, Timeout}</li>
<li data-sourcepos="604:13-604:52">{next_state, NextStateName, hibernate}</li>
<li data-sourcepos="605:13-605:34">{stop, Reason, Data}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="606:5-618:42">StateName/3
<ul data-sourcepos="607:9-618:42">
<li data-sourcepos="607:9-607:28">同期イベント</li>
<li data-sourcepos="608:9-609:36">Params
<ul data-sourcepos="609:13-609:36">
<li data-sourcepos="609:13-609:36">Event, From, StateData</li>
</ul>
</li>
<li data-sourcepos="610:9-618:42">Return
<ul data-sourcepos="611:13-618:42">
<li data-sourcepos="611:13-611:57">{reply, Reply, NextStateName, NewStateData}</li>
<li data-sourcepos="612:13-612:66">{reply, Reply, NextStateName, NewStateData, Timeout}</li>
<li data-sourcepos="613:13-613:68">{reply, Reply, NextStateName, NewStateData, hibernate}</li>
<li data-sourcepos="614:13-614:55">{next_state, NextStateName, NewStateData}</li>
<li data-sourcepos="615:13-615:64">{next_state, NextStateName, NewStateData, Timeout}</li>
<li data-sourcepos="616:13-616:66">{next_state, NextStateName, NewStateData, hibernate}</li>
<li data-sourcepos="617:13-617:49">{stop, Reason, Reply, NewStateData}</li>
<li data-sourcepos="618:13-618:42">{stop, Reason, NewStateData}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="619:5-627:34">handle_event/3
<ul data-sourcepos="620:9-627:34">
<li data-sourcepos="620:9-620:61">非同期イベント、グローバルイベント</li>
<li data-sourcepos="621:9-622:30">Params
<ul data-sourcepos="622:13-622:30">
<li data-sourcepos="622:13-622:30">Event, StateData</li>
</ul>
</li>
<li data-sourcepos="623:9-627:34">Return
<ul data-sourcepos="624:13-627:34">
<li data-sourcepos="624:13-624:50">{next_state, NextStateName, NewData}</li>
<li data-sourcepos="625:13-625:59">{next_state, NextStateName, NewData, Timeout}</li>
<li data-sourcepos="626:13-626:52">{next_state, NextStateName, hibernate}</li>
<li data-sourcepos="627:13-627:34">{stop, Reason, Data}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="628:5-640:42">handle_sync_event/4
<ul data-sourcepos="629:9-640:42">
<li data-sourcepos="629:9-629:58">同期イベント、グローバルイベント</li>
<li data-sourcepos="630:9-631:36">Params
<ul data-sourcepos="631:13-631:36">
<li data-sourcepos="631:13-631:36">Event, From, StateData</li>
</ul>
</li>
<li data-sourcepos="632:9-640:42">Return
<ul data-sourcepos="633:13-640:42">
<li data-sourcepos="633:13-633:57">{reply, Reply, NextStateName, NewStateData}</li>
<li data-sourcepos="634:13-634:66">{reply, Reply, NextStateName, NewStateData, Timeout}</li>
<li data-sourcepos="635:13-635:68">{reply, Reply, NextStateName, NewStateData, hibernate}</li>
<li data-sourcepos="636:13-636:55">{next_state, NextStateName, NewStateData}</li>
<li data-sourcepos="637:13-637:64">{next_state, NextStateName, NewStateData, Timeout}</li>
<li data-sourcepos="638:13-638:66">{next_state, NextStateName, NewStateData, hibernate}</li>
<li data-sourcepos="639:13-639:49">{stop, Reason, Reply, NewStateData}</li>
<li data-sourcepos="640:13-640:42">{stop, Reason, NewStateData}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="641:5-645:47">code_change/4
<ul data-sourcepos="642:9-645:47">
<li data-sourcepos="642:9-643:48">Params
<ul data-sourcepos="643:13-643:48">
<li data-sourcepos="643:13-643:48">OldVersion, StateName, Data, Extra</li>
</ul>
</li>
<li data-sourcepos="644:9-645:47">Return
<ul data-sourcepos="645:13-645:47">
<li data-sourcepos="645:13-645:47">{ok, NextStateName, NewStateData}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="646:5-647:41">terminate/3
<ul data-sourcepos="647:9-647:41">
<li data-sourcepos="647:9-647:41">init/1 と逆の挙動をする</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="648:1-655:0">イベント送信関数
<ul data-sourcepos="649:5-655:0">
<li data-sourcepos="649:5-651:29">ローカル
<ul data-sourcepos="650:9-651:29">
<li data-sourcepos="650:9-650:22">send_event/2</li>
<li data-sourcepos="651:9-651:29">sync_send_event/2-3</li>
</ul>
</li>
<li data-sourcepos="652:5-655:0">グローバル
<ul data-sourcepos="653:9-655:0">
<li data-sourcepos="653:9-653:34">send_all_state_event/2-3</li>
<li data-sourcepos="654:9-655:0">sync_send_event/2-3</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="656:1-656:52" id="3-9-2" name="3-9-2">
<a class="anchor" id="18.2. ユーザー同士の取引システム例" name="18.2.%20%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%90%8C%E5%A3%AB%E3%81%AE%E5%8F%96%E5%BC%95%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E4%BE%8B" href="#18.2.%20%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%90%8C%E5%A3%AB%E3%81%AE%E5%8F%96%E5%BC%95%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E4%BE%8B" data-position="3-9-2"><i class="fa fa-link"></i><span class="hidden" data-text="18.2. ユーザー同士の取引システム例"> &gt; 18.2. ユーザー同士の取引システム例</span></a>18.2. ユーザー同士の取引システム例</h3>
<ul data-sourcepos="657:1-659:0">
<li data-sourcepos="657:1-657:155"><a href="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/fd6db392-06fd-4926-8372-7bbad7407464.png" target="_blank" rel="noopener noreferrer"><img width="426" alt="thumbnail" src="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/fd6db392-06fd-4926-8372-7bbad7407464.png"></a></li>
<li data-sourcepos="658:1-659:0"><a href="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/715e0610-f7ee-4076-813b-125302f99da9.png" target="_blank" rel="noopener noreferrer"><img width="170" alt="image.png (24.2 kB)" src="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/715e0610-f7ee-4076-813b-125302f99da9.png"></a></li>
</ul>
<h2 data-sourcepos="660:1-660:15" id="3-10-0" name="3-10-0">
<a class="anchor" id="19 gen_event" name="19%20gen_event" href="#19%20gen_event" data-position="3-10-0"><i class="fa fa-link"></i><span class="hidden" data-text="19 gen_event"> &gt; 19 gen_event</span></a>19 gen_event</h2>
<p data-sourcepos="661:1-661:82">今回はイベントハンドラ。ビヘイビアは <code>gen_event</code> をつかう。</p>
<ul data-sourcepos="663:1-680:0">
<li data-sourcepos="663:1-680:0">人々（あるいは、あるプロセスやアプリケーション）にイベントが起きたことを知らせる機能の実装方法
<ul data-sourcepos="664:5-680:0">
<li data-sourcepos="664:5-665:37">単純出力方式
<ul data-sourcepos="665:9-665:37">
<li data-sourcepos="665:9-665:37">結果を出力するのみ</li>
</ul>
</li>
<li data-sourcepos="666:5-669:71">単純サブスクライバ方式
<ul data-sourcepos="667:9-669:71">
<li data-sourcepos="667:9-667:73">メッセージ送信前にサブスクライバのPidを取得</li>
<li data-sourcepos="668:9-669:71">Cons
<ul data-sourcepos="669:13-669:71">
<li data-sourcepos="669:13-669:71">コールバックのために待機プロセスが必要</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="670:5-680:0">イベントマネージャ方式
<ul data-sourcepos="671:9-680:0">
<li data-sourcepos="671:9-671:121">関数をうけとるプロセスをたて、すべてのイベントに対して当該関数をはしらせる</li>
<li data-sourcepos="672:9-675:95">Pros
<ul data-sourcepos="673:13-675:95">
<li data-sourcepos="673:13-673:98">サーバのサブスクライバがたくさんあっても稼働し続けられる</li>
<li data-sourcepos="674:13-674:89">すべてのコールバックは同じインスタンスで操作される</li>
<li data-sourcepos="675:13-675:95">短命なタスクに対して新しいプロセスを生成する必要がない</li>
</ul>
</li>
<li data-sourcepos="676:9-680:0">Cons
<ul data-sourcepos="677:13-680:0">
<li data-sourcepos="677:13-678:111">関数が長時間動作する必要があった場合、お互いブロックしあう
<ul data-sourcepos="678:17-678:111">
<li data-sourcepos="678:17-678:111">イベントマネージャをイベントフォワーダにすれば防ぐことができる</li>
</ul>
</li>
<li data-sourcepos="679:13-680:0">無限ループする関数はクラッシュするまで新規イベントをブロックする</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="681:1-681:49" id="3-11-0" name="3-11-0">
<a class="anchor" id="19.2. 汎用イベントハンドラ gen_event" name="19.2.%20%E6%B1%8E%E7%94%A8%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%20gen_event" href="#19.2.%20%E6%B1%8E%E7%94%A8%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%20gen_event" data-position="3-11-0"><i class="fa fa-link"></i><span class="hidden" data-text="19.2. 汎用イベントハンドラ gen_event"> &gt; 19.2. 汎用イベントハンドラ gen_event</span></a>19.2. 汎用イベントハンドラ gen_event</h2>
<a href="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/bdb8218b-1dce-4b9d-a0d9-a5e0416da32e.png" target="_blank" rel="noopener noreferrer"><img width="285" alt="image.png (19.9 kB)" src="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/bdb8218b-1dce-4b9d-a0d9-a5e0416da32e.png"></a>
<ul data-sourcepos="684:1-724:0">
<li data-sourcepos="684:1-724:0">gen_event の各関数
<ul data-sourcepos="685:5-724:0">
<li data-sourcepos="685:5-687:25">init/1
<ul data-sourcepos="686:9-687:25">
<li data-sourcepos="686:9-687:25">Response
<ul data-sourcepos="687:13-687:25">
<li data-sourcepos="687:13-687:25">{ok, State}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="688:5-688:17">terminate/2</li>
<li data-sourcepos="689:5-701:99">handle_event/2
<ul data-sourcepos="690:9-701:99">
<li data-sourcepos="690:9-691:134">非同期
<ul data-sourcepos="691:13-691:134">
<li data-sourcepos="691:13-691:134">すべてのイベントマネージャは戻り値を返さないことで呼び出しプロセスをブロックする</li>
</ul>
</li>
<li data-sourcepos="692:9-693:26">Params
<ul data-sourcepos="693:13-693:26">
<li data-sourcepos="693:13-693:26">Event, State</li>
</ul>
</li>
<li data-sourcepos="694:9-701:99">Response
<ul data-sourcepos="695:13-701:99">
<li data-sourcepos="695:13-696:58">{ok, NewState}
<ul data-sourcepos="696:17-696:58">
<li data-sourcepos="696:17-696:58">gen_server:handle_cast/2 と似た動作</li>
</ul>
</li>
<li data-sourcepos="697:13-697:39">{ok, NewState, hibernate}</li>
<li data-sourcepos="698:13-699:78">{remove_handler}
<ul data-sourcepos="699:17-699:78">
<li data-sourcepos="699:17-699:78">イベントマネージャからハンドラを削除する</li>
</ul>
</li>
<li data-sourcepos="700:13-701:99">{swap_handler, Args1, NewState, NewHandler, Args2}
<ul data-sourcepos="701:17-701:99">
<li data-sourcepos="701:17-701:99">今あるイベントハンドラを削除して新しいものに置き換える</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="702:5-703:67">notify/2
<ul data-sourcepos="703:9-703:67">
<li data-sourcepos="703:9-703:67">すべての流入イベントを通知する (非同期)</li>
</ul>
</li>
<li data-sourcepos="704:5-705:64">sync_notify/2
<ul data-sourcepos="705:9-705:64">
<li data-sourcepos="705:9-705:64">すべての流入イベントを通知する (同期)</li>
</ul>
</li>
<li data-sourcepos="706:5-707:19">cast/2
<ul data-sourcepos="707:9-707:19">
<li data-sourcepos="707:9-707:19">非同期</li>
</ul>
</li>
<li data-sourcepos="708:5-715:65">handle_call
<ul data-sourcepos="709:9-715:65">
<li data-sourcepos="709:9-709:96">gen_server:handle_call コールバックに似ているがレスポンスが異なる</li>
<li data-sourcepos="710:9-710:66">gen_server:call/3-4 が呼び出しに使われている</li>
<li data-sourcepos="711:9-715:65">Response
<ul data-sourcepos="712:13-715:65">
<li data-sourcepos="712:13-712:35">{ok, Reply, NewState}</li>
<li data-sourcepos="713:13-713:46">{ok, Reply, NewState, hibernate}</li>
<li data-sourcepos="714:13-714:37">{remove_handler, Reply}</li>
<li data-sourcepos="715:13-715:65">{swap_handler, Reply, Args1, NewState, Handle_Call}</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="716:5-717:179">handle_info/2
<ul data-sourcepos="717:9-717:179">
<li data-sourcepos="717:9-717:179">hendle_event と同じレスポンスだが、終了シグナルや ! 演算子でイベントマネージャに贈られたメッセージのみを扱う点で異なる</li>
</ul>
</li>
<li data-sourcepos="718:5-724:0">code_change/3
<ul data-sourcepos="719:9-724:0">
<li data-sourcepos="719:9-719:57">gen_server:code_change と同じ動作をする</li>
<li data-sourcepos="720:9-721:78">Params
<ul data-sourcepos="721:13-721:78">
<li data-sourcepos="721:13-721:78">OldVsn バージョン番号, State ハンドラの状態, Extra</li>
</ul>
</li>
<li data-sourcepos="722:9-724:0">Response
<ul data-sourcepos="723:13-724:0">
<li data-sourcepos="723:13-724:0">{ok, NewState}</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="725:1-725:16" id="3-12-0" name="3-12-0">
<a class="anchor" id="20 supervisor" name="20%20supervisor" href="#20%20supervisor" data-position="3-12-0"><i class="fa fa-link"></i><span class="hidden" data-text="20 supervisor"> &gt; 20 supervisor</span></a>20 supervisor</h2>
<p data-sourcepos="726:1-726:104">今回のビヘイビアはスーパバイザ <code>supervisor</code>。 監視戦略の概要にふれてみる。</p>
<ul data-sourcepos="728:1-782:0">
<li data-sourcepos="728:1-782:0">init/1
<ul data-sourcepos="729:5-782:0">
<li data-sourcepos="729:5-782:0">レスポンス
<ul data-sourcepos="730:9-782:0">
<li data-sourcepos="730:9-782:0">
<code>{ok, { {RestartStrategy, MaxRestart, MaxTime}, [{ChildId, StartFunc, Restart, Shutdown, Type, Modules}] } }.</code><ul data-sourcepos="736:13-782:0">
<li data-sourcepos="736:13-745:22">例
<ul data-sourcepos="737:17-745:22">
<li data-sourcepos="737:17-745:22">
<code>{ok, { {one_for_all, 5, 60}, [ {fake_id, {fake_mod, start_link, [SomeArg]}, permanent, 5000, worker, [fake_mod]}, {other_id, {event_manager_mod, start_link, []}, transient, infinity, worker, dynamic} ] } }</code>.</li>
</ul>
</li>
<li data-sourcepos="746:13-757:186">再起動戦略
<ul data-sourcepos="747:17-757:186">
<li data-sourcepos="747:17-749:217">
<code>one_for_one</code><ul data-sourcepos="748:21-749:217">
<li data-sourcepos="748:21-748:98">1つのワーカがクラッシュしたら当該ワーカを再起動する</li>
<li data-sourcepos="749:21-749:217">各々のワーカが独立している、互いが関係していない、あるいは、ワーカが再起動して状態が消えても隣のワーカに影響を与えない場合につかう</li>
</ul>
</li>
<li data-sourcepos="750:17-752:94">
<code>one_for_all</code><ul data-sourcepos="751:21-752:94">
<li data-sourcepos="751:21-751:128">1つのワーカがクラッシュしたらすべてのワーカをクラッシュさせて再起動する</li>
<li data-sourcepos="752:21-752:94">各々のワーカが互いに強く依存している場合につかう</li>
</ul>
</li>
<li data-sourcepos="753:17-755:100">
<code>rest_for_one</code><ul data-sourcepos="754:21-755:100">
<li data-sourcepos="754:21-754:143">1つのワーカがクラッシュした当該ワーカのら子ワーカたちをクラッシュさせて再起動する</li>
<li data-sourcepos="755:21-755:100">各々のワーカがチェーン状態に依存している場合につかう</li>
</ul>
</li>
<li data-sourcepos="756:17-757:186">
<code>simple_one_for_one</code><ul data-sourcepos="757:21-757:186">
<li data-sourcepos="757:21-757:186">
<code>one_for_one</code> はワーカのリストを起動した順で保持している一方 、<code>simple_one_for_one</code> はワーカへの定義を <code>dict</code> で保持している</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="758:13-759:149">再起動制限
<ul data-sourcepos="759:17-759:149">
<li data-sourcepos="759:17-759:149">MaxTime 秒以内に MaxRestart 回起動したら、スーパバイザは再起動をやめて自身をシャットダウンする</li>
</ul>
</li>
<li data-sourcepos="760:13-782:0">ワーカ (子プロセス)
<ul data-sourcepos="761:17-782:0">
<li data-sourcepos="761:17-782:0">構成要素
<ul data-sourcepos="762:21-782:0">
<li data-sourcepos="762:21-762:29">ChildId</li>
<li data-sourcepos="763:21-764:102">StartFunc
<ul data-sourcepos="764:25-764:102">
<li data-sourcepos="764:25-764:102">スーパバイザの起動方法をつたえるためのタプル {M, F, A}</li>
</ul>
</li>
<li data-sourcepos="765:21-773:73">Restart
<ul data-sourcepos="766:25-773:73">
<li data-sourcepos="766:25-773:73">再起動戦略
<ul data-sourcepos="767:29-773:73">
<li data-sourcepos="767:29-768:49">permanent
<ul data-sourcepos="768:33-768:49">
<li data-sourcepos="768:33-768:49">常に再起動</li>
</ul>
</li>
<li data-sourcepos="769:29-770:52">temporary
<ul data-sourcepos="770:33-770:52">
<li data-sourcepos="770:33-770:52">再起動しない</li>
</ul>
</li>
<li data-sourcepos="771:29-773:73">transient
<ul data-sourcepos="772:33-773:73">
<li data-sourcepos="772:33-772:76">正常終了の場合は再起動しない</li>
<li data-sourcepos="773:33-773:73">異常終了の場合は再起動する</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="774:21-775:38">Shutdown
<ul data-sourcepos="775:25-775:38">
<li data-sourcepos="775:25-775:38">終了期限</li>
</ul>
</li>
<li data-sourcepos="776:21-779:48">Type
<ul data-sourcepos="777:25-779:48">
<li data-sourcepos="777:25-779:48">子プロセスの種類
<ul data-sourcepos="778:29-779:48">
<li data-sourcepos="778:29-778:39">ワーカ</li>
<li data-sourcepos="779:29-779:48">スーパバイザ</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="780:21-782:0">Modules
<ul data-sourcepos="781:25-782:0">
<li data-sourcepos="781:25-782:0">コールバックモジュールのリスト</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="783:1-783:39" id="3-13-0" name="3-13-0">
<a class="anchor" id="21 プロセスプールをつくる" name="21%20%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%83%97%E3%83%BC%E3%83%AB%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B" href="#21%20%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%83%97%E3%83%BC%E3%83%AB%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B" data-position="3-13-0"><i class="fa fa-link"></i><span class="hidden" data-text="21 プロセスプールをつくる"> &gt; 21 プロセスプールをつくる</span></a>21 プロセスプールをつくる</h2>
<p data-sourcepos="784:1-784:90">今回はプロセスプール管理アプリケーションをOTPを使ってつくる。</p>
<h2 data-sourcepos="786:1-786:9" id="3-14-0" name="3-14-0">
<a class="anchor" id="要件" name="%E8%A6%81%E4%BB%B6" href="#%E8%A6%81%E4%BB%B6" data-position="3-14-0"><i class="fa fa-link"></i><span class="hidden" data-text="要件"> &gt; 要件</span></a>要件</h2>
<ul data-sourcepos="787:1-791:0">
<li data-sourcepos="787:1-787:51">サーバを最大でN個の並列接続に制限</li>
<li data-sourcepos="788:1-788:77">アプリケーションによって開かれるファイルの数を制限</li>
<li data-sourcepos="789:1-789:47">サブシステムに優先順位を与える</li>
<li data-sourcepos="790:1-791:0">不定期なアクセス負荷に対してキューにタスクを貯めることで、可用性を高める</li>
</ul>
<h2 data-sourcepos="792:1-792:9" id="3-15-0" name="3-15-0">
<a class="anchor" id="実装" name="%E5%AE%9F%E8%A3%85" href="#%E5%AE%9F%E8%A3%85" data-position="3-15-0"><i class="fa fa-link"></i><span class="hidden" data-text="実装"> &gt; 実装</span></a>実装</h2>
<p data-sourcepos="793:1-793:10"><strong>機能</strong></p>
<ul data-sourcepos="794:1-809:0">
<li data-sourcepos="794:1-796:12">アプリケーション
<ul data-sourcepos="795:5-796:12">
<li data-sourcepos="795:5-795:12">起動</li>
<li data-sourcepos="796:5-796:12">停止</li>
</ul>
</li>
<li data-sourcepos="797:1-799:12">特定のプロセスプール
<ul data-sourcepos="798:5-799:12">
<li data-sourcepos="798:5-798:12">起動</li>
<li data-sourcepos="799:5-799:12">停止</li>
</ul>
</li>
<li data-sourcepos="800:1-809:0">プール内のタスク
<ul data-sourcepos="801:5-809:0">
<li data-sourcepos="801:5-804:55">プールに余裕がある場合
<ul data-sourcepos="802:9-804:55">
<li data-sourcepos="802:9-802:16">実行</li>
<li data-sourcepos="803:9-803:64">タスクが実行されたら呼び出し元は解放</li>
<li data-sourcepos="804:9-804:55">できる限りタスクを非同期に実行</li>
</ul>
</li>
<li data-sourcepos="805:5-809:0">プールに余裕がない場合
<ul data-sourcepos="806:9-809:0">
<li data-sourcepos="806:9-806:40">起動できないと告げる</li>
<li data-sourcepos="807:9-807:103">タスクがキューの中にある間は呼び出し元のプロセスを待たせておく</li>
<li data-sourcepos="808:9-809:0">タスクをキューに貯める</li>
</ul>
</li>
</ul>
</li>
</ul>
<p data-sourcepos="810:1-810:10"><strong>状態</strong></p>
<ul data-sourcepos="811:1-830:0">
<li data-sourcepos="811:1-815:79">静的な状態
<ul data-sourcepos="812:5-815:79">
<li data-sourcepos="812:5-815:79">下記から容易に取得
<ul data-sourcepos="813:9-815:79">
<li data-sourcepos="813:9-813:28">設定ファイル</li>
<li data-sourcepos="814:9-814:28">他のプロセス</li>
<li data-sourcepos="815:9-815:79">アプリケーションを再起動しているスーパーバイザ</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="816:1-821:31">動的な状態
<ul data-sourcepos="817:5-821:31">
<li data-sourcepos="817:5-817:45">再計算できるデータから取得</li>
<li data-sourcepos="818:5-821:31">状態の種類
<ul data-sourcepos="819:9-821:31">
<li data-sourcepos="819:9-819:31">初期からの状態</li>
<li data-sourcepos="820:9-820:31">現在までの状態</li>
<li data-sourcepos="821:9-821:31">変換すべき状態</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="822:1-830:0">再計算できない動的なデータ
<ul data-sourcepos="823:5-830:0">
<li data-sourcepos="823:5-827:16">下記から取得
<ul data-sourcepos="824:9-827:16">
<li data-sourcepos="824:9-824:28">ユーザの入力</li>
<li data-sourcepos="825:9-825:25">生のデータ</li>
<li data-sourcepos="826:9-826:40">逐次的な外部イベント</li>
<li data-sourcepos="827:9-827:16">など</li>
</ul>
</li>
<li data-sourcepos="828:5-830:0">保存方法
<ul data-sourcepos="829:9-830:0">
<li data-sourcepos="829:9-830:0">データベースに登録</li>
</ul>
</li>
</ul>
</li>
</ul>
<a href="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/bf8a471b-38d3-4405-af1a-daac5f59ca0f.png" target="_blank" rel="noopener noreferrer"><img width="395" alt="image.png (20.1 kB)" src="https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/bf8a471b-38d3-4405-af1a-daac5f59ca0f.png"></a>
<h2 data-sourcepos="833:1-833:42" id="3-16-0" name="3-16-0">
<a class="anchor" id="25 ホットコードローディング" name="25%20%E3%83%9B%E3%83%83%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AD%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0" href="#25%20%E3%83%9B%E3%83%83%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AD%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0" data-position="3-16-0"><i class="fa fa-link"></i><span class="hidden" data-text="25 ホットコードローディング"> &gt; 25 ホットコードローディング</span></a>25 ホットコードローディング</h2>
<ul data-sourcepos="834:1-837:0">
<li data-sourcepos="834:1-834:89">今回はホットコードローディング（更新）についてかんがえる。</li>
<li data-sourcepos="835:1-835:124">ホットコードローディングはホットスワップの1種でElixir/Erlangの信頼性につながっている。</li>
<li data-sourcepos="836:1-837:0">ホットコードローディングは <code>systools</code> により複数の <code>appup</code> から <code>relup</code> として構成されている。</li>
</ul>
<h3 data-sourcepos="838:1-838:25" id="3-16-1" name="3-16-1">
<a class="anchor" id="リリースの更新" name="%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0" href="#%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0" data-position="3-16-1"><i class="fa fa-link"></i><span class="hidden" data-text="リリースの更新"> &gt; リリースの更新</span></a>リリースの更新</h3>
<p data-sourcepos="839:1-839:84">バージョンがあがるほどリリースの更新は煩雑になっていく。</p>
<ul data-sourcepos="841:1-848:0">
<li data-sourcepos="841:1-842:39">OTPアプリケーションを書く (ver. 1.0.0)
<ul data-sourcepos="842:5-842:39">
<li data-sourcepos="842:5-842:39">それらをリリースにする</li>
</ul>
</li>
<li data-sourcepos="843:1-844:198">1つ以上のOTPアプリケーションのバージョンを更新する (ver. 1.1.0)
<ul data-sourcepos="844:5-844:198">
<li data-sourcepos="844:5-844:198">そのアプリケーションの古いバージョンから新しいバージョンへの遷移を行うために、何を変更すべきかを説明した <code>appup</code> ファイルを作成する</li>
</ul>
</li>
<li data-sourcepos="845:1-848:0">新しいアプリケーションで新しいリリースを作る (ver. 1.2.0)
<ul data-sourcepos="846:5-848:0">
<li data-sourcepos="846:5-846:71">
<code>appup</code> ファイルをこれらのリリースから生成する</li>
<li data-sourcepos="847:5-848:0">新しいアプリケーションを稼働しているErlangシェルにインストールする</li>
</ul>
</li>
</ul>
<p data-sourcepos="849:1-849:135">リリース作業として以下の通り。<code>relup</code> 構成ツールとして、Erlangは <code>relx</code> 、Elixirは <code>distillery</code> がある。</p>
<ul data-sourcepos="851:1-855:0">
<li data-sourcepos="851:1-851:113">巻き戻しできるようアップグレードとダウングレード双方を <code>appup</code> ファイルに記述</li>
<li data-sourcepos="852:1-852:78">モジュールによるリリース構成を <code>config</code> ファイルに記述</li>
<li data-sourcepos="853:1-853:45">
<code>systools:make_relup</code> で <code>relup</code> を作成</li>
<li data-sourcepos="854:1-855:0">
<code>release_hanlder</code> によって更新</li>
</ul>
<div class="code-block" data-sourcepos="856:1-872:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>appup</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="c">%% {NewVersion,
%%  [{VersionUpgradingFrom, [Instructions]}]
%%  [{VersionDownGradingTo, [Instructions]}]}.
</span><span class="p">{</span><span class="s">"1.1.0"</span><span class="p">,</span>
 <span class="p">[{</span><span class="s">"1.0.0"</span><span class="p">,</span> <span class="p">[{</span><span class="n">add_module</span><span class="p">,</span> <span class="n">pq_quest</span><span class="p">},</span>
             <span class="p">{</span><span class="nb">load_module</span><span class="p">,</span> <span class="n">pq_enemy</span><span class="p">},</span>
             <span class="p">{</span><span class="nb">load_module</span><span class="p">,</span> <span class="n">pq_events</span><span class="p">},</span>
             <span class="p">{</span><span class="n">update</span><span class="p">,</span> <span class="n">pq_player</span><span class="p">,</span> <span class="p">{</span><span class="n">advanced</span><span class="p">,</span> <span class="p">[]},</span> <span class="p">[</span><span class="n">pq_quest</span><span class="p">,</span> <span class="n">pq_events</span><span class="p">]}]}],</span>
 <span class="p">[{</span><span class="s">"1.0.0"</span><span class="p">,</span> <span class="p">[{</span><span class="n">update</span><span class="p">,</span> <span class="n">pq_player</span><span class="p">,</span> <span class="p">{</span><span class="n">advanced</span><span class="p">,</span> <span class="p">[]}},</span>
             <span class="p">{</span><span class="nb">delete_module</span><span class="p">,</span> <span class="n">pq_quest</span><span class="p">},</span>
             <span class="p">{</span><span class="nb">load_module</span><span class="p">,</span> <span class="n">pq_enemy</span><span class="p">},</span>
             <span class="p">{</span><span class="nb">load_module</span><span class="p">,</span> <span class="n">pq_events</span><span class="p">}]}]}.</span>
<span class="p">{</span><span class="s">"1.0.1"</span><span class="p">,</span>
 <span class="p">[{</span><span class="s">"1.0.0"</span><span class="p">,</span> <span class="p">[{</span><span class="nb">load_module</span><span class="p">,</span> <span class="n">sockserv_serv</span><span class="p">}]}],</span>
 <span class="p">[{</span><span class="s">"1.0.0"</span><span class="p">,</span> <span class="p">[{</span><span class="nb">load_module</span><span class="p">,</span> <span class="n">sockserv_serv</span><span class="p">}]}]}.</span>
</code></pre></div>
</div>
<h2 data-sourcepos="874:1-874:11" id="3-17-0" name="3-17-0">
<a class="anchor" id="27 EUnit" name="27%20EUnit" href="#27%20EUnit" data-position="3-17-0"><i class="fa fa-link"></i><span class="hidden" data-text="27 EUnit"> &gt; 27 EUnit</span></a>27 EUnit</h2>
<ul data-sourcepos="876:1-877:0">
<li data-sourcepos="876:1-877:0">今回は単体テストEUnitについてかんがえる。</li>
</ul>
<h2 data-sourcepos="878:1-878:17" id="3-18-0" name="3-18-0">
<a class="anchor" id="EUnitの特徴" name="EUnit%E3%81%AE%E7%89%B9%E5%BE%B4" href="#EUnit%E3%81%AE%E7%89%B9%E5%BE%B4" data-position="3-18-0"><i class="fa fa-link"></i><span class="hidden" data-text="EUnitの特徴"> &gt; EUnitの特徴</span></a>EUnitの特徴</h2>
<ul data-sourcepos="879:1-884:0">
<li data-sourcepos="879:1-879:55">
<code>eunit:test(モジュール名, [verbose])</code> で実行</li>
<li data-sourcepos="880:1-880:72">postfixがtestの関数 <code>_test()</code> に対してテストをおこなう</li>
<li data-sourcepos="881:1-881:65">モジュールの内外ともにテストコードをかける</li>
<li data-sourcepos="882:1-882:104">モジュール外に書いた場合プライベート関数に対するテストはできなくなる</li>
<li data-sourcepos="883:1-884:0">テスト用モジュールはpostfixがtestsとなる <code>_tests.erl</code>
</li>
</ul>
<h3 data-sourcepos="885:1-885:18" id="3-18-1" name="3-18-1">
<a class="anchor" id="EUnitの関数" name="EUnit%E3%81%AE%E9%96%A2%E6%95%B0" href="#EUnit%E3%81%AE%E9%96%A2%E6%95%B0" data-position="3-18-1"><i class="fa fa-link"></i><span class="hidden" data-text="EUnitの関数"> &gt; EUnitの関数</span></a>EUnitの関数</h3>
<ul data-sourcepos="886:1-918:0">
<li data-sourcepos="886:1-908:34">表現系
<ul data-sourcepos="887:5-908:34">
<li data-sourcepos="887:5-888:90">テスト
<ul data-sourcepos="888:9-888:90">
<li data-sourcepos="888:9-888:90"><code>foo_test -&gt; ?assert(is_number(ops:add(1, 2))), ?assertEqual(4, ops:add(2, 2)).</code></li>
</ul>
</li>
<li data-sourcepos="889:5-890:84">テストジェネレータ
<ul data-sourcepos="890:9-890:84">
<li data-sourcepos="890:9-890:84"><code>foo_test_ -&gt; [test_them_1(), test_them_2, ?_assertError(badarith, 1/0)].</code></li>
</ul>
</li>
<li data-sourcepos="891:5-908:34">フィクスチャー
<ul data-sourcepos="892:9-908:34">
<li data-sourcepos="892:9-896:60">setup
<ul data-sourcepos="893:13-896:60">
<li data-sourcepos="893:13-893:44"><code>{setup, Setup, Instantiator}</code></li>
<li data-sourcepos="894:13-894:53"><code>{setup, Setup, Cleanup, Instantiator}</code></li>
<li data-sourcepos="895:13-895:51"><code>{setup, Where, Setup, Instantiator}</code></li>
<li data-sourcepos="896:13-896:60"><code>{setup, Where, Setup, Cleanup, Instantiator}</code></li>
</ul>
</li>
<li data-sourcepos="897:9-901:64">foreach
<ul data-sourcepos="898:13-901:64">
<li data-sourcepos="898:13-898:48"><code>{foreach, Setup, [Instantiator]}</code></li>
<li data-sourcepos="899:13-899:57"><code>{foreach, Setup, Cleanup, [Instantiator]}</code></li>
<li data-sourcepos="900:13-900:55"><code>{foreach, Where, Setup, [Instantiator]}</code></li>
<li data-sourcepos="901:13-901:64"><code>{foreach, Where, Setup, Cleanup, [Instantiator]}</code></li>
</ul>
</li>
<li data-sourcepos="902:9-906:52">instantiator制御
<ul data-sourcepos="903:13-906:52">
<li data-sourcepos="903:13-903:47">
<code>{spawn, TestSet}</code> - 並行処理</li>
<li data-sourcepos="904:13-904:69">
<code>{timeout, (時間 秒), TestSet}</code> - 時間指定処理</li>
<li data-sourcepos="905:13-905:49">
<code>{inorder, TestSet}</code> - 逐次処理</li>
<li data-sourcepos="906:13-906:52">
<code>{inparallel, TestSet}</code> - 並列処理</li>
</ul>
</li>
<li data-sourcepos="907:9-908:34">コメント
<ul data-sourcepos="908:13-908:34">
<li data-sourcepos="908:13-908:34"><code>{Comment, Fixture}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="909:1-918:0">アサーション系
<ul data-sourcepos="910:5-918:0">
<li data-sourcepos="910:5-910:27"><code>?assert(expression)</code></li>
<li data-sourcepos="911:5-911:30"><code>?assertNot(expression)</code></li>
<li data-sourcepos="912:5-912:26"><code>?assertEqual(A, B)</code></li>
<li data-sourcepos="913:5-913:41"><code>?assertMatch(Pattern, Expression)</code></li>
<li data-sourcepos="914:5-914:41"><code>?assertError(Pattern, Expression)</code></li>
<li data-sourcepos="915:5-915:41"><code>?assertThrow(Pattern, Expression)</code></li>
<li data-sourcepos="916:5-916:40"><code>?assertExit(Pattern, Expression)</code></li>
<li data-sourcepos="917:5-918:0"><code>?assertException(Class, Pattern, Expression)</code></li>
</ul>
</li>
</ul>
<p data-sourcepos="919:1-919:78"><strong>フィクスチャー (foreach) をつかったテストジェネレータ</strong></p>
<div class="code-block" data-sourcepos="920:1-942:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">setup</span><span class="p">(</span><span class="nv">F</span><span class="p">),</span> <span class="p">{</span><span class="n">setup</span><span class="p">,</span> <span class="k">fun</span> <span class="n">start</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="k">fun</span> <span class="n">stop</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="nv">F</span><span class="p">}).</span>

<span class="c">%% 関数some2について
</span><span class="nf">some2_test_</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="p">[{</span><span class="s">"SetupData1を適切に評価できること"</span><span class="p">,</span>
      <span class="p">{</span><span class="n">foreach</span><span class="p">,</span>
       <span class="o">?</span><span class="nf">setup</span><span class="p">(</span><span class="k">fun</span> <span class="p">(</span><span class="nv">SetupData1</span><span class="p">)</span> <span class="o">-&gt;</span>
           <span class="p">[</span><span class="nf">some_instantiator1</span><span class="p">(</span><span class="nv">SetupData1</span><span class="p">),</span>
            <span class="nf">some_instantiator2</span><span class="p">(</span><span class="nv">SetupData1</span><span class="p">),</span>
            <span class="p">...</span>
            <span class="nf">some_instantiatorN</span><span class="p">(</span><span class="nv">SetupData1</span><span class="p">)]</span>
       <span class="k">end</span><span class="p">}},</span>
     <span class="p">{</span><span class="s">"SetupData2を並列処理で適切に評価できること"</span><span class="p">,</span>
      <span class="p">{</span><span class="n">foreach</span><span class="p">,</span>
       <span class="o">?</span><span class="nf">setup</span><span class="p">(</span><span class="k">fun</span> <span class="p">(</span><span class="nv">SetupData2</span><span class="p">)</span> <span class="o">-&gt;</span>
           <span class="p">{</span><span class="n">inparallel</span><span class="p">,</span>
            <span class="p">[</span><span class="nf">some_instantiator1</span><span class="p">(</span><span class="nv">SetupData2</span><span class="p">),</span>
             <span class="nf">some_instantiator2</span><span class="p">(</span><span class="nv">SetupData2</span><span class="p">),</span>
             <span class="p">...</span>
             <span class="nf">some_instantiatorN</span><span class="p">(</span><span class="nv">SetupData2</span><span class="p">)]}</span>
       <span class="k">end</span><span class="p">)}}].</span>
</code></pre></div>
</div>
<p data-sourcepos="944:1-944:52"><strong>並列・並行でテストする際の注意点</strong></p>
<ul data-sourcepos="945:1-946:0">
<li data-sourcepos="945:1-946:0">名前をa、b、cのようにハードコードすると、並列で走らせている際、名前の衝突が起きる可能性がある。可能な限り名前はハードコードせずに <code>make_ref()</code> によって一意の値をつかうこと。</li>
</ul>
<h2 data-sourcepos="947:1-947:46" id="3-19-0" name="3-19-0">
<a class="anchor" id="28 インメモリーデータベース ETS" name="28%20%E3%82%A4%E3%83%B3%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%BC%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%20ETS" href="#28%20%E3%82%A4%E3%83%B3%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%BC%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%20ETS" data-position="3-19-0"><i class="fa fa-link"></i><span class="hidden" data-text="28 インメモリーデータベース ETS"> &gt; 28 インメモリーデータベース ETS</span></a>28 インメモリーデータベース ETS</h2>
<h3 data-sourcepos="948:1-948:16" id="3-19-1" name="3-19-1">
<a class="anchor" id="ETSの特徴" name="ETS%E3%81%AE%E7%89%B9%E5%BE%B4" href="#ETS%E3%81%AE%E7%89%B9%E5%BE%B4" data-position="3-19-1"><i class="fa fa-link"></i><span class="hidden" data-text="ETSの特徴"> &gt; ETSの特徴</span></a>ETSの特徴</h3>
<ul data-sourcepos="949:1-953:0">
<li data-sourcepos="949:1-953:0">データへの並列平行なアクセスが可能
<ul data-sourcepos="950:5-953:0">
<li data-sourcepos="950:5-950:72">ただし、安全性と並行性が低下する可能性がある</li>
<li data-sourcepos="951:5-953:0">ETSのデフォルト使用数は1400
<ul data-sourcepos="952:9-953:0">
<li data-sourcepos="952:9-953:0">
<code>erl -env ERL_MAX_ETS_TABLES Number</code> で設定</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="954:1-954:28" id="3-19-2" name="3-19-2">
<a class="anchor" id="ETSのテーブル種類" name="ETS%E3%81%AE%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%A8%AE%E9%A1%9E" href="#ETS%E3%81%AE%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%A8%AE%E9%A1%9E" data-position="3-19-2"><i class="fa fa-link"></i><span class="hidden" data-text="ETSのテーブル種類"> &gt; ETSのテーブル種類</span></a>ETSのテーブル種類</h3>
<ul data-sourcepos="955:1-982:0">
<li data-sourcepos="955:1-956:12">
<code>set</code><ul data-sourcepos="956:5-956:12">
<li data-sourcepos="956:5-956:12">標準</li>
</ul>
</li>
<li data-sourcepos="957:1-959:124">
<code>ordered_set</code><ul data-sourcepos="958:5-959:124">
<li data-sourcepos="958:5-958:51">テーブルデータのソート機能あり</li>
<li data-sourcepos="959:5-959:124">ユースケース: 範囲指定してデータ取得する (ただし、アクセス時間が遅くなる <code>O(log N)</code>)</li>
</ul>
</li>
<li data-sourcepos="960:1-961:63">
<code>bag</code><ul data-sourcepos="961:5-961:63">
<li data-sourcepos="961:5-961:63">同一キーのタプル（レコード）を保持可能</li>
</ul>
</li>
<li data-sourcepos="962:1-963:63">
<code>duplicate_bag</code><ul data-sourcepos="963:5-963:63">
<li data-sourcepos="963:5-963:63">同一内容のタプル（レコード）を保持可能</li>
</ul>
</li>
<li data-sourcepos="964:1-982:0">共通機能
<ul data-sourcepos="965:5-982:0">
<li data-sourcepos="965:5-976:31">テーブル所有権
<ul data-sourcepos="966:9-976:31">
<li data-sourcepos="966:9-966:112">ETSテーブル起動関数であらたにコールしたプロセスがそのテーブルの所有者</li>
<li data-sourcepos="967:9-976:31">権限
<ul data-sourcepos="968:13-976:31">
<li data-sourcepos="968:13-970:32">protected level
<ul data-sourcepos="969:17-970:32">
<li data-sourcepos="969:17-969:39">所有者 read, write</li>
<li data-sourcepos="970:17-970:32">その他 read</li>
</ul>
</li>
<li data-sourcepos="971:13-973:39">public level
<ul data-sourcepos="972:17-973:39">
<li data-sourcepos="972:17-972:39">所有者 read, write</li>
<li data-sourcepos="973:17-973:39">その他 read, write</li>
</ul>
</li>
<li data-sourcepos="974:13-976:31">private level
<ul data-sourcepos="975:17-976:31">
<li data-sourcepos="975:17-975:39">所有者 read, write</li>
<li data-sourcepos="976:17-976:31">その他 n/a</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="977:5-982:0">テーブルの移譲
<ul data-sourcepos="978:9-982:0">
<li data-sourcepos="978:9-978:64">ETSテーブルはプロセスが死ぬと消滅する</li>
<li data-sourcepos="979:9-982:0">移譲の種類
<ul data-sourcepos="980:13-982:0">
<li data-sourcepos="980:13-980:38">都度指定する移譲</li>
<li data-sourcepos="981:13-982:0">プロセスが死んだ場合の自動移譲</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-sourcepos="983:1-983:16" id="3-19-3" name="3-19-3">
<a class="anchor" id="ETSの関数" name="ETS%E3%81%AE%E9%96%A2%E6%95%B0" href="#ETS%E3%81%AE%E9%96%A2%E6%95%B0" data-position="3-19-3"><i class="fa fa-link"></i><span class="hidden" data-text="ETSの関数"> &gt; ETSの関数</span></a>ETSの関数</h3>
<ul data-sourcepos="984:1-994:0">
<li data-sourcepos="984:1-985:17">テーブル作成・削除
<ul data-sourcepos="985:5-985:17">
<li data-sourcepos="985:5-985:17"><code>ets:new/2</code></li>
</ul>
</li>
<li data-sourcepos="986:1-988:30">データ挿入・参照
<ul data-sourcepos="987:5-988:30">
<li data-sourcepos="987:5-987:42"><code>ets:insert(Table, ObjectOrObjects)</code></li>
<li data-sourcepos="988:5-988:30"><code>ets:lookup(Table, Key)</code></li>
</ul>
</li>
<li data-sourcepos="989:1-994:0">その他
<ul data-sourcepos="990:5-994:0">
<li data-sourcepos="990:5-990:30"><code>ets:delete(Table, Key)</code></li>
<li data-sourcepos="991:5-991:37"><code>ets:match(Table, MatchClause)</code></li>
<li data-sourcepos="992:5-992:44"><code>ets:match_object(Table, MatchClause)</code></li>
<li data-sourcepos="993:5-994:0"><code>ets:fun2ms(MatchSpecClause)</code></li>
</ul>
</li>
</ul>
<p data-sourcepos="995:1-995:67"><strong>setテーブルでnamed_tableオプションをつける場合</strong></p>
<div class="code-block" data-sourcepos="996:1-1019:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">21</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">[</span><span class="n">set</span><span class="p">,</span> <span class="n">named_table</span><span class="p">]).</span>
<span class="n">ingredients</span>
<span class="mi">22</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">{</span><span class="n">bacon</span><span class="p">,</span> <span class="n">great</span><span class="p">}).</span>
<span class="n">true</span>
<span class="mi">23</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="n">bacon</span><span class="p">).</span>
<span class="p">[{</span><span class="n">bacon</span><span class="p">,</span><span class="n">great</span><span class="p">}]</span>
<span class="mi">24</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">[{</span><span class="n">bacon</span><span class="p">,</span> <span class="n">awesome</span><span class="p">},</span> <span class="p">{</span><span class="n">cabbage</span><span class="p">,</span> <span class="n">alright</span><span class="p">}]).</span>
<span class="n">true</span>
<span class="mi">25</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="n">bacon</span><span class="p">).</span>
<span class="p">[{</span><span class="n">bacon</span><span class="p">,</span><span class="n">awesome</span><span class="p">}]</span>
<span class="mi">26</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">).</span>
<span class="p">[{</span><span class="n">cabbage</span><span class="p">,</span><span class="n">alright</span><span class="p">}]</span>
<span class="mi">27</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">delete</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">).</span>
<span class="n">true</span>
<span class="mi">28</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">delete</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">).</span>
<span class="n">true</span>
<span class="mi">29</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">).</span>
<span class="p">[]</span>
<span class="mi">32</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert_new</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">{</span><span class="n">tomato</span><span class="p">,</span> <span class="n">hey</span><span class="p">}).</span>
<span class="n">true</span>
<span class="mi">33</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert_new</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">{</span><span class="n">tomato</span><span class="p">,</span> <span class="n">hey</span><span class="p">}).</span>
<span class="n">false</span>
</code></pre></div>
</div>
<p data-sourcepos="1021:1-1021:70"><strong>bagテーブルでnamed_tableオプションをつけない場合</strong></p>
<div class="code-block" data-sourcepos="1022:1-1033:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">34</span><span class="o">&gt;</span> <span class="nv">TabId</span> <span class="o">=</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">[</span><span class="n">bag</span><span class="p">]).</span>
<span class="mi">16401</span>
<span class="mi">35</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="nv">TabId</span><span class="p">,</span> <span class="p">{</span><span class="n">bacon</span><span class="p">,</span> <span class="n">delicious</span><span class="p">}).</span>
<span class="n">true</span>
<span class="mi">36</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="nv">TabId</span><span class="p">,</span> <span class="p">{</span><span class="n">bacon</span><span class="p">,</span> <span class="n">fat</span><span class="p">}).</span>
<span class="n">true</span>
<span class="mi">37</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="nv">TabId</span><span class="p">,</span> <span class="p">{</span><span class="n">bacon</span><span class="p">,</span> <span class="n">fat</span><span class="p">}).</span>
<span class="n">true</span>
<span class="mi">38</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p">(</span><span class="nv">TabId</span><span class="p">,</span> <span class="n">bacon</span><span class="p">).</span>
<span class="p">[{</span><span class="n">bacon</span><span class="p">,</span><span class="n">delicious</span><span class="p">},{</span><span class="n">bacon</span><span class="p">,</span><span class="n">fat</span><span class="p">}]</span>
</code></pre></div>
</div>
<p data-sourcepos="1035:1-1035:79"><strong>ordered_setターブルで、named_tableオプションをつける場合</strong></p>
<div class="code-block" data-sourcepos="1036:1-1051:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">42</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">[</span><span class="n">ordered_set</span><span class="p">,</span> <span class="n">named_table</span><span class="p">]).</span>
<span class="n">ingredients</span>
<span class="mi">43</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="p">[{</span><span class="n">ketchup</span><span class="p">,</span> <span class="s">"not much"</span><span class="p">},</span> <span class="p">{</span><span class="n">mustard</span><span class="p">,</span> <span class="s">"a lot"</span><span class="p">},</span> <span class="p">{</span><span class="n">cheese</span><span class="p">,</span> <span class="s">"yes"</span><span class="p">,</span> <span class="s">"goat"</span><span class="p">},</span> <span class="p">{</span><span class="n">patty</span><span class="p">,</span> <span class="s">"moose"</span><span class="p">},</span> <span class="p">{</span><span class="n">onions</span><span class="p">,</span> <span class="s">"a lot"</span><span class="p">,</span> <span class="s">"caramelized"</span><span class="p">}]).</span>
<span class="n">true</span>
<span class="mi">44</span><span class="o">&gt;</span> <span class="nv">Res1</span> <span class="o">=</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">first</span><span class="p">(</span><span class="n">ingredients</span><span class="p">).</span>
<span class="n">cheese</span>
<span class="mi">45</span><span class="o">&gt;</span> <span class="nv">Res2</span> <span class="o">=</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">next</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="nv">Res1</span><span class="p">).</span>
<span class="n">ketchup</span>
<span class="mi">46</span><span class="o">&gt;</span> <span class="nv">Res3</span> <span class="o">=</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">next</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="nv">Res2</span><span class="p">).</span>
<span class="n">mustard</span>
<span class="mi">47</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">last</span><span class="p">(</span><span class="n">ingredients</span><span class="p">).</span>
<span class="n">patty</span>
<span class="mi">48</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">prev</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">last</span><span class="p">(</span><span class="n">ingredients</span><span class="p">)).</span>
<span class="n">onions</span>
</code></pre></div>
</div>
<p data-sourcepos="1053:1-1053:85"><strong>named_tableオプションつきbagテーブルでパターンマッチをする</strong></p>
<div class="code-block" data-sourcepos="1054:1-1067:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="mi">53</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[</span><span class="n">named_table</span><span class="p">,</span> <span class="n">bag</span><span class="p">]).</span>
<span class="n">table</span>
<span class="mi">54</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[{</span><span class="n">items</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">},</span> <span class="p">{</span><span class="n">items</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">},</span> <span class="p">{</span><span class="n">cat</span><span class="p">,</span> <span class="n">brown</span><span class="p">,</span> <span class="n">soft</span><span class="p">,</span> <span class="n">loveable</span><span class="p">,</span> <span class="n">selfish</span><span class="p">},</span> <span class="p">{</span><span class="n">friends</span><span class="p">,</span> <span class="p">[</span><span class="n">jem</span><span class="p">,</span> <span class="n">jeff</span><span class="p">,</span> <span class="n">etc</span><span class="p">]},</span> <span class="p">{</span><span class="n">items</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">}]).</span>
<span class="n">true</span>
<span class="mi">55</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">match</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="n">items</span><span class="p">,</span> <span class="n">'$1'</span><span class="p">,</span> <span class="n">'$2'</span><span class="p">,</span> <span class="n">'_'</span><span class="p">,</span> <span class="n">'$1'</span><span class="p">}).</span>
<span class="p">[[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="mi">56</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">match</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="n">items</span><span class="p">,</span> <span class="n">'$114'</span><span class="p">,</span> <span class="n">'$212'</span><span class="p">,</span> <span class="n">'_'</span><span class="p">,</span> <span class="n">'$6'</span><span class="p">}).</span>
<span class="p">[[</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],[</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="mi">57</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">match_object</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="n">items</span><span class="p">,</span> <span class="n">'$1'</span><span class="p">,</span> <span class="n">'$2'</span><span class="p">,</span> <span class="n">'_'</span><span class="p">,</span> <span class="n">'$1'</span><span class="p">}).</span>
<span class="p">[{</span><span class="n">items</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">a</span><span class="p">},{</span><span class="n">items</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">}]</span>
<span class="mi">58</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">delete</span><span class="p">(</span><span class="n">table</span><span class="p">).</span>
<span class="n">true</span>
</code></pre></div>
</div>
<h2 data-sourcepos="1069:1-1069:29" id="3-20-0" name="3-20-0">
<a class="anchor" id="29 分散システム EPMD" name="29%20%E5%88%86%E6%95%A3%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%20EPMD" href="#29%20%E5%88%86%E6%95%A3%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%20EPMD" data-position="3-20-0"><i class="fa fa-link"></i><span class="hidden" data-text="29 分散システム EPMD"> &gt; 29 分散システム EPMD</span></a>29 分散システム EPMD</h2>
<ul data-sourcepos="1070:1-1071:0">
<li data-sourcepos="1070:1-1071:0">今回は分散システム Erlang Port Mapper Daemon (EPMD) についてかんがえる。今回の章がSLAにもっとも関係しているといえそうである。ほかの言語・フレームワークが「分散コンピューティングの落とし穴」「CAP定理」にどのように対応している比較すると、Erlangの特徴がより見えてくるだろう。</li>
</ul>
<h3 data-sourcepos="1072:1-1072:35" id="3-20-1" name="3-20-1">
<a class="anchor" id="分散システムEPMDの特徴" name="%E5%88%86%E6%95%A3%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0EPMD%E3%81%AE%E7%89%B9%E5%BE%B4" href="#%E5%88%86%E6%95%A3%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0EPMD%E3%81%AE%E7%89%B9%E5%BE%B4" data-position="3-20-1"><i class="fa fa-link"></i><span class="hidden" data-text="分散システムEPMDの特徴"> &gt; 分散システムEPMDの特徴</span></a>分散システムEPMDの特徴</h3>
<p data-sourcepos="1073:1-1073:10"><strong>前提</strong></p>
<ul data-sourcepos="1074:1-1169:0">
<li data-sourcepos="1074:1-1079:104">分散システムによるFault toleranceについて
<ul data-sourcepos="1075:5-1079:104">
<li data-sourcepos="1075:5-1079:104">ソフトウェアの稼働状況と対ハードウェア障害リスク
<ul data-sourcepos="1076:9-1079:104">
<li data-sourcepos="1076:9-1077:41">マシン1台
<ul data-sourcepos="1077:13-1077:41">
<li data-sourcepos="1077:13-1077:41">リスク対策できない</li>
</ul>
</li>
<li data-sourcepos="1078:9-1079:104">マシン複数台
<ul data-sourcepos="1079:13-1079:104">
<li data-sourcepos="1079:13-1079:104">アプリケーションが正しく構築されない場合、リスク対策できない</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1080:1-1116:26">「分散コンピューティングの落とし穴」へのErlangの対応
<ul data-sourcepos="1081:5-1116:26">
<li data-sourcepos="1081:5-1084:236">ネットワークは信頼できる
<ul data-sourcepos="1082:9-1084:236">
<li data-sourcepos="1082:9-1084:236">Erlangの対応
<ul data-sourcepos="1083:13-1084:236">
<li data-sourcepos="1083:13-1083:155">非同期通信モード（リンクやモニタ）により、メッセージを送信に正常な場合に必ず返信するように設計</li>
<li data-sourcepos="1084:13-1084:236">ただし、ノード間でリンクやモニタを張った際にネットワーク障害起きた場合、リンクやモニタが一斉にトリガーされシステムに予期しない負荷をかけることになる</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1085:5-1087:113">レイテンシはゼロである
<ul data-sourcepos="1086:9-1087:113">
<li data-sourcepos="1086:9-1087:113">Erlangの対応
<ul data-sourcepos="1087:13-1087:113">
<li data-sourcepos="1087:13-1087:113">タイムアウト、リンク、モニタ、非同期パターンにより遅延を想定し設計</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1088:5-1090:53">帯域幅は無限である
<ul data-sourcepos="1089:9-1090:53">
<li data-sourcepos="1089:9-1090:53">Erlangの対応
<ul data-sourcepos="1090:13-1090:53">
<li data-sourcepos="1090:13-1090:53">大きなメッセージを送らない</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1091:5-1097:72">ネットワークはセキュアである
<ul data-sourcepos="1092:9-1097:72">
<li data-sourcepos="1092:9-1097:72">Erlangの対応
<ul data-sourcepos="1093:13-1097:72">
<li data-sourcepos="1093:13-1097:72">Erlangはネットワークの安全性を確認しないため
<ul data-sourcepos="1094:17-1097:72">
<li data-sourcepos="1094:17-1094:90">異なるデータセンター間で自動的にクラスタ化しない</li>
<li data-sourcepos="1095:17-1095:54">あるいは、SSLに切り替える</li>
<li data-sourcepos="1096:17-1096:69">安全なチャンネル越しにトンネルする</li>
<li data-sourcepos="1097:17-1097:72">ノード間の通信プロトコルを再実装する</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1098:5-1100:104">ネットワーク構成は変化せず一定である
<ul data-sourcepos="1099:9-1100:104">
<li data-sourcepos="1099:9-1100:104">Erlangの対応
<ul data-sourcepos="1100:13-1100:104">
<li data-sourcepos="1100:13-1100:104">アプリケーションでネットワーク構成（トポロジー）を管理しない</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1101:5-1105:65">管理者は1人である
<ul data-sourcepos="1102:9-1105:65">
<li data-sourcepos="1102:9-1105:65">Erlangの対応
<ul data-sourcepos="1103:13-1105:65">
<li data-sourcepos="1103:13-1103:62">デバッグツールによる個別障害対応</li>
<li data-sourcepos="1104:13-1104:80">ノード監視ツールによるシステム運用状況の共有</li>
<li data-sourcepos="1105:13-1105:65">実装プロトコルやAPIのバージョン管理</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1106:5-1110:72">転送コストはゼロである
<ul data-sourcepos="1107:9-1110:72">
<li data-sourcepos="1107:9-1110:72">Erlangの対応
<ul data-sourcepos="1108:13-1110:72">
<li data-sourcepos="1108:13-1110:72">Erlangはほかのノードに渡されるメッセージを圧縮しないため
<ul data-sourcepos="1109:17-1110:72">
<li data-sourcepos="1109:17-1109:57">送るメッセージを小さくする</li>
<li data-sourcepos="1110:17-1110:72">あるいは、独自の通信レイヤを実装する</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1111:5-1116:26">ネットワークは均質である
<ul data-sourcepos="1112:9-1116:26">
<li data-sourcepos="1112:9-1116:26">Erlangの対応
<ul data-sourcepos="1113:13-1116:26">
<li data-sourcepos="1113:13-1116:26">Erlangノードと同じプロトコル形式にして通信
<ul data-sourcepos="1114:17-1116:26">
<li data-sourcepos="1114:17-1114:28">Cノード</li>
<li data-sourcepos="1115:17-1115:22">BERT</li>
<li data-sourcepos="1116:17-1116:26">BERT-RPC</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1117:1-1169:0">障害（ノードの応答不能）への対応
<ul data-sourcepos="1118:5-1169:0">
<li data-sourcepos="1118:5-1123:20">下記の中から原因を特定するが確実には対応できない
<ul data-sourcepos="1119:9-1123:20">
<li data-sourcepos="1119:9-1119:34">ハードウェア障害</li>
<li data-sourcepos="1120:9-1120:49">アプリケーションクラッシュ</li>
<li data-sourcepos="1121:9-1123:20">ネットワーク分断
<ul data-sourcepos="1122:13-1123:20">
<li data-sourcepos="1122:13-1122:20">輻輳</li>
<li data-sourcepos="1123:13-1123:20">遮断</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1124:5-1127:152">ゾンビ化するということ
<ul data-sourcepos="1125:9-1127:152">
<li data-sourcepos="1125:9-1127:152">ネットワーク分断が起きている間アプリケーションが生きていた場合
<ul data-sourcepos="1126:13-1127:152">
<li data-sourcepos="1126:13-1126:179">当該ノードで保持していたデータがクラスタ間で保持していたデータと整合性がとれず、欠損扱いになる（一貫性の欠如）</li>
<li data-sourcepos="1127:13-1127:152">当該ノードからレスポンスが返ってこないため生きているか死んでいるかわからない（可用性の欠如）</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1128:5-1169:0">CAP（Consistency, Availability, Partition Tolerance）定理
<ul data-sourcepos="1129:9-1169:0">
<li data-sourcepos="1129:9-1135:99">ノード間において、同時に下記3つの要素を保証することはできない
<ul data-sourcepos="1130:13-1135:99">
<li data-sourcepos="1130:13-1131:156">一貫性 Consistency
<ul data-sourcepos="1131:17-1131:156">
<li data-sourcepos="1131:17-1131:156">すべてのデータ読み込みにおいて、最新の書き込みデータもしくはエラーのどちらかを受け取れること</li>
</ul>
</li>
<li data-sourcepos="1132:13-1133:79">可用性 Availability
<ul data-sourcepos="1133:17-1133:79">
<li data-sourcepos="1133:17-1133:79">システム要求に応答できること（SPOFがない）</li>
</ul>
</li>
<li data-sourcepos="1134:13-1135:99">分断耐性 Partition tolerance
<ul data-sourcepos="1135:17-1135:99">
<li data-sourcepos="1135:17-1135:99">ネットワーク分断時でもシステムを継続して運用できること</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1136:9-1169:0">組合せ、採用条件、採用ケース
<ul data-sourcepos="1137:13-1169:0">
<li data-sourcepos="1137:13-1144:25">CA
<ul data-sourcepos="1138:17-1144:25">
<li data-sourcepos="1138:17-1141:61">採用条件
<ul data-sourcepos="1139:21-1141:61">
<li data-sourcepos="1139:21-1139:70">ネットワークが絶対に落ちない場合</li>
<li data-sourcepos="1140:21-1140:86">ネットワークが1つの塊として動作している場合</li>
<li data-sourcepos="1141:21-1141:61">データの読み書きが多い場合</li>
</ul>
</li>
<li data-sourcepos="1142:17-1144:25">採用ケース
<ul data-sourcepos="1143:21-1144:25">
<li data-sourcepos="1143:21-1143:27">RDBMS</li>
<li data-sourcepos="1144:21-1144:25">NFS</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1145:13-1160:41">AP
<ul data-sourcepos="1146:17-1160:41">
<li data-sourcepos="1146:17-1155:66">採用条件
<ul data-sourcepos="1147:21-1155:66">
<li data-sourcepos="1147:21-1147:70">ネットワーク分断が起きやすい場合</li>
<li data-sourcepos="1148:21-1148:41">SPOFがない場合</li>
<li data-sourcepos="1149:21-1149:97">ネットワーク分断時データ変更不可だと問題がある場合</li>
<li data-sourcepos="1150:21-1155:66">結果整合性を適用可能な場合
<ul data-sourcepos="1151:25-1155:66">
<li data-sourcepos="1151:25-1151:41">時間ベース</li>
<li data-sourcepos="1152:25-1152:59">個別にコンフリクト解消</li>
<li data-sourcepos="1153:25-1155:66">全ノードによる合意
<ul data-sourcepos="1154:29-1155:66">
<li data-sourcepos="1154:29-1154:57">合意割合による調整</li>
<li data-sourcepos="1155:29-1155:66">問い合わせ対象による調整</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1156:17-1160:41">採用ケース
<ul data-sourcepos="1157:21-1160:41">
<li data-sourcepos="1157:21-1157:37">Amazon SimpleDB</li>
<li data-sourcepos="1158:21-1158:38">Apache Cassandra</li>
<li data-sourcepos="1159:21-1159:25">DNS</li>
<li data-sourcepos="1160:21-1160:41">HTTPキャッシュ</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1161:13-1169:0">CP
<ul data-sourcepos="1162:17-1169:0">
<li data-sourcepos="1162:17-1165:94">採用条件
<ul data-sourcepos="1163:21-1165:94">
<li data-sourcepos="1163:21-1163:70">ネットワーク分断が起きやすい場合</li>
<li data-sourcepos="1164:21-1164:41">SPOFがある場合</li>
<li data-sourcepos="1165:21-1165:94">ネットワーク分断時データ変更不可でも問題ない場合</li>
</ul>
</li>
<li data-sourcepos="1166:17-1169:0">採用ケース
<ul data-sourcepos="1167:21-1169:0">
<li data-sourcepos="1167:21-1167:28">Mnesia</li>
<li data-sourcepos="1168:21-1169:0">Apache HBase</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p data-sourcepos="1170:1-1170:31"><strong>Erlangが提供する道具</strong></p>
<ul data-sourcepos="1171:1-1191:0">
<li data-sourcepos="1171:1-1187:89">ノードとEPMD
<ul data-sourcepos="1172:5-1187:89">
<li data-sourcepos="1172:5-1182:53">特徴
<ul data-sourcepos="1173:9-1182:53">
<li data-sourcepos="1173:9-1173:64">ノードとはErlang VMのインスタンスのこと</li>
<li data-sourcepos="1174:9-1175:113">各ノードはEPMDに接続されている
<ul data-sourcepos="1175:13-1175:113">
<li data-sourcepos="1175:13-1175:113">新しいノードは自動的にErlangクラスタに接続され、各ノードに接続される</li>
</ul>
</li>
<li data-sourcepos="1176:9-1180:48">接続されているノードでも完全に独立している
<ul data-sourcepos="1177:13-1180:48">
<li data-sourcepos="1177:13-1180:48">各ノードが固有に保持しているもの
<ul data-sourcepos="1178:17-1180:48">
<li data-sourcepos="1178:17-1178:45">プロセスレジストリ</li>
<li data-sourcepos="1179:17-1179:33">ETSテーブル</li>
<li data-sourcepos="1180:17-1180:48">読み込んだモジュール</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1181:9-1181:98">EPMDはErlangクラスタの一部として、各コンピューター上で稼働する</li>
<li data-sourcepos="1182:9-1182:53">EPMDは名前サーバとして機能する</li>
</ul>
</li>
<li data-sourcepos="1183:5-1184:25">Pros
<ul data-sourcepos="1184:9-1184:25">
<li data-sourcepos="1184:9-1184:25">Fault tolerance</li>
</ul>
</li>
<li data-sourcepos="1185:5-1187:89">Cons
<ul data-sourcepos="1186:9-1187:89">
<li data-sourcepos="1186:9-1187:89">1ノードにつき1エフェメラルポートが必要になるため、Scalingに制限がある
<ul data-sourcepos="1187:13-1187:89">
<li data-sourcepos="1187:13-1187:89">対処として、ノードのグループを小さなクラスタに分割</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1188:1-1188:44">シリアライズ、デシリアライズ</li>
<li data-sourcepos="1189:1-1189:23">マルチプロセス</li>
<li data-sourcepos="1190:1-1191:0">ネットワークの障害監視</li>
</ul>
<p data-sourcepos="1192:1-1192:37"><strong>Erlangクラスタを設定する</strong></p>
<ul data-sourcepos="1193:1-1257:0">
<li data-sourcepos="1193:1-1204:79">ノードの名前解決
<ul data-sourcepos="1194:5-1204:79">
<li data-sourcepos="1194:5-1197:30">長い名前
<ul data-sourcepos="1195:9-1197:30">
<li data-sourcepos="1195:9-1195:60">aaa.bbb.cccのような完全修飾ドメイン名</li>
<li data-sourcepos="1196:9-1196:43">DNSリゾルバによって解決</li>
<li data-sourcepos="1197:9-1197:30"><code>erl -name LongName</code></li>
</ul>
</li>
<li data-sourcepos="1198:5-1201:32">短い名前
<ul data-sourcepos="1199:9-1201:32">
<li data-sourcepos="1199:9-1199:43">ピリオドがないホスト名</li>
<li data-sourcepos="1200:9-1200:67">ホストファイルやDNSエントリによって解決</li>
<li data-sourcepos="1201:9-1201:32"><code>erl -sname ShortName</code></li>
</ul>
</li>
<li data-sourcepos="1202:5-1204:79">注意点
<ul data-sourcepos="1203:9-1204:79">
<li data-sourcepos="1203:9-1203:110">1台のコンピューター上でErlangノードを設定する際は通常短い名前をつかう</li>
<li data-sourcepos="1204:9-1204:79">長い名前と短い名前、双方でのやり取りはできない</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1205:1-1218:24">関数
<ul data-sourcepos="1206:5-1218:24">
<li data-sourcepos="1206:5-1206:51">
<code>net_kernel:connect_node/1</code> - ノード接続</li>
<li data-sourcepos="1207:5-1209:43">ノード名参照
<ul data-sourcepos="1208:9-1209:43">
<li data-sourcepos="1208:9-1208:51">
<code>node/0</code> - 現在のノード名を参照</li>
<li data-sourcepos="1209:9-1209:43">
<code>nodes/0</code> - 接続ノード参照</li>
</ul>
</li>
<li data-sourcepos="1210:5-1213:69">リンクとモニタ
<ul data-sourcepos="1211:9-1213:69">
<li data-sourcepos="1211:9-1211:52">
<code>link</code> - ノードをまたいだリンク</li>
<li data-sourcepos="1212:9-1212:157">
<code>erlang:monitor/2</code> - ノードをまたいだモニタ（ネットワーク分断時に一斉に活性化し負荷が増加する可能性あり）</li>
<li data-sourcepos="1213:9-1213:69">
<code>erlang:monitor_node/2</code> - ノードを指定したモニタ</li>
</ul>
</li>
<li data-sourcepos="1214:5-1218:24">遠隔操作
<ul data-sourcepos="1215:9-1218:24">
<li data-sourcepos="1215:9-1215:19"><code>spawn/2</code></li>
<li data-sourcepos="1216:9-1216:19"><code>spawn/4</code></li>
<li data-sourcepos="1217:9-1217:24"><code>spawn_link/2</code></li>
<li data-sourcepos="1218:9-1218:24"><code>spawn_link/4</code></li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1219:1-1223:31">クラスタのUIDトークンとしてのCookie
<ul data-sourcepos="1220:5-1223:31">
<li data-sourcepos="1220:5-1223:31">関数
<ul data-sourcepos="1221:9-1223:31">
<li data-sourcepos="1221:9-1221:54"><code>erl -sname ShortName -setcookie CookieName</code></li>
<li data-sourcepos="1222:9-1222:31"><code>erlang:get_cookei/0</code></li>
<li data-sourcepos="1223:9-1223:31"><code>erlang:set_cookei/2</code></li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1224:1-1229:52">隠しノード
<ul data-sourcepos="1225:5-1229:52">
<li data-sourcepos="1225:5-1225:261">クラスタを介してノード接続すると、クラスタ間で予期しないメッセージ通信がおこなわれる可能性があるため、それを防止する策としてクラスタを介さず接続可能な隠しノード機能がある</li>
<li data-sourcepos="1226:5-1229:52">関数
<ul data-sourcepos="1227:9-1229:52">
<li data-sourcepos="1227:9-1227:99">
<code>erlang:send(Dest, Message, [noconnect])</code> - クラスタを介さずにノードに接続</li>
<li data-sourcepos="1228:9-1228:94">
<code>erl -sname ShortName -hidden</code> - クラスタを介さずに隠しノードに接続</li>
<li data-sourcepos="1229:9-1229:52">
<code>nodes(hidden)</code> - 隠しノードを参照</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1230:1-1235:103">ポート範囲指定
<ul data-sourcepos="1231:5-1235:103">
<li data-sourcepos="1231:5-1231:38">EPMDのポート番号は <code>4369</code>
</li>
<li data-sourcepos="1232:5-1235:103">設定方法
<ul data-sourcepos="1233:9-1235:103">
<li data-sourcepos="1233:9-1233:98"><code>erl -name LongName -kernel inet_dist_listen_min 9100 -kernel inet_dist_listen_max 9115</code></li>
<li data-sourcepos="1234:9-1235:103">
<code>erl -name LongName -config ports</code><ul data-sourcepos="1235:13-1235:103">
<li data-sourcepos="1235:13-1235:103">ports.config: <code>[{kernel, [{inet_dist_listen_min, 9100}, {inet_dist_listen_max, 9115}]}].</code>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1236:1-1257:0">分散用モジュール
<ul data-sourcepos="1237:5-1257:0">
<li data-sourcepos="1237:5-1239:144">
<code>net_kernel</code><ul data-sourcepos="1238:9-1239:144">
<li data-sourcepos="1238:9-1238:104">
<code>start([Name, Type, HeartbeatInMilliseconds])</code> - インスタンスを一時的にノード化</li>
<li data-sourcepos="1239:9-1239:144">
<code>set_net_ticktime(Milliseconds)</code> - Ticktime（ハートビートを4倍した時間、ノードの死亡判定時間）を設定変更</li>
</ul>
</li>
<li data-sourcepos="1240:5-1248:197">
<code>global</code> - プロセスレジストリの代替
<ul data-sourcepos="1241:9-1248:197">
<li data-sourcepos="1241:9-1241:66">
<code>register_name(Name, Pid)</code> - gloabl登録し名前変更</li>
<li data-sourcepos="1242:9-1242:65">
<code>unregister_name(Name, Pid)</code> - globalから名前解除</li>
<li data-sourcepos="1243:9-1243:105">
<code>re_register_name(Name, Pid)</code> - 参照先の喪失を防ぎながらglobal登録し名前変更</li>
<li data-sourcepos="1244:9-1244:42">
<code>whereis_name(Name)</code> - PID探索</li>
<li data-sourcepos="1245:9-1245:55">
<code>send(Name, Message)</code> - メッセージ送信</li>
<li data-sourcepos="1246:9-1246:73">
<code>random_exit_name/3</code> - ランダムにプロセスをkillする</li>
<li data-sourcepos="1247:9-1247:222">
<code>random_notify_name/3</code> - 2つのプロセスのうちいかすプロセスをランダムに1つ選び、globalから解除されるプロセスに <code>{global_name_conflict, Name}</code> というメッセージを送信</li>
<li data-sourcepos="1248:9-1248:197">
<code>notify_all_name/3</code> - 指定したPIDプロセスをglobalから解除し、 <code>{global_name_conflict, Name, OtherPid}</code> というメッセージを送信、コンフリクト解消を促す</li>
</ul>
</li>
<li data-sourcepos="1249:5-1257:0">
<code>rpc</code><ul data-sourcepos="1250:9-1257:0">
<li data-sourcepos="1250:9-1250:56"><code>call(Node, Module, Function, Args[, Timout])</code></li>
<li data-sourcepos="1251:9-1251:54"><code>async_call(Node, Mod, Fun, Args[, Timout])</code></li>
<li data-sourcepos="1252:9-1252:27"><code>yield(AsyncPid)</code></li>
<li data-sourcepos="1253:9-1253:86">
<code>nb_yield(AsyncPid[, Timeout])</code> - ポーリング、ロングポーリング</li>
<li data-sourcepos="1254:9-1254:65">
<code>cast(Node, Mod, Fun, Args)</code> - 返値なしのコール</li>
<li data-sourcepos="1255:9-1255:77">
<code>multicall(Nodes, Mod, Fun, Args)</code> - 複数ノードへのコール</li>
<li data-sourcepos="1256:9-1257:0">
<code>eval_everywhere(Nodes, Mod, Fun, Args)</code> - 複数ノードへの命令（コールとほぼ同じ）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="1258:1-1258:15" id="3-21-0" name="3-21-0">
<a class="anchor" id="30 分散OTP" name="30%20%E5%88%86%E6%95%A3OTP" href="#30%20%E5%88%86%E6%95%A3OTP" data-position="3-21-0"><i class="fa fa-link"></i><span class="hidden" data-text="30 分散OTP"> &gt; 30 分散OTP</span></a>30 分散OTP</h2>
<ul data-sourcepos="1259:1-1260:0">
<li data-sourcepos="1259:1-1260:0">前回の分散の章でnine ninesのなぞが見えてきた。今回はそれを補完する分散OTPについてかんがえる。</li>
</ul>
<h3 data-sourcepos="1261:1-1261:43" id="3-21-1" name="3-21-1">
<a class="anchor" id="分散アプリケーションの特徴" name="%E5%88%86%E6%95%A3%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%89%B9%E5%BE%B4" href="#%E5%88%86%E6%95%A3%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%89%B9%E5%BE%B4" data-position="3-21-1"><i class="fa fa-link"></i><span class="hidden" data-text="分散アプリケーションの特徴"> &gt; 分散アプリケーションの特徴</span></a>分散アプリケーションの特徴</h3>
<p data-sourcepos="1262:1-1262:10"><strong>構成</strong></p>
<ul data-sourcepos="1263:1-1271:0">
<li data-sourcepos="1263:1-1266:35">標準アプリケーション
<ul data-sourcepos="1264:5-1266:35">
<li data-sourcepos="1264:5-1266:35">アプリケーションコントローラ（ノード）
<ul data-sourcepos="1265:9-1266:35">
<li data-sourcepos="1265:9-1266:35">アプリケーションマスタ
<ul data-sourcepos="1266:13-1266:35">
<li data-sourcepos="1266:13-1266:35">スーパーバイザ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1267:1-1271:0">分散アプリケーション
<ul data-sourcepos="1268:5-1271:0">
<li data-sourcepos="1268:5-1271:0">アプリケーションコントローラ（ノード）
<ul data-sourcepos="1269:9-1271:0">
<li data-sourcepos="1269:9-1271:0">アプリケーションマスタ
<ul data-sourcepos="1270:13-1271:0">
<li data-sourcepos="1270:13-1271:0">スーパーバイザ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p data-sourcepos="1272:1-1272:25"><strong>ライフサイクル</strong></p>
<ul data-sourcepos="1273:1-1286:0">
<li data-sourcepos="1273:1-1277:16">標準アプリケーション
<ol data-sourcepos="1274:5-1277:16">
<li data-sourcepos="1274:5-1274:16">読込中</li>
<li data-sourcepos="1275:5-1275:16">起動中</li>
<li data-sourcepos="1276:5-1276:16">停止中</li>
<li data-sourcepos="1277:5-1277:16">解放中</li>
</ol>
</li>
<li data-sourcepos="1278:1-1286:0">分散アプリケーション
<ol data-sourcepos="1279:5-1286:0">
<li data-sourcepos="1279:5-1279:16">読込中</li>
<li data-sourcepos="1280:5-1281:85">起動中
<ul data-sourcepos="1281:9-1281:85">
<li data-sourcepos="1281:9-1281:85">稼働中の分散ノードが死んだら稼働中ステータスに移行</li>
</ul>
</li>
<li data-sourcepos="1282:5-1283:59">稼働中
<ul data-sourcepos="1283:9-1283:59">
<li data-sourcepos="1283:9-1283:59">稼働中ステータスは1つのノードのみ</li>
</ul>
</li>
<li data-sourcepos="1284:5-1284:16">停止中</li>
<li data-sourcepos="1285:5-1286:0">解放中</li>
</ol>
</li>
</ul>
<p data-sourcepos="1287:1-1287:19"><strong>再起動戦略</strong></p>
<ul data-sourcepos="1288:1-1298:0">
<li data-sourcepos="1288:1-1290:101">特徴
<ul data-sourcepos="1289:5-1290:101">
<li data-sourcepos="1289:5-1289:86">ハードウェア障害を前提にしたCAシステムでよくとられます</li>
<li data-sourcepos="1290:5-1290:101">ネットワーク分断を前提にしたCPシステムの場合は採用を熟慮すること</li>
</ul>
</li>
<li data-sourcepos="1291:1-1298:0">2つの戦略
<ul data-sourcepos="1292:5-1298:0">
<li data-sourcepos="1292:5-1295:89">フェイルオーバー
<ul data-sourcepos="1293:9-1295:89">
<li data-sourcepos="1293:9-1295:89">アプリケーション停止後、別の場所で再起動する戦略
<ul data-sourcepos="1294:13-1295:89">
<li data-sourcepos="1294:13-1294:68">メインとバックアップを入れ替える方法</li>
<li data-sourcepos="1295:13-1295:89">複数台サーバを立ち上げて相互に負荷を補完しあう方法</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1296:5-1298:0">テイクオーバー
<ul data-sourcepos="1297:9-1298:0">
<li data-sourcepos="1297:9-1298:0">アプリケーション復活後、バックアップからメインに移行する戦略</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-sourcepos="1299:1-1299:12" id="3-22-0" name="3-22-0">
<a class="anchor" id="32 Mnesia" name="32%20Mnesia" href="#32%20Mnesia" data-position="3-22-0"><i class="fa fa-link"></i><span class="hidden" data-text="32 Mnesia"> &gt; 32 Mnesia</span></a>32 Mnesia</h2>
<h3 data-sourcepos="1300:1-1300:19" id="3-22-1" name="3-22-1">
<a class="anchor" id="Mnesiaの特徴" name="Mnesia%E3%81%AE%E7%89%B9%E5%BE%B4" href="#Mnesia%E3%81%AE%E7%89%B9%E5%BE%B4" data-position="3-22-1"><i class="fa fa-link"></i><span class="hidden" data-text="Mnesiaの特徴"> &gt; Mnesiaの特徴</span></a>Mnesiaの特徴</h3>
<ul data-sourcepos="1301:1-1312:0">
<li data-sourcepos="1301:1-1305:88">Pros
<ul data-sourcepos="1302:5-1305:88">
<li data-sourcepos="1302:5-1305:88">CPシステム（NoSQL）
<ul data-sourcepos="1303:9-1305:88">
<li data-sourcepos="1303:9-1303:47">トランザクション機能 (ACID)</li>
<li data-sourcepos="1304:9-1305:88">ネットワーク分断につよい
<ul data-sourcepos="1305:13-1305:88">
<li data-sourcepos="1305:13-1305:88">ただし、10ノード前後が実用上の限界と考えられている</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1306:1-1312:0">Cons
<ul data-sourcepos="1307:5-1312:0">
<li data-sourcepos="1307:5-1308:51">各テーブルにつき2Gの容量制限
<ul data-sourcepos="1308:9-1308:51">
<li data-sourcepos="1308:9-1308:51">Table Frangmentation機能で回避可能</li>
</ul>
</li>
<li data-sourcepos="1309:5-1309:72">厳密なシステム要求に応答することはむずかしい</li>
<li data-sourcepos="1310:5-1310:84">数テラバイトの大きなデータをあつかうのに向いていない</li>
<li data-sourcepos="1311:5-1312:0">組込型制限がない</li>
</ul>
</li>
</ul>
<p data-sourcepos="1313:1-1313:31"><strong>適切なユースケース</strong></p>
<ul data-sourcepos="1314:1-1317:0">
<li data-sourcepos="1314:1-1317:0">下記条件をみたした場合
<ul data-sourcepos="1315:5-1317:0">
<li data-sourcepos="1315:5-1315:69">ノード数、データ量双方を見積もることが可能</li>
<li data-sourcepos="1316:5-1317:0">ETS/DETS（タプル）形式でアクセス可能</li>
</ul>
</li>
</ul>
<p data-sourcepos="1318:1-1318:31"><strong>テーブルオプション</strong></p>
<ul data-sourcepos="1319:1-1327:0">
<li data-sourcepos="1319:1-1322:125">保存方法
<ul data-sourcepos="1320:5-1322:125">
<li data-sourcepos="1320:5-1320:109">
<code>ram_copies</code> - データをETS（メモリ）にのみ保存、32ビットマシンで4Gの容量制限</li>
<li data-sourcepos="1321:5-1321:78">
<code>disc_only_copies</code> - データをDETSにのみ保存、2Gの容量制限</li>
<li data-sourcepos="1322:5-1322:125">
<code>disc_copies</code> - データをETSとDETS双方に保存、DETSの2G容量制限はない、通常はこちらはつかう</li>
</ul>
</li>
<li data-sourcepos="1323:1-1327:0">テーブル種類
<ul data-sourcepos="1324:5-1327:0">
<li data-sourcepos="1324:5-1324:11"><code>set</code></li>
<li data-sourcepos="1325:5-1325:11"><code>bag</code></li>
<li data-sourcepos="1326:5-1327:0"><code>ordered_set</code></li>
</ul>
</li>
</ul>
<p data-sourcepos="1328:1-1328:7"><strong>CLI</strong></p>
<ul data-sourcepos="1329:1-1330:0">
<li data-sourcepos="1329:1-1330:0">
<code>erl -name LongName -mnesia dir path/to/db</code> - <code>dir</code> 変数でスキーマ保存場所を指定</li>
</ul>
<p data-sourcepos="1331:1-1331:10"><strong>関数</strong></p>
<ul data-sourcepos="1332:1-1357:0">
<li data-sourcepos="1332:1-1354:14">
<code>mnesia</code><ul data-sourcepos="1333:5-1354:14">
<li data-sourcepos="1333:5-1333:34"><code>create_schema(ListOfNodes)</code></li>
<li data-sourcepos="1334:5-1341:181">
<code>create_table(TableName, Option)</code><ul data-sourcepos="1335:9-1341:181">
<li data-sourcepos="1335:9-1341:181">オプション
<ul data-sourcepos="1336:13-1341:181">
<li data-sourcepos="1336:13-1336:64">
<code>{attributes, List}</code> - テーブルのカラム名</li>
<li data-sourcepos="1337:13-1337:125">
<code>{disc_copies, NodeList}</code> <code>{disc_only_copies, NodeList}</code> <code>{ram_copies, NodeList}</code> - テーブルの保存場所</li>
<li data-sourcepos="1338:13-1338:69">
<code>{index, ListOfIntegers}</code> - インデックスをはる</li>
<li data-sourcepos="1339:13-1339:74">
<code>{record_name, Atom}</code> - テーブルの別名（非推奨）</li>
<li data-sourcepos="1340:13-1340:79">
<code>{type, Type}</code> - テーブル種類 (<code>set</code>, <code>ordered_set</code>, <code>bag</code>)</li>
<li data-sourcepos="1341:13-1341:181">
<code>{local_content, Boolean}</code> - デフォルト <code>false</code>。<code>true</code> にすると、多数のノード上に共有されない固有のローカルテーブルを作成する</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1342:5-1342:62">
<code>wait_for_tables</code> - テーブル読込完了まで待機</li>
<li data-sourcepos="1343:5-1349:67">
<code>activity(AccessContext, Fun[, Args])</code> - クエリの実行方法を指定
<ul data-sourcepos="1344:9-1349:67">
<li data-sourcepos="1344:9-1349:67">AccessContextの種類
<ul data-sourcepos="1345:13-1349:67">
<li data-sourcepos="1345:13-1345:150">
<code>transaction</code> - 非同期トランザクション、トランザクションの完了を待つわけではないので正確ではない</li>
<li data-sourcepos="1346:13-1346:65">
<code>sync_transaction</code> - 同期トランザクション</li>
<li data-sourcepos="1347:13-1347:63">
<code>async_dirty</code> - 非同期のロックなし処理</li>
<li data-sourcepos="1348:13-1348:59">
<code>sync_dirty</code> - 同期のロックなし処理</li>
<li data-sourcepos="1349:13-1349:67">
<code>ets</code> - MnesiaをつかわずETSテーブルで処理</li>
</ul>
</li>
</ul>
</li>
<li data-sourcepos="1350:5-1350:13"><code>write</code></li>
<li data-sourcepos="1351:5-1351:14"><code>delete</code></li>
<li data-sourcepos="1352:5-1352:12"><code>read</code></li>
<li data-sourcepos="1353:5-1353:20"><code>match_object</code></li>
<li data-sourcepos="1354:5-1354:14"><code>select</code></li>
</ul>
</li>
<li data-sourcepos="1355:1-1357:0">
<code>application</code><ul data-sourcepos="1356:5-1357:0">
<li data-sourcepos="1356:5-1357:0">
<code>set_env(mnesia, dir, "path/to/db")</code> - スキーマ保存場所を指定</li>
</ul>
</li>
</ul>
<p data-sourcepos="1358:1-1358:34"><strong>クエリリスト内包表記</strong></p>
<ul data-sourcepos="1359:1-1363:0">
<li data-sourcepos="1359:1-1363:0">
<code>qlc</code><ul data-sourcepos="1360:5-1363:0">
<li data-sourcepos="1360:5-1360:49">
<code>q(Fun, Generator)</code> - クエリハンドル</li>
<li data-sourcepos="1361:5-1361:34">
<code>eval(QueryHandle)</code> - 評価</li>
<li data-sourcepos="1362:5-1363:0"><code>fold(Fun, Dict, QueryHandle)</code></li>
</ul>
</li>
</ul>
<h2 data-sourcepos="1364:1-1364:14" id="3-23-0" name="3-23-0">
<a class="anchor" id="33 Dialyzer" name="33%20Dialyzer" href="#33%20Dialyzer" data-position="3-23-0"><i class="fa fa-link"></i><span class="hidden" data-text="33 Dialyzer"> &gt; 33 Dialyzer</span></a>33 Dialyzer</h2>
<p data-sourcepos="1365:1-1365:71">今回は静的型チェッカーDialyzerについてかんがえる。</p>
<h3 data-sourcepos="1367:1-1367:21" id="3-23-1" name="3-23-1">
<a class="anchor" id="Dialyzerの特徴" name="Dialyzer%E3%81%AE%E7%89%B9%E5%BE%B4" href="#Dialyzer%E3%81%AE%E7%89%B9%E5%BE%B4" data-position="3-23-1"><i class="fa fa-link"></i><span class="hidden" data-text="Dialyzerの特徴"> &gt; Dialyzerの特徴</span></a>Dialyzerの特徴</h3>
<p data-sourcepos="1368:1-1368:7"><strong>CLI</strong></p>
<ul data-sourcepos="1369:1-1375:0">
<li data-sourcepos="1369:1-1371:56">PLT (Persistent Lookup Table 永続的探索表)
<ul data-sourcepos="1370:5-1371:56">
<li data-sourcepos="1370:5-1370:96">
<code>dialyzer --build_plt --apps erts kernel stdlib mnesia sasl common_test eunit</code> - PLT作成</li>
<li data-sourcepos="1371:5-1371:56">
<code>dialyzer --add_to_plt --apps reltool</code> - PLT追加</li>
</ul>
</li>
<li data-sourcepos="1372:1-1375:0">型チェック
<ul data-sourcepos="1373:5-1375:0">
<li data-sourcepos="1373:5-1373:56">
<code>dialyzer foo/src/bar.erl</code> - ファイルを解析</li>
<li data-sourcepos="1374:5-1375:0">
<code>dialyzer -r foo/src bar/src --src</code> - ディレクトリ指定してerlファイルを解析</li>
</ul>
</li>
</ul>
<p data-sourcepos="1376:1-1376:16"><strong>Erlangの型</strong></p>
<ul data-sourcepos="1377:1-1423:0">
<li data-sourcepos="1377:1-1382:30">シングルトン型 - それ自体が型を示すオブジェクト
<ul data-sourcepos="1378:5-1382:30">
<li data-sourcepos="1378:5-1378:30">
<code>'some atom</code> - アトム</li>
<li data-sourcepos="1379:5-1379:19">
<code>42</code> - 整数</li>
<li data-sourcepos="1380:5-1380:25">
<code>[]</code> - 空リスト</li>
<li data-sourcepos="1381:5-1381:25">
<code>{}</code> - 空タプル</li>
<li data-sourcepos="1382:5-1382:30">
<code>&lt;&lt;&gt;&gt;</code> - 空バイナリ</li>
</ul>
</li>
<li data-sourcepos="1383:1-1408:94">BIF型
<ul data-sourcepos="1384:5-1408:94">
<li data-sourcepos="1384:5-1384:13"><code>any()</code></li>
<li data-sourcepos="1385:5-1385:14"><code>none()</code></li>
<li data-sourcepos="1386:5-1386:13"><code>pid()</code></li>
<li data-sourcepos="1387:5-1387:14"><code>port()</code></li>
<li data-sourcepos="1388:5-1388:19"><code>reference()</code></li>
<li data-sourcepos="1389:5-1389:14"><code>atom()</code></li>
<li data-sourcepos="1390:5-1390:14"><code>atom()</code></li>
<li data-sourcepos="1391:5-1391:16"><code>binary()</code></li>
<li data-sourcepos="1392:5-1392:54">
<code>&lt;&lt;_:Integer&gt;&gt;</code> - 特定サイズのバイナリ</li>
<li data-sourcepos="1393:5-1393:103">
<code>&lt;&lt;_:*Integer&gt;&gt;</code> - 特定のユニットサイズで長さは指定されていないバイナリ</li>
<li data-sourcepos="1394:5-1394:124">
<code>&lt;&lt;_:Integer, _:_*OtherInteger&gt;&gt;</code> - 上記2つの組み合わせ、バイナリの最小の長さを指定する形式</li>
<li data-sourcepos="1395:5-1395:17"><code>integer()</code></li>
<li data-sourcepos="1396:5-1396:30">
<code>N..M</code> - 整数の範囲</li>
<li data-sourcepos="1397:5-1397:25"><code>non_neg_integer()</code></li>
<li data-sourcepos="1398:5-1398:54">
<code>pos_integer()</code> - ゼロより大きい自然数</li>
<li data-sourcepos="1399:5-1399:36">
<code>neg_integer()</code> - 負の整数</li>
<li data-sourcepos="1400:5-1400:15"><code>float()</code></li>
<li data-sourcepos="1401:5-1401:43">
<code>fun()</code> - あらゆる種類の関数</li>
<li data-sourcepos="1402:5-1402:110">
<code>fun((...) -&gt; Type)</code> - 引数のアリティが決まっていない、特定の肩を返す無名関数</li>
<li data-sourcepos="1403:5-1403:23"><code>fun(() -&gt; Type)</code></li>
<li data-sourcepos="1404:5-1404:47"><code>fun((Type1, Type2, ..., TypeN) -&gt; Type)</code></li>
<li data-sourcepos="1405:5-1405:49">
<code>[Type()]</code> - 特定の型を持つリスト</li>
<li data-sourcepos="1406:5-1406:102">
<code>[Type(), ...]</code> - 特定の型を持つリスト、またリストが空でないことを示す</li>
<li data-sourcepos="1407:5-1407:15"><code>tuple()</code></li>
<li data-sourcepos="1408:5-1408:94">
<code>{Type1, Type2, ..., TypeN}</code> - 全要素の型とサイズがわかっているタプル</li>
</ul>
</li>
<li data-sourcepos="1409:1-1423:0">エイリアス型
<ul data-sourcepos="1410:5-1423:0">
<li data-sourcepos="1410:5-1410:14"><code>term()</code></li>
<li data-sourcepos="1411:5-1411:38">
<code>boolean()</code> - <code>'true' | 'false'</code>
</li>
<li data-sourcepos="1412:5-1412:25">
<code>byte()</code> - <code>0..255</code>
</li>
<li data-sourcepos="1413:5-1413:31">
<code>char()</code> - <code>0..16#10ffff</code>
</li>
<li data-sourcepos="1414:5-1414:40">
<code>number()</code> - <code>integer() | float()</code>
</li>
<li data-sourcepos="1415:5-1415:67">
<code>maybe_improper_list()</code> - <code>maybe_improper_list(any(), any())</code>
</li>
<li data-sourcepos="1416:5-1416:64">
<code>maybe_improper_list(T)</code> - <code>maybe_improper_list(T, any())</code>
</li>
<li data-sourcepos="1417:5-1417:29">
<code>string()</code> - <code>[char()]</code>
</li>
<li data-sourcepos="1418:5-1418:85">
<code>iolist()</code> - <code>maybe_improper_list(char() | binary() | iolist(), binary() | [])</code>
</li>
<li data-sourcepos="1419:5-1419:27">
<code>module()</code> - <code>atom()</code>
</li>
<li data-sourcepos="1420:5-1420:39">
<code>timeout()</code> - <code>non_neg_integer()</code>
</li>
<li data-sourcepos="1421:5-1421:26">
<code>node()</code> - アトム</li>
<li data-sourcepos="1422:5-1423:0">
<code>no_return()</code> - <code>none()</code>
</li>
</ul>
</li>
</ul>
<p data-sourcepos="1424:1-1424:34"><strong>判定できない例と対策</strong></p>
<div class="code-block" data-sourcepos="1425:1-1444:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">cards</span><span class="p">).</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">kind</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">main</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>

<span class="p">-</span><span class="ni">type</span> <span class="nf">suit</span><span class="p">()</span> <span class="p">::</span> <span class="n">spades</span> <span class="p">|</span> <span class="n">clubs</span> <span class="p">|</span> <span class="n">hearts</span> <span class="p">|</span> <span class="n">diamonds</span><span class="p">.</span>
<span class="p">-</span><span class="ni">type</span> <span class="nf">value</span><span class="p">()</span> <span class="p">::</span> <span class="mi">1</span><span class="p">..</span><span class="mi">10</span> <span class="p">|</span> <span class="n">j</span> <span class="p">|</span> <span class="n">q</span> <span class="p">|</span> <span class="n">k</span><span class="p">.</span>
<span class="p">-</span><span class="ni">type</span> <span class="nf">card</span><span class="p">()</span> <span class="p">::</span> <span class="p">{</span><span class="nf">suit</span><span class="p">(),</span> <span class="nf">value</span><span class="p">()}.</span>

<span class="p">-</span><span class="ni">spec</span> <span class="nf">kind</span><span class="p">(</span><span class="nf">card</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">'face'</span> <span class="p">|</span> <span class="n">'number'</span><span class="p">.</span> <span class="c">% 注釈をくわえることでdialyzerに警告させる
</span><span class="nf">kind</span><span class="p">({_,</span> <span class="nv">A</span><span class="p">})</span> <span class="k">when</span> <span class="nv">A</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">A</span> <span class="o">=&lt;</span> <span class="mi">10</span> <span class="o">-&gt;</span>
    <span class="n">number</span><span class="p">;</span>
<span class="nf">kind</span><span class="p">(_)</span> <span class="o">-&gt;</span>
    <span class="n">face</span><span class="p">.</span>

<span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nf">kind</span><span class="p">({</span><span class="n">spades</span><span class="p">,</span> <span class="mi">7</span><span class="p">}),</span>
    <span class="n">face</span> <span class="o">=</span> <span class="nf">kind</span><span class="p">({</span><span class="n">hearts</span><span class="p">,</span> <span class="n">k</span><span class="p">}),</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nf">kind</span><span class="p">({</span><span class="n">rubies</span><span class="p">,</span> <span class="mi">4</span><span class="p">}),</span> <span class="c">% タプルの中の型が違う
</span>    <span class="n">face</span> <span class="o">=</span> <span class="nf">kind</span><span class="p">({</span><span class="n">clubs</span><span class="p">,</span> <span class="n">q</span><span class="p">}).</span>
</code></pre></div>
</div>
<div class="code-block" data-sourcepos="1446:1-1465:3">
<div class="code-filename">
<i class="fa fa-file-code-o"></i>erlang</div>
<div class="highlight"><pre class="highlight erlang"><code><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">convert</span><span class="p">).</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">main</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>

<span class="c">%% 注釈をつけないとdialyzerは下記のように判定する
% -spec convert(list() | tuple()) -&gt; list() | tuple().
</span><span class="p">-</span><span class="ni">spec</span> <span class="nf">convert</span><span class="p">(</span><span class="nf">tuple</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nf">list</span><span class="p">();</span>
             <span class="p">(</span><span class="nf">list</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nf">tuple</span><span class="p">().</span>
<span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="p">[_,</span> <span class="p">_]</span> <span class="o">=</span> <span class="nf">convert</span><span class="p">({</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">}),</span>
    <span class="p">{_,</span> <span class="p">_}</span> <span class="o">=</span> <span class="nf">convert</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]),</span>
    <span class="p">[_,</span> <span class="p">_]</span> <span class="o">=</span> <span class="nf">convert</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]),</span>
    <span class="p">{_,</span> <span class="p">_}</span> <span class="o">=</span> <span class="nf">convert</span><span class="p">({</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">}).</span>

<span class="c">%% private
</span><span class="nf">convert</span><span class="p">(</span><span class="nv">Tup</span><span class="p">)</span> <span class="k">when</span> <span class="nb">is_tuple</span><span class="p">(</span><span class="nv">Tup</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nb">tuple_to_list</span><span class="p">(</span><span class="nv">Tup</span><span class="p">);</span>
<span class="nf">convert</span><span class="p">(</span><span class="nv">L</span><span class="o">=</span><span class="p">[_|_])</span> <span class="o">-&gt;</span>
    <span class="nb">list_to_tuple</span><span class="p">(</span><span class="nv">L</span><span class="p">).</span>
</code></pre></div>
</div>
</div><style data-emotion-css="k022ln">.css-k022ln > .heading{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:4.375rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-k022ln > .heading > .avatar{height:50px;width:50;margin-right:8px;border-radius:21px;}.css-k022ln > .heading > .description > a{color:#58463C;}.css-k022ln > .heading > .description > a:hover{color:#80695F;}</style><div class="css-k022ln ewgr1al0"><div class="heading"><img class="avatar" src="https://pbs.twimg.com/profile_images/1342772423859392512/fMR9l4Sv_400x400.jpg" alt="nabinno"/><div class="description">Emacsianでアート好き、ランニング好きな@nabinnoが書いています<br/><a href="https://utagaki.com/nabinno" target="_blank" rel="noopener noreferrer">Utagaki</a> / <a href="https://github.com/nabinno" target="_blank" rel="noopener noreferrer">GitHub</a> / <a href="https://twitter.com/nabinno" target="_blank" rel="noopener noreferrer">Twitter</a> / <a href="https://linkedin.com/in/nabinno" target="_blank" rel="noopener noreferrer">LinkedIn</a> / <a href="https://www.wantedly.com/companies/nextinnovation" target="_blank" rel="noopener noreferrer">ネクイノ</a></div></div></div></div><style data-emotion-css="1r17nfx">.css-1r17nfx{box-shadow:none;color:inherit;display:block;-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-1r17nfx" href="/posts/89"><style data-emotion-css="xbv8og">.css-xbv8og{height:100%;background-color:white;border-radius:8px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border-bottom:1px solid #eee;padding:20px 12px;}@media (min-width:624px){.css-xbv8og{padding-left:0;padding-right:0;}}.css-xbv8og:hover .title{color:#80695F;}</style><div class="css-xbv8og"><style data-emotion-css="19idom">.css-19idom{margin-bottom:8px;}</style><div class="css-19idom eff00rj1"><style data-emotion-css="lhqszh">.css-lhqszh{line-height:1.4;background-color:white;font-weight:600;display:inline-block;font-size:12px;background-image:linear-gradient( 45deg,#58463C 0px,#80695F 100% );color:white;text-transform:capitalize;-webkit-letter-spacing:0.2px;-moz-letter-spacing:0.2px;-ms-letter-spacing:0.2px;letter-spacing:0.2px;border-style:solid;border-color:rgb(221,221,221);border-image:initial;margin:0px 8px 4px 0px;padding:4px 6px;border-radius:3px;border-width:0px;}</style><div class="css-lhqszh eff00rj0">blog/backend</div><style data-emotion-css="jsyva2">.css-jsyva2{margin-bottom:1px;font-size:18px;line-height:1.48;color:#1a202c;}</style><h3 class="title css-jsyva2 eff00rj2">imi-enrichment-addressは住所のバリデーションチェックでどの程度使えるか</h3><style data-emotion-css="1p4gbp4">.css-1p4gbp4{color:#1a202c;opacity:0.6;font-size:14px;line-height:1.6;word-break:break-all;overflow-y:hidden;max-height:67.2px;}</style><p class="css-1p4gbp4 eff00rj3">コロナ禍であらゆる流通がオンラインに移行する中、正しい住所を使うことはいっそう求められています。ユーザーが配送用に住所を入力する時そのデータが正しいとどうやって判定するのでしょうか。今回はOSSライブ</p></div><style data-emotion-css="8xl60i">.css-8xl60i{margin-top:auto;}</style><div class="css-8xl60i eff00rj4"><style data-emotion-css="2qp2g2">.css-2qp2g2{font-size:12px;font-weight:700;color:#666;}.css-2qp2g2:after{content:' ';width:1px;height:100%;background-color:#ddd;display:inline-block;}</style><time class="css-2qp2g2 eff00rj5">2021/07/23</time></div></div></a><a class="css-1r17nfx" href="/posts/80"><div class="css-xbv8og"><div class="css-19idom eff00rj1"><div class="css-lhqszh eff00rj0">blog/backend</div><h3 class="title css-jsyva2 eff00rj2">AWS Organizationsを別のAWSアカウントに移行する</h3><p class="css-1p4gbp4 eff00rj3">最近のAWSはCDKの発表に代表されるようにインフラ以外の開発者が触りやすい環境が整ってきています。ただ、こうした機能やリソースを存分に享受するにはIAM管理だけでは不足しており、AWSアカウントの管</p></div><div class="css-8xl60i eff00rj4"><time class="css-2qp2g2 eff00rj5">2021/05/13</time><style data-emotion-css="om1c75">.css-om1c75{font-size:12px;margin-left:4px;}.css-om1c75:before{content:'#';}</style><span class="css-om1c75 eff00rj6">aws-organizations</span></div></div></a><a class="css-1r17nfx" href="/posts/55"><div class="css-xbv8og"><div class="css-19idom eff00rj1"><div class="css-lhqszh eff00rj0">blog/backend</div><h3 class="title css-jsyva2 eff00rj2">PositiveSSLをHerokuに適用する</h3><p class="css-1p4gbp4 eff00rj3">年に1回のSSL更新のイベントです。毎年同じことをすれば良いかというとそうでもなく、販社と卸の都合でSSLの購入方法が微妙に変わります。とは言え、毎年一から調べ直すのも手間なので備忘として記しておきま</p></div><div class="css-8xl60i eff00rj4"><time class="css-2qp2g2 eff00rj5">2017/04/23</time></div></div></a></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-314558-24', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/65";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c2af0f9bcfb46c63126b.js"],"app":["/app-1609d7d465ccd6a5a330.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-7a73fce44527957a28a5.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-557e62df0f80429a7567.js"],"component---src-templates-posts-tsx":["/component---src-templates-posts-tsx-01adf45b9f8003118fcd.js"]};/*]]>*/</script><script src="/polyfill-c2af0f9bcfb46c63126b.js" nomodule=""></script><script src="/component---src-templates-post-tsx-557e62df0f80429a7567.js" async=""></script><script src="/component---src-templates-posts-tsx-01adf45b9f8003118fcd.js" async=""></script><script src="/commons-d1e204551af284801370.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-1609d7d465ccd6a5a330.js" async=""></script><script src="/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/webpack-runtime-7a7e64c679eaacb6bc0d.js" async=""></script></body></html>