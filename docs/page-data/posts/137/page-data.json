{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/137","result":{"data":{"esaPost":{"number":137,"relative_category":"blog/backend","fields":{"title":"G Suite無償版停止に伴い、MXレコード等のドメイン管理を整理した","excerpt":"今回は10年以上利用していたG Suite無償版が2022年8月に停止されるとのことで、メールアドレスの管理をどうするか検討しました。メール管理は別のGMailアカウントを使っていたので、転送できれば良いのですが、これを機にドメイン管理をAWSにまとめていくことを思いつきました。   > PROBLEMPROBLEM \n\n- 10年以上利用していたG Suite無償版が2022年8月に停止され、メールアドレスの管理をどうしようか Google Workspaceにアップグレードしても良いけどBusiness Starterプランにしても面白みがないので別の方法を探したい G Suiteはメールしか利用しておらず、メール管理は別のGMailアカウントを使っていたのでメール転送機能で代替できそう \n- Google Workspaceにアップグレードしても良いけどBusiness Starterプランにしても面白みがないので別の方法を探したい G Suiteはメールしか利用しておらず、メール管理は別のGMailアカウントを使っていたのでメール転送機能で代替できそう \n- G Suiteはメールしか利用しておらず、メール管理は別のGMailアカウントを使っていたのでメール転送機能で代替できそう  > SOLUTIONSOLUTION \n\nと言うわけで、今回はG Suiteアカウントの利用を止めて、MXレコード周りを整理することにしました。個人利用なのでドメイン管理は既存のままで良かったのですが、証跡管理のない状況に耐えられずAWSに移管。メール転送機能はPOBOX以外はサブアドレス対応していなかったのですが、キャッチオール対応できるのでまずは良しとしています。現時点での構成は下記の通り。 \n\nなお、複数人数で必要になった場合は、サブアドレスとグループアドレスが対応可能なAmazon Workmailに移管する予定ですが、これでもGoogle Workspaceを利用するよりコストは半分程で済みます。  > 構成構成  > beforebefore \n\n- ドメイン管理 バリュードメイン\n- NSレコード Cloudflare DNS\n- MXレコード G Suite\n- SMTP G Suite  > afterafter \n\n- ドメイン管理 Amazon Route 53\n- NSレコード Amazon Route 53\n- MXレコード Cloudflare Email Routing\n- SMTP Amazon SES  > 手順手順 \n\n方針が決まるまでいくつかメールサービスを検討したのですが、決まってしまえばやることは単純です。  > 1. ドメイン管理を整理する1. ドメイン管理を整理する \n\n基本はドメイン移管申請ですが、G Suiteを後ほど削除することを考慮してMXレコードをCloudflare Email Routingに変更。本来はこの処理の前にG Suiteに紐付いている各サービスの設定変更が必要になります。 \n\n1. 移管元にてWHOIS情報公開代行の解除\n2. 移管元にてドメインロックの解除\n3. 移管元にて認証鍵 (Auth-Code) を確認\n4. 移管先にてホストゾーンの作成、各レコードの内容を移管元に合わせる\n5. Cloudflare Email Routingにて転送先メールアドレスを検証する\n6. 移管先にてMXレコードをCloudflare Email Routingのものを設定する\n7. 移管元のNSレコードを移管先に変更\n8. 移管先にて認証鍵をつかい移管申請を行う\n9. 移管元に対して移管申請を行った旨をメールにて連携する \n\nCf. \n\n- ドメインの他社への移管 | バリュードメイン ユーザーガイド\n- ドメイン登録の Amazon Route 53 への移管 - Amazon Route 53\n- Easily creating and routing email addresses with Cloudflare Email Routing  > 2. SMTPを設定する2. SMTPを設定する \n\n最近はセキュリティ対策のためGMailのSMTPが使いづらくなっているので、今回はAmazon SESを利用しました。サンドボックス解除のため下記の通りサポートに依頼しました。 txt\n\n# メールタイプ 通例の取引がメインとなる予定です # ユースケース ## メールを送信する頻度 週に1-2回 ## 受信者リストのメンテナンス方法 四半期に一度の棚卸し ## バウンス対応 当該メールアドレスの削除 ## 申し立て対応 当該メールアドレスへのフラグ管理 ## 解除申請の管理方法 メールでの受付 ## 送信予定のメールサンプル {{宛先名}}様 お世話になっております。 表題の件につきまして1点問い合わせします。 {{問い合わせ内容}} ご不明な点等ございましたらお気軽にお問い合わせ下さい。 どうぞ、よろしくお願い致します。   > 3. G Suiteを退会する3. G Suiteを退会する \n\nG Suiteに依存しているサービスがないか確認し、退会します。  > WRAPUPWRAPUP \n\n以前からドメイン管理をAWSに移管したかったのですが、積極的な理由がないためなおざりになっていました。今回のG Suite無償版の期限切れに伴い整理できすっきりしたので、これを機にいろいろ整理していきたいですね。  > 後日談後日談 \n\nCloudflare DNSからAmazon Route 53に設定を変更した数日後、Cloudflare Email Routingが使用できなくなりました。転送機能としてドメイン管理から切り離されていると思ったのですがそうではなかったようです。ドメイン管理は厳しめに証跡を取っていきたいところなので、Amazon Route 53による管理は譲れません。 \n\nまた、Amazon SESによる転送機能も検討したのですが、送信元すべてに対してドメイン検証が必要なため現実的ではありませんでした。AWSにはメール転送の種類が2つあって、送信元を転送者に置き換える「転送」と送信元をそのまま利用する「リダイレクト」があります。「転送」だと元の送信元とコミュニケーションが取りづらくなる一方、「リダイレクト」だとすべての送信元のドメイン検証が必要となります。ここでは融通が利かないと判断するのではなく、セキュリティを考慮された実装と捉え、AWSが提供しているWorkMailを素直に使うことにしました。慣れればたいしたことはありません。下記が結果になります。  > beforebefore \n\n- ドメイン管理 Amazon Route 53\n- NSレコード Amazon Route 53\n- MXレコード Cloudflare Email Routing\n- SMTP Amazon SES  > afterafter \n\n- ドメイン管理 Amazon Route 53\n- NSレコード Amazon Route 53\n- MXレコード Amazon WorkMail\n- SMTP Amazon WorkMail","thumbnail":"https://img.esa.io/uploads/production/attachments/16651/2022/04/13/97367/51630abf-d1d2-4244-bf28-7820c1072275.jpg"},"wip":false,"body_md":"今回は10年以上利用していた[G Suite無償版が2022年8月に停止される](https://support.google.com/a/answer/60217)とのことで、メールアドレスの管理をどうするか検討しました。メール管理は別のGMailアカウントを使っていたので、転送できれば良いのですが、これを機にドメイン管理をAWSにまとめていくことを思いつきました。\r\n\r\n<img width=\"952\" alt=\"thumbnail\" src=\"https://img.esa.io/uploads/production/attachments/16651/2022/04/13/97367/51630abf-d1d2-4244-bf28-7820c1072275.jpg\">\r\n\r\n# PROBLEM\r\n- 10年以上利用していたG Suite無償版が2022年8月に停止され、メールアドレスの管理をどうしようか\r\n    - Google Workspaceにアップグレードしても良いけどBusiness Starterプランにしても面白みがないので別の方法を探したい\r\n        - G Suiteはメールしか利用しておらず、メール管理は別のGMailアカウントを使っていたのでメール転送機能で代替できそう\r\n\r\n# SOLUTION\r\nと言うわけで、今回はG Suiteアカウントの利用を止めて、MXレコード周りを整理することにしました。個人利用なのでドメイン管理は既存のままで良かったのですが、証跡管理のない状況に耐えられずAWSに移管。メール転送機能はPOBOX以外はサブアドレス対応していなかったのですが、キャッチオール対応できるのでまずは良しとしています。現時点での構成は下記の通り。\r\n\r\nなお、複数人数で必要になった場合は、サブアドレスとグループアドレスが対応可能なAmazon Workmailに移管する予定ですが、これでもGoogle Workspaceを利用するよりコストは半分程で済みます。\r\n\r\n## 構成\r\n### before\r\n- ドメイン管理 バリュードメイン\r\n- NSレコード Cloudflare DNS\r\n- MXレコード G Suite\r\n- SMTP G Suite\r\n\r\n### after\r\n- ドメイン管理 Amazon Route 53\r\n- NSレコード Amazon Route 53\r\n- MXレコード Cloudflare Email Routing\r\n- SMTP Amazon SES\r\n\r\n## 手順\r\n方針が決まるまでいくつかメールサービスを検討したのですが、決まってしまえばやることは単純です。\r\n\r\n### 1. ドメイン管理を整理する\r\n基本はドメイン移管申請ですが、G Suiteを後ほど削除することを考慮してMXレコードをCloudflare Email Routingに変更。本来はこの処理の前にG Suiteに紐付いている各サービスの設定変更が必要になります。\r\n\r\n1. 移管元にてWHOIS情報公開代行の解除\r\n2. 移管元にてドメインロックの解除\r\n3. 移管元にて認証鍵 (Auth-Code) を確認\r\n4. 移管先にてホストゾーンの作成、各レコードの内容を移管元に合わせる\r\n5. Cloudflare Email Routingにて転送先メールアドレスを検証する\r\n6. 移管先にてMXレコードをCloudflare Email Routingのものを設定する\r\n7. 移管元のNSレコードを移管先に変更\r\n8. 移管先にて認証鍵をつかい移管申請を行う\r\n9. 移管元に対して移管申請を行った旨をメールにて連携する\r\n\r\nCf.\r\n- [ドメインの他社への移管 | バリュードメイン ユーザーガイド](https://www.value-domain.com/userguide/manual/transferother)\r\n- [ドメイン登録の Amazon Route 53 への移管 - Amazon Route 53](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html#domain-transfer-to-route-53-request-transfer)\r\n- [Easily creating and routing email addresses with Cloudflare Email Routing](https://blog.cloudflare.com/introducing-email-routing/)\r\n\r\n### 2. SMTPを設定する\r\n最近はセキュリティ対策のためGMailのSMTPが使いづらくなっているので、今回はAmazon SESを利用しました。サンドボックス解除のため下記の通りサポートに依頼しました。\r\n\r\n```txt\r\n# メールタイプ\r\n通例の取引がメインとなる予定です\r\n\r\n# ユースケース\r\n## メールを送信する頻度\r\n週に1-2回\r\n\r\n## 受信者リストのメンテナンス方法\r\n四半期に一度の棚卸し\r\n\r\n## バウンス対応\r\n当該メールアドレスの削除\r\n\r\n## 申し立て対応\r\n当該メールアドレスへのフラグ管理\r\n\r\n## 解除申請の管理方法\r\nメールでの受付\r\n\r\n## 送信予定のメールサンプル\r\n{{宛先名}}様\r\nお世話になっております。\r\n表題の件につきまして1点問い合わせします。\r\n{{問い合わせ内容}}\r\nご不明な点等ございましたらお気軽にお問い合わせ下さい。\r\nどうぞ、よろしくお願い致します。\r\n```\r\n\r\n## 3. G Suiteを退会する\r\nG Suiteに依存しているサービスがないか確認し、退会します。\r\n\r\n# WRAPUP\r\n以前からドメイン管理をAWSに移管したかったのですが、積極的な理由がないためなおざりになっていました。今回のG Suite無償版の期限切れに伴い整理できすっきりしたので、これを機にいろいろ整理していきたいですね。\r\n\r\n## 後日談\r\nCloudflare DNSからAmazon Route 53に設定を変更した数日後、Cloudflare Email Routingが使用できなくなりました。転送機能としてドメイン管理から切り離されていると思ったのですがそうではなかったようです。ドメイン管理は厳しめに証跡を取っていきたいところなので、Amazon Route 53による管理は譲れません。\r\n\r\nまた、Amazon SESによる転送機能も検討したのですが、送信元すべてに対してドメイン検証が必要なため現実的ではありませんでした。AWSにはメール転送の種類が2つあって、送信元を転送者に置き換える「転送」と送信元をそのまま利用する「リダイレクト」があります。「転送」だと元の送信元とコミュニケーションが取りづらくなる一方、「リダイレクト」だとすべての送信元のドメイン検証が必要となります。ここでは融通が利かないと判断するのではなく、セキュリティを考慮された実装と捉え、AWSが提供しているWorkMailを素直に使うことにしました。慣れればたいしたことはありません。下記が結果になります。\r\n\r\n### before\r\n- ドメイン管理 Amazon Route 53\r\n- NSレコード Amazon Route 53\r\n- MXレコード Cloudflare Email Routing\r\n- SMTP Amazon SES\r\n\r\n## after\r\n- ドメイン管理 Amazon Route 53\r\n- NSレコード Amazon Route 53\r\n- MXレコード Amazon WorkMail\r\n- SMTP Amazon WorkMail\r\n","body_html":"<p data-sourcepos=\"1:1-1:421\">今回は10年以上利用していた<a href=\"https://support.google.com/a/answer/60217\" target=\"_blank\" rel=\"noopener noreferrer\">G Suite無償版が2022年8月に停止される</a>とのことで、メールアドレスの管理をどうするか検討しました。メール管理は別のGMailアカウントを使っていたので、転送できれば良いのですが、これを機にドメイン管理をAWSにまとめていくことを思いつきました。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/16651/2022/04/13/97367/51630abf-d1d2-4244-bf28-7820c1072275.jpg\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"952\" alt=\"thumbnail\" src=\"https://img.esa.io/uploads/production/attachments/16651/2022/04/13/97367/51630abf-d1d2-4244-bf28-7820c1072275.jpg\"></a>\n<h1 data-sourcepos=\"5:1-5:9\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"PROBLEM\" name=\"PROBLEM\" href=\"#PROBLEM\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"PROBLEM\"> &gt; PROBLEM</span></a>PROBLEM</h1>\n<ul data-sourcepos=\"6:1-9:0\">\n<li data-sourcepos=\"6:1-9:0\">10年以上利用していたG Suite無償版が2022年8月に停止され、メールアドレスの管理をどうしようか\n<ul data-sourcepos=\"7:5-9:0\">\n<li data-sourcepos=\"7:5-9:0\">Google Workspaceにアップグレードしても良いけどBusiness Starterプランにしても面白みがないので別の方法を探したい\n<ul data-sourcepos=\"8:9-9:0\">\n<li data-sourcepos=\"8:9-9:0\">G Suiteはメールしか利用しておらず、メール管理は別のGMailアカウントを使っていたのでメール転送機能で代替できそう</li>\n</ul></li>\n</ul></li>\n</ul>\n<h1 data-sourcepos=\"10:1-10:10\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"SOLUTION\" name=\"SOLUTION\" href=\"#SOLUTION\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SOLUTION\"> &gt; SOLUTION</span></a>SOLUTION</h1>\n<p data-sourcepos=\"11:1-11:500\">と言うわけで、今回はG Suiteアカウントの利用を止めて、MXレコード周りを整理することにしました。個人利用なのでドメイン管理は既存のままで良かったのですが、証跡管理のない状況に耐えられずAWSに移管。メール転送機能はPOBOX以外はサブアドレス対応していなかったのですが、キャッチオール対応できるのでまずは良しとしています。現時点での構成は下記の通り。</p>\n<p data-sourcepos=\"13:1-13:253\">なお、複数人数で必要になった場合は、サブアドレスとグループアドレスが対応可能なAmazon Workmailに移管する予定ですが、これでもGoogle Workspaceを利用するよりコストは半分程で済みます。</p>\n<h2 data-sourcepos=\"15:1-15:9\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"構成\" name=\"構成\" href=\"#構成\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"構成\"> &gt; 構成</span></a>構成</h2>\n<h3 data-sourcepos=\"16:1-16:10\" id=\"2-1-1\" name=\"2-1-1\"><a class=\"anchor\" id=\"before\" name=\"before\" href=\"#before\" data-position=\"2-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"before\"> &gt; before</span></a>before</h3>\n<ul data-sourcepos=\"17:1-21:0\">\n<li data-sourcepos=\"17:1-17:45\">ドメイン管理 バリュードメイン</li>\n<li data-sourcepos=\"18:1-18:31\">NSレコード Cloudflare DNS</li>\n<li data-sourcepos=\"19:1-19:24\">MXレコード G Suite</li>\n<li data-sourcepos=\"20:1-21:0\">SMTP G Suite</li>\n</ul>\n<h3 data-sourcepos=\"22:1-22:9\" id=\"2-1-2\" name=\"2-1-2\"><a class=\"anchor\" id=\"after\" name=\"after\" href=\"#after\" data-position=\"2-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"after\"> &gt; after</span></a>after</h3>\n<ul data-sourcepos=\"23:1-27:0\">\n<li data-sourcepos=\"23:1-23:36\">ドメイン管理 Amazon Route 53</li>\n<li data-sourcepos=\"24:1-24:32\">NSレコード Amazon Route 53</li>\n<li data-sourcepos=\"25:1-25:41\">MXレコード Cloudflare Email Routing</li>\n<li data-sourcepos=\"26:1-27:0\">SMTP Amazon SES</li>\n</ul>\n<h2 data-sourcepos=\"28:1-28:9\" id=\"2-2-0\" name=\"2-2-0\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h2>\n<p data-sourcepos=\"29:1-29:141\">方針が決まるまでいくつかメールサービスを検討したのですが、決まってしまえばやることは単純です。</p>\n<h3 data-sourcepos=\"31:1-31:40\" id=\"2-2-1\" name=\"2-2-1\"><a class=\"anchor\" id=\"1. ドメイン管理を整理する\" name=\"1. ドメイン管理を整理する\" href=\"#1. ドメイン管理を整理する\" data-position=\"2-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1. ドメイン管理を整理する\"> &gt; 1. ドメイン管理を整理する</span></a>1. ドメイン管理を整理する</h3>\n<p data-sourcepos=\"32:1-32:265\">基本はドメイン移管申請ですが、G Suiteを後ほど削除することを考慮してMXレコードをCloudflare Email Routingに変更。本来はこの処理の前にG Suiteに紐付いている各サービスの設定変更が必要になります。</p>\n<ol data-sourcepos=\"34:1-43:0\">\n<li data-sourcepos=\"34:1-34:50\">移管元にてWHOIS情報公開代行の解除</li>\n<li data-sourcepos=\"35:1-35:48\">移管元にてドメインロックの解除</li>\n<li data-sourcepos=\"36:1-36:49\">移管元にて認証鍵 (Auth-Code) を確認</li>\n<li data-sourcepos=\"37:1-37:99\">移管先にてホストゾーンの作成、各レコードの内容を移管元に合わせる</li>\n<li data-sourcepos=\"38:1-38:78\">Cloudflare Email Routingにて転送先メールアドレスを検証する</li>\n<li data-sourcepos=\"39:1-39:83\">移管先にてMXレコードをCloudflare Email Routingのものを設定する</li>\n<li data-sourcepos=\"40:1-40:50\">移管元のNSレコードを移管先に変更</li>\n<li data-sourcepos=\"41:1-41:60\">移管先にて認証鍵をつかい移管申請を行う</li>\n<li data-sourcepos=\"42:1-43:0\">移管元に対して移管申請を行った旨をメールにて連携する</li>\n</ol>\n<p data-sourcepos=\"44:1-44:3\">Cf.</p>\n<ul data-sourcepos=\"45:1-48:0\">\n<li data-sourcepos=\"45:1-45:147\"><a href=\"https://www.value-domain.com/userguide/manual/transferother\" target=\"_blank\" rel=\"noopener noreferrer\">ドメインの他社への移管 | バリュードメイン ユーザーガイド</a></li>\n<li data-sourcepos=\"46:1-46:217\"><a href=\"https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html#domain-transfer-to-route-53-request-transfer\" target=\"_blank\" rel=\"noopener noreferrer\">ドメイン登録の Amazon Route&nbsp;53 への移管 - Amazon Route&nbsp;53</a></li>\n<li data-sourcepos=\"47:1-48:0\"><a href=\"https://blog.cloudflare.com/introducing-email-routing/\" target=\"_blank\" rel=\"noopener noreferrer\">Easily creating and routing email addresses with Cloudflare Email Routing</a></li>\n</ul>\n<h3 data-sourcepos=\"49:1-49:26\" id=\"2-2-2\" name=\"2-2-2\"><a class=\"anchor\" id=\"2. SMTPを設定する\" name=\"2. SMTPを設定する\" href=\"#2. SMTPを設定する\" data-position=\"2-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2. SMTPを設定する\"> &gt; 2. SMTPを設定する</span></a>2. SMTPを設定する</h3>\n<p data-sourcepos=\"50:1-50:226\">最近はセキュリティ対策のためGMailのSMTPが使いづらくなっているので、今回はAmazon SESを利用しました。サンドボックス解除のため下記の通りサポートに依頼しました。</p>\n<div class=\"code-block\" data-sourcepos=\"52:1-79:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>txt</div><div class=\"highlight\"><pre class=\"highlight plaintext\"><code># メールタイプ\n通例の取引がメインとなる予定です\n\n# ユースケース\n## メールを送信する頻度\n週に1-2回\n\n## 受信者リストのメンテナンス方法\n四半期に一度の棚卸し\n\n## バウンス対応\n当該メールアドレスの削除\n\n## 申し立て対応\n当該メールアドレスへのフラグ管理\n\n## 解除申請の管理方法\nメールでの受付\n\n## 送信予定のメールサンプル\n{{宛先名}}様\nお世話になっております。\n表題の件につきまして1点問い合わせします。\n{{問い合わせ内容}}\nご不明な点等ございましたらお気軽にお問い合わせ下さい。\nどうぞ、よろしくお願い致します。\n</code></pre></div></div>\n<h2 data-sourcepos=\"81:1-81:28\" id=\"2-3-0\" name=\"2-3-0\"><a class=\"anchor\" id=\"3. G Suiteを退会する\" name=\"3. G Suiteを退会する\" href=\"#3. G Suiteを退会する\" data-position=\"2-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"3. G Suiteを退会する\"> &gt; 3. G Suiteを退会する</span></a>3. G Suiteを退会する</h2>\n<p data-sourcepos=\"82:1-82:82\">G Suiteに依存しているサービスがないか確認し、退会します。</p>\n<h1 data-sourcepos=\"84:1-84:8\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"WRAPUP\" name=\"WRAPUP\" href=\"#WRAPUP\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"WRAPUP\"> &gt; WRAPUP</span></a>WRAPUP</h1>\n<p data-sourcepos=\"85:1-85:298\">以前からドメイン管理をAWSに移管したかったのですが、積極的な理由がないためなおざりになっていました。今回のG Suite無償版の期限切れに伴い整理できすっきりしたので、これを機にいろいろ整理していきたいですね。</p>\n<h2 data-sourcepos=\"87:1-87:12\" id=\"3-1-0\" name=\"3-1-0\"><a class=\"anchor\" id=\"後日談\" name=\"後日談\" href=\"#後日談\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"後日談\"> &gt; 後日談</span></a>後日談</h2>\n<p data-sourcepos=\"88:1-88:401\">Cloudflare DNSからAmazon Route 53に設定を変更した数日後、Cloudflare Email Routingが使用できなくなりました。転送機能としてドメイン管理から切り離されていると思ったのですがそうではなかったようです。ドメイン管理は厳しめに証跡を取っていきたいところなので、Amazon Route 53による管理は譲れません。</p>\n<p data-sourcepos=\"90:1-90:835\">また、Amazon SESによる転送機能も検討したのですが、送信元すべてに対してドメイン検証が必要なため現実的ではありませんでした。AWSにはメール転送の種類が2つあって、送信元を転送者に置き換える「転送」と送信元をそのまま利用する「リダイレクト」があります。「転送」だと元の送信元とコミュニケーションが取りづらくなる一方、「リダイレクト」だとすべての送信元のドメイン検証が必要となります。ここでは融通が利かないと判断するのではなく、セキュリティを考慮された実装と捉え、AWSが提供しているWorkMailを素直に使うことにしました。慣れればたいしたことはありません。下記が結果になります。</p>\n<h3 data-sourcepos=\"92:1-92:10\" id=\"3-1-1\" name=\"3-1-1\"><a class=\"anchor\" id=\"before-1\" name=\"before-1\" href=\"#before-1\" data-position=\"3-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"before\"> &gt; before</span></a>before</h3>\n<ul data-sourcepos=\"93:1-97:0\">\n<li data-sourcepos=\"93:1-93:36\">ドメイン管理 Amazon Route 53</li>\n<li data-sourcepos=\"94:1-94:32\">NSレコード Amazon Route 53</li>\n<li data-sourcepos=\"95:1-95:41\">MXレコード Cloudflare Email Routing</li>\n<li data-sourcepos=\"96:1-97:0\">SMTP Amazon SES</li>\n</ul>\n<h2 data-sourcepos=\"98:1-98:8\" id=\"3-2-0\" name=\"3-2-0\"><a class=\"anchor\" id=\"after-1\" name=\"after-1\" href=\"#after-1\" data-position=\"3-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"after\"> &gt; after</span></a>after</h2>\n<ul data-sourcepos=\"99:1-102:22\">\n<li data-sourcepos=\"99:1-99:36\">ドメイン管理 Amazon Route 53</li>\n<li data-sourcepos=\"100:1-100:32\">NSレコード Amazon Route 53</li>\n<li data-sourcepos=\"101:1-101:32\">MXレコード Amazon WorkMail</li>\n<li data-sourcepos=\"102:1-102:22\">SMTP Amazon WorkMail</li>\n</ul>\n","tags":["gsuite","google-workspace","cloudflare","amazon-ses","amazon-workmail"],"updated_at":"2022-04-17T15:48:38+09:00","childPublishedDate":{"published_on":"2022-04-12T00:00:00.000Z"},"updated_by":{"name":"なびの👷","screen_name":"nabinno","icon":"https://img.esa.io/uploads/production/members/94286/icon/thumb_m_7b757a0db07cde6a337af7df901ab0c5.jpg"}},"relatedPosts":{"edges":[{"node":{"number":66,"relative_category":"blog","fields":{"title":"On Blahfe","excerpt":"txt\n\n（小学校の作文より） ぼくは、二年の時、友達と自転車で、じゅくから帰ってくるとちゅう、トラックに足をふまれてしまいました。おほりの近くの道路でトラックが来たから、よけようとした時、ころんで足を道路にだしてしまったのです。 いたみは感じなかったのに、なぜか泣いてしまい、トラックのおじさんたちが「けがはなかったかい」と心配してくれました。それでも、ぼくが泣いてるもんだから、病院に行って、レントゲンで見てもらいました。全然いじょうはなかったそうです。 その時、ぼくはほっとして、これからは自分で安全を守ろうと、決心しました。ただ、三年になってしまうと、安全を守ろうなんていう決心は、とっくに忘れてしまいました。 三年の五月になって、お父さんと兄弟と友達で郡山ダムまでサイクリングに行きました。行くときは、よかったんだけど、帰りの時、坂で足をすべらして、自転車のスポークの中につま先をはめてしまいました。その勢いで、自転車が、一回転してしまいました。 たまたま車が通って、中の農家の人が「どうしたんだい」と、話しかけてくれました。ぼくは、足の方のいたさで、話すこともできませんでした。それから、農家の人が、心配して、家までつれていってくれました。 家に帰ると、安心して、泣いてしまいました。それから、病院に行ってレントゲンをとって見ると、お医者さんがだいじょうぶといっていました。とってもよかったです。 また、ぼくは、自分で安全を守ろうと、心に決めました。  \n\n※ 上記シーンは自身のテーマである「痛み」と向き合いながら、過去の出来事から学び取るエピソードとして描かれています。個人的な成長と共に、安全に対する意識も高めていく様子が見て取れます。  > サイト構成サイト構成 \n\nある方曰く、痛みとは人の根源だそうで。小学校の作文ではないですが、私がいつも気にしてるテーマです。 \n\n- 退屈\n- 寂しさ\n- 肉体の痛み\n- 健康喪失の恐れ\n- 金銭ストレス\n- 虚しさ \n\nこのブログは、PROBLEM-SOLUTIONの2つのセクションを通して、私自身の成長と向き合いながら、読者の皆さんにも共感を呼び起こすような内容を発信していきたいと考えています。PROBLEMは上記テーマのどれかが当てはまります。SOLUTIONでは、私が個人的に試してみた問題解決の手法やアプローチを紹介します。これらの方法は、私の職業や日常生活に近いものだけでなく、自分自身の成長や心の豊かさを追求するためのものも含まれています。人間の根源的な問題に直面する経験と、それに対する解決策を通して、共に成長していくことを願っています。"},"name":"[2017-01-31]On Blahfe","tags":["blahfe"],"childPublishedDate":{"published_on":"2017-01-31T00:00:00.000Z","published_on_unix":1485820800}}},{"node":{"number":44,"relative_category":"blog/organization","fields":{"title":"整理したい私はITILをかぶる、PlantUMLへの愛","excerpt":"現在、ネクイノでエンジニアリングマネージャー、バックエンドエンジニア、インフラエンジニアを担当している私は、年の瀬を迎えて振り返り記事を書くことに決めました。この記事では、PlantUMLに絞り、振り返ることで気づいた問題点とその解決策を詳細に描写します。PlantUMLは私にとって全知全能のツールではありませんが、愛しているツールであり、これまでの8ヶ月間の成長を共有したいと思います。   > PROBLEMPROBLEM \n\n振り返ることで私が気づいた主な問題点は、開発チーム全体がまだ機能していないことでした。管理規程はあるものの、業務フローが明示化されておらず、誰が何を何の目的で業務を回しているか分からない状態でした。この可視化されていないプロセスが問題になるケースが増えてきました。  > SOLUTIONSOLUTION \n\nこの問題に対して、私は入社早々PlantUML1を活用して業務フローの可視化を始めました。PlantUMLはオープンソースのUMLダイアグラム作成用のテキストベースの言語であり、シークエンス図、ユースケース図、アクティビティ図、クラス図などのダイアグラムをシンプルで直感的に書くことができます。 \n\n私がネクイノに入社してから使用し始めたのは、Emacsのorg-babelで実装された2014年頃であり、esa.ioやVS Codeなどで実装されてから爆発的に普及したと記憶しています。私がesa.ioでPlantUMLの実装を要望したのも良い思い出です。  > やったことやったこと \n\nさて、私はネクイノに入社してすぐに既存システムの運用開発と情シス（業務運用）の部長職にアサインされました。外部パートナーが入るということで、開発フローが大きく変わる節目にありました。  > 開発フローを整備する開発フローを整備する \n\n開発フローを整備するために、新しく入る外部パートナーがプロジェクトマネージャ、ブリッジエンジニア・コミュニケーター、モバイルエンジニア、バックエンドエンジニア、フロントエンジニア、品質チェックを含めて20名程の体制であることを把握しました。また、既存システムの運用開発ではプロダクトマネジャー、プロダクトオーナーが各開発者とともに企画策定を行うことが慣習として存在していました。そこで、私は企画から実装、レビュー、リリースまでの流れを整理しました。 \n\n 開発の流れ \n\nその結果、開発フローはJira上で大まかな流れとして、エピック(仕様策定)、エピック(見積)、エピック(実装)、エピック(レビュー)、エピック(リリース)という5つのステップに分かれました。このフローをPlantUMLを使って可視化しました。 \n\n  > 要望フローを整備する要望フローを整備する \n\nまた、要望フローについても同様に整備しました。機能要望、バグ報告、改善要望がSlackチャンネルに散在しており、チケット化されないケースがあったため、GoogleフォームとJira連携を行い、要望の集約とトリアージを行いました2。プロダクトマネジャーの体制が整備された後も、バグ報告や改善要望は要所要所で利用され、トリアージが定期的に活用されるようになりました。 \n\n  > デプロイフローを整備するデプロイフローを整備する \n\n開発が進んでいくと、今度は開発環境が足りなくなりました。当時はステージング環境と本番環境しかなく、かつ、ステージング環境がテスト環境兼デモ環境の役割を呈しており、ステージング環境おテストで不具合を起こすとデモに影響が出るという状態が続いておりました。また、外部パートナーが開発するに当たり繊細なステージング環境を使うのが難しいため進捗に影響が出始めておりました。 \n\n急を要する事態のためAWS CDKでステージング環境とは別に結合環境を用意し3、デプロイフローを整備しました。 \n\n  > 障害対応フローを整備する障害対応フローを整備する \n\nさて、運用開発が順調に進んでいくと、今度は障害が頻繁に起きていることに気づきました。いいえ、薄々気づいていたのですが多忙にかまけて蓋をしておりました。ここに関しては本腰を入れてAWSサポートプランをビジネスに変更し原因を突き止めました。協力いただいた各位には感謝です。 \n\nまた、今まで見過ごされていたGoogle Workspace等の業務運用のシステムも含め障害報告の体制を敷くとともに、監視体制も強化しました。 \n\n  > 業務フローを整理する業務フローを整理する \n\nまだまだあります。業務内容に関しては詳細は書けませんが、部内の業務から他部署の業務まで安全に生産性を高めるため整理を行いました。まだまだ行います。  > リモート飲みのフローを整備するリモート飲みのフローを整備する \n\nいよいよ疲れてきたのでお酒が飲みたくなりました。飲み会フローを作ってみましたが思いの外手間がかかることが分かりあまり活用できておりません。その代わり社内でオンラインシャッフルランチという制度ができました。 \n\n  > 分かったこと分かったこと \n\nはい、こうして振り返ると入社時に感じていた雑然さは業務フローが明確でない状態のことでした。開発者なら分かると思いますが、企画段階で思い描く構成図は実装する段になるとあまり意味をなさず、結局は頭の中はシークエンス図でいっぱいになります。それと同じで、登場人物、登場人物間のメッセージ、メッセージの大枠が関係者に共有されていないと、いくらリソースが投下されても不安定で生産性に伸び悩むのです。つまり、雑然とした環境を整理すると言うことはシークエンス図を書くことに他なりません。 \n\nしかしながら、当該環境一つ一つを俯瞰的に見るとITILプラクティスそのものであることにも気づきます。 \n\nITILとはITサービスマネジメントのベストプラクティスフレームワークのこと。何らかの高い技術を持っていても、投資対効果を考えていなければ赤字になりビジネスと成り立ちませんし、顧客のことを考えずに作ったものに価値はありませんし、サービスの評価を落とすことになります。このようなことを防ぐには顧客目線やビジネス的な観点が必要で、そのノウハウがまとまったものがITILです。  > 今回対応したプラクティス今回対応したプラクティス \n\n今回の振り返りでは具体的に次のプラクティスをなぞっておりました。    振り返り ITILプラクティス     開発フローを整備する 継続的サービス改善   要望フローを整備する 要求管理、問題管理   デプロイフローを整備する リリース管理及び展開管理   障害対応フローを整備する インシデント管理   業務フローを整理する CMMI   リモート飲みのフローを整備する 組織変更管理    \n\nCMMIと組織変更管理が分かりづらいの少し補足します。 \n\n- CMMIとは能力成熟度モデル統合のことで、業務フローを評価し5段階で成熟度レベルを出す手法です。現状はレベル1-2（初期段階）のものがほとんどなのでまずはPlantUMLを使い共通認識を作るところから始めました。\n- 組織変更管理とは経営学で言うところのチェンジマネジメントに当たります。ここでは各種フローを整備しメンバー全員に落とし込むことを目指します。『Fearless Change』では今回のリモート飲み以外にも多くのパターンランゲージが紹介されています。  > WRAPUPWRAPUP  > 次にすること次にすること \n\nネクストアクションですが、採用フローを考えています。 \n\n（読者の皆様はどんなシークエンス図を思い浮かべましたか?） \n\nというわけで、ネクイノはPlantUMLを愛している開発者を募集中です。  > PR__colon__ ネクイノとはPR: ネクイノとは \n\n「世界中の医療空間と体験を再定義する」をミッションに、人々と医療の間にICTのチカラで橋をかける遠隔医療ソリューションを手掛けている会社です。医療というと高齢の患者さんをイメージされるかもしれませんが、我らがターゲットとしているのは現役世代の方。病気を治療するというより、現役世代がQOLを高めるためのサポートを目的としています。 \n\nメインサービスは、女性に特化したピルのオンライン診療アプリ「スマルナ」。ピルを飲まれている人だけでなく、受診や服用に抵抗がある方にも気軽に利用していただけたらと思いサービス提供しています。診察室の手前に助産師と薬剤師を配置した相談室を設ける等、受診のハードルを下げる工夫をそこかしこに施しているのが特徴です。 \n\n様々なメディカルコミュニケーションを行っています - 専門家相談 - カスタマーサポート - ユーザーコミュニティ  \n\n妻からは「10年前にサービスがあったら良かったのに」とお墨付きをいただいており、興味をもった方は詳しくはこちらをご覧下さい。 https://smaluna.com/  \n\n1. [B! plantuml] nabinnoのブックマーク ↩ \n2. https://github.com/nabinno/google-forms-to-jira-slack ↩ \n3. CDKはaws-rails-provisionerを参考に ecs_patterns.ApplicationLoadBalancedFargateService を実装しました ↩"},"name":"[2020-12-30]整理したい私はITILをかぶる、PlantUMLへの愛","tags":["team-building"],"childPublishedDate":{"published_on":"2020-12-30T00:00:00.000Z","published_on_unix":1609286400}}},{"node":{"number":47,"relative_category":"blog/organization","fields":{"title":"マネジメントとは何か","excerpt":"組織が拡大するにつれて、私は自らの手だけでは対応できないことに気づきました。そこで、マネジメント業務をチームのメンバーに委譲する必要が生じました。これは容易なことではありません。個々のタスク指示はうまくいくかもしれませんが、「よしなにやって」と言っても、周辺の整理も含めてタスクを円滑に進めるための調整を伝えるのは一言では不可能です。同じマネジメント職同士なら問題ないのですが、私がまだマネジメントの世界に入りたてのメンバーと連携する場合、どうすれば良いのかわかりませんでした。  > PROBLEMPROBLEM \n\n- チームメンバーにマネジメントを理解して欲しい けれど、マネジメントに関する書籍が多く、一言でこれを読めと伝えるのが難しい 一方、一言では言い表せないが、一目でなら表せるものが自分の中に出来上がっている 昔手にした書籍をヒントにマネジメントの枠組みというのを自分の頭に構築していた ただ、そのことについて書かれた書籍を見たことがない \n- けれど、マネジメントに関する書籍が多く、一言でこれを読めと伝えるのが難しい\n- 一方、一言では言い表せないが、一目でなら表せるものが自分の中に出来上がっている 昔手にした書籍をヒントにマネジメントの枠組みというのを自分の頭に構築していた ただ、そのことについて書かれた書籍を見たことがない \n- 昔手にした書籍をヒントにマネジメントの枠組みというのを自分の頭に構築していた ただ、そのことについて書かれた書籍を見たことがない \n- ただ、そのことについて書かれた書籍を見たことがない  > SOLUTIONSOLUTION \n\nそこで、私は自分の頭の中に構築したマネジメントの枠組みを整理することにしました。 \n\n私はそのフレームワークを「GRPR（グルーパー）マネジメントサイクル」と呼んでいます。GRPRはゴール（G）、リソース（R）、プロセス（P）、ルール（R）の頭文字の組み合わせです。私はこのGRPRを grouper（熱帯や温帯の海域に分布する魚のハタの意）の略字に見立てることで、マネジメントサイクルをハタの形に重ねて覚えています。下記がそのサイクルです。どうです、ハタに見えませんか? \n\n \n\nこのフレームワークは、どの職種にも応用できます。私はこれまでいくつかの職種でマネジメントを行ってきましたが、どれも無理なく実施できました。また、このフレームワークはマネジメント関連の書籍を整理する際にも役立ちます。 \n\nさて、それでは各要素を具体的に見ていきましょう。  > ゴールゴール \n\n計画と意思決定を行います。これはSMARTの原則に従って戦略的かつ具体的かつ測定可能で達成可能な目標を設定することが重要です。以下は分かりやすい例です。 \n\n目標例 \n\n- デザインコーディネーション 組織パターン \n- 組織パターン\n- サービスカタログ  > 変化前のリソースとプロセス変化前のリソースとプロセス \n\nゴールを決めた後にその方向に動き出すための現状把握を行います。対象にはリソースとプロセスがありますが、それらは人も含みます。まずリソースについて、人の場合は意志の状態と価値観の確認を行い、人以外の場合は当該リソースのステータスを確認します。 \n\n- マインドフルネス、アンガーマネジメント、心理的安全性\n- キャリアアンカー \n\nプロセスについては各業務フロー、システムフローを確認します。 \n\n- CMMI  > 変化後のリソースとプロセス変化後のリソースとプロセス \n\n現状を把握した後に目指すべきリソースとプロセスが決まったらそちらに変更を促します。所謂 指示と動機付けを元にした「変更管理」を行います。これはリーダーシップという切り口で語られることが多いマネジメント領域です。  > ルールルール \n\n最後にリソースやプロセスの現状や変化を観察し評価します。この評価によってルールを定め、次のゴールへと段階を上げていきます。なお、ルールはリソースやプロセスに制限をかけるものではありますが、長期的に見た際に安全に業務を回すためのガードレールの役割を果たします。 \n\n例えば、ルールには下記のようなものがあります。 \n\n- 業務運用方針\n- 各パブリッククラウドのIAM設定・運用の方針\n- AWS Control Tower  > WRAPUPWRAPUP \n\nまとめると、これが私が考えたマネジメントのフレームワークです。まだ未完成ではありますが、今後はメンバーからのフィードバックを受けながらさらに洗練していきたいと思っています。"},"name":"[2021-04-01]マネジメントとは何か","tags":["team-building"],"childPublishedDate":{"published_on":"2021-04-01T00:00:00.000Z","published_on_unix":1617235200}}}]}},"pageContext":{"number":137}},"staticQueryHashes":[]}