{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/64","result":{"data":{"esaPost":{"number":64,"relative_category":"blog/backend","fields":{"title":"WSL2時代のDocker開発スタイル","excerpt":"6月13日は狂喜乱舞しました、久しぶりに徹夜するくらい興奮しました。そう、WSL2が出たのですよね。先日やっと私の手元に届いたので早々に検証しました。   > PROBLEMPROBLEM \n\n- あたらしくでたWSL2によって以前書いた記事からだいぶ状況が変わった 主な変更点 WSLのアーキテクチャが2種類になり、WSLはその2つのアーキテクチャを管理する機能に変わった WSL1 Windows Subsystem for Linux上のLinux (LXCore/Lxss) WSL2 軽量Hyper-V上のLinux (Linux Kernel) /procや/sysなどの特殊ファイルもふくめた共有プロトコル「9P」が実装された Win32側の9Pクライアント 9prdr.sys WSL側の9Pクライアント /init \n- 主な変更点 WSLのアーキテクチャが2種類になり、WSLはその2つのアーキテクチャを管理する機能に変わった WSL1 Windows Subsystem for Linux上のLinux (LXCore/Lxss) WSL2 軽量Hyper-V上のLinux (Linux Kernel) /procや/sysなどの特殊ファイルもふくめた共有プロトコル「9P」が実装された Win32側の9Pクライアント 9prdr.sys WSL側の9Pクライアント /init \n- WSLのアーキテクチャが2種類になり、WSLはその2つのアーキテクチャを管理する機能に変わった WSL1 Windows Subsystem for Linux上のLinux (LXCore/Lxss) WSL2 軽量Hyper-V上のLinux (Linux Kernel) \n- WSL1 Windows Subsystem for Linux上のLinux (LXCore/Lxss)\n- WSL2 軽量Hyper-V上のLinux (Linux Kernel)\n- /procや/sysなどの特殊ファイルもふくめた共有プロトコル「9P」が実装された Win32側の9Pクライアント 9prdr.sys WSL側の9Pクライアント /init \n- Win32側の9Pクライアント 9prdr.sys \n- WSL側の9Pクライアント /init    > SOLUTIONSOLUTION \n\nというわけで、前記事で掲げていた目標「WSLでDockerをつかったWebアプリケーション開発ができるかどうか」について再確認します。   > 対象環境対象環境 \n\n- Windows 10 Pro Version 1903 OS Build 18922.1000 Windows Terminal (Preview) Version 0.2.1715.0 WSL2 Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard) Docker version 19.03.0-rc3, build 27fcb77 WSL1 Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft) \n- Windows Terminal (Preview) Version 0.2.1715.0\n- WSL2 Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard) Docker version 19.03.0-rc3, build 27fcb77 \n- Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard)\n- Docker version 19.03.0-rc3, build 27fcb77\n- WSL1 Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft) \n- Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft)   > Windowsの開発環境を構築するWindowsの開発環境を構築する \n\nまず、Windowsの開発環境の構築ですが、既知の情報をふまえつつTIPSを順次紹介します。   > WSLのインストールWSLのインストール \n\n- WSL2を使ってみる (InsiderPreview) \n\nWSLのパッケージ管理は下記2つを押さえておけば問題ないでしょう。 \n\n1. asdf/anyenv プログラミング言語をバージョンごとにわけて使いたい場合はこちらをつかいましょう 関数言語界隈ではasdfが主流になってきてるようです。 \n2. プログラミング言語をバージョンごとにわけて使いたい場合はこちらをつかいましょう\n3. 関数言語界隈ではasdfが主流になってきてるようです。\n4. nix Haskellのようにasdf/anyenvでインストールできない、あるいは、扱われいないパッケージはnixをつかいましょう また、aptのバージョンが古すぎるパッケージもnixが最適です \n5. Haskellのようにasdf/anyenvでインストールできない、あるいは、扱われいないパッケージはnixをつかいましょう\n6. また、aptのバージョンが古すぎるパッケージもnixが最適です   > ターミナルのインストールターミナルのインストール \n\nWSLttyはWSL2に対応しておらずConEmuは描画がくずれやすいため、デフォルトのターミナルかWindows Terminalが選択肢となります。 \n\nWindows TerminalとConEmuとの比較    - Windows Terminal ConEmu     透過対象 backgroundImage ConEmu自体   キーバインド制約 Alt+Shiftが効かない 特になし   WSL2の描画 特になし くずれる   管理者権限で実行 初回のみ タスク実行ごと      > DockerのインストールDockerのインストール \n\nWSL1ではDockerデーモンがつかえないのでWSL2でDockerをつかうようにしましょう。Docker CEをインストールします。 \n\nどうしてもWSL1でということであれば、Win32 (WSL1からみるとdrvfs) 側でDocker For Windowsを用意します。インストールはDockerのダウンロードページから手順通りおこないます。\n 構成等は前回の記事を参照ください。   > さて、WSL2からDockerはどの程度つかえるのかさて、WSL2からDockerはどの程度つかえるのか \n\nWSL2は軽量Hyper-V上にLinuxコンテナを動かしているので、基本Hyper-Vと同様にDockerをつかうことができます。 \n\nただし、WSL1と違いlocalhostにWSL2がバインドできません (2019-07-27追記: Build Version 18945で解決しました )。\n また、WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています。 \n\nひとつずつ解決方法を見ていきましょう。   > 1. WSL1と違いlocalhostにWSL2がバインドできません1. WSL1と違いlocalhostにWSL2がバインドできません \n\nWSL2がつかっているVirtual Switchはinternal onlyのため、Win32側からlocalhostをつかってWSL2にアクセスすることができません。現在対応中のようです (2019-07-27追記: Build Version 18945で解決しました )。 \n\n対処方法は2つあります。 \n\na. WSL1をつかう \n\nこれが一番楽ですが、WSL1は次項であげるパフォーマンス上の欠点があるので、Web系フロントエンド開発におけるライブリローディング機能をつかうケースに限定するといいでしょう。 \n\nb. Hostsファイルをつかう \n\nWin32のHostsファイルでWSL2のeth0インターフェイスのIPアドレスに適当なホスト名を割り当てます（ポートごとにホストを振り分けたい場合はWSL2側にProxyを用意するといいでしょう）。   shell \n\n# C:\\Windows\\System32\\drivers\\etc\\hosts 172.17.72.217 dashboard.local.me   \n\nWSL2のIPアドレスはコンテナを立ち上げるごとに変わるので、下記のようなコマンドレットをWin32側のPowerShell $PROFILEに用意しておくといいでしょう。WSL2だけで完結したい方はシェル上から powershell.exe -Command 'Sync-HostsToWslIp' と打つだけです。   powershell \n\n# $PROFILE function Sync-HostsToWslIp { $hosts = \"$env:SystemRoot\\System32\\drivers\\etc\\hosts\"; $pattern = \"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\"; $wslip = bash.exe -c \"ifconfig eth0 | grep 'inet '\"; if ($wslip -match $pattern) { $wslip = $matches[0]; } else { echo \"The Script Exited, the ip address of WSL 2 cannot be found\"; exit; } cat $hosts | %{ $_ -match $pattern } $rc = cat $hosts | %{ $_ -replace $matches[0], $wslip } $rc | Out-File $hosts; }     > 2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています \n\nいろんな方がベンチマークを公開してるのでそれを参考にするといいでしょう。 \n\nCf. \n\n- Pythonでファイル操作のベンチマーク\n- dd、git cloneのベンチマーク \n\nわたしは git status -sb をよくつかうので、そのコマンドで簡単なベンチマークとりました。   shell \n\n# WSLx $ cd ~/nabinno.github.io $ \\time -f %e git status -sb # Win32/WSLx $ cd ~/nabinno.github.io $ \\time -f %e powershell.exe -Command 'git status -sb' # Win32 PS> cd ~/nabinno.github.io PS> (Measure-Command { git status -sb }).TotalMilliseconds / 1000 | %{ [math]::Round($_, 2) }      Subject WSL Win32     WSL1 0.47 0.09   WSL2 0.00 0.61   Win32/WSL1 2.66 1.91   Win32/WSL2 2.81 1.79   Win32 0.51 0.12      > Docker以外でWSLの課題はないのかDocker以外でWSLの課題はないのか   > デバイスへのアクセスデバイスへのアクセス \n\n以前から要望があったものだと「デバイスアクセスができない」件があります。 \n\n9P導入前だとこれはElixirのIoTフレームワークNervesのように、WSL UtilitiesでWSLパスをWin32パスに変換してからWin32にあるデバイス関連ツールをつかうのが簡単な解決策でした。   sh \n\n$ fwup.exe -a -i $(wslpath -w -a _build/rpi0_dev/nerves/images/hello_nerves.fw) -t complete -d $(fwup.exe -D | sed 's/,.*//')   \n\nただし9Pを導入したWindows 10 Version 1903以降は、WSL1もWSL2もともにWSLパスを変換せずにWin32にあるデバイス関連ツールをつかうことができます。   sh \n\n$ fwup.exe -a -i _build/rpi0_dev/nerves/images/hello_nerves.fw -t complete -d $(fwup.exe -D | sed 's/,.*//')     > WRAPUPWRAPUP \n\nわたしの観測範囲では課題はほぼ問題ない状態になっていました。 \n\nおすすめ開発環境は下記のとおり    item content     IDE WSLx上のエディタ   Webフロントエンド開発 WSL1   Docker関連開発 WSL2   dotfiles WSLx、Win32を共有管理    \n\nWin32側のIDEをつかっているユーザーはパフォーマンス上の不満がまだあるかもしれませんが、WSLでDockerをつかったWebアプリケーション開発は十分できる、と言えそうです。つまり、Linux・macOS・WindowsによるWebアプリケーション開発は十分共有できる、と。 \n\nいい時代になりました。","thumbnail":"https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/3f687a61-ff91-4a70-875d-d6c739416630.png"},"wip":false,"body_md":"<img width=\"1130\" alt=\"thumbnail\" src=\"https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/3f687a61-ff91-4a70-875d-d6c739416630.png\" />\r\n6月13日は狂喜乱舞しました、久しぶりに徹夜するくらい興奮しました。そう、WSL2が出たのですよね。先日やっと私の手元に届いたので早々に検証しました。\r\n\r\n# PROBLEM\r\n- あたらしくでたWSL2によって[以前書いた記事](/posts/58)からだいぶ状況が変わった\r\n    - 主な変更点\r\n\t    - WSLのアーキテクチャが2種類になり、WSLはその2つのアーキテクチャを管理する機能に変わった\r\n            - WSL1 Windows Subsystem for Linux上のLinux (LXCore/Lxss)\r\n            - WSL2 軽量Hyper-V上のLinux (Linux Kernel)\r\n        - /procや/sysなどの特殊ファイルもふくめた共有プロトコル「9P」が実装された\r\n            - Win32側の9Pクライアント `9prdr.sys`\r\n            - WSL側の9Pクライアント `/init`\r\n\r\n# SOLUTION\r\nというわけで、前記事で掲げていた目標「WSLでDockerをつかったWebアプリケーション開発ができるかどうか」について再確認します。\r\n\r\n## 対象環境\r\n- Windows 10 Pro Version 1903 OS Build 18922.1000\r\n    - Windows Terminal (Preview) Version 0.2.1715.0\r\n    - WSL2\r\n\t    - Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard)\r\n        - Docker version 19.03.0-rc3, build 27fcb77\r\n    - WSL1\r\n\t    - Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft)\r\n\r\n## Windowsの開発環境を構築する\r\nまず、Windowsの開発環境の構築ですが、既知の情報をふまえつつTIPSを順次紹介します。\r\n\r\n### WSLのインストール\r\n- [WSL2を使ってみる (InsiderPreview)](https://qiita.com/namoshika/items/53a9ac2df7eace656870)\r\n\r\nWSLのパッケージ管理は下記2つを押さえておけば問題ないでしょう。\r\n1. [asdf](https://github.com/asdf-vm/asdf)/[anyenv](https://github.com/riywo/anyenv)\r\n    - プログラミング言語をバージョンごとにわけて使いたい場合はこちらをつかいましょう\r\n    - 関数言語界隈ではasdfが主流になってきてるようです。\r\n2. [nix](https://nixos.org/nix/)\r\n    - Haskellのようにasdf/anyenvでインストールできない、あるいは、扱われいないパッケージはnixをつかいましょう\r\n    - また、aptのバージョンが古すぎるパッケージもnixが最適です\r\n\r\n### ターミナルのインストール\r\nWSLttyはWSL2に対応しておらずConEmuは描画がくずれやすいため、デフォルトのターミナルか[Windows Terminal](https://www.microsoft.com/en-us/p/windows-terminal-preview/9n0dx20hk701?WT.mc_id=-blog-scottha&wa=wsignin1.0&activetab=pivot:overviewtab)が選択肢となります。\r\n\r\n**Windows TerminalとConEmuとの比較**\r\n\r\n| -                | Windows Terminal    | ConEmu         |\r\n| ---              | ---                 | ---            |\r\n| 透過対象         | backgroundImage     | ConEmu自体     |\r\n| キーバインド制約 | Alt+Shiftが効かない | 特になし       |\r\n| WSL2の描画       | 特になし            | くずれる       |\r\n| 管理者権限で実行 | 初回のみ            | タスク実行ごと |\r\n\r\n### Dockerのインストール\r\nWSL1ではDockerデーモンがつかえないのでWSL2でDockerをつかうようにしましょう。[Docker CE](https://docs.docker.com/install/linux/docker-ce/ubuntu/)をインストールします。\r\n\r\nどうしてもWSL1でということであれば、Win32 (WSL1からみるとdrvfs) 側で[Docker For Windows](https://www.docker.com/docker-windows)を用意します。インストールはDockerのダウンロードページから手順通りおこないます。\r\n構成等は[前回の記事](/posts/58#docker-for-windowsのインストール)を参照ください。\r\n\r\n## さて、WSL2からDockerはどの程度つかえるのか\r\nWSL2は軽量Hyper-V上にLinuxコンテナを動かしているので、基本Hyper-Vと同様にDockerをつかうことができます。\r\n\r\nただし、~~WSL1と違いlocalhostにWSL2がバインドできません~~ (2019-07-27追記: [Build Version 18945で解決しました](https://devblogs.microsoft.com/commandline/whats-new-for-wsl-in-insiders-preview-build-18945/) :tada:)。\r\nまた、WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています。\r\n\r\nひとつずつ解決方法を見ていきましょう。\r\n\r\n### 1. WSL1と違いlocalhostにWSL2がバインドできません\r\nWSL2がつかっているVirtual Switchはinternal onlyのため、Win32側からlocalhostをつかってWSL2にアクセスすることができません。[現在対応中のようです](https://docs.microsoft.com/en-us/windows/wsl/wsl2-faq#will-wsl-2-be-able-to-use-networking-applications) (2019-07-27追記: [Build Version 18945で解決しました](https://devblogs.microsoft.com/commandline/whats-new-for-wsl-in-insiders-preview-build-18945/) :tada:)。\r\n\r\n対処方法は2つあります。\r\n\r\n**a. WSL1をつかう**\r\n\r\nこれが一番楽ですが、WSL1は次項であげるパフォーマンス上の欠点があるので、Web系フロントエンド開発におけるライブリローディング機能をつかうケースに限定するといいでしょう。\r\n\r\n**b. Hostsファイルをつかう**\r\n\r\nWin32のHostsファイルでWSL2のeth0インターフェイスのIPアドレスに適当なホスト名を割り当てます（ポートごとにホストを振り分けたい場合はWSL2側にProxyを用意するといいでしょう）。\r\n\r\n```shell\r\n# C:\\Windows\\System32\\drivers\\etc\\hosts\r\n\r\n172.17.72.217 dashboard.local.me\r\n```\r\n\r\nWSL2のIPアドレスはコンテナを立ち上げるごとに変わるので、下記のようなコマンドレットをWin32側のPowerShell $PROFILEに用意しておくといいでしょう。WSL2だけで完結したい方はシェル上から `powershell.exe -Command 'Sync-HostsToWslIp'` と打つだけです。\r\n\r\n```powershell\r\n# $PROFILE\r\n\r\nfunction Sync-HostsToWslIp {\r\n  $hosts = \"$env:SystemRoot\\System32\\drivers\\etc\\hosts\";\r\n  $pattern = \"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\";\r\n  $wslip = bash.exe -c \"ifconfig eth0 | grep 'inet '\";\r\n  if ($wslip -match $pattern) {\r\n    $wslip = $matches[0];\r\n  } else {\r\n    echo \"The Script Exited, the ip address of WSL 2 cannot be found\";\r\n    exit;\r\n  }\r\n  cat $hosts | %{ $_ -match $pattern }\r\n  $rc = cat $hosts | %{ $_ -replace $matches[0], $wslip }\r\n  $rc | Out-File $hosts;\r\n}\r\n```\r\n\r\n### 2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています\r\nいろんな方がベンチマークを公開してるのでそれを参考にするといいでしょう。\r\n\r\n**Cf.**\r\n\r\n- [Pythonでファイル操作のベンチマーク](https://twitter.com/ZahmbieND/status/1139921840351170560?s=20)\r\n- [dd、git cloneのベンチマーク](https://qiita.com/kunit/items/051196022763e64e91f6)\r\n\r\nわたしは `git status -sb` をよくつかうので、そのコマンドで簡単なベンチマークとりました。\r\n\r\n```shell\r\n# WSLx\r\n$ cd ~/nabinno.github.io\r\n$ \\time -f %e git status -sb \r\n\r\n# Win32/WSLx\r\n$ cd ~/nabinno.github.io\r\n$ \\time -f %e powershell.exe -Command 'git status -sb'\r\n\r\n# Win32\r\nPS> cd ~/nabinno.github.io\r\nPS> (Measure-Command { git status -sb }).TotalMilliseconds / 1000 | %{ [math]::Round($_, 2) }\r\n```\r\n\r\n| Subject    | WSL  | Win32 |\r\n| ---        | ---  | ---   |\r\n| WSL1       | 0.47 | 0.09  |\r\n| WSL2       | 0.00 | 0.61  |\r\n| Win32/WSL1 | 2.66 | 1.91  |\r\n| Win32/WSL2 | 2.81 | 1.79  |\r\n| Win32      | 0.51 | 0.12  |\r\n\r\n## Docker以外でWSLの課題はないのか\r\n### デバイスへのアクセス\r\n以前から要望があったものだと「デバイスアクセスができない」件があります。\r\n\r\n9P導入前だとこれはElixirのIoTフレームワークNervesのように、[WSL Utilities](https://github.com/wslutilities/wslu)でWSLパスをWin32パスに変換してからWin32にあるデバイス関連ツールをつかうのが簡単な解決策でした。\r\n\r\n```sh\r\n$ fwup.exe -a -i $(wslpath -w -a _build/rpi0_dev/nerves/images/hello_nerves.fw) -t complete -d $(fwup.exe -D | sed 's/,.*//')\r\n```\r\n\r\nただし9Pを導入したWindows 10 Version 1903以降は、WSL1もWSL2もともにWSLパスを変換せずにWin32にあるデバイス関連ツールをつかうことができます。\r\n\r\n```sh\r\n$ fwup.exe -a -i _build/rpi0_dev/nerves/images/hello_nerves.fw -t complete -d $(fwup.exe -D | sed 's/,.*//')\r\n```\r\n\r\n# WRAPUP\r\nわたしの観測範囲では課題はほぼ問題ない状態になっていました。\r\n\r\n**おすすめ開発環境は下記のとおり**\r\n\r\n| item                  | content               |\r\n| ---                   | ---                   |\r\n| IDE                   | WSLx上のエディタ      |\r\n| Webフロントエンド開発 | WSL1                  |\r\n| Docker関連開発        | WSL2                  |\r\n| dotfiles              | WSLx、Win32を共有管理 |\r\n\r\nWin32側のIDEをつかっているユーザーはパフォーマンス上の不満がまだあるかもしれませんが、WSLでDockerをつかったWebアプリケーション開発は十分できる、と言えそうです。つまり、Linux・macOS・WindowsによるWebアプリケーション開発は十分共有できる、と。\r\n\r\nいい時代になりました。\r\n\r\n","body_html":"<a href=\"https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/3f687a61-ff91-4a70-875d-d6c739416630.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1130\" alt=\"thumbnail\" src=\"https://img.esa.io/uploads/production/attachments/16651/2021/01/11/97367/3f687a61-ff91-4a70-875d-d6c739416630.png\"></a>\n6月13日は狂喜乱舞しました、久しぶりに徹夜するくらい興奮しました。そう、WSL2が出たのですよね。先日やっと私の手元に届いたので早々に検証しました。\n<h1 data-sourcepos=\"4:1-4:9\" id=\"1-0-0\" name=\"1-0-0\">\n<a class=\"anchor\" id=\"PROBLEM\" name=\"PROBLEM\" href=\"#PROBLEM\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"PROBLEM\"> &gt; PROBLEM</span></a>PROBLEM</h1>\n<ul data-sourcepos=\"5:1-13:0\">\n<li data-sourcepos=\"5:1-13:0\">あたらしくでたWSL2によって<a href=\"/posts/58\">以前書いた記事</a>からだいぶ状況が変わった\n<ul data-sourcepos=\"6:5-13:0\">\n<li data-sourcepos=\"6:5-13:0\">主な変更点\n<ul data-sourcepos=\"7:6-13:0\">\n<li data-sourcepos=\"7:6-9:58\">WSLのアーキテクチャが2種類になり、WSLはその2つのアーキテクチャを管理する機能に変わった\n<ul data-sourcepos=\"8:13-9:58\">\n<li data-sourcepos=\"8:13-8:71\">WSL1 Windows Subsystem for Linux上のLinux (LXCore/Lxss)</li>\n<li data-sourcepos=\"9:13-9:58\">WSL2 軽量Hyper-V上のLinux (Linux Kernel)</li>\n</ul>\n</li>\n<li data-sourcepos=\"10:9-13:0\">/procや/sysなどの特殊ファイルもふくめた共有プロトコル「9P」が実装された\n<ul data-sourcepos=\"11:13-13:0\">\n<li data-sourcepos=\"11:13-11:57\">Win32側の9Pクライアント <code>9prdr.sys</code>\n</li>\n<li data-sourcepos=\"12:13-13:0\">WSL側の9Pクライアント <code>/init</code>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 data-sourcepos=\"14:1-14:10\" id=\"2-0-0\" name=\"2-0-0\">\n<a class=\"anchor\" id=\"SOLUTION\" name=\"SOLUTION\" href=\"#SOLUTION\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SOLUTION\"> &gt; SOLUTION</span></a>SOLUTION</h1>\n<p data-sourcepos=\"15:1-15:177\">というわけで、前記事で掲げていた目標「WSLでDockerをつかったWebアプリケーション開発ができるかどうか」について再確認します。</p>\n<h2 data-sourcepos=\"17:1-17:15\" id=\"2-1-0\" name=\"2-1-0\">\n<a class=\"anchor\" id=\"対象環境\" name=\"%E5%AF%BE%E8%B1%A1%E7%92%B0%E5%A2%83\" href=\"#%E5%AF%BE%E8%B1%A1%E7%92%B0%E5%A2%83\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"対象環境\"> &gt; 対象環境</span></a>対象環境</h2>\n<ul data-sourcepos=\"18:1-25:0\">\n<li data-sourcepos=\"18:1-25:0\">Windows 10 Pro Version 1903 OS Build 18922.1000\n<ul data-sourcepos=\"19:5-25:0\">\n<li data-sourcepos=\"19:5-19:51\">Windows Terminal (Preview) Version 0.2.1715.0</li>\n<li data-sourcepos=\"20:5-22:51\">WSL2\n<ul data-sourcepos=\"21:6-22:51\">\n<li data-sourcepos=\"21:6-21:71\">Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard)</li>\n<li data-sourcepos=\"22:9-22:51\">Docker version 19.03.0-rc3, build 27fcb77</li>\n</ul>\n</li>\n<li data-sourcepos=\"23:5-25:0\">WSL1\n<ul data-sourcepos=\"24:6-25:0\">\n<li data-sourcepos=\"24:6-25:0\">Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 data-sourcepos=\"26:1-26:40\" id=\"2-2-0\" name=\"2-2-0\">\n<a class=\"anchor\" id=\"Windowsの開発環境を構築する\" name=\"Windows%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\" href=\"#Windows%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Windowsの開発環境を構築する\"> &gt; Windowsの開発環境を構築する</span></a>Windowsの開発環境を構築する</h2>\n<p data-sourcepos=\"27:1-27:116\">まず、Windowsの開発環境の構築ですが、既知の情報をふまえつつTIPSを順次紹介します。</p>\n<h3 data-sourcepos=\"29:1-29:28\" id=\"2-2-1\" name=\"2-2-1\">\n<a class=\"anchor\" id=\"WSLのインストール\" name=\"WSL%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" href=\"#WSL%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" data-position=\"2-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"WSLのインストール\"> &gt; WSLのインストール</span></a>WSLのインストール</h3>\n<ul data-sourcepos=\"30:1-31:0\">\n<li data-sourcepos=\"30:1-31:0\"><a href=\"https://qiita.com/namoshika/items/53a9ac2df7eace656870\" target=\"_blank\" rel=\"noopener noreferrer\">WSL2を使ってみる (InsiderPreview)</a></li>\n</ul>\n<p data-sourcepos=\"32:1-32:91\">WSLのパッケージ管理は下記2つを押さえておけば問題ないでしょう。</p>\n<ol data-sourcepos=\"33:1-39:0\">\n<li data-sourcepos=\"33:1-35:79\">\n<a href=\"https://github.com/asdf-vm/asdf\" target=\"_blank\" rel=\"noopener noreferrer\">asdf</a>/<a href=\"https://github.com/riywo/anyenv\" target=\"_blank\" rel=\"noopener noreferrer\">anyenv</a>\n<ul data-sourcepos=\"34:5-35:79\">\n<li data-sourcepos=\"34:5-34:123\">プログラミング言語をバージョンごとにわけて使いたい場合はこちらをつかいましょう</li>\n<li data-sourcepos=\"35:5-35:79\">関数言語界隈ではasdfが主流になってきてるようです。</li>\n</ul>\n</li>\n<li data-sourcepos=\"36:1-39:0\">\n<a href=\"https://nixos.org/nix/\" target=\"_blank\" rel=\"noopener noreferrer\">nix</a>\n<ul data-sourcepos=\"37:5-39:0\">\n<li data-sourcepos=\"37:5-37:150\">Haskellのようにasdf/anyenvでインストールできない、あるいは、扱われいないパッケージはnixをつかいましょう</li>\n<li data-sourcepos=\"38:5-39:0\">また、aptのバージョンが古すぎるパッケージもnixが最適です</li>\n</ul>\n</li>\n</ol>\n<h3 data-sourcepos=\"40:1-40:40\" id=\"2-2-2\" name=\"2-2-2\">\n<a class=\"anchor\" id=\"ターミナルのインストール\" name=\"%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" href=\"#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" data-position=\"2-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ターミナルのインストール\"> &gt; ターミナルのインストール</span></a>ターミナルのインストール</h3>\n<p data-sourcepos=\"41:1-41:304\">WSLttyはWSL2に対応しておらずConEmuは描画がくずれやすいため、デフォルトのターミナルか<a href=\"https://www.microsoft.com/en-us/p/windows-terminal-preview/9n0dx20hk701?WT.mc_id=-blog-scottha&amp;wa=wsignin1.0&amp;activetab=pivot:overviewtab\" target=\"_blank\" rel=\"noopener noreferrer\">Windows Terminal</a>が選択肢となります。</p>\n<p data-sourcepos=\"43:1-43:41\"><strong>Windows TerminalとConEmuとの比較</strong></p>\n<table data-sourcepos=\"45:1-50:78\">\n<thead>\n<tr data-sourcepos=\"45:1-45:59\">\n<th data-sourcepos=\"45:2-45:19\">-</th>\n<th data-sourcepos=\"45:21-45:41\">Windows Terminal</th>\n<th data-sourcepos=\"45:43-45:58\">ConEmu</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"47:1-47:65\">\n<td data-sourcepos=\"47:2-47:23\">透過対象</td>\n<td data-sourcepos=\"47:25-47:45\">backgroundImage</td>\n<td data-sourcepos=\"47:47-47:64\">ConEmu自体</td>\n</tr>\n<tr data-sourcepos=\"48:1-48:76\">\n<td data-sourcepos=\"48:2-48:27\">キーバインド制約</td>\n<td data-sourcepos=\"48:29-48:54\">Alt+Shiftが効かない</td>\n<td data-sourcepos=\"48:56-48:75\">特になし</td>\n</tr>\n<tr data-sourcepos=\"49:1-49:70\">\n<td data-sourcepos=\"49:2-49:22\">WSL2の描画</td>\n<td data-sourcepos=\"49:24-49:48\">特になし</td>\n<td data-sourcepos=\"49:50-49:69\">くずれる</td>\n</tr>\n<tr data-sourcepos=\"50:1-50:78\">\n<td data-sourcepos=\"50:2-50:27\">管理者権限で実行</td>\n<td data-sourcepos=\"50:29-50:53\">初回のみ</td>\n<td data-sourcepos=\"50:55-50:77\">タスク実行ごと</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"52:1-52:31\" id=\"2-2-3\" name=\"2-2-3\">\n<a class=\"anchor\" id=\"Dockerのインストール\" name=\"Docker%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" href=\"#Docker%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" data-position=\"2-2-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Dockerのインストール\"> &gt; Dockerのインストール</span></a>Dockerのインストール</h3>\n<p data-sourcepos=\"53:1-53:205\">WSL1ではDockerデーモンがつかえないのでWSL2でDockerをつかうようにしましょう。<a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker CE</a>をインストールします。</p>\n<p data-sourcepos=\"55:1-56:104\">どうしてもWSL1でということであれば、Win32 (WSL1からみるとdrvfs) 側で<a href=\"https://www.docker.com/docker-windows\" target=\"_blank\" rel=\"noopener noreferrer\">Docker For Windows</a>を用意します。インストールはDockerのダウンロードページから手順通りおこないます。<br>\n構成等は<a href=\"/posts/58#docker-for-windows%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">前回の記事</a>を参照ください。</p>\n<h2 data-sourcepos=\"58:1-58:61\" id=\"2-3-0\" name=\"2-3-0\">\n<a class=\"anchor\" id=\"さて、WSL2からDockerはどの程度つかえるのか\" name=\"%E3%81%95%E3%81%A6%E3%80%81WSL2%E3%81%8B%E3%82%89Docker%E3%81%AF%E3%81%A9%E3%81%AE%E7%A8%8B%E5%BA%A6%E3%81%A4%E3%81%8B%E3%81%88%E3%82%8B%E3%81%AE%E3%81%8B\" href=\"#%E3%81%95%E3%81%A6%E3%80%81WSL2%E3%81%8B%E3%82%89Docker%E3%81%AF%E3%81%A9%E3%81%AE%E7%A8%8B%E5%BA%A6%E3%81%A4%E3%81%8B%E3%81%88%E3%82%8B%E3%81%AE%E3%81%8B\" data-position=\"2-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"さて、WSL2からDockerはどの程度つかえるのか\"> &gt; さて、WSL2からDockerはどの程度つかえるのか</span></a>さて、WSL2からDockerはどの程度つかえるのか</h2>\n<p data-sourcepos=\"59:1-59:140\">WSL2は軽量Hyper-V上にLinuxコンテナを動かしているので、基本Hyper-Vと同様にDockerをつかうことができます。</p>\n<p data-sourcepos=\"61:1-62:132\">ただし、<del>WSL1と違いlocalhostにWSL2がバインドできません</del> (2019-07-27追記: <a href=\"https://devblogs.microsoft.com/commandline/whats-new-for-wsl-in-insiders-preview-build-18945/\" target=\"_blank\" rel=\"noopener noreferrer\">Build Version 18945で解決しました</a> <img class=\"emoji\" title=\":tada:\" alt=\":tada:\" src=\"https://assets.esa.io/images/emoji/unicode/1f389.png\">)。<br>\nまた、WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています。</p>\n<p data-sourcepos=\"64:1-64:57\">ひとつずつ解決方法を見ていきましょう。</p>\n<h3 data-sourcepos=\"66:1-66:66\" id=\"2-3-1\" name=\"2-3-1\">\n<a class=\"anchor\" id=\"1. WSL1と違いlocalhostにWSL2がバインドできません\" name=\"1.%20WSL1%E3%81%A8%E9%81%95%E3%81%84localhost%E3%81%ABWSL2%E3%81%8C%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93\" href=\"#1.%20WSL1%E3%81%A8%E9%81%95%E3%81%84localhost%E3%81%ABWSL2%E3%81%8C%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93\" data-position=\"2-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1. WSL1と違いlocalhostにWSL2がバインドできません\"> &gt; 1. WSL1と違いlocalhostにWSL2がバインドできません</span></a>1. WSL1と違いlocalhostにWSL2がバインドできません</h3>\n<p data-sourcepos=\"67:1-67:462\">WSL2がつかっているVirtual Switchはinternal onlyのため、Win32側からlocalhostをつかってWSL2にアクセスすることができません。<a href=\"https://docs.microsoft.com/en-us/windows/wsl/wsl2-faq#will-wsl-2-be-able-to-use-networking-applications\" target=\"_blank\" rel=\"noopener noreferrer\">現在対応中のようです</a> (2019-07-27追記: <a href=\"https://devblogs.microsoft.com/commandline/whats-new-for-wsl-in-insiders-preview-build-18945/\" target=\"_blank\" rel=\"noopener noreferrer\">Build Version 18945で解決しました</a> <img class=\"emoji\" title=\":tada:\" alt=\":tada:\" src=\"https://assets.esa.io/images/emoji/unicode/1f389.png\">)。</p>\n<p data-sourcepos=\"69:1-69:34\">対処方法は2つあります。</p>\n<p data-sourcepos=\"71:1-71:23\"><strong>a. WSL1をつかう</strong></p>\n<p data-sourcepos=\"73:1-73:247\">これが一番楽ですが、WSL1は次項であげるパフォーマンス上の欠点があるので、Web系フロントエンド開発におけるライブリローディング機能をつかうケースに限定するといいでしょう。</p>\n<p data-sourcepos=\"75:1-75:36\"><strong>b. Hostsファイルをつかう</strong></p>\n<p data-sourcepos=\"77:1-77:242\">Win32のHostsファイルでWSL2のeth0インターフェイスのIPアドレスに適当なホスト名を割り当てます（ポートごとにホストを振り分けたい場合はWSL2側にProxyを用意するといいでしょう）。</p>\n<div class=\"code-block\" data-sourcepos=\"79:1-83:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>shell</div>\n<div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># C:\\Windows\\System32\\drivers\\etc\\hosts</span>\n\n172.17.72.217 dashboard.local.me\n</code></pre></div>\n</div>\n<p data-sourcepos=\"85:1-85:321\">WSL2のIPアドレスはコンテナを立ち上げるごとに変わるので、下記のようなコマンドレットをWin32側のPowerShell $PROFILEに用意しておくといいでしょう。WSL2だけで完結したい方はシェル上から <code>powershell.exe -Command 'Sync-HostsToWslIp'</code> と打つだけです。</p>\n<div class=\"code-block\" data-sourcepos=\"87:1-104:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>powershell</div>\n<div class=\"highlight\"><pre class=\"highlight powershell\"><code><span class=\"c\"># $PROFILE</span><span class=\"w\">\n\n</span><span class=\"kr\">function</span><span class=\"w\"> </span><span class=\"nf\">Sync-HostsToWslIp</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nv\">$hosts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$</span><span class=\"nn\">env</span><span class=\"p\">:</span><span class=\"nv\">SystemRoot</span><span class=\"s2\">\\System32\\drivers\\etc\\hosts\"</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"nv\">$pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\"</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"nv\">$wslip</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">bash.exe</span><span class=\"w\"> </span><span class=\"nt\">-c</span><span class=\"w\"> </span><span class=\"s2\">\"ifconfig eth0 | grep 'inet '\"</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"kr\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">$wslip</span><span class=\"w\"> </span><span class=\"o\">-match</span><span class=\"w\"> </span><span class=\"nv\">$pattern</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nv\">$wslip</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nv\">$matches</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span><span class=\"w\">\n  </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"kr\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"The Script Exited, the ip address of WSL 2 cannot be found\"</span><span class=\"p\">;</span><span class=\"w\">\n    </span><span class=\"kr\">exit</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\">}</span><span class=\"w\">\n  </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"nv\">$hosts</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">$_</span><span class=\"w\"> </span><span class=\"o\">-match</span><span class=\"w\"> </span><span class=\"nv\">$pattern</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\">\n  </span><span class=\"nv\">$rc</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"nv\">$hosts</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">$_</span><span class=\"w\"> </span><span class=\"o\">-replace</span><span class=\"w\"> </span><span class=\"nv\">$matches</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"nv\">$wslip</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\">\n  </span><span class=\"nv\">$rc</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Out-File</span><span class=\"w\"> </span><span class=\"nv\">$hosts</span><span class=\"p\">;</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div>\n</div>\n<h3 data-sourcepos=\"106:1-106:127\" id=\"2-3-2\" name=\"2-3-2\">\n<a class=\"anchor\" id=\"2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています\" name=\"2.%20WSL1%E3%81%A8%E5%90%8C%E6%A7%98%E3%81%ABWin32%E3%83%BBWSL%E9%96%93%E3%81%A7%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%AA%AD%E3%81%BF%E6%9B%B8%E3%81%8D%E3%81%AB%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E5%B7%AE%E3%81%8C%E5%A4%A7%E3%81%8D%E3%81%8F%E5%87%BA%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99\" href=\"#2.%20WSL1%E3%81%A8%E5%90%8C%E6%A7%98%E3%81%ABWin32%E3%83%BBWSL%E9%96%93%E3%81%A7%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%AA%AD%E3%81%BF%E6%9B%B8%E3%81%8D%E3%81%AB%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E5%B7%AE%E3%81%8C%E5%A4%A7%E3%81%8D%E3%81%8F%E5%87%BA%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99\" data-position=\"2-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています\"> &gt; 2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています</span></a>2. WSL1と同様にWin32・WSL間でのファイルの読み書きにパフォーマンスの差が大きく出ています</h3>\n<p data-sourcepos=\"107:1-107:108\">いろんな方がベンチマークを公開してるのでそれを参考にするといいでしょう。</p>\n<p data-sourcepos=\"109:1-109:7\"><strong>Cf.</strong></p>\n<ul data-sourcepos=\"111:1-113:0\">\n<li data-sourcepos=\"111:1-111:115\"><a href=\"https://twitter.com/ZahmbieND/status/1139921840351170560?s=20\" target=\"_blank\" rel=\"noopener noreferrer\">Pythonでファイル操作のベンチマーク</a></li>\n<li data-sourcepos=\"112:1-113:0\"><a href=\"https://qiita.com/kunit/items/051196022763e64e91f6\" target=\"_blank\" rel=\"noopener noreferrer\">dd、git cloneのベンチマーク</a></li>\n</ul>\n<p data-sourcepos=\"114:1-114:123\">わたしは <code>git status -sb</code> をよくつかうので、そのコマンドで簡単なベンチマークとりました。</p>\n<div class=\"code-block\" data-sourcepos=\"116:1-128:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>shell</div>\n<div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># WSLx</span>\n<span class=\"nv\">$ </span><span class=\"nb\">cd</span> ~/nabinno.github.io\n<span class=\"nv\">$ </span><span class=\"se\">\\t</span>ime <span class=\"nt\">-f</span> %e git status <span class=\"nt\">-sb</span> \n\n<span class=\"c\"># Win32/WSLx</span>\n<span class=\"nv\">$ </span><span class=\"nb\">cd</span> ~/nabinno.github.io\n<span class=\"nv\">$ </span><span class=\"se\">\\t</span>ime <span class=\"nt\">-f</span> %e powershell.exe <span class=\"nt\">-Command</span> <span class=\"s1\">'git status -sb'</span>\n\n<span class=\"c\"># Win32</span>\nPS&gt; <span class=\"nb\">cd</span> ~/nabinno.github.io\nPS&gt; <span class=\"o\">(</span>Measure-Command <span class=\"o\">{</span> git status <span class=\"nt\">-sb</span> <span class=\"o\">})</span>.TotalMilliseconds / 1000 | %<span class=\"o\">{</span> <span class=\"o\">[</span>math]::Round<span class=\"o\">(</span><span class=\"nv\">$_</span>, 2<span class=\"o\">)</span> <span class=\"o\">}</span>\n</code></pre></div>\n</div>\n<table data-sourcepos=\"130:1-136:29\">\n<thead>\n<tr data-sourcepos=\"130:1-130:29\">\n<th data-sourcepos=\"130:2-130:13\">Subject</th>\n<th data-sourcepos=\"130:15-130:20\">WSL</th>\n<th data-sourcepos=\"130:22-130:28\">Win32</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"132:1-132:29\">\n<td data-sourcepos=\"132:2-132:13\">WSL1</td>\n<td data-sourcepos=\"132:15-132:20\">0.47</td>\n<td data-sourcepos=\"132:22-132:28\">0.09</td>\n</tr>\n<tr data-sourcepos=\"133:1-133:29\">\n<td data-sourcepos=\"133:2-133:13\">WSL2</td>\n<td data-sourcepos=\"133:15-133:20\">0.00</td>\n<td data-sourcepos=\"133:22-133:28\">0.61</td>\n</tr>\n<tr data-sourcepos=\"134:1-134:29\">\n<td data-sourcepos=\"134:2-134:13\">Win32/WSL1</td>\n<td data-sourcepos=\"134:15-134:20\">2.66</td>\n<td data-sourcepos=\"134:22-134:28\">1.91</td>\n</tr>\n<tr data-sourcepos=\"135:1-135:29\">\n<td data-sourcepos=\"135:2-135:13\">Win32/WSL2</td>\n<td data-sourcepos=\"135:15-135:20\">2.81</td>\n<td data-sourcepos=\"135:22-135:28\">1.79</td>\n</tr>\n<tr data-sourcepos=\"136:1-136:29\">\n<td data-sourcepos=\"136:2-136:13\">Win32</td>\n<td data-sourcepos=\"136:15-136:20\">0.51</td>\n<td data-sourcepos=\"136:22-136:28\">0.12</td>\n</tr>\n</tbody>\n</table>\n<h2 data-sourcepos=\"138:1-138:45\" id=\"2-4-0\" name=\"2-4-0\">\n<a class=\"anchor\" id=\"Docker以外でWSLの課題はないのか\" name=\"Docker%E4%BB%A5%E5%A4%96%E3%81%A7WSL%E3%81%AE%E8%AA%B2%E9%A1%8C%E3%81%AF%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B\" href=\"#Docker%E4%BB%A5%E5%A4%96%E3%81%A7WSL%E3%81%AE%E8%AA%B2%E9%A1%8C%E3%81%AF%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B\" data-position=\"2-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Docker以外でWSLの課題はないのか\"> &gt; Docker以外でWSLの課題はないのか</span></a>Docker以外でWSLの課題はないのか</h2>\n<h3 data-sourcepos=\"139:1-139:34\" id=\"2-4-1\" name=\"2-4-1\">\n<a class=\"anchor\" id=\"デバイスへのアクセス\" name=\"%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9\" href=\"#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9\" data-position=\"2-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"デバイスへのアクセス\"> &gt; デバイスへのアクセス</span></a>デバイスへのアクセス</h3>\n<p data-sourcepos=\"140:1-140:108\">以前から要望があったものだと「デバイスアクセスができない」件があります。</p>\n<p data-sourcepos=\"142:1-142:269\">9P導入前だとこれはElixirのIoTフレームワークNervesのように、<a href=\"https://github.com/wslutilities/wslu\" target=\"_blank\" rel=\"noopener noreferrer\">WSL Utilities</a>でWSLパスをWin32パスに変換してからWin32にあるデバイス関連ツールをつかうのが簡単な解決策でした。</p>\n<div class=\"code-block\" data-sourcepos=\"144:1-146:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>sh</div>\n<div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">$ </span>fwup.exe <span class=\"nt\">-a</span> <span class=\"nt\">-i</span> <span class=\"si\">$(</span>wslpath <span class=\"nt\">-w</span> <span class=\"nt\">-a</span> _build/rpi0_dev/nerves/images/hello_nerves.fw<span class=\"si\">)</span> <span class=\"nt\">-t</span> <span class=\"nb\">complete</span> <span class=\"nt\">-d</span> <span class=\"si\">$(</span>fwup.exe <span class=\"nt\">-D</span> | <span class=\"nb\">sed</span> <span class=\"s1\">'s/,.*//'</span><span class=\"si\">)</span>\n</code></pre></div>\n</div>\n<p data-sourcepos=\"148:1-148:188\">ただし9Pを導入したWindows 10 Version 1903以降は、WSL1もWSL2もともにWSLパスを変換せずにWin32にあるデバイス関連ツールをつかうことができます。</p>\n<div class=\"code-block\" data-sourcepos=\"150:1-152:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>sh</div>\n<div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">$ </span>fwup.exe <span class=\"nt\">-a</span> <span class=\"nt\">-i</span> _build/rpi0_dev/nerves/images/hello_nerves.fw <span class=\"nt\">-t</span> <span class=\"nb\">complete</span> <span class=\"nt\">-d</span> <span class=\"si\">$(</span>fwup.exe <span class=\"nt\">-D</span> | <span class=\"nb\">sed</span> <span class=\"s1\">'s/,.*//'</span><span class=\"si\">)</span>\n</code></pre></div>\n</div>\n<h1 data-sourcepos=\"154:1-154:8\" id=\"3-0-0\" name=\"3-0-0\">\n<a class=\"anchor\" id=\"WRAPUP\" name=\"WRAPUP\" href=\"#WRAPUP\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"WRAPUP\"> &gt; WRAPUP</span></a>WRAPUP</h1>\n<p data-sourcepos=\"155:1-155:90\">わたしの観測範囲では課題はほぼ問題ない状態になっていました。</p>\n<p data-sourcepos=\"157:1-157:49\"><strong>おすすめ開発環境は下記のとおり</strong></p>\n<table data-sourcepos=\"159:1-164:55\">\n<thead>\n<tr data-sourcepos=\"159:1-159:49\">\n<th data-sourcepos=\"159:2-159:24\">item</th>\n<th data-sourcepos=\"159:26-159:48\">content</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"161:1-161:55\">\n<td data-sourcepos=\"161:2-161:24\">IDE</td>\n<td data-sourcepos=\"161:26-161:54\">WSLx上のエディタ</td>\n</tr>\n<tr data-sourcepos=\"162:1-162:58\">\n<td data-sourcepos=\"162:2-162:33\">Webフロントエンド開発</td>\n<td data-sourcepos=\"162:35-162:57\">WSL1</td>\n</tr>\n<tr data-sourcepos=\"163:1-163:53\">\n<td data-sourcepos=\"163:2-163:28\">Docker関連開発</td>\n<td data-sourcepos=\"163:30-163:52\">WSL2</td>\n</tr>\n<tr data-sourcepos=\"164:1-164:55\">\n<td data-sourcepos=\"164:2-164:24\">dotfiles</td>\n<td data-sourcepos=\"164:26-164:54\">WSLx、Win32を共有管理</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"166:1-166:340\">Win32側のIDEをつかっているユーザーはパフォーマンス上の不満がまだあるかもしれませんが、WSLでDockerをつかったWebアプリケーション開発は十分できる、と言えそうです。つまり、Linux・macOS・WindowsによるWebアプリケーション開発は十分共有できる、と。</p>\n<p data-sourcepos=\"168:1-168:33\">いい時代になりました。</p>\n","tags":["wsl","wsl2","ubuntu"],"updated_at":"2021-01-15T21:48:15+09:00","childPublishedDate":{"published_on":"2019-07-06T00:00:00.000Z"},"updated_by":{"name":"なびの👷","screen_name":"nabinno","icon":"https://img.esa.io/uploads/production/members/94286/icon/thumb_m_ef5f024307008aa399b91f87fa5f64e8.jpg"}},"relatedPosts":{"edges":[{"node":{"number":59,"relative_category":"blog/backend","fields":{"title":"連載 Rails2Phoenix 1 UmbrellaプロジェクトをHerokuにデプロイする","excerpt":"使い慣れたRailsのプロジェクトを拡張したいのですが、その都度技術スタックを増やす必要があり、この点をどうにかクリアしたいと考えています。連載「Rails2Phoenix」になります、今回はフレームワークをElixir製のPhoenix Frameworkへと変更を試みました。   > PROBLEMPROBLEM \n\n- サービスについて 拡張にともない技術スタックがふえるのを抑えたい スケーラビリティのためのコストを抑えたい パフォーマンスをあげたい \n- 拡張にともない技術スタックがふえるのを抑えたい\n- スケーラビリティのためのコストを抑えたい\n- パフォーマンスをあげたい   > SOLUTIONSOLUTION \n\nというわけで、現在つかっているRailsをPhoenixに変更することにしました。方針は以下の通りで、今回はRailsから移行中のPhoenix UmbrellaプロジェクトをHerokuにデプロイする流れをとりあげます。 \n\n方針 \n\n- Railsから徐々にPhoenixに移行できるように いままでとおなじPaaS（Heroku） いままでとおなじレポジトリ ブランチ戦略は phoenix/base をベースに 気軽に参照できるようにRails関連ファイルは可能な限りのこしておく いままでとおなじDB 移行完了までDBマイグレーションをしない \n- いままでとおなじPaaS（Heroku）\n- いままでとおなじレポジトリ ブランチ戦略は phoenix/base をベースに 気軽に参照できるようにRails関連ファイルは可能な限りのこしておく \n- ブランチ戦略は phoenix/base をベースに\n- 気軽に参照できるようにRails関連ファイルは可能な限りのこしておく\n- いままでとおなじDB 移行完了までDBマイグレーションをしない \n- 移行完了までDBマイグレーションをしない\n- Phoenixは今後の拡張性をかんがえてUmbrellaプロジェクトで   > HerokuへのデプロイのながれHerokuへのデプロイのながれ \n\n基本的にドキュメント通り。   > Phoenixアプリケーションを作成Phoenixアプリケーションを作成 \n\nまず、こんな感じでPhoenixの骨組みをつくります。Phoenix関連のファイル apps/, deps/, config/config.exs, mix.exs, mix.lock が追加されます。   sh \n\n> cd rails_project > mix new . --umbrella > (cd ./apps && mix phx.new phoenix_app)   \n\n次に、既存のRailsでつくられたスキーマをPhoenixに移植します。Ripperをつかうとはかどります。ちなみに手動でスキーマをつくりたい場合は、CLI mix phx.gen.schema --no-migration Blog.Post blog_posts title:string で作成します。   rb \n\n# lib/tasks/convert_to_phoenix.rake # こちらはスキーマ移植タスクをPhoenix1.3用に改めたもの require 'ripper' require 'erb' require 'fileutils' namespace :db do namespace :schema do desc 'Convert schema from Rails to Phoenix' task convert_to_phoenix: :environment do ConvertSchemaForPhoenixService.call end end end class ConvertSchemaForPhoenixService class << self def call FileUtils.mkdir_p(File.join('tmp', 'models')) extract_activerecord_define_block( Ripper.sexp( Rails.root .join('db', 'schema.rb') .read ) ).select(&method(:create_table_block?)) .map(&method(:configuration)) .each do |conf| project_name = 'PhoenixApp' table_name = conf[:table_name] table_columns = conf[:table_columns].reject(&method(:reject_condition)) .map do |c| case c[:column_type] when 'text' then c[:column_type] = ':string' when 'datetime' then c[:column_type] = ':naive_datetime' when 'inet' then c[:column_type] = 'EctoNetwork.INET' else c[:column_type] = \":#{c[:column_type]}\" end c end File.write( File.join('tmp', 'models', \"#{conf[:table_name].singularize}.ex\"), template.result(binding) ) end end private def extract_activerecord_define_block(sexp) sexp.dig(1, 0, 2, 2) end def create_table_block?(activerecord_define_block_element_sexp) activerecord_define_block_element_sexp.dig(1, 1, 1) == 'create_table' rescue false end def extract_table_name(create_table_block_sexp) create_table_block_sexp.dig(1, 2, 1, 0, 1, 1, 1) end def extract_table_columns(create_table_block_sexp) create_table_block_sexp.dig(2, 2) end def extract_column_type(table_column_sexp) table_column_sexp.dig(3, 1) end def extract_column_name(table_column_sexp) # Return value of `t.index` is array like ['user_id']. if table_column_sexp.dig(4, 1, 0, 0) == :array return table_column_sexp.dig(4, 1, 0, 1).map { |e| e.dig(1, 1, 1) } end table_column_sexp.dig(4, 1, 0, 1, 1, 1) end def extract_column_option(table_column_sexp) # If is not `column_option`, then `table_column_sexp.dig(4, 1, 1, # 1)` method return nil. Set blank array ([]) for avoiding nil. table_column_sexp.dig(4, 1, 1, 1) || [] end def extract_option_key(column_option_sexp) # Remove colon for avoiding `null:`. column_option_sexp.dig(1, 1).gsub(/:\\z/, '') end def extract_option_value(column_option_sexp) if column_option_sexp.dig(2, 0) == :array return Array(column_option_sexp.dig(2, 1)).map { |e| e.dig(1, 1, 1) } end element = column_option_sexp.dig(2, 1) if element.class != Array return element end case element.dig(0) when :kw then element.dig(1) when :string_content then element.dig(1, 1) || '' end end def template ERB.new(<<'__EOD__', nil, '-') defmodule <%= project_name %>.<%= table_name.classify %> do use Ecto.Schema import Ecto.Changeset alias <%= project_name %>.<%= table_name.classify %> schema \"<%= table_name %>\" do<% table_columns.each do |c| %> field :<%= c[:column_name] -%>, <%= c[:column_type] -%> <% end %> timestamps inserted_at: :created_at end @doc false def changeset(%<%= table_name.classify %>{} = <%= table_name.singularize %>, attrs) do <%= table_name.singularize %> |> cast(attrs, [<%= table_columns.map { |c| \":\" << c[:column_name] }.join(\", \") -%>]) # |> validate_required([<%= table_columns.map { |c| \":\" << c[:column_name] }.join(\", \") -%>]) end end __EOD__ end def configuration(table) { table_name: extract_table_name(table), table_columns: extract_table_columns(table).map do |c| { column_name: extract_column_name(c), column_type: extract_column_type(c), column_option: Hash[extract_column_option(c).map { |o| [extract_option_key(o), extract_option_value(o)] }] } end } end def reject_condition(column) column[:column_name] =~ /\\A(created|updated)_at\\z/ || column[:column_type] == 'index' end end end     sh \n\n> rails db:schema:convert_to_phoenix   \n\n最後に、既存DBへはこんな感じで接続します。   config \n\n# rails_project/apps/phoenix_app/config/dev.exs config :phoenix_app, PhoenixApp.Repo, adapter: Ecto.Adapters.Postgres, url: System.get_env(\"DATABASE_URL\"), pool_size: 10, ssl: true     sh \n\n> (cd ./apps/phoenix_app/assets && npm install) > mix deps.get > mix phx.server     > デプロイのパイプラインを追加デプロイのパイプラインを追加 \n\nさて、既存のCI（Wercker）も更新しましょう。今回はPhoenix関連ブランチが更新された場合にのみ、関連パイプラインを走らせるように下記のように変更しました。 \n\nBEFORE \n\n- build (all branch) deploy.prod (master branch) \n- deploy.prod (master branch) \n\nAFTER \n\n- build (all branch) deploy.prod (master branch) deploy.phoenix.prod (phoenix/base branch) \n- deploy.prod (master branch)\n- deploy.phoenix.prod (phoenix/base branch)   yaml \n\n# wercker.yml deploy-phoenix-prod-heroku: steps: - add-ssh-key: host: github.com keyname: GITHUB - add-to-known_hosts: hostname: github.com fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48 - heroku-deploy: key: $HEROKU_KEY user: $HEROKU_USER app-name: $HEROKU_APP_NAME install-toolbelt: true after-steps: - wantedly/pretty-slack-notify: webhook_url: ${SLACK_WEBHOOK_URL} channel: general     > Herokuアプリケーションを作成Herokuアプリケーションを作成 \n\n基本ドキュメントの説明通りです。Phoenix Umbrellaプロジェクトの注意点としては、ディレクトリの差異くらいでそれ以外は同じです。つまり、これ rails_project/config/prod.exs をこう rails_project/apps/phoenix_app/config/prod.exs 変更します。 \n\n1. Herokuアプリにビルドパックを適用   sh \n\n> heroku create --buildpack https://github.com/HashNuke/heroku-buildpack-elixir.git > heroku buildpacks:add https://github.com/gjaldon/heroku-buildpack-phoenix-static.git   \n\n2. 起動設定を準備   config \n\n# rails_project/elixir_buildpack.config erlang_version=19.1 elixir_version=1.4.2 always_rebuild=false pre_compile=\"pwd\" post_compile=\"pwd\" runtime_path=/app config_vars_to_export=(DATABASE_URL) config_vars_to_export=(DATABASE_POOL_SIZE)     config \n\n# rails_project/phoenix_static_buildpack.config phoenix_relative_path=apps/phoenix_app     config \n\n# rails_project/Procfile web: MIX_ENV=prod mix phx.server   \n\n3. 環境変数を適用 \n\nデータベース関連。   config \n\n# rails_project/apps/phoenix_app/config/prod.exs config :phoenix_app, PhoenixApp.Repo, adapter: Ecto.Adapters.Postgres, url: System.get_env(\"DATABASE_URL\"), pool_size: String.to_integer(System.get_env(\"DATABASE_POOL_SIZE\") || 10), ssl: true     sh \n\nheroku config:set DATABASE_URL=foo heroku config:set DATABASE_POOL_SIZE=bar   \n\nクレデンシャル関連。   sh \n\n> heroku config:set HEROKU_API_KEY=$(heroku auth:token) > heroku config:set SECRET_KEY_BASE=$(mix phx.gen.secret)     > WRAPUPWRAPUP \n\n大枠は想定通りすんなり進めることが出来ましたが、課題もいくつか出てきました。まずは認証機能。こちらは次回のテーマで取り上げようと思いますが、Railsの認証ライブラリほど充実していないので自前でいくつか用意する必要がありそうです。次にビジネスロジック。これは元のRailsの実装が悪かったので致し方ないのですが、移植するのに時間がかかりそうです。先にRails側を整理してから進めた方が良いかもしれません。"},"name":"[2018-01-08]連載 Rails2Phoenix 1 UmbrellaプロジェクトをHerokuにデプロイする","tags":["phoenix-framework","elixir","ruby-on-rails","ruby","wercker","heroku"],"childPublishedDate":{"published_on":"2018-01-08T00:00:00.000Z","published_on_unix":1515369600}}},{"node":{"number":63,"relative_category":"blog/frontend","fields":{"title":"イケてるしヤバい言語REBOLの後継Redでクライアントソフトをつくった話","excerpt":"Redという言語はご存じでしょうか。可読性が高いシンタックスを持ち、ワンバイナリーをクロスコンパイルでき、かつ、クライアント用のUIコンポーネントを標準ライブラリに備えたプログラミング言語です。その野心的な挑戦にすぐに虜になりました。新年早々の恋です。   > PROBLEMPROBLEM \n\n- クロスプラットフォーム用のクライアントソフトをつくるにあたり 重たいフレームワークが多い 汎用的な言語をつかってるものが多く、そのためライブラリー等の依存関係が多くなりやすい \n- 重たいフレームワークが多い\n- 汎用的な言語をつかってるものが多く、そのためライブラリー等の依存関係が多くなりやすい   > SOLUTIONSOLUTION \n\nというわけで、年明け見つけたRedがシンプルだったので使ってみました。題材は以前つくったEmacsライブラリ「esa.el」の移植です。 \n\n- 今回作ったコード https://github.com/nabinno/esa.red    > やったことやったこと   > エディターエディター \n\n構文がすなおなので特にエディタは関係なさそうでしたが、慣れ親しんでるEmacsに「Skrylar/red.el」を適用しました。その際、 red-font-lock-keywords と red-indent-line に足りない箇所があったのでオーバーライドしました。   > 糖衣構文の適用糖衣構文の適用 \n\nRedはコマンドラインREPLがつかえるので、 docs.red-lang.org とRed by Exampleをみながらひとつひとつ挙動を確認しました。その中でどうしても慣れない表現が2つあったので糖衣構文を実装しました。 \n\n- 実装した糖衣構文 nabinno/red-elixir  \n\n1. compose \n\nブロック内の変数を評価しブロックとして返す関数 compose は、VIDのフェイス更新によく使われます。HTML/JavaScripでいうところDOM更新にあたるものといえば分かるでしょうか。頻繁に「 compose [foo (bar)] 」のような表現がつづくとほかの変数や関数とまざり可読性がおちるので、Elixirのシジルを参考に compose 関数を省略しました。こんな感じです。 \n\n;-- before compose [foo (bar)] ;-- after ~c[foo (bar)]  \n\n2. 関数の入れ子 \n\n素のRedはイテレーター構文なので、関数の入れ子による可読性低下をおさえるため変数定義をよく使います。個人的には変数は意味のあるものだけ使いたい派なので、パイプを導入しました。といっても、フロントエンドの場合、データ加工はあまりやらないのでつかうケースはほぼありませんでした。あってもこのくらいです。   red \n\n;-- before rejoin collect [ foreach d data [ keep rejoin [d \" \"] ] ] ;-- after data .[ |> Series/map 'd [rejoin [d \" \"]] |> rejoin ]     > タスクランナーの用意タスクランナーの用意 \n\n今回は上で実装したライブラリ「red-elixir」のほかにHTTPリクエスト・JSONパーサーライブラリを使っています。ライブラリパッケージはインストールはgit submodulesで良いですが、呼び出しも考えると実装が冗長的になるのでパッケージ管理とタスクランナーをあわせて用意しました（nabinno/hot、nabinno/mods）。 \n\nタスクランナーインストール後、パッケージのインストールから呼び出しまでの流れ \n\nRedはGoとおなじくワンバイナリーなので、wgetやcurlだけでインストールが完了します。   sh \n\n> mkdir -p ~/.local/bin > wget https://github.com/nabinno/hot/releases/download/0.0.3/hot-linux -O ~/.local/bin/hot > chmod 744 ~/.local/bin/hot   \n\nパッケージ管理はElixirのmixを参考にタスクランナー管理ファイル内に定義します。   sh \n\n> hot cmd/install https://raw.githubusercontent.com/nabinno/mods/master/mods.red > cat hots.red Red [] hots: context [ mods: [ red-elixir #(init: %init.red git: https://github.com/nabinno/red-elixir) json #(init: %json.red git: https://github.com/rebolek/red-tools) http-tools #(init: %http-tools.red git: https://github.com/rebolek/red-tools) ] ] > hot mods/get   \n\nビルド時は #include をつかうのでパッケージ呼び出し機能は使えないですが、コマンドラインREPLで挙動確認している際は do/args %require を使います。   sh \n\n> red >> do/args %require [red-elixir] >> 1 .. 10 .[ |> Series/map 'i [i * 2] |> Series/map 'i [i + 1] ] == [3 5 7 9 11 13 15 17 19 21]     > WRAPUPWRAPUP \n\nクライアントソフトを作る中で感じたことは、この1点です。Redは既存のフレームワークと比べるとまだまだ機能不足感が拭えませんが、それを補えるだけの表現力を持っていました。手触りが本当に良い言語でした。"},"name":"[2019-03-31]イケてるしヤバい言語REBOLの後継Redでクライアントソフトをつくった話","tags":["red","esa"],"childPublishedDate":{"published_on":"2019-03-31T00:00:00.000Z","published_on_unix":1553990400}}},{"node":{"number":53,"relative_category":"blog/frontend","fields":{"title":"Hyper-VモードでLinux OSとAndroid OSを同時使用する","excerpt":"Xamarinの開発環境を模索しています。普段はLinux/Hyper-V上でAPIを開発しているのですが、Hyper-VとAndroid Emulatorとの組み合わせがまだ整備されておらず一筋縄ではいかなかったのでその備忘となります。   > PROBLEMPROBLEM \n\n- 普段の開発環境CentOS/Hyper-Vを変更することなく、Xamarinをつかいたい CentOS/Hyper-V上にAPIサーバーをたてて、XamarinアプリからAPIをたたく構成 \n- CentOS/Hyper-V上にAPIサーバーをたてて、XamarinアプリからAPIをたたく構成\n- Android EmulatorはIntel HAXM＋ホスト型Hypervisor前提のものが多い VirtualBoxなどホスト型HypervisorだとVMがよくクラッシュしてつらい なので、APIサーバーはHyper-Vでたてている また、オフィス移動が多いのでネットワーク環境はおもにWi-Fi（無線LAN）を使用している \n- VirtualBoxなどホスト型HypervisorだとVMがよくクラッシュしてつらい なので、APIサーバーはHyper-Vでたてている また、オフィス移動が多いのでネットワーク環境はおもにWi-Fi（無線LAN）を使用している \n- なので、APIサーバーはHyper-Vでたてている\n- また、オフィス移動が多いのでネットワーク環境はおもにWi-Fi（無線LAN）を使用している   > SOLUTIONSOLUTION \n\nというわけで、Hyper-Vでイメージ管理するVisual Studio Emulator for Android（VS Emulator）を使うことにしました。これで何もせずに解決かというそうではなく、まず前提としてネットワーク上の注意があります。 \n\n1. VS EmulatorはHyper-VのNetwork AdapterをEthernet（有線LAN）しか使用できません。Wi-Fi（無線LAN）は使用できません\n2. VS Emulatorの各デバイス(Android VM）を初回起動させる際に、有線LANと無線LAN双方からネットワークにつなげていると失敗します   > Hyper-VモードでLinux OS（VM）とAndroid OS（VM）を同時使用する方法Hyper-VモードでLinux OS（VM）とAndroid OS（VM）を同時使用する方法 \n\nその上で、同時使用する方法ですが、先ほどネットワークの注意を考慮すると下記のような流れになります。 \n\n1. Stop-VM CentOS 現在稼働しているLinux VMを停止します\n2. Disable-NetAdapter Wi-Fi 無線LANの接続を停止し、有線LANのみの接続にします\n3. VS EmulatorからAndroid VMを初回起動します、そうすると有線LAN用のvEthernetが作成されます\n4. Enable-NetAdapter Wi-Fi - 無線LAN、有線LAN、双方を接続します\n5. Start-VM CentOS - Linux VMを起動します   > WRAPUPWRAPUP \n\nWindows Subsystems for Linux等、Windowsの仮想化環境はまだ発展途上にあります。おそらく今回の対処方法は一時的なものに過ぎず、こうしたネットワーク上の注意を意識することなく解決できると思われます。しばし様子見です。"},"name":"[2017-03-09]Hyper-VモードでLinux OSとAndroid OSを同時使用する","tags":["android","smartphone","visual-studio-emulator-for-android","surface-book","android-emulator"],"childPublishedDate":{"published_on":"2017-03-09T00:00:00.000Z","published_on_unix":1489017600}}}]}},"pageContext":{"number":64}},"staticQueryHashes":[]}