{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/62","result":{"data":{"esaPost":{"number":62,"relative_category":"blog/backend","fields":{"title":"Elixirã§ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯","excerpt":"ç´†ä½™æ›²æŠ˜åˆã£ã¦ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®é‹ç”¨ã‚’è¦‹ç›´ã™å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚äººã®èˆˆå‘³ã¨ã„ã†ã®ã¯å°½ããªã„ã‚‚ã®ã§çŸ¥ã‚ŠãŸã„ã“ã¨ãŒæ¬¡ã€…å‡ºã¦ãã¾ã™ã€‚ã«ã‚‚æ‹˜ã‚ã‚‰ãšäººã®æ™‚é–“ã¯æœ‰é™ã§ãã‚Œã«ã‚ãŒãªã†ãŸã‚ã®æ‰‹æ®µã‚’è€ƒãˆãŸã‚ã‘ã§ã™ã€‚   > PROBLEMPROBLEM \n\n- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆãƒ–ã‚¯ãƒï¼‰ã™ã‚‹ã¨ãƒ•ã‚£ãƒ¼ãƒ‰æ¶ˆåŒ–ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹ ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹ ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„ èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† \n- ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹ ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„ èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† \n- ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„\n- èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†\n- é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†   > SOLUTIONSOLUTION \n\nã¨ã„ã†ã‚ã‘ã§ã€ä¸‹è¨˜ã®æ–¹é‡ã§ãƒ–ã‚¯ãƒã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯GitHubãƒ¬ãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ãã ã•ã„ã€‚ãã—ã¦ã€æ–¹é‡ã¯ä¸‹è¨˜ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ \n\næ–¹é‡ \n\n- ãƒ•ã‚£ãƒ¼ãƒ‰ã”ã¨ã«ã‚¿ã‚°ã¥ã‘ã™ã‚‹\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ã§é™¤å¤–åˆ¤å®šã™ã‚‹\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã‹ã‚‰æ ¡æ­£ã™ã¹ãã‚‚ã®ã‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã¹ãã‚‚ã®ã‹åˆ¤å®šã™ã‚‹\n- ä¸Šè¨˜è¨­å®šã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\n- ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã‚’éåŒæœŸå‡¦ç†ã§ãã‚‹ã‚ˆã†Elixirã§å®Ÿè£…ã™ã‚‹   > ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³• \n\nã¾ãšãƒ–ã‚¯ãƒã®ç®¡ç†ã§ã™ãŒã€ä¸‹è¨˜5ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§æ§‹æˆã—ã¦ã„ã¾ã™ã€æ§‹é€ ã¯ãƒãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã®ã¿ã€‚ãƒ–ã‚¯ãƒã—ãŸã„ã¨æ€ã†è¨˜äº‹ã‚’èª­ã¿ã™ã™ã‚ã‚‹ä¸­ã§æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ããŸã‚‰éƒ½åº¦ feed.yaml ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã¾ãŸã€è¨˜äº‹ã«ãƒã‚¤ã‚ºãŒå¤šã„ã‚ˆã†ã ã£ãŸã‚‰å‚¾å‘ã‚’åˆ†æã—ã¦é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ« feed_excluded_link.yaml feed_excluded_title.yaml ã‚’æ›´æ–°ã—ã¾ã™ã€‚    item description     feed.yaml ãƒ•ã‚£ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã«å¯¾ã™ã‚‹ãƒªãƒ³ã‚¯ã€ã‚¿ã‚°ã®ãƒãƒƒãƒ—   feed_excluded_link.yaml é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆ   feed_excluded_title.yaml é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒªã‚¹ãƒˆ   feed_corrected_link.yaml ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ—   feed_redirected_link.yaml ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒªãƒ³ã‚¯ã®ãƒãƒƒãƒ—      yaml \n\n# feed.yaml nabinno/sports/feed_group_name: tags: - ski links: - http://rss.example.com/ski_feed.rss - http://rss.example.com/snowboard_feed.rss - http://ski-status.example.com/rss # feed_excluded_link.yaml - anti-ski.example.com - awesome-snowboard.example.com # feed_excluded_title.yaml - queer - two-planker - beaver-tail # feed_corrected_link.yaml amazon.com: - ref - ie # feed_redirected_link.yaml ski-status.example.com: - Floki.find(fst, \".post__body a\")     > Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç† \n\nElixirã§éåŒæœŸå‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€å¤§ããåˆ†ã‘ã¦ç›£è¦–æ©Ÿæ§‹ã®Supervisorã¨éåŒæœŸå‡¦ç†ã®Task.async_streamã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚   > ç›£è¦–æ©Ÿæ§‹ Supervisorç›£è¦–æ©Ÿæ§‹ Supervisor \n\nã¾ãšã€Supervisorã€‚Elixirã«ã¯ç›£è¦–æ©Ÿæ§‹SupervisorãŒã‚ã‚Šã€ãã‚ŒãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã¯åˆ¥ã€…ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å‡¦ç†ã—ã¾ã™ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæš–æ°—å‡¦ç†ã‚’åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚å†èµ·å‹•æˆ¦ç•¥ã¯ã€Œå¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã«ã‚ã‚‹ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã€ï¼ˆ one_for_all ï¼‰ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚å†èµ·å‹•æˆ¦ç•¥ã®è©³ç´°ã¯ã€ŒOTPã‚¹ãƒ¼ãƒ‘ãƒã‚¤ã‚¶ Â· Elixir Schoolã€ã‚’å‚ç…§ä¸‹ã•ã„ã€‚ \n\nä¸‹è¨˜ã®ã‚ˆã†ã« Supervisor.start_link ã‚’ Keshikimi2.Application.start ã«é©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆ mix run ï¼‰ã—ãŸæ™‚ç‚¹ã§ç›£è¦–æ©Ÿæ§‹ãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚   ex \n\nSupervisor.start_link( [ :hackney_pool.child_spec(:hatena_bookmark_pool, timeout: 15_000, max_connections: 100), # @todo å½“è©²ãƒ¯ãƒ¼ã‚«ãƒ¼ã§æš–æ°—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„ã®ã§ `one_for_one` ã«ã—ãŸå ´åˆã€å†èµ·å‹•æ™‚ã«ã»ã‹ã«å½±éŸ¿ã™ã‚‹ supervisor(Cachex, [:feed, []]), supervisor(Keshikimi2Feed.Registry, [prefix]), # ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼å‡¦ç† (PubSub) supervisor(Keshikimi2Feed.Subscriber, [prefix]), worker(Keshikimi2Feed.Worker, [prefix]), worker(Keshikimi2Feed.Publisher, [[prefix: prefix, poll_interval: 3_000]]), # ãƒ–ã‚¯ãƒå‡¦ç† worker(Keshikimi2.HatenaBookmark.AddEntry, [ [prefix: prefix, poll_interval: 3_000] ]) ], strategy: :one_for_all, name: name(prefix) )     > éåŒæœŸå‡¦ç† Task.async_streaméåŒæœŸå‡¦ç† Task.async_stream \n\næ¬¡ã«ã€Task.async_streamã€‚é…åˆ—ã‚’å¼•ãå›ã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯ Task.async_stream ãŒã†ã£ã¦ã¤ã‘ã§ã™ã€‚ä¸‹è¨˜ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–ã‚Šå‡ºã—ã€é™¤å¤–å‡¦ç†ã€æ ¡æ­£å‡¦ç†ã‚’åŠ ãˆã¦ã€ãƒ–ã‚¯ãƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã¨ã„ã†æµã‚Œã‚’çµ„ã‚“ã§ã„ã¾ã™ã€‚Elixirã§ã¯ã€æµã‚Œã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãéåŒæœŸå‡¦ç†ã—ã¦ãã“ã¨ãŒã§ãã¾ã™ã€‚   ex \n\nCachex.keys!(:feed) |> Enum.reject(fn key -> key in [ \"excluded_links\", \"excluded_titles\", \"corrected_links\", \"redirected_links\", \"feed_group\", \"archived_links\" ] end) |> Task.async_stream( fn item_link -> with {:ok, [item_title, feed_tags]} <- Cachex.get(:feed, item_link), :ok <- validate_all(item_link, item_title), corrected_link <- correct_all(item_link), {:ok, payload} <- FormData.create( %{ url: corrected_link, comment: feed_tags |> Enum.map_join(fn tag -> \"[#{tag}]\" end), rks: System.get_env(\"HATENA_BOOKMARK_RKS\"), private: 0, keep_original_url: 1, with_status_op: 1, from: \"inplace\", post_twitter: 0, post_evernote: 0 }, :url_encoded, get: false ) do do_add_entries_to_hb(payload) Logger.info(\"add entry: #{item_link}\") end archive_link(item_link) end, timeout: 15_000 ) |> Stream.run()     > WRAPUPWRAPUP \n\nElixirã®éåŒæœŸå‡¦ç†ã‚’ä½¿ã†ã“ã¨ã§ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®é‹ç”¨ãŒã¨ã¦ã‚‚å¿«é©ã«ãªã‚Šã¾ã—ãŸã€‚ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¨ã®ä»Šå¾Œã®ä»˜ãåˆã„æ–¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è€ƒãˆã¦ã„ã¾ã™ã€‚ \n\n- æ‰‹å‹•ã§ãƒ–ã‚¯ãƒ: æ°—ã«ãªã£ãŸè¨˜äº‹ãŒã‚ã‚‹ã”ã¨ã«\n- ãƒ–ã‚¯ãƒã®ç¢ºèª: æ°—ã«ãªã‚‹ã‚¿ã‚°ã”ã¨ã«ã¾ã¨ã‚ã¦ç¢ºèª \n\nãƒ–ã‚¯ãƒã®ç¢ºèªã«ã¤ã„ã¦ã¯ã€ä¾‹ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œnabinno/githubã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã®é‹ç”¨ã§ã™ã€‚ \n\nèé€šãŒåˆ©ã‹ãªã„ç‚¹ã§é€”ä¸­é‹ç”¨ãŒé›£ã—ããªã‚‹æ°—ã‚‚ã—ã¾ã™ãŒã€ã—ã°ã‚‰ãå›ã—ã¦ã¿ã¾ã™ã€‚","thumbnail":"https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png"},"wip":false,"body_md":"<img alt=thumbnail src=https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png />\r\n\r\nç´†ä½™æ›²æŠ˜åˆã£ã¦ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®é‹ç”¨ã‚’è¦‹ç›´ã™å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚äººã®èˆˆå‘³ã¨ã„ã†ã®ã¯å°½ããªã„ã‚‚ã®ã§çŸ¥ã‚ŠãŸã„ã“ã¨ãŒæ¬¡ã€…å‡ºã¦ãã¾ã™ã€‚ã«ã‚‚æ‹˜ã‚ã‚‰ãšäººã®æ™‚é–“ã¯æœ‰é™ã§ãã‚Œã«ã‚ãŒãªã†ãŸã‚ã®æ‰‹æ®µã‚’è€ƒãˆãŸã‚ã‘ã§ã™ã€‚\r\n\r\n# PROBLEM\r\n- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆãƒ–ã‚¯ãƒï¼‰ã™ã‚‹ã¨ãƒ•ã‚£ãƒ¼ãƒ‰æ¶ˆåŒ–ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹\r\n    - ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹\r\n        - ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„\r\n        - èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†\r\n        - é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†\r\n\r\n# SOLUTION\r\nã¨ã„ã†ã‚ã‘ã§ã€ä¸‹è¨˜ã®æ–¹é‡ã§ãƒ–ã‚¯ãƒã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯[GitHubãƒ¬ãƒã‚¸ãƒˆãƒª](https://github.com/nabinno/keshikimi2)ã‚’å‚ç…§ãã ã•ã„ã€‚ãã—ã¦ã€æ–¹é‡ã¯ä¸‹è¨˜ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚\r\n\r\n**æ–¹é‡**\r\n\r\n- ãƒ•ã‚£ãƒ¼ãƒ‰ã”ã¨ã«ã‚¿ã‚°ã¥ã‘ã™ã‚‹\r\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ã§é™¤å¤–åˆ¤å®šã™ã‚‹\r\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã‹ã‚‰æ ¡æ­£ã™ã¹ãã‚‚ã®ã‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã¹ãã‚‚ã®ã‹åˆ¤å®šã™ã‚‹\r\n- ä¸Šè¨˜è¨­å®šã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\r\n- ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã‚’éåŒæœŸå‡¦ç†ã§ãã‚‹ã‚ˆã†Elixirã§å®Ÿè£…ã™ã‚‹\r\n\r\n## ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•\r\nã¾ãšãƒ–ã‚¯ãƒã®ç®¡ç†ã§ã™ãŒã€ä¸‹è¨˜5ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§æ§‹æˆã—ã¦ã„ã¾ã™ã€æ§‹é€ ã¯ãƒãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã®ã¿ã€‚ãƒ–ã‚¯ãƒã—ãŸã„ã¨æ€ã†è¨˜äº‹ã‚’èª­ã¿ã™ã™ã‚ã‚‹ä¸­ã§æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ããŸã‚‰éƒ½åº¦ `feed.yaml` ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã¾ãŸã€è¨˜äº‹ã«ãƒã‚¤ã‚ºãŒå¤šã„ã‚ˆã†ã ã£ãŸã‚‰å‚¾å‘ã‚’åˆ†æã—ã¦é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ« `feed_excluded_link.yaml` `feed_excluded_title.yaml` ã‚’æ›´æ–°ã—ã¾ã™ã€‚\r\n\r\n| item                        | description                                              |\r\n|-----------------------------|----------------------------------------------------------|\r\n| `feed.yaml`                 | ãƒ•ã‚£ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã«å¯¾ã™ã‚‹ãƒªãƒ³ã‚¯ã€ã‚¿ã‚°ã®ãƒãƒƒãƒ—           |\r\n| `feed_excluded_link.yaml`   | é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆ                         |\r\n| `feed_excluded_title.yaml`  | é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒªã‚¹ãƒˆ                       |\r\n| `feed_corrected_link.yaml`  | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ— |\r\n| `feed_redirected_link.yaml` | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒªãƒ³ã‚¯ã®ãƒãƒƒãƒ—       |\r\n\r\n```yaml\r\n# feed.yaml\r\nnabinno/sports/feed_group_name:\r\n  tags:\r\n    - ski\r\n  links:\r\n    - http://rss.example.com/ski_feed.rss\r\n    - http://rss.example.com/snowboard_feed.rss\r\n    - http://ski-status.example.com/rss\r\n\r\n# feed_excluded_link.yaml\r\n- anti-ski.example.com\r\n- awesome-snowboard.example.com\r\n\r\n# feed_excluded_title.yaml\r\n- queer\r\n- two-planker\r\n- beaver-tail\r\n\r\n# feed_corrected_link.yaml\r\namazon.com:\r\n  - ref\r\n  - ie\r\n\r\n# feed_redirected_link.yaml\r\nski-status.example.com:\r\n  - Floki.find(fst, \".post__body a\")\r\n```\r\n\r\n## Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†\r\nElixirã§éåŒæœŸå‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€å¤§ããåˆ†ã‘ã¦ç›£è¦–æ©Ÿæ§‹ã®Supervisorã¨éåŒæœŸå‡¦ç†ã®Task.async_streamã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚\r\n\r\n### ç›£è¦–æ©Ÿæ§‹ Supervisor\r\nã¾ãšã€Supervisorã€‚Elixirã«ã¯ç›£è¦–æ©Ÿæ§‹SupervisorãŒã‚ã‚Šã€ãã‚ŒãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã¯åˆ¥ã€…ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å‡¦ç†ã—ã¾ã™ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæš–æ°—å‡¦ç†ã‚’åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚å†èµ·å‹•æˆ¦ç•¥ã¯ã€Œå¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã«ã‚ã‚‹ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã€ï¼ˆ `one_for_all` ï¼‰ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚å†èµ·å‹•æˆ¦ç•¥ã®è©³ç´°ã¯ã€Œ[OTPã‚¹ãƒ¼ãƒ‘ãƒã‚¤ã‚¶ Â· Elixir School](https://elixirschool.com/ja/lessons/advanced/otp-supervisors/)ã€ã‚’å‚ç…§ä¸‹ã•ã„ã€‚\r\n\r\nä¸‹è¨˜ã®ã‚ˆã†ã« `Supervisor.start_link` ã‚’ `Keshikimi2.Application.start` ã«é©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆ `mix run` ï¼‰ã—ãŸæ™‚ç‚¹ã§ç›£è¦–æ©Ÿæ§‹ãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚\r\n\r\n```ex\r\nSupervisor.start_link(\r\n  [\r\n    :hackney_pool.child_spec(:hatena_bookmark_pool, timeout: 15_000, max_connections: 100),\r\n    # @todo å½“è©²ãƒ¯ãƒ¼ã‚«ãƒ¼ã§æš–æ°—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„ã®ã§ `one_for_one` ã«ã—ãŸå ´åˆã€å†èµ·å‹•æ™‚ã«ã»ã‹ã«å½±éŸ¿ã™ã‚‹\r\n    supervisor(Cachex, [:feed, []]),\r\n    supervisor(Keshikimi2Feed.Registry, [prefix]),\r\n\r\n    # ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼å‡¦ç† (PubSub)\r\n    supervisor(Keshikimi2Feed.Subscriber, [prefix]),\r\n    worker(Keshikimi2Feed.Worker, [prefix]),\r\n    worker(Keshikimi2Feed.Publisher, [[prefix: prefix, poll_interval: 3_000]]),\r\n\r\n    # ãƒ–ã‚¯ãƒå‡¦ç†\r\n    worker(Keshikimi2.HatenaBookmark.AddEntry, [\r\n      [prefix: prefix, poll_interval: 3_000]\r\n    ])\r\n  ],\r\n  strategy: :one_for_all,\r\n  name: name(prefix)\r\n)\r\n```\r\n\r\n### éåŒæœŸå‡¦ç† Task.async_stream\r\næ¬¡ã«ã€Task.async_streamã€‚é…åˆ—ã‚’å¼•ãå›ã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯ `Task.async_stream` ãŒã†ã£ã¦ã¤ã‘ã§ã™ã€‚ä¸‹è¨˜ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–ã‚Šå‡ºã—ã€é™¤å¤–å‡¦ç†ã€æ ¡æ­£å‡¦ç†ã‚’åŠ ãˆã¦ã€ãƒ–ã‚¯ãƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã¨ã„ã†æµã‚Œã‚’çµ„ã‚“ã§ã„ã¾ã™ã€‚Elixirã§ã¯ã€æµã‚Œã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãéåŒæœŸå‡¦ç†ã—ã¦ãã“ã¨ãŒã§ãã¾ã™ã€‚\r\n\r\n```ex\r\nCachex.keys!(:feed)\r\n|> Enum.reject(fn key ->\r\n  key in [\r\n    \"excluded_links\",\r\n    \"excluded_titles\",\r\n    \"corrected_links\",\r\n    \"redirected_links\",\r\n    \"feed_group\",\r\n    \"archived_links\"\r\n  ]\r\nend)\r\n|> Task.async_stream(\r\n  fn item_link ->\r\n    with {:ok, [item_title, feed_tags]} <- Cachex.get(:feed, item_link),\r\n         :ok <- validate_all(item_link, item_title),\r\n         corrected_link <- correct_all(item_link),\r\n         {:ok, payload} <-\r\n           FormData.create(\r\n             %{\r\n               url: corrected_link,\r\n               comment: feed_tags |> Enum.map_join(fn tag -> \"[#{tag}]\" end),\r\n               rks: System.get_env(\"HATENA_BOOKMARK_RKS\"),\r\n               private: 0,\r\n               keep_original_url: 1,\r\n               with_status_op: 1,\r\n               from: \"inplace\",\r\n               post_twitter: 0,\r\n               post_evernote: 0\r\n             },\r\n             :url_encoded,\r\n             get: false\r\n           ) do\r\n      do_add_entries_to_hb(payload)\r\n      Logger.info(\"add entry: #{item_link}\")\r\n    end\r\n\r\n    archive_link(item_link)\r\n  end,\r\n  timeout: 15_000\r\n)\r\n|> Stream.run()\r\n```\r\n\r\n# WRAPUP\r\nElixirã®éåŒæœŸå‡¦ç†ã‚’ä½¿ã†ã“ã¨ã§ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®é‹ç”¨ãŒã¨ã¦ã‚‚å¿«é©ã«ãªã‚Šã¾ã—ãŸã€‚ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¨ã®ä»Šå¾Œã®ä»˜ãåˆã„æ–¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è€ƒãˆã¦ã„ã¾ã™ã€‚\r\n\r\n- **æ‰‹å‹•ã§ãƒ–ã‚¯ãƒ:** æ°—ã«ãªã£ãŸè¨˜äº‹ãŒã‚ã‚‹ã”ã¨ã«\r\n- **ãƒ–ã‚¯ãƒã®ç¢ºèª:** æ°—ã«ãªã‚‹ã‚¿ã‚°ã”ã¨ã«ã¾ã¨ã‚ã¦ç¢ºèª\r\n\r\nãƒ–ã‚¯ãƒã®ç¢ºèªã«ã¤ã„ã¦ã¯ã€ä¾‹ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œ[nabinno/github](http://b.hatena.ne.jp/nabinno/github)ã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã®é‹ç”¨ã§ã™ã€‚\r\n\r\nèé€šãŒåˆ©ã‹ãªã„ç‚¹ã§é€”ä¸­é‹ç”¨ãŒé›£ã—ããªã‚‹æ°—ã‚‚ã—ã¾ã™ãŒã€ã—ã°ã‚‰ãå›ã—ã¦ã¿ã¾ã™ã€‚\r\n","body_html":"<a href=\"https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img alt=\"thumbnail\" src=\"https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png\"></a>\n<p data-sourcepos=\"3:1-3:297\">ç´†ä½™æ›²æŠ˜åˆã£ã¦ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®é‹ç”¨ã‚’è¦‹ç›´ã™å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚äººã®èˆˆå‘³ã¨ã„ã†ã®ã¯å°½ããªã„ã‚‚ã®ã§çŸ¥ã‚ŠãŸã„ã“ã¨ãŒæ¬¡ã€…å‡ºã¦ãã¾ã™ã€‚ã«ã‚‚æ‹˜ã‚ã‚‰ãšäººã®æ™‚é–“ã¯æœ‰é™ã§ãã‚Œã«ã‚ãŒãªã†ãŸã‚ã®æ‰‹æ®µã‚’è€ƒãˆãŸã‚ã‘ã§ã™ã€‚</p>\n<h1 data-sourcepos=\"5:1-5:9\" id=\"1-0-0\" name=\"1-0-0\">\n<a class=\"anchor\" id=\"PROBLEM\" name=\"PROBLEM\" href=\"#PROBLEM\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"PROBLEM\"> &gt; PROBLEM</span></a>PROBLEM</h1>\n<ul data-sourcepos=\"6:1-11:0\">\n<li data-sourcepos=\"6:1-11:0\">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆãƒ–ã‚¯ãƒï¼‰ã™ã‚‹ã¨ãƒ•ã‚£ãƒ¼ãƒ‰æ¶ˆåŒ–ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹\n<ul data-sourcepos=\"7:5-11:0\">\n<li data-sourcepos=\"7:5-11:0\">ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹\n<ul data-sourcepos=\"8:9-11:0\">\n<li data-sourcepos=\"8:9-8:52\">ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„</li>\n<li data-sourcepos=\"9:9-9:61\">èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†</li>\n<li data-sourcepos=\"10:9-11:0\">é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 data-sourcepos=\"12:1-12:10\" id=\"2-0-0\" name=\"2-0-0\">\n<a class=\"anchor\" id=\"SOLUTION\" name=\"SOLUTION\" href=\"#SOLUTION\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SOLUTION\"> &gt; SOLUTION</span></a>SOLUTION</h1>\n<p data-sourcepos=\"13:1-13:242\">ã¨ã„ã†ã‚ã‘ã§ã€ä¸‹è¨˜ã®æ–¹é‡ã§ãƒ–ã‚¯ãƒã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯<a href=\"https://github.com/nabinno/keshikimi2\" target=\"_blank\" rel=\"noopener noreferrer\">GitHubãƒ¬ãƒã‚¸ãƒˆãƒª</a>ã‚’å‚ç…§ãã ã•ã„ã€‚ãã—ã¦ã€æ–¹é‡ã¯ä¸‹è¨˜ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚</p>\n<p data-sourcepos=\"15:1-15:10\"><strong>æ–¹é‡</strong></p>\n<ul data-sourcepos=\"17:1-22:0\">\n<li data-sourcepos=\"17:1-17:41\">ãƒ•ã‚£ãƒ¼ãƒ‰ã”ã¨ã«ã‚¿ã‚°ã¥ã‘ã™ã‚‹</li>\n<li data-sourcepos=\"18:1-18:80\">ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ã§é™¤å¤–åˆ¤å®šã™ã‚‹</li>\n<li data-sourcepos=\"19:1-19:122\">ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã‹ã‚‰æ ¡æ­£ã™ã¹ãã‚‚ã®ã‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã¹ãã‚‚ã®ã‹åˆ¤å®šã™ã‚‹</li>\n<li data-sourcepos=\"20:1-20:75\">ä¸Šè¨˜è¨­å®šã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹</li>\n<li data-sourcepos=\"21:1-22:0\">ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã‚’éåŒæœŸå‡¦ç†ã§ãã‚‹ã‚ˆã†Elixirã§å®Ÿè£…ã™ã‚‹</li>\n</ul>\n<h2 data-sourcepos=\"23:1-23:27\" id=\"2-1-0\" name=\"2-1-0\">\n<a class=\"anchor\" id=\"ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•\" name=\"%E3%83%96%E3%82%AF%E3%83%9E%E3%81%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95\" href=\"#%E3%83%96%E3%82%AF%E3%83%9E%E3%81%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•\"> &gt; ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•</span></a>ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•</h2>\n<p data-sourcepos=\"24:1-24:444\">ã¾ãšãƒ–ã‚¯ãƒã®ç®¡ç†ã§ã™ãŒã€ä¸‹è¨˜5ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§æ§‹æˆã—ã¦ã„ã¾ã™ã€æ§‹é€ ã¯ãƒãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã®ã¿ã€‚ãƒ–ã‚¯ãƒã—ãŸã„ã¨æ€ã†è¨˜äº‹ã‚’èª­ã¿ã™ã™ã‚ã‚‹ä¸­ã§æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ããŸã‚‰éƒ½åº¦ <code>feed.yaml</code> ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã¾ãŸã€è¨˜äº‹ã«ãƒã‚¤ã‚ºãŒå¤šã„ã‚ˆã†ã ã£ãŸã‚‰å‚¾å‘ã‚’åˆ†æã—ã¦é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ« <code>feed_excluded_link.yaml</code> <code>feed_excluded_title.yaml</code> ã‚’æ›´æ–°ã—ã¾ã™ã€‚</p>\n<table data-sourcepos=\"26:1-32:115\">\n<thead>\n<tr data-sourcepos=\"26:1-26:90\">\n<th data-sourcepos=\"26:2-26:30\">item</th>\n<th data-sourcepos=\"26:32-26:89\">description</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"28:1-28:113\">\n<td data-sourcepos=\"28:2-28:30\"><code>feed.yaml</code></td>\n<td data-sourcepos=\"28:32-28:112\">ãƒ•ã‚£ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã«å¯¾ã™ã‚‹ãƒªãƒ³ã‚¯ã€ã‚¿ã‚°ã®ãƒãƒƒãƒ—</td>\n</tr>\n<tr data-sourcepos=\"29:1-29:106\">\n<td data-sourcepos=\"29:2-29:30\"><code>feed_excluded_link.yaml</code></td>\n<td data-sourcepos=\"29:32-29:105\">é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆ</td>\n</tr>\n<tr data-sourcepos=\"30:1-30:107\">\n<td data-sourcepos=\"30:2-30:30\"><code>feed_excluded_title.yaml</code></td>\n<td data-sourcepos=\"30:32-30:106\">é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒªã‚¹ãƒˆ</td>\n</tr>\n<tr data-sourcepos=\"31:1-31:118\">\n<td data-sourcepos=\"31:2-31:30\"><code>feed_corrected_link.yaml</code></td>\n<td data-sourcepos=\"31:32-31:117\">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ—</td>\n</tr>\n<tr data-sourcepos=\"32:1-32:115\">\n<td data-sourcepos=\"32:2-32:30\"><code>feed_redirected_link.yaml</code></td>\n<td data-sourcepos=\"32:32-32:114\">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒªãƒ³ã‚¯ã®ãƒãƒƒãƒ—</td>\n</tr>\n</tbody>\n</table>\n<div class=\"code-block\" data-sourcepos=\"34:1-61:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>yaml</div>\n<div class=\"highlight\"><pre class=\"highlight yaml\"><code><span class=\"c1\"># feed.yaml</span>\n<span class=\"s\">nabinno/sports/feed_group_name</span><span class=\"pi\">:</span>\n  <span class=\"na\">tags</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">ski</span>\n  <span class=\"na\">links</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">http://rss.example.com/ski_feed.rss</span>\n    <span class=\"pi\">-</span> <span class=\"s\">http://rss.example.com/snowboard_feed.rss</span>\n    <span class=\"pi\">-</span> <span class=\"s\">http://ski-status.example.com/rss</span>\n\n<span class=\"c1\"># feed_excluded_link.yaml</span>\n<span class=\"pi\">-</span> <span class=\"s\">anti-ski.example.com</span>\n<span class=\"pi\">-</span> <span class=\"s\">awesome-snowboard.example.com</span>\n\n<span class=\"c1\"># feed_excluded_title.yaml</span>\n<span class=\"pi\">-</span> <span class=\"s\">queer</span>\n<span class=\"pi\">-</span> <span class=\"s\">two-planker</span>\n<span class=\"pi\">-</span> <span class=\"s\">beaver-tail</span>\n\n<span class=\"c1\"># feed_corrected_link.yaml</span>\n<span class=\"s\">amazon.com</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"s\">ref</span>\n  <span class=\"pi\">-</span> <span class=\"s\">ie</span>\n\n<span class=\"c1\"># feed_redirected_link.yaml</span>\n<span class=\"s\">ski-status.example.com</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"s\">Floki.find(fst, \".post__body a\")</span>\n</code></pre></div>\n</div>\n<h2 data-sourcepos=\"63:1-63:33\" id=\"2-2-0\" name=\"2-2-0\">\n<a class=\"anchor\" id=\"Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†\" name=\"Elixir%E3%81%AB%E3%82%88%E3%82%8B%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86\" href=\"#Elixir%E3%81%AB%E3%82%88%E3%82%8B%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†\"> &gt; Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†</span></a>Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†</h2>\n<p data-sourcepos=\"64:1-64:162\">Elixirã§éåŒæœŸå‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€å¤§ããåˆ†ã‘ã¦ç›£è¦–æ©Ÿæ§‹ã®Supervisorã¨éåŒæœŸå‡¦ç†ã®Task.async_streamã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚</p>\n<h3 data-sourcepos=\"66:1-66:27\" id=\"2-2-1\" name=\"2-2-1\">\n<a class=\"anchor\" id=\"ç›£è¦–æ©Ÿæ§‹ Supervisor\" name=\"%E7%9B%A3%E8%A6%96%E6%A9%9F%E6%A7%8B%20Supervisor\" href=\"#%E7%9B%A3%E8%A6%96%E6%A9%9F%E6%A7%8B%20Supervisor\" data-position=\"2-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ç›£è¦–æ©Ÿæ§‹ Supervisor\"> &gt; ç›£è¦–æ©Ÿæ§‹ Supervisor</span></a>ç›£è¦–æ©Ÿæ§‹ Supervisor</h3>\n<p data-sourcepos=\"67:1-67:609\">ã¾ãšã€Supervisorã€‚Elixirã«ã¯ç›£è¦–æ©Ÿæ§‹SupervisorãŒã‚ã‚Šã€ãã‚ŒãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã¯åˆ¥ã€…ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å‡¦ç†ã—ã¾ã™ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæš–æ°—å‡¦ç†ã‚’åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚å†èµ·å‹•æˆ¦ç•¥ã¯ã€Œå¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã«ã‚ã‚‹ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã€ï¼ˆ <code>one_for_all</code> ï¼‰ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚å†èµ·å‹•æˆ¦ç•¥ã®è©³ç´°ã¯ã€Œ<a href=\"https://elixirschool.com/ja/lessons/advanced/otp-supervisors/\" target=\"_blank\" rel=\"noopener noreferrer\">OTPã‚¹ãƒ¼ãƒ‘ãƒã‚¤ã‚¶ Â· Elixir School</a>ã€ã‚’å‚ç…§ä¸‹ã•ã„ã€‚</p>\n<p data-sourcepos=\"69:1-69:197\">ä¸‹è¨˜ã®ã‚ˆã†ã« <code>Supervisor.start_link</code> ã‚’ <code>Keshikimi2.Application.start</code> ã«é©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆ <code>mix run</code> ï¼‰ã—ãŸæ™‚ç‚¹ã§ç›£è¦–æ©Ÿæ§‹ãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚</p>\n<div class=\"code-block\" data-sourcepos=\"71:1-92:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>ex</div>\n<div class=\"highlight\"><pre class=\"highlight elixir\"><code><span class=\"no\">Supervisor</span><span class=\"o\">.</span><span class=\"n\">start_link</span><span class=\"p\">(</span>\n  <span class=\"p\">[</span>\n    <span class=\"ss\">:hackney_pool</span><span class=\"o\">.</span><span class=\"n\">child_spec</span><span class=\"p\">(</span><span class=\"ss\">:hatena_bookmark_pool</span><span class=\"p\">,</span> <span class=\"ss\">timeout:</span> <span class=\"mi\">15_000</span><span class=\"p\">,</span> <span class=\"ss\">max_connections:</span> <span class=\"mi\">100</span><span class=\"p\">),</span>\n    <span class=\"c1\"># @todo å½“è©²ãƒ¯ãƒ¼ã‚«ãƒ¼ã§æš–æ°—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„ã®ã§ `one_for_one` ã«ã—ãŸå ´åˆã€å†èµ·å‹•æ™‚ã«ã»ã‹ã«å½±éŸ¿ã™ã‚‹</span>\n    <span class=\"n\">supervisor</span><span class=\"p\">(</span><span class=\"no\">Cachex</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"ss\">:feed</span><span class=\"p\">,</span> <span class=\"p\">[]]),</span>\n    <span class=\"n\">supervisor</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Registry</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]),</span>\n\n    <span class=\"c1\"># ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼å‡¦ç† (PubSub)</span>\n    <span class=\"n\">supervisor</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Subscriber</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]),</span>\n    <span class=\"n\">worker</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Worker</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]),</span>\n    <span class=\"n\">worker</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Publisher</span><span class=\"p\">,</span> <span class=\"p\">[[</span><span class=\"ss\">prefix:</span> <span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"ss\">poll_interval:</span> <span class=\"mi\">3_000</span><span class=\"p\">]]),</span>\n\n    <span class=\"c1\"># ãƒ–ã‚¯ãƒå‡¦ç†</span>\n    <span class=\"n\">worker</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2</span><span class=\"o\">.</span><span class=\"no\">HatenaBookmark</span><span class=\"o\">.</span><span class=\"no\">AddEntry</span><span class=\"p\">,</span> <span class=\"p\">[</span>\n      <span class=\"p\">[</span><span class=\"ss\">prefix:</span> <span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"ss\">poll_interval:</span> <span class=\"mi\">3_000</span><span class=\"p\">]</span>\n    <span class=\"p\">])</span>\n  <span class=\"p\">],</span>\n  <span class=\"ss\">strategy:</span> <span class=\"ss\">:one_for_all</span><span class=\"p\">,</span>\n  <span class=\"ss\">name:</span> <span class=\"n\">name</span><span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">)</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n</div>\n<h3 data-sourcepos=\"94:1-94:37\" id=\"2-2-2\" name=\"2-2-2\">\n<a class=\"anchor\" id=\"éåŒæœŸå‡¦ç† Task.async_stream\" name=\"%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%20Task.async_stream\" href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%20Task.async_stream\" data-position=\"2-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"éåŒæœŸå‡¦ç† Task.async_stream\"> &gt; éåŒæœŸå‡¦ç† Task.async_stream</span></a>éåŒæœŸå‡¦ç† Task.async_stream</h3>\n<p data-sourcepos=\"95:1-95:461\">æ¬¡ã«ã€Task.async_streamã€‚é…åˆ—ã‚’å¼•ãå›ã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯ <code>Task.async_stream</code> ãŒã†ã£ã¦ã¤ã‘ã§ã™ã€‚ä¸‹è¨˜ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–ã‚Šå‡ºã—ã€é™¤å¤–å‡¦ç†ã€æ ¡æ­£å‡¦ç†ã‚’åŠ ãˆã¦ã€ãƒ–ã‚¯ãƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã¨ã„ã†æµã‚Œã‚’çµ„ã‚“ã§ã„ã¾ã™ã€‚Elixirã§ã¯ã€æµã‚Œã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãéåŒæœŸå‡¦ç†ã—ã¦ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>\n<div class=\"code-block\" data-sourcepos=\"97:1-139:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>ex</div>\n<div class=\"highlight\"><pre class=\"highlight elixir\"><code><span class=\"no\">Cachex</span><span class=\"o\">.</span><span class=\"n\">keys!</span><span class=\"p\">(</span><span class=\"ss\">:feed</span><span class=\"p\">)</span>\n<span class=\"o\">|&gt;</span> <span class=\"no\">Enum</span><span class=\"o\">.</span><span class=\"n\">reject</span><span class=\"p\">(</span><span class=\"k\">fn</span> <span class=\"n\">key</span> <span class=\"o\">-&gt;</span>\n  <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"p\">[</span>\n    <span class=\"s2\">\"excluded_links\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"excluded_titles\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"corrected_links\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"redirected_links\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"feed_group\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"archived_links\"</span>\n  <span class=\"p\">]</span>\n<span class=\"k\">end</span><span class=\"p\">)</span>\n<span class=\"o\">|&gt;</span> <span class=\"no\">Task</span><span class=\"o\">.</span><span class=\"n\">async_stream</span><span class=\"p\">(</span>\n  <span class=\"k\">fn</span> <span class=\"n\">item_link</span> <span class=\"o\">-&gt;</span>\n    <span class=\"n\">with</span> <span class=\"p\">{</span><span class=\"ss\">:ok</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">item_title</span><span class=\"p\">,</span> <span class=\"n\">feed_tags</span><span class=\"p\">]}</span> <span class=\"o\">&lt;-</span> <span class=\"no\">Cachex</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"ss\">:feed</span><span class=\"p\">,</span> <span class=\"n\">item_link</span><span class=\"p\">),</span>\n         <span class=\"ss\">:ok</span> <span class=\"o\">&lt;-</span> <span class=\"n\">validate_all</span><span class=\"p\">(</span><span class=\"n\">item_link</span><span class=\"p\">,</span> <span class=\"n\">item_title</span><span class=\"p\">),</span>\n         <span class=\"n\">corrected_link</span> <span class=\"o\">&lt;-</span> <span class=\"n\">correct_all</span><span class=\"p\">(</span><span class=\"n\">item_link</span><span class=\"p\">),</span>\n         <span class=\"p\">{</span><span class=\"ss\">:ok</span><span class=\"p\">,</span> <span class=\"n\">payload</span><span class=\"p\">}</span> <span class=\"o\">&lt;-</span>\n           <span class=\"no\">FormData</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n             <span class=\"p\">%{</span>\n               <span class=\"ss\">url:</span> <span class=\"n\">corrected_link</span><span class=\"p\">,</span>\n               <span class=\"ss\">comment:</span> <span class=\"n\">feed_tags</span> <span class=\"o\">|&gt;</span> <span class=\"no\">Enum</span><span class=\"o\">.</span><span class=\"n\">map_join</span><span class=\"p\">(</span><span class=\"k\">fn</span> <span class=\"n\">tag</span> <span class=\"o\">-&gt;</span> <span class=\"s2\">\"[</span><span class=\"si\">#{</span><span class=\"n\">tag</span><span class=\"si\">}</span><span class=\"s2\">]\"</span> <span class=\"k\">end</span><span class=\"p\">),</span>\n               <span class=\"ss\">rks:</span> <span class=\"no\">System</span><span class=\"o\">.</span><span class=\"n\">get_env</span><span class=\"p\">(</span><span class=\"s2\">\"HATENA_BOOKMARK_RKS\"</span><span class=\"p\">),</span>\n               <span class=\"ss\">private:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n               <span class=\"ss\">keep_original_url:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n               <span class=\"ss\">with_status_op:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n               <span class=\"ss\">from:</span> <span class=\"s2\">\"inplace\"</span><span class=\"p\">,</span>\n               <span class=\"ss\">post_twitter:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n               <span class=\"ss\">post_evernote:</span> <span class=\"mi\">0</span>\n             <span class=\"p\">},</span>\n             <span class=\"ss\">:url_encoded</span><span class=\"p\">,</span>\n             <span class=\"ss\">get:</span> <span class=\"no\">false</span>\n           <span class=\"p\">)</span> <span class=\"k\">do</span>\n      <span class=\"n\">do_add_entries_to_hb</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"p\">)</span>\n      <span class=\"no\">Logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">\"add entry: </span><span class=\"si\">#{</span><span class=\"n\">item_link</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n\n    <span class=\"n\">archive_link</span><span class=\"p\">(</span><span class=\"n\">item_link</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span><span class=\"p\">,</span>\n  <span class=\"ss\">timeout:</span> <span class=\"mi\">15_000</span>\n<span class=\"p\">)</span>\n<span class=\"o\">|&gt;</span> <span class=\"no\">Stream</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span>\n</code></pre></div>\n</div>\n<h1 data-sourcepos=\"141:1-141:8\" id=\"3-0-0\" name=\"3-0-0\">\n<a class=\"anchor\" id=\"WRAPUP\" name=\"WRAPUP\" href=\"#WRAPUP\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"WRAPUP\"> &gt; WRAPUP</span></a>WRAPUP</h1>\n<p data-sourcepos=\"142:1-142:216\">Elixirã®éåŒæœŸå‡¦ç†ã‚’ä½¿ã†ã“ã¨ã§ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®é‹ç”¨ãŒã¨ã¦ã‚‚å¿«é©ã«ãªã‚Šã¾ã—ãŸã€‚ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¨ã®ä»Šå¾Œã®ä»˜ãåˆã„æ–¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è€ƒãˆã¦ã„ã¾ã™ã€‚</p>\n<ul data-sourcepos=\"144:1-146:0\">\n<li data-sourcepos=\"144:1-144:65\">\n<strong>æ‰‹å‹•ã§ãƒ–ã‚¯ãƒ:</strong> æ°—ã«ãªã£ãŸè¨˜äº‹ãŒã‚ã‚‹ã”ã¨ã«</li>\n<li data-sourcepos=\"145:1-146:0\">\n<strong>ãƒ–ã‚¯ãƒã®ç¢ºèª:</strong> æ°—ã«ãªã‚‹ã‚¿ã‚°ã”ã¨ã«ã¾ã¨ã‚ã¦ç¢ºèª</li>\n</ul>\n<p data-sourcepos=\"147:1-147:239\">ãƒ–ã‚¯ãƒã®ç¢ºèªã«ã¤ã„ã¦ã¯ã€ä¾‹ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œ<a href=\"http://b.hatena.ne.jp/nabinno/github\" target=\"_blank\" rel=\"noopener noreferrer\">nabinno/github</a>ã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã®é‹ç”¨ã§ã™ã€‚</p>\n<p data-sourcepos=\"149:1-149:111\">èé€šãŒåˆ©ã‹ãªã„ç‚¹ã§é€”ä¸­é‹ç”¨ãŒé›£ã—ããªã‚‹æ°—ã‚‚ã—ã¾ã™ãŒã€ã—ã°ã‚‰ãå›ã—ã¦ã¿ã¾ã™ã€‚</p>\n","tags":["elixir","hatena-bookmark"],"updated_at":"2021-01-16T01:12:01+09:00","childPublishedDate":{"published_on":"2019-01-01T00:00:00.000Z"},"updated_by":{"name":"ãªã³ã®ğŸ‘·","screen_name":"nabinno","icon":"https://img.esa.io/uploads/production/members/94286/icon/thumb_m_7b757a0db07cde6a337af7df901ab0c5.jpg"}},"relatedPosts":{"edges":[{"node":{"number":93,"relative_category":"blog/backend","fields":{"title":"AWS CloudTrailç”¨ã®ã‚³ã‚¹ãƒ‘ã®è‰¯ã„SIEMã‚’æ¢ã™","excerpt":"ITçµ±åˆ¶ã«ãŠã„ã¦è¨¼è·¡ç®¡ç†ã®å……å®Ÿã¨ã„ã†è¦³ç‚¹ã‹ã‚‰ã€ã¾ãŸã€ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã®å¼·åŒ–ã¨ã„ã†è¦³ç‚¹ã‹ã‚‰SIEMã®å°å…¥ãŒå¿…è¦ã«ãªã£ã¦ãã¾ã—ãŸã€‚ä»Šå›ã¯AWS CloudTrailç”¨ã®SIEMã«ã¤ã„ã¦ã–ã£ã¨èª¿ã¹ã¾ã—ãŸã€‚   > PROBLEMPROBLEM \n\n- AWS CloudTrailã®ãƒ­ã‚°ã‚’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é›†ç´„ã—ã¦ã„ã‚‹ãŒã€æ·±ãç›£è¦–ã—ãã‚Œã¦ã„ãªã„ å¯èƒ½ãªã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¸å¯©ãªæ“ä½œã‚’ã—ãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é£›ã°ã—ãŸã„ å¯èƒ½ãªã‚‰CloudTrailä»¥å¤–ã®IaaSãƒªã‚½ãƒ¼ã‚¹ã‚’ç›£è¦–å¯¾è±¡ã«ã—ãŸã„ NewRelicã®ã‚ˆã†ã«äººã®ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ãšã«ç®¡ç†ã—ãŸã„ \n- å¯èƒ½ãªã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¸å¯©ãªæ“ä½œã‚’ã—ãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é£›ã°ã—ãŸã„\n- å¯èƒ½ãªã‚‰CloudTrailä»¥å¤–ã®IaaSãƒªã‚½ãƒ¼ã‚¹ã‚’ç›£è¦–å¯¾è±¡ã«ã—ãŸã„ NewRelicã®ã‚ˆã†ã«äººã®ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ãšã«ç®¡ç†ã—ãŸã„ \n- NewRelicã®ã‚ˆã†ã«äººã®ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ãšã«ç®¡ç†ã—ãŸã„  > SOLUTIONSOLUTION \n\nã¨è¨€ã†ã‚ã‘ã§ã€ã‚³ã‚¹ãƒ‘ãŒè‰¯ã„ã¨å™‚ã®Sumo Logicã¨Azure Sentinelã‚’æ¯”è¼ƒè©•ä¾¡ã—ã¾ã™ã€‚  > Azure SentinelAzure Sentinel  > æ–™é‡‘æ–™é‡‘ \n\n- Azure Sentinel ã®ä¾¡æ ¼ | Microsoft Azure\n- ä¾¡æ ¼ - Azure Monitor | Microsoft Azure  > SIEMã‹ã‚‰CloudTrailã¸ã®æ¥ç¶šæ–¹æ³•SIEMã‹ã‚‰CloudTrailã¸ã®æ¥ç¶šæ–¹æ³• \n\n1. ä¸‹è¨˜è¨­å®šã§Log Analyticsãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ç„¡æ–™è©¦ç”¨ç‰ˆ ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ— production åå‰ prod-sentinel åœ°åŸŸ æ±æ—¥æœ¬ \n2. ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ç„¡æ–™è©¦ç”¨ç‰ˆ\n3. ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ— production\n4. åå‰ prod-sentinel\n5. åœ°åŸŸ æ±æ—¥æœ¬\n6. [ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹prod-sentinel - ãƒ‡ãƒ¼ã‚¿ã‚³ãƒã‚¯ã‚¿] ã«ã¦ [ã‚¢ãƒã‚¾ãƒ³ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹] ã‚³ãƒã‚¯ã‚¿ãƒšãƒ¼ã‚¸ã‚’é–‹ã\n7. [AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ - IAM - ãƒ­ãƒ¼ãƒ«] ã«ã¦ä¸‹è¨˜è¨­å®šã§ [åˆ¥ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ] ã‚’ä½œæˆ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID {Microsoft account ID} ã‚ªãƒ—ã‚·ãƒ§ãƒ³ å¤–éƒ¨IDãŒå¿…è¦ ã‚’ãƒã‚§ãƒƒã‚¯ å¤–éƒ¨ID {å¤–éƒ¨ID (ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ID)} ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ AWSCloudTrailReadOnlyAccess ãƒ­ãƒ¼ãƒ«å AzureSentinel â€» Cf. AWS CloudTrail ã‚’ Azure Sentinel ã«æ¥ç¶šã™ã‚‹ | Microsoft Docs ã‚¢ãƒã‚¾ãƒ³ ã‚¦ã‚§ãƒ– ã‚µãƒ¼ãƒ“ã‚¹ (AWS) ã®ãŸã‚ã® MCAS ã¨ Azure Sentinel - Azure Solution Ideas | Microsoft Docs Security-JAWS ç¬¬21å›ãƒ¬ãƒãƒ¼ãƒˆ #secjaws #secjaws21 #jawsug | DevelopersIO \n8. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID {Microsoft account ID}\n9. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ å¤–éƒ¨IDãŒå¿…è¦ ã‚’ãƒã‚§ãƒƒã‚¯ å¤–éƒ¨ID {å¤–éƒ¨ID (ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ID)} \n10. å¤–éƒ¨IDãŒå¿…è¦ ã‚’ãƒã‚§ãƒƒã‚¯\n11. å¤–éƒ¨ID {å¤–éƒ¨ID (ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ID)}\n12. ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ AWSCloudTrailReadOnlyAccess\n13. ãƒ­ãƒ¼ãƒ«å AzureSentinel\n14. â€» Cf. AWS CloudTrail ã‚’ Azure Sentinel ã«æ¥ç¶šã™ã‚‹ | Microsoft Docs ã‚¢ãƒã‚¾ãƒ³ ã‚¦ã‚§ãƒ– ã‚µãƒ¼ãƒ“ã‚¹ (AWS) ã®ãŸã‚ã® MCAS ã¨ Azure Sentinel - Azure Solution Ideas | Microsoft Docs Security-JAWS ç¬¬21å›ãƒ¬ãƒãƒ¼ãƒˆ #secjaws #secjaws21 #jawsug | DevelopersIO \n15. AWS CloudTrail ã‚’ Azure Sentinel ã«æ¥ç¶šã™ã‚‹ | Microsoft Docs\n16. ã‚¢ãƒã‚¾ãƒ³ ã‚¦ã‚§ãƒ– ã‚µãƒ¼ãƒ“ã‚¹ (AWS) ã®ãŸã‚ã® MCAS ã¨ Azure Sentinel - Azure Solution Ideas | Microsoft Docs\n17. Security-JAWS ç¬¬21å›ãƒ¬ãƒãƒ¼ãƒˆ #secjaws #secjaws21 #jawsug | DevelopersIO  > SIEMæ©Ÿèƒ½ (AWS CloudTrail)SIEMæ©Ÿèƒ½ (AWS CloudTrail) \n\n- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›£è¦–å¯¾è±¡ æ™‚é–“çµŒéã«ä¼´ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆ æ‚ªæ„ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ æœ€è¿‘ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ç•°å¸¸ \n- æ™‚é–“çµŒéã«ä¼´ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆ\n- æ‚ªæ„ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ\n- æœ€è¿‘ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ\n- ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ç•°å¸¸\n- ãƒ­ã‚°ã‚¯ã‚¨ãƒª Audit Network Security \n- Audit\n- Network\n- Security\n- è„…å¨ç®¡ç† ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ ãƒ–ãƒƒã‚¯ ... ç°¡æ˜“ãªåˆ†ææƒ…å ±ã‚’æä¾› AWSãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ... SGã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ACLã€IGWã€ELBã€VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€NIã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãªã©ã€AWS ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ã®ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã«é–¢ã™ã‚‹åˆ†ææƒ…å ±ã‚’å¾—ã¾ã™ã€‚ AWSãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ... å¤±æ•—ã—ãŸã‚µã‚¤ãƒ³ã‚¤ãƒ³è©¦è¡Œã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ID ã®ç¨®é¡ã€ã¾ãŸæƒ³å®šã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’æŒã¤æ‚ªæ„ã®ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãªã©ã€AWS ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã«é–¢ã™ã‚‹åˆ†ææƒ…å ±ã‚’å¾—ã¾ã™ã€‚ ãƒãƒ³ãƒ†ã‚£ãƒ³ã‚° ... è„…å¨åˆ¤å®šã¨ãªã‚‹ãƒ­ã‚°ã‚¯ã‚¨ãƒªã‚’æä¾› Changes made to AWS IAM policy Tracking Privileged Account Rare Activity Exploit and Pentest Framework User Agent IAM Privilege Escalation by Instance Profile attachment Privileged role attached to Instance Suspicious credential token access of valid IAM Roles Unused or Unsupported Cloud Regions ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ ... Jupyter Notebookã«ã‚ˆã‚‹åˆ†æã‚’æä¾› \n- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ\n- ãƒ–ãƒƒã‚¯ ... ç°¡æ˜“ãªåˆ†ææƒ…å ±ã‚’æä¾› AWSãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ... SGã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ACLã€IGWã€ELBã€VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€NIã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãªã©ã€AWS ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ã®ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã«é–¢ã™ã‚‹åˆ†ææƒ…å ±ã‚’å¾—ã¾ã™ã€‚ AWSãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ... å¤±æ•—ã—ãŸã‚µã‚¤ãƒ³ã‚¤ãƒ³è©¦è¡Œã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ID ã®ç¨®é¡ã€ã¾ãŸæƒ³å®šã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’æŒã¤æ‚ªæ„ã®ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãªã©ã€AWS ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã«é–¢ã™ã‚‹åˆ†ææƒ…å ±ã‚’å¾—ã¾ã™ã€‚ \n- AWSãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ... SGã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ACLã€IGWã€ELBã€VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€NIã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãªã©ã€AWS ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ã®ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã«é–¢ã™ã‚‹åˆ†ææƒ…å ±ã‚’å¾—ã¾ã™ã€‚\n- AWSãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ... å¤±æ•—ã—ãŸã‚µã‚¤ãƒ³ã‚¤ãƒ³è©¦è¡Œã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ID ã®ç¨®é¡ã€ã¾ãŸæƒ³å®šã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’æŒã¤æ‚ªæ„ã®ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãªã©ã€AWS ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã«é–¢ã™ã‚‹åˆ†ææƒ…å ±ã‚’å¾—ã¾ã™ã€‚\n- ãƒãƒ³ãƒ†ã‚£ãƒ³ã‚° ... è„…å¨åˆ¤å®šã¨ãªã‚‹ãƒ­ã‚°ã‚¯ã‚¨ãƒªã‚’æä¾› Changes made to AWS IAM policy Tracking Privileged Account Rare Activity Exploit and Pentest Framework User Agent IAM Privilege Escalation by Instance Profile attachment Privileged role attached to Instance Suspicious credential token access of valid IAM Roles Unused or Unsupported Cloud Regions \n- Changes made to AWS IAM policy\n- Tracking Privileged Account Rare Activity\n- Exploit and Pentest Framework User Agent\n- IAM Privilege Escalation by Instance Profile attachment\n- Privileged role attached to Instance\n- Suspicious credential token access of valid IAM Roles\n- Unused or Unsupported Cloud Regions\n- ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ ... Jupyter Notebookã«ã‚ˆã‚‹åˆ†æã‚’æä¾›\n- ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ ... å¤–éƒ¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¨é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ Trend Micro Apex One McAfee Network Security Platform \n- Trend Micro Apex One\n- McAfee Network Security Platform  > Sumo LogicSumo Logic  > æ–™é‡‘æ–™é‡‘ \n\n- Sumo Logic æ–™é‡‘è¡¨  > SIEMã‹ã‚‰CloudTrailã¸ã®æ¥ç¶šæ–¹æ³•SIEMã‹ã‚‰CloudTrailã¸ã®æ¥ç¶šæ–¹æ³• \n\n1. [AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆSecurity - S3] ã«ã¦ãƒã‚±ãƒƒãƒˆ cloudtrail-accumulativelogs-{account-id} ã‚’ä¸‹è¨˜è¨­å®šã«ã¦ä½œæˆ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã¹ã¦ãƒ–ãƒ­ãƒƒã‚¯ ã‚ªãƒ• ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ json{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"AWSCloudTrailAclCheck20150319\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"s3:GetBucketAcl\", \"Resource\": \"arn:aws:s3:::cloudtrail-accumulativelogs-{account-id}\" }, { \"Sid\": \"AWSCloudTrailWrite20150319\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"s3:PutObject\", \"Resource\": \"arn:aws:s3:::cloudtrail-accumulativelogs-{account-id}/AWSLogs/{organization-id}/*\", \"Condition\": { \"StringEquals\": { \"s3:x-amz-acl\": \"bucket-owner-full-control\" } } } ] } \n2. ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã¹ã¦ãƒ–ãƒ­ãƒƒã‚¯ ã‚ªãƒ•\n3. ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ json{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"AWSCloudTrailAclCheck20150319\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"s3:GetBucketAcl\", \"Resource\": \"arn:aws:s3:::cloudtrail-accumulativelogs-{account-id}\" }, { \"Sid\": \"AWSCloudTrailWrite20150319\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"s3:PutObject\", \"Resource\": \"arn:aws:s3:::cloudtrail-accumulativelogs-{account-id}/AWSLogs/{organization-id}/*\", \"Condition\": { \"StringEquals\": { \"s3:x-amz-acl\": \"bucket-owner-full-control\" } } } ] } \n4. [è¦ªAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ - KMS] ã«ã¦ä¸‹è¨˜è¨­å®šã§KSMã‚’ä½œæˆ ã‚­ãƒ¼ã®ã‚¿ã‚¤ãƒ— å¯¾ç§° ã‚­ãƒ¼ãƒãƒ†ãƒªã‚¢ãƒ«ã‚ªãƒªã‚¸ãƒ³ KMS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ å˜ä¸€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ ã‚¨ã‚¤ãƒªã‚¢ã‚¹å cloudtrail-kms ã‚­ãƒ¼ãƒãƒªã‚·ãƒ¼ json{ \"Version\": \"2012-10-17\", \"Id\": \"Key policy created by CloudTrail\", \"Statement\": [ { \"Sid\": \"Enable IAM User Permissions\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": \"kms:*\", \"Resource\": \"*\" }, { \"Sid\": \"Allow CloudTrail to encrypt logs\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"kms:GenerateDataKey*\", \"Resource\": \"*\", \"Condition\": { \"StringLike\": { \"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:{account-id}:trail/*\" } } }, { \"Sid\": \"Allow CloudTrail to describe key\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"kms:DescribeKey\", \"Resource\": \"*\" }, { \"Sid\": \"Allow principals in the account to decrypt log files\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": [ \"kms:Decrypt\", \"kms:ReEncryptFrom\" ], \"Resource\": \"*\", \"Condition\": { \"StringEquals\": { \"kms:CallerAccount\": \"{account-id}\" }, \"StringLike\": { \"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:{account-id}:trail/*\" } } }, { \"Sid\": \"Allow alias creation during setup\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": \"kms:CreateAlias\", \"Resource\": \"*\", \"Condition\": { \"StringEquals\": { \"kms:CallerAccount\": \"{account-id}\", \"kms:ViaService\": \"ec2.ap-northeast-1.amazonaws.com\" } } }, { \"Sid\": \"Enable cross account log decryption\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": [ \"kms:Decrypt\", \"kms:ReEncryptFrom\" ], \"Resource\": \"*\", \"Condition\": { \"StringEquals\": { \"kms:CallerAccount\": \"{account-id}\" }, \"StringLike\": { \"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:{account-id}:trail/*\" } } } ] } \n5. ã‚­ãƒ¼ã®ã‚¿ã‚¤ãƒ— å¯¾ç§°\n6. ã‚­ãƒ¼ãƒãƒ†ãƒªã‚¢ãƒ«ã‚ªãƒªã‚¸ãƒ³ KMS\n7. ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ å˜ä¸€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³\n8. ã‚¨ã‚¤ãƒªã‚¢ã‚¹å cloudtrail-kms\n9. ã‚­ãƒ¼ãƒãƒªã‚·ãƒ¼ json{ \"Version\": \"2012-10-17\", \"Id\": \"Key policy created by CloudTrail\", \"Statement\": [ { \"Sid\": \"Enable IAM User Permissions\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": \"kms:*\", \"Resource\": \"*\" }, { \"Sid\": \"Allow CloudTrail to encrypt logs\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"kms:GenerateDataKey*\", \"Resource\": \"*\", \"Condition\": { \"StringLike\": { \"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:{account-id}:trail/*\" } } }, { \"Sid\": \"Allow CloudTrail to describe key\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"cloudtrail.amazonaws.com\" }, \"Action\": \"kms:DescribeKey\", \"Resource\": \"*\" }, { \"Sid\": \"Allow principals in the account to decrypt log files\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": [ \"kms:Decrypt\", \"kms:ReEncryptFrom\" ], \"Resource\": \"*\", \"Condition\": { \"StringEquals\": { \"kms:CallerAccount\": \"{account-id}\" }, \"StringLike\": { \"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:{account-id}:trail/*\" } } }, { \"Sid\": \"Allow alias creation during setup\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": \"kms:CreateAlias\", \"Resource\": \"*\", \"Condition\": { \"StringEquals\": { \"kms:CallerAccount\": \"{account-id}\", \"kms:ViaService\": \"ec2.ap-northeast-1.amazonaws.com\" } } }, { \"Sid\": \"Enable cross account log decryption\", \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"*\" }, \"Action\": [ \"kms:Decrypt\", \"kms:ReEncryptFrom\" ], \"Resource\": \"*\", \"Condition\": { \"StringEquals\": { \"kms:CallerAccount\": \"{account-id}\" }, \"StringLike\": { \"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:{account-id}:trail/*\" } } } ] } \n10. [è¦ªAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ - CloudTrail] ã«ã¦ä¸‹è¨˜è¨­å®šã§è¨¼è·¡ã‚’ä½œæˆ å…¨èˆ¬çš„ãªè©³ç´° è¨¼è·¡å cloudtrail-logs çµ„ç¹”ã«è¨¼è·¡ã‚’é©ç”¨ ã¯ã„ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å ´æ‰€ æ—¢å­˜ã®S3ãƒã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ è¨¼è·¡ãƒ­ã‚°ãƒã‚±ãƒƒãƒˆå cloudtrail-accumulativelogs-{account-id} ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®SSE-KMSæš—å·åŒ– æœ‰åŠ¹ ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ã®AWS KMSã‚­ãƒ¼ æ–°è¦ AWS KMSã‚¨ã‚¤ãƒªã‚¢ã‚¹ arn:aws:kms:{region}:{account-id}:key/{kms-id} ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ æœ‰åŠ¹ ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆ APIã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ã™ã¹ã¦ \n11. å…¨èˆ¬çš„ãªè©³ç´° è¨¼è·¡å cloudtrail-logs çµ„ç¹”ã«è¨¼è·¡ã‚’é©ç”¨ ã¯ã„ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å ´æ‰€ æ—¢å­˜ã®S3ãƒã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ è¨¼è·¡ãƒ­ã‚°ãƒã‚±ãƒƒãƒˆå cloudtrail-accumulativelogs-{account-id} ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®SSE-KMSæš—å·åŒ– æœ‰åŠ¹ ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ã®AWS KMSã‚­ãƒ¼ æ–°è¦ AWS KMSã‚¨ã‚¤ãƒªã‚¢ã‚¹ arn:aws:kms:{region}:{account-id}:key/{kms-id} ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ æœ‰åŠ¹ \n12. è¨¼è·¡å cloudtrail-logs\n13. çµ„ç¹”ã«è¨¼è·¡ã‚’é©ç”¨ ã¯ã„\n14. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å ´æ‰€ æ—¢å­˜ã®S3ãƒã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹\n15. è¨¼è·¡ãƒ­ã‚°ãƒã‚±ãƒƒãƒˆå cloudtrail-accumulativelogs-{account-id}\n16. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®SSE-KMSæš—å·åŒ– æœ‰åŠ¹\n17. ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ã®AWS KMSã‚­ãƒ¼ æ–°è¦\n18. AWS KMSã‚¨ã‚¤ãƒªã‚¢ã‚¹ arn:aws:kms:{region}:{account-id}:key/{kms-id}\n19. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ æœ‰åŠ¹\n20. ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆ APIã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ã™ã¹ã¦ \n21. APIã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ã™ã¹ã¦\n22. [Sumo Logic - Setup Wizard - Start streaming data to Sumo Logic - CloudTrail] ã«ã¦ä¸‹è¨˜è¨­å®šã§CloudTrailãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã‚’ä½œæˆ Source Category aws/cloudtrail S3 Bucket S3 Bucket Name cloudtrail-accumulativelogs-{account-id} Path Expression AWSLogs/{organization-id}/* S3 Region Asia Pacific (Tokyo) How do you want the user to access the S3 Bucket? Role-based access æŒ‡å®šã•ã‚ŒãŸCFnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ \n23. Source Category aws/cloudtrail\n24. S3 Bucket S3 Bucket Name cloudtrail-accumulativelogs-{account-id} Path Expression AWSLogs/{organization-id}/* S3 Region Asia Pacific (Tokyo) How do you want the user to access the S3 Bucket? Role-based access æŒ‡å®šã•ã‚ŒãŸCFnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ \n25. S3 Bucket Name cloudtrail-accumulativelogs-{account-id}\n26. Path Expression AWSLogs/{organization-id}/*\n27. S3 Region Asia Pacific (Tokyo)\n28. How do you want the user to access the S3 Bucket? Role-based access æŒ‡å®šã•ã‚ŒãŸCFnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ \n29. æŒ‡å®šã•ã‚ŒãŸCFnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ  > SIEMæ©Ÿèƒ½ (AWS CloudTrail)SIEMæ©Ÿèƒ½ (AWS CloudTrail) \n\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›£è¦–å¯¾è±¡ \n\n- Console Logins Geo Location of All Users Login Events By User Logins Over Time Logins from Multiple IP Logins from Outside the USA Outlier - Success Login Outlier - Failed Login Login Results - One Day Time Comparison Logins without MFA \n- Geo Location of All Users\n- Login Events By User\n- Logins Over Time\n- Logins from Multiple IP\n- Logins from Outside the USA\n- Outlier - Success Login\n- Outlier - Failed Login\n- Login Results - One Day Time Comparison\n- Logins without MFA\n- Network and Security Authorization Failures from All Countries Network and Security Events Over Time Authorization Failures Over Time Network ACL with All Allowed Ingress/Egress Recent Authorization Failures Recent Security Group and Network ACL Changes Created and Deleted Network and Security Events Short Lived Critical Operations \n- Authorization Failures from All Countries\n- Network and Security Events Over Time\n- Authorization Failures Over Time\n- Network ACL with All Allowed Ingress/Egress\n- Recent Authorization Failures\n- Recent Security Group and Network ACL Changes\n- Created and Deleted Network and Security Events\n- Short Lived Critical Operations\n- Operations Action Events Requested AWS Services Over Time Events by AWS Region Recent Elastic IP Address Operations Created Resources Over Time Deleted Resources Over Time \n- Action Events\n- Requested AWS Services Over Time\n- Events by AWS Region\n- Recent Elastic IP Address Operations\n- Created Resources Over Time\n- Deleted Resources Over Time\n- Overview Geo Location of All Users Created Resources Deleted Resources Over Time Top 10 Users Failed Logins Created and Deleted Network and Security Events \n- Geo Location of All Users\n- Created Resources\n- Deleted Resources Over Time\n- Top 10 Users\n- Failed Logins\n- Created and Deleted Network and Security Events\n- S3 Public Objects and Buckets New Public Objects New Public Object by Object-Bucket New Public Objects Table Public Buckets Public Buckets Table Modified Public Objects Modified Public Objects by Object-Buket Modified Public Objects Table \n- New Public Objects\n- New Public Object by Object-Bucket\n- New Public Objects Table\n- Public Buckets\n- Public Buckets Table\n- Modified Public Objects\n- Modified Public Objects by Object-Buket\n- Modified Public Objects Table\n- User Monitoring Geo Location of All Users Top 10 Users Launched and Terminated Instances by User Administrative Activities Over Time Top 10 Activities by Administrative User Recent Activity by Administrative Users \n- Geo Location of All Users\n- Top 10 Users\n- Launched and Terminated Instances by User\n- Administrative Activities Over Time\n- Top 10 Activities by Administrative User\n- Recent Activity by Administrative Users  > ç·è©•ç·è©•  > ä½¿ç”¨ã‚³ã‚¹ãƒˆä½¿ç”¨ã‚³ã‚¹ãƒˆ \n\nåˆæœŸå°å…¥ã®æ®µéšã§ã¯Sumo Logicã‚ˆã‚ŠAzure Sentinelã®æ–¹ãŒå€ã®ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã¾ã™ã€‚    ãƒ­ã‚°å–è¾¼é‡/æ—¥ Azure Sentinelæœˆé¡ Sumo Logicæœˆé¡     100MB 2,396 JPY 0 USD   500MB 11,978 JPY 0 USD   3GB 71,870 JPY 332 USD    \n\nâ€» Azure Sentinelã®å†…è¨³ã¯ã€Œ ((GBå½“ãŸã‚Šã®Azure Sentinelå–è¾¼é‡347.20å††) + (GBå½“ãŸã‚Šã®Log Analyticså–è¾¼é‡451.36å††) * å–è¾¼é‡GB ã€  > å°å…¥ã‚³ã‚¹ãƒˆå°å…¥ã‚³ã‚¹ãƒˆ \n\nä¸€åº¦ã®è¨­å®šã§å®Œäº†ã™ã‚‹Sumo Logicã®æ–¹ãŒå°å…¥ã‚³ã‚¹ãƒˆãŒä½ã„ã§ã™ã€‚Azure Sentinelã¯IAMãƒ­ãƒ¼ãƒ«ã®ã¿ã§æ¸ˆã‚€ã¨ã„ã†ç‚¹ã§å°å…¥ã¯æ¥½ã§ã™ãŒAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã”ã¨ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§æ‰‹é›¢ã‚ŒãŒæ‚ªã„ã§ã™ã€‚  > SIEMæ©Ÿèƒ½SIEMæ©Ÿèƒ½ \n\nAzure Sentinelã®æ–¹ãŒåˆ†ææ©Ÿèƒ½ãŒå……å®Ÿã—ã¦ã„ã¾ã™ã€‚Sumo LogicãŒå¤§ã¾ã‹ãªè„…å¨ã‚’ãƒ­ã‚°ã‚¯ã‚¨ãƒªã‹ã‚‰ã—ã‹æ‹¾ãˆãªã„ã®ã«å¯¾ã—ã€Azure Sentinelã¯ç´°ã‹ãªè„…å¨åˆ¤å®šã‚’ãƒ­ã‚°ã‚¯ã‚¨ãƒªã§æä¾›ã—ã¦ã„ã‚‹ã®ã«åŠ ãˆã€Jupyter Notebookã‚„å¤–éƒ¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç›£è¦–å¯¾è±¡ã‚‚æ™‚é–“çµŒéã«ä¼´ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã€æ‚ªæ„ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã€æœ€è¿‘ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç­‰å¿…è¦ååˆ†ãªæƒ…å ±ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ \n\nã¾ãŸã€å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¯Azure SentinelãŒAWS CloudTrailã€Google Workspaceã€Office 365ã€Azure ADç­‰ã¨å¹…åºƒãç”¨æ„ã—ã¦ã„ã‚‹ã®ã«å¯¾ã—ã€Sumo Logicã¯SIEMã¨ã„ã†è¦³ç‚¹ã§ã¯å®Ÿè³ªAWS CloudTrailå°‚ç”¨ã®ãƒ„ãƒ¼ãƒ«ã«è½ã¡ç€ã„ã¦ã„ã¾ã™ã€‚  > WRAPUPWRAPUP \n\nãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãŒã¾ã 2-3ã—ã‹ãªã„çŠ¶æ³ã§SIEMã‚’AWSã ã‘ã«é™å®šã™ã‚‹å ´åˆã¯Sumo Logicã§ååˆ†ã§ã—ã‚‡ã†ã€‚ä½¿ç”¨ã‚³ã‚¹ãƒˆã€å°å…¥ã‚³ã‚¹ãƒˆã¨ã‚‚ã«ä½ãæŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ã—ã°ã‚‰ãã¯Sumo Logicã§é‹ç”¨ã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãŒã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹æ®µéšã§Azure Sentinelã‚’ç§»è¡Œã™ã‚‹ã®ãŒç¾å®Ÿçš„ã ã¨æ€ã„ã¾ã—ãŸã€‚"},"name":"[2021-08-15]AWS CloudTrailç”¨ã®ã‚³ã‚¹ãƒ‘ã®è‰¯ã„SIEMã‚’æ¢ã™","tags":["siem","aws-cloudtrail","azure-sentinel","sumo-logic"],"childPublishedDate":{"published_on":"2021-08-15T00:00:00.000Z","published_on_unix":1628985600}}},{"node":{"number":119,"relative_category":"blog/backend","fields":{"title":"è¸ã¿å°ã‚’SSM Session Managerã¨AWS SSOã§å®Ÿç¾ã™ã‚‹","excerpt":"è¸ã¿å°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¢—ãˆã¦ããŸãŸã‚å…¬é–‹éµç®¡ç†ã‚„ç›£è¦–ã¨é‹ç”¨è² è·ãŒä¸ŠãŒã£ã¦ãã¾ã—ãŸã€‚ã‚ªãƒšãƒŸã‚¹ãŒç™ºç”Ÿã—ã‚„ã™ã„ä¸Š ç›£æŸ»çš„ãªæ„å‘³ã§ç„¡è¦–ã§ããªã„çŠ¶æ³ã«ãªã£ã¦ããŸã®ã§é‡ã„è…°ã‚’ä¸Šã’ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚   > PROBLEMPROBLEM \n\n- EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¸ã¿å°é‹ç”¨ãŒã¤ã‚‰ã„ å…¬é–‹éµç®¡ç†ãŒã¤ã‚‰ã„ æå‡ºãƒ»è¨­å®šãƒ»ç¢ºèªã¨ã‚‚ã«é‹ç”¨ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•° x ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã§æŒ‡æ•°é–¢æ•°çš„ã«é‹ç”¨ã‚³ã‚¹ãƒˆãŒå¢—ã—ã¦ã„ãã“ã¨ãŒæƒ³å®šã•ã‚Œã‚‹ ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ãŒåˆ†æ•£ã—ã¦ã„ã‚‹ã¨ã€æå‡ºå´ãƒ»è¨­å®šå´ã¨ã‚‚ã«é‡è¤‡ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿã™ã‚‹ ç›£è¦–é‹ç”¨ãŒã¤ã‚‰ã„ å®šæœŸçš„ã«è¸ã¿å°ãŒãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã‚’å—ã‘ã¦ãŠã‚Šã€è„…å¨ãŒä½ã„ã¨ã¯è¨€ãˆã‚¹ãƒˆãƒ¬ã‚¹ãŒã‹ã‹ã‚‹ è¸ã¿å°ã‚¢ã‚¯ã‚»ã‚¹ã¸ã®ç›£æŸ»ãƒ­ã‚°ãŒä¸ååˆ† \n- å…¬é–‹éµç®¡ç†ãŒã¤ã‚‰ã„ æå‡ºãƒ»è¨­å®šãƒ»ç¢ºèªã¨ã‚‚ã«é‹ç”¨ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•° x ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã§æŒ‡æ•°é–¢æ•°çš„ã«é‹ç”¨ã‚³ã‚¹ãƒˆãŒå¢—ã—ã¦ã„ãã“ã¨ãŒæƒ³å®šã•ã‚Œã‚‹ ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ãŒåˆ†æ•£ã—ã¦ã„ã‚‹ã¨ã€æå‡ºå´ãƒ»è¨­å®šå´ã¨ã‚‚ã«é‡è¤‡ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿã™ã‚‹ \n- æå‡ºãƒ»è¨­å®šãƒ»ç¢ºèªã¨ã‚‚ã«é‹ç”¨ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹\n- AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•° x ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã§æŒ‡æ•°é–¢æ•°çš„ã«é‹ç”¨ã‚³ã‚¹ãƒˆãŒå¢—ã—ã¦ã„ãã“ã¨ãŒæƒ³å®šã•ã‚Œã‚‹\n- ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ãŒåˆ†æ•£ã—ã¦ã„ã‚‹ã¨ã€æå‡ºå´ãƒ»è¨­å®šå´ã¨ã‚‚ã«é‡è¤‡ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿã™ã‚‹\n- ç›£è¦–é‹ç”¨ãŒã¤ã‚‰ã„ å®šæœŸçš„ã«è¸ã¿å°ãŒãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã‚’å—ã‘ã¦ãŠã‚Šã€è„…å¨ãŒä½ã„ã¨ã¯è¨€ãˆã‚¹ãƒˆãƒ¬ã‚¹ãŒã‹ã‹ã‚‹ è¸ã¿å°ã‚¢ã‚¯ã‚»ã‚¹ã¸ã®ç›£æŸ»ãƒ­ã‚°ãŒä¸ååˆ† \n- å®šæœŸçš„ã«è¸ã¿å°ãŒãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã‚’å—ã‘ã¦ãŠã‚Šã€è„…å¨ãŒä½ã„ã¨ã¯è¨€ãˆã‚¹ãƒˆãƒ¬ã‚¹ãŒã‹ã‹ã‚‹\n- è¸ã¿å°ã‚¢ã‚¯ã‚»ã‚¹ã¸ã®ç›£æŸ»ãƒ­ã‚°ãŒä¸ååˆ†  > SOLUTIONSOLUTION \n\nã¨ã„ã†ã‚ã‘ã§ã€Session Managerã¨SSOã§ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã®åŠ¹ç‡åŒ–ã‚’ç‹™ã„ã¾ã™ã€‚  > è¸ã¿å°ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šè¸ã¿å°ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š \n\nã¾ãšã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦ã¯ä¸‹è¨˜ã®å›³ã®é€šã‚Šã§ã€ä»Šå›ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆä¸Šã«EC2ã‚’ç½®ã„ã¦ç´ ã®Session Managerã§DBã¸ã®æ¥ç¶šã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚å½“è©²ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ AmazonSSMManagedInstanceCore ãƒãƒªã‚·ãƒ¼1ã‚’å«ã‚“ã ãƒ­ãƒ¼ãƒ«ã‚’é©ç”¨ã€‚ãªãŠã€ECS Execã§ã¯Session Managerã§ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿç¾ã§ãç„¡ã‹ã£ãŸã“ã¨ã«åŠ ãˆã€æ—¢å­˜ã®è¸ã¿å°è³‡ç”£ã‚’æµç”¨ã™ã‚‹ãŸã‚ä»Šå›ã®å®Ÿè£…å¯¾è±¡ã‹ã‚‰å¤–ã—ã¾ã—ãŸã€‚ \n\n  > SSOã®è¨­å®šSSOã®è¨­å®š \n\nè¸ã¿å°ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šãŒçµ‚ã‚ã£ãŸã‚‰ã€æ¬¡ã«å½“è©²ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸æ¥ç¶šã™ã‚‹ãŸã‚ã«SSOã§æ¸¡ã™ãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚»ãƒƒãƒˆã«è¨­å®šã—ã¾ã™ã€‚ä¸‹è¨˜ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã¯EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®å¿…è¦æœ€ä½é™ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ json\n\n{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"cloudwatch:PutMetricData\", \"ds:CreateComputer\", \"ds:DescribeDirectories\", \"ec2:DescribeInstanceStatus\", \"logs:*\", \"ssm:*\", \"ec2messages:*\" ], \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"ssm:StartSession\" ], \"Resource\": [ \"arn:aws:ssm:*:*:session/<EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID>\", \"arn:aws:ec2:*:*:instance/<EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID>\" ] }, { \"Effect\": \"Deny\", \"Action\": [ \"ssm:Describe*\", \"ssm:Get*\", \"ssm:List*\", \"logs:Describe*\", \"logs:Get*\", \"logs:List*\" ], \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": \"iam:CreateServiceLinkedRole\", \"Resource\": \"arn:aws:iam::*:role/aws-service-role/ssm.amazonaws.com/AWSServiceRoleForAmazonSSM*\", \"Condition\": { \"StringLike\": { \"iam:AWSServiceName\": \"ssm.amazonaws.com\" } } }, { \"Effect\": \"Allow\", \"Action\": \"iam:CreateServiceLinkedRole\", \"Resource\": \"arn:aws:iam::*:role/aws-service-role/ssm.amazonaws.com/AWSServiceRoleForAmazonSSM*\", \"Condition\": { \"StringLike\": { \"iam:AWSServiceName\": \"ssm.amazonaws.com\" } } }, { \"Effect\": \"Allow\", \"Action\": [ \"iam:DeleteServiceLinkedRole\", \"iam:GetServiceLinkedRoleDeletionStatus\" ], \"Resource\": \"arn:aws:iam::*:role/aws-service-role/ssm.amazonaws.com/AWSServiceRoleForAmazonSSM*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"ssmmessages:CreateControlChannel\", \"ssmmessages:CreateDataChannel\", \"ssmmessages:OpenControlChannel\", \"ssmmessages:OpenDataChannel\" ], \"Resource\": \"*\" } ] }    > ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚‹ãŸã‚ã®äº‹å‰æº–å‚™ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚‹ãŸã‚ã®äº‹å‰æº–å‚™ \n\nã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚‹ãŸã‚ã«ã¯ä¸‹è¨˜3ã¤ã®æ‰‹é †ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚SSOçµŒç”±ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šãŒ2é€šã‚Šã‚ã‚Šã¾ã™ãŒã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æ–¹å¼ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã‚‹æ¯ã«å¤‰æ›´ã™ã‚‹æ‰‹é–“ãŒã‚ã‚‹ãŸã‚ã€CLIæ–¹å¼ã‚’ãŠè–¦ã‚ã—ã¾ã™ã€‚ \n\n1. AWS CLI v2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n2. ä¸‹è¨˜ã„ãšã‚Œã‹ã®æ–¹å¼ã§SSOçµŒç”±ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šã‚’è¡Œã† ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æ–¹å¼ CLIï¼ˆ aws sso login ï¼‰æ–¹å¼ \n3. ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æ–¹å¼\n4. CLIï¼ˆ aws sso login ï¼‰æ–¹å¼\n5. Session Manager ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  > DBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šDBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®š \n\næœ€å¾Œã«ã€DBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã¤ã„ã¦3ã¤ã®æ‰‹é †ã‚’è¸ã‚“ã§æ¥ç¶šã‚’è©¦ã¿ã¾ã™2ã€‚ãªãŠã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éƒ½åº¦è¡Œã†ã®ã‚’çœç•¥ã—ãŸã„æ–¹ã¯ã€DataGripã‚’åˆ©ç”¨ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚ \n\n1. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ã¦ ~/.ssh/config ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›† Session Managerã«proxyã¨å¯¾è±¡RDSã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨˜è¼‰ configHost <ä»»æ„ã®hostå> HostName <â€» æŒ‡å®šã—ãªã‘ã‚Œã°localhostã«ãªã‚‹> User ec2-user ProxyCommand sh -c \"aws ssm start-session --target <æ¥ç¶šã™ã‚‹è¸ã¿å°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID> --document-name AWS-StartSSHSession --parameters 'portNumber=%p' --region ap-northeast-1 --profile <ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«>\" LocalForward <ä»»æ„ã®ãƒãƒ¼ãƒˆ> <RDSã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ>:<RDSãƒãƒ¼ãƒˆ> IdentityFile ~/.ssh/<EC2ã«æ¥ç¶šã™ã‚‹ç§˜å¯†éµ> è¨­å®šã—ãŸhoståã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼è¶Šã—ã«sshæ¥ç¶šã§ãã‚‹ã‹ã‚’ç¢ºèª sh$ ssh <è¨­å®šã—ãŸhostå> \n2. Session Managerã«proxyã¨å¯¾è±¡RDSã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨˜è¼‰ configHost <ä»»æ„ã®hostå> HostName <â€» æŒ‡å®šã—ãªã‘ã‚Œã°localhostã«ãªã‚‹> User ec2-user ProxyCommand sh -c \"aws ssm start-session --target <æ¥ç¶šã™ã‚‹è¸ã¿å°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID> --document-name AWS-StartSSHSession --parameters 'portNumber=%p' --region ap-northeast-1 --profile <ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«>\" LocalForward <ä»»æ„ã®ãƒãƒ¼ãƒˆ> <RDSã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ>:<RDSãƒãƒ¼ãƒˆ> IdentityFile ~/.ssh/<EC2ã«æ¥ç¶šã™ã‚‹ç§˜å¯†éµ> \n3. è¨­å®šã—ãŸhoståã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼è¶Šã—ã«sshæ¥ç¶šã§ãã‚‹ã‹ã‚’ç¢ºèª sh$ ssh <è¨­å®šã—ãŸhostå> \n4. æ‰‹é †1ã§è¨­å®šã—ãŸsshã§æ¥ç¶šã™ã‚‹ã“ã¨ã§ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°\n5. DBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä¸‹è¨˜ã®ã‚ˆã†ã«æ¥ç¶šæƒ…å ±ã‚’è¨­å®šã—æ¥ç¶šã™ã‚‹ Host: <æ‰‹é †1ã®configãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ä»»æ„æŒ‡å®šã—ãŸãƒ›ã‚¹ãƒˆå> Port: <æ‰‹é †4ã®configãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ä»»æ„æŒ‡å®šã—ãŸãƒãƒ¼ãƒˆ> ä»–é …ç›®: DBæ¥ç¶šæƒ…å ± \n6. Host: <æ‰‹é †1ã®configãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ä»»æ„æŒ‡å®šã—ãŸãƒ›ã‚¹ãƒˆå>\n7. Port: <æ‰‹é †4ã®configãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ä»»æ„æŒ‡å®šã—ãŸãƒãƒ¼ãƒˆ>\n8. ä»–é …ç›®: DBæ¥ç¶šæƒ…å ±  > WRAPUPWRAPUP \n\nãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆä¸Šã®è¸ã¿å°ã«æ…£ã‚Œã¦ã„ã‚‹æ–¹ã¯é¦´æŸ“ã¿ã®ãªã„æ–¹æ³•ã«æˆ¸æƒ‘ã†ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ãŒã€è¸ã¿å°è³‡ç”£ã‚’æµç”¨ã§ãã‚‹ã¨ã„ã†æ„å‘³ã§å°å…¥ã®ã‚³ã‚¹ãƒˆã‚‚ãã‚Œã»ã©ã‹ã‹ã‚Šã¾ã›ã‚“ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã‚‚åˆ©ç”¨ã®æ•·å±…ã¯é«˜ãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å¾Œã€…ã®ç®¡ç†ã‚³ã‚¹ãƒˆã‚’å¿ƒé…ã—ã¦ã„ã‚‹æ–¹ã¯ä¸€åº¦æ¤œè¨ã—ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚  \n\n1. AmazonEC2RoleforSSM ã¯éæ¨å¥¨ã®ãŸã‚é©ç”¨ã—ãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¾ã™ã€‚ â†© \n2. ä»Šå›ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã‚’é¿ã‘ã‚‹ãŸã‚SSH over SSMã®é–¢é€£ãƒ„ãƒ¼ãƒ« ssh-ssm.sh ssm-tool ã¯ä½¿ã‚ãªã„æ–¹é‡ã§ã„ã¾ã™ã€‚ â†©"},"name":"[2021-11-21]è¸ã¿å°ã‚’SSM Session Managerã¨AWS SSOã§å®Ÿç¾ã™ã‚‹","tags":["session-manager","aws-sso"],"childPublishedDate":{"published_on":"2021-11-21T00:00:00.000Z","published_on_unix":1637452800}}},{"node":{"number":137,"relative_category":"blog/backend","fields":{"title":"G Suiteç„¡å„Ÿç‰ˆåœæ­¢ã«ä¼´ã„ã€MXãƒ¬ã‚³ãƒ¼ãƒ‰ç­‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‚’æ•´ç†ã—ãŸ","excerpt":"ä»Šå›ã¯10å¹´ä»¥ä¸Šåˆ©ç”¨ã—ã¦ã„ãŸG Suiteç„¡å„Ÿç‰ˆãŒ2022å¹´8æœˆã«åœæ­¢ã•ã‚Œã‚‹ã¨ã®ã“ã¨ã§ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç®¡ç†ã‚’ã©ã†ã™ã‚‹ã‹æ¤œè¨ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ç®¡ç†ã¯åˆ¥ã®GMailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã€è»¢é€ã§ãã‚Œã°è‰¯ã„ã®ã§ã™ãŒã€ã“ã‚Œã‚’æ©Ÿã«ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‚’AWSã«ã¾ã¨ã‚ã¦ã„ãã“ã¨ã‚’æ€ã„ã¤ãã¾ã—ãŸã€‚   > PROBLEMPROBLEM \n\n- 10å¹´ä»¥ä¸Šåˆ©ç”¨ã—ã¦ã„ãŸG Suiteç„¡å„Ÿç‰ˆãŒ2022å¹´8æœˆã«åœæ­¢ã•ã‚Œã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç®¡ç†ã‚’ã©ã†ã—ã‚ˆã†ã‹ Google Workspaceã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã‚‚è‰¯ã„ã‘ã©Business Starterãƒ—ãƒ©ãƒ³ã«ã—ã¦ã‚‚é¢ç™½ã¿ãŒãªã„ã®ã§åˆ¥ã®æ–¹æ³•ã‚’æ¢ã—ãŸã„ G Suiteã¯ãƒ¡ãƒ¼ãƒ«ã—ã‹åˆ©ç”¨ã—ã¦ãŠã‚‰ãšã€ãƒ¡ãƒ¼ãƒ«ç®¡ç†ã¯åˆ¥ã®GMailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ãŸã®ã§ãƒ¡ãƒ¼ãƒ«è»¢é€æ©Ÿèƒ½ã§ä»£æ›¿ã§ããã† \n- Google Workspaceã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã‚‚è‰¯ã„ã‘ã©Business Starterãƒ—ãƒ©ãƒ³ã«ã—ã¦ã‚‚é¢ç™½ã¿ãŒãªã„ã®ã§åˆ¥ã®æ–¹æ³•ã‚’æ¢ã—ãŸã„ G Suiteã¯ãƒ¡ãƒ¼ãƒ«ã—ã‹åˆ©ç”¨ã—ã¦ãŠã‚‰ãšã€ãƒ¡ãƒ¼ãƒ«ç®¡ç†ã¯åˆ¥ã®GMailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ãŸã®ã§ãƒ¡ãƒ¼ãƒ«è»¢é€æ©Ÿèƒ½ã§ä»£æ›¿ã§ããã† \n- G Suiteã¯ãƒ¡ãƒ¼ãƒ«ã—ã‹åˆ©ç”¨ã—ã¦ãŠã‚‰ãšã€ãƒ¡ãƒ¼ãƒ«ç®¡ç†ã¯åˆ¥ã®GMailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ãŸã®ã§ãƒ¡ãƒ¼ãƒ«è»¢é€æ©Ÿèƒ½ã§ä»£æ›¿ã§ããã†  > SOLUTIONSOLUTION \n\nã¨è¨€ã†ã‚ã‘ã§ã€ä»Šå›ã¯G Suiteã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åˆ©ç”¨ã‚’æ­¢ã‚ã¦ã€MXãƒ¬ã‚³ãƒ¼ãƒ‰å‘¨ã‚Šã‚’æ•´ç†ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚å€‹äººåˆ©ç”¨ãªã®ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã¯æ—¢å­˜ã®ã¾ã¾ã§è‰¯ã‹ã£ãŸã®ã§ã™ãŒã€è¨¼è·¡ç®¡ç†ã®ãªã„çŠ¶æ³ã«è€ãˆã‚‰ã‚ŒãšAWSã«ç§»ç®¡ã€‚ãƒ¡ãƒ¼ãƒ«è»¢é€æ©Ÿèƒ½ã¯POBOXä»¥å¤–ã¯ã‚µãƒ–ã‚¢ãƒ‰ãƒ¬ã‚¹å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸã®ã§ã™ãŒã€ã‚­ãƒ£ãƒƒãƒã‚ªãƒ¼ãƒ«å¯¾å¿œã§ãã‚‹ã®ã§ã¾ãšã¯è‰¯ã—ã¨ã—ã¦ã„ã¾ã™ã€‚ç¾æ™‚ç‚¹ã§ã®æ§‹æˆã¯ä¸‹è¨˜ã®é€šã‚Šã€‚ \n\nãªãŠã€è¤‡æ•°äººæ•°ã§å¿…è¦ã«ãªã£ãŸå ´åˆã¯ã€ã‚µãƒ–ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¯¾å¿œå¯èƒ½ãªAmazon Workmailã«ç§»ç®¡ã™ã‚‹äºˆå®šã§ã™ãŒã€ã“ã‚Œã§ã‚‚Google Workspaceã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã‚Šã‚³ã‚¹ãƒˆã¯åŠåˆ†ç¨‹ã§æ¸ˆã¿ã¾ã™ã€‚  > æ§‹æˆæ§‹æˆ  > beforebefore \n\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç† ãƒãƒªãƒ¥ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³\n- NSãƒ¬ã‚³ãƒ¼ãƒ‰ Cloudflare DNS\n- MXãƒ¬ã‚³ãƒ¼ãƒ‰ G Suite\n- SMTP G Suite  > afterafter \n\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç† Amazon Route 53\n- NSãƒ¬ã‚³ãƒ¼ãƒ‰ Amazon Route 53\n- MXãƒ¬ã‚³ãƒ¼ãƒ‰ Cloudflare Email Routing\n- SMTP Amazon SES  > æ‰‹é †æ‰‹é † \n\næ–¹é‡ãŒæ±ºã¾ã‚‹ã¾ã§ã„ãã¤ã‹ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¤œè¨ã—ãŸã®ã§ã™ãŒã€æ±ºã¾ã£ã¦ã—ã¾ãˆã°ã‚„ã‚‹ã“ã¨ã¯å˜ç´”ã§ã™ã€‚  > 1. ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‚’æ•´ç†ã™ã‚‹1. ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‚’æ•´ç†ã™ã‚‹ \n\nåŸºæœ¬ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»ç®¡ç”³è«‹ã§ã™ãŒã€G Suiteã‚’å¾Œã»ã©å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã¦MXãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’Cloudflare Email Routingã«å¤‰æ›´ã€‚æœ¬æ¥ã¯ã“ã®å‡¦ç†ã®å‰ã«G Suiteã«ç´ä»˜ã„ã¦ã„ã‚‹å„ã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®šå¤‰æ›´ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ \n\n1. ç§»ç®¡å…ƒã«ã¦WHOISæƒ…å ±å…¬é–‹ä»£è¡Œã®è§£é™¤\n2. ç§»ç®¡å…ƒã«ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ãƒƒã‚¯ã®è§£é™¤\n3. ç§»ç®¡å…ƒã«ã¦èªè¨¼éµ (Auth-Code) ã‚’ç¢ºèª\n4. ç§»ç®¡å…ˆã«ã¦ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã®ä½œæˆã€å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã‚’ç§»ç®¡å…ƒã«åˆã‚ã›ã‚‹\n5. Cloudflare Email Routingã«ã¦è»¢é€å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¤œè¨¼ã™ã‚‹\n6. ç§»ç®¡å…ˆã«ã¦MXãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’Cloudflare Email Routingã®ã‚‚ã®ã‚’è¨­å®šã™ã‚‹\n7. ç§»ç®¡å…ƒã®NSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç§»ç®¡å…ˆã«å¤‰æ›´\n8. ç§»ç®¡å…ˆã«ã¦èªè¨¼éµã‚’ã¤ã‹ã„ç§»ç®¡ç”³è«‹ã‚’è¡Œã†\n9. ç§»ç®¡å…ƒã«å¯¾ã—ã¦ç§»ç®¡ç”³è«‹ã‚’è¡Œã£ãŸæ—¨ã‚’ãƒ¡ãƒ¼ãƒ«ã«ã¦é€£æºã™ã‚‹ \n\nCf. \n\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä»–ç¤¾ã¸ã®ç§»ç®¡ | ãƒãƒªãƒ¥ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²ã® Amazon RouteÂ 53 ã¸ã®ç§»ç®¡ - Amazon RouteÂ 53\n- Easily creating and routing email addresses with Cloudflare Email Routing  > 2. SMTPã‚’è¨­å®šã™ã‚‹2. SMTPã‚’è¨­å®šã™ã‚‹ \n\næœ€è¿‘ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®ãŸã‚GMailã®SMTPãŒä½¿ã„ã¥ã‚‰ããªã£ã¦ã„ã‚‹ã®ã§ã€ä»Šå›ã¯Amazon SESã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹è§£é™¤ã®ãŸã‚ä¸‹è¨˜ã®é€šã‚Šã‚µãƒãƒ¼ãƒˆã«ä¾é ¼ã—ã¾ã—ãŸã€‚ txt\n\n# ãƒ¡ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ— é€šä¾‹ã®å–å¼•ãŒãƒ¡ã‚¤ãƒ³ã¨ãªã‚‹äºˆå®šã§ã™ # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ ## ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹é »åº¦ é€±ã«1-2å› ## å—ä¿¡è€…ãƒªã‚¹ãƒˆã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ–¹æ³• å››åŠæœŸã«ä¸€åº¦ã®æ£šå¸ã— ## ãƒã‚¦ãƒ³ã‚¹å¯¾å¿œ å½“è©²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰Šé™¤ ## ç”³ã—ç«‹ã¦å¯¾å¿œ å½“è©²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®ãƒ•ãƒ©ã‚°ç®¡ç† ## è§£é™¤ç”³è«‹ã®ç®¡ç†æ–¹æ³• ãƒ¡ãƒ¼ãƒ«ã§ã®å—ä»˜ ## é€ä¿¡äºˆå®šã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ³ãƒ—ãƒ« {{å®›å…ˆå}}æ§˜ ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚ è¡¨é¡Œã®ä»¶ã«ã¤ãã¾ã—ã¦1ç‚¹å•ã„åˆã‚ã›ã—ã¾ã™ã€‚ {{å•ã„åˆã‚ã›å†…å®¹}} ã”ä¸æ˜ãªç‚¹ç­‰ã”ã–ã„ã¾ã—ãŸã‚‰ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ä¸‹ã•ã„ã€‚ ã©ã†ãã€ã‚ˆã‚ã—ããŠé¡˜ã„è‡´ã—ã¾ã™ã€‚   > 3. G Suiteã‚’é€€ä¼šã™ã‚‹3. G Suiteã‚’é€€ä¼šã™ã‚‹ \n\nG Suiteã«ä¾å­˜ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒãªã„ã‹ç¢ºèªã—ã€é€€ä¼šã—ã¾ã™ã€‚  > WRAPUPWRAPUP \n\nä»¥å‰ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‚’AWSã«ç§»ç®¡ã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€ç©æ¥µçš„ãªç†ç”±ãŒãªã„ãŸã‚ãªãŠã–ã‚Šã«ãªã£ã¦ã„ã¾ã—ãŸã€‚ä»Šå›ã®G Suiteç„¡å„Ÿç‰ˆã®æœŸé™åˆ‡ã‚Œã«ä¼´ã„æ•´ç†ã§ãã™ã£ãã‚Šã—ãŸã®ã§ã€ã“ã‚Œã‚’æ©Ÿã«ã„ã‚ã„ã‚æ•´ç†ã—ã¦ã„ããŸã„ã§ã™ã­ã€‚  > å¾Œæ—¥è«‡å¾Œæ—¥è«‡ \n\nCloudflare DNSã‹ã‚‰Amazon Route 53ã«è¨­å®šã‚’å¤‰æ›´ã—ãŸæ•°æ—¥å¾Œã€Cloudflare Email RoutingãŒä½¿ç”¨ã§ããªããªã‚Šã¾ã—ãŸã€‚è»¢é€æ©Ÿèƒ½ã¨ã—ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‹ã‚‰åˆ‡ã‚Šé›¢ã•ã‚Œã¦ã„ã‚‹ã¨æ€ã£ãŸã®ã§ã™ãŒãã†ã§ã¯ãªã‹ã£ãŸã‚ˆã†ã§ã™ã€‚ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã¯å³ã—ã‚ã«è¨¼è·¡ã‚’å–ã£ã¦ã„ããŸã„ã¨ã“ã‚ãªã®ã§ã€Amazon Route 53ã«ã‚ˆã‚‹ç®¡ç†ã¯è­²ã‚Œã¾ã›ã‚“ã€‚ \n\nã¾ãŸã€Amazon SESã«ã‚ˆã‚‹è»¢é€æ©Ÿèƒ½ã‚‚æ¤œè¨ã—ãŸã®ã§ã™ãŒã€é€ä¿¡å…ƒã™ã¹ã¦ã«å¯¾ã—ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ãŒå¿…è¦ãªãŸã‚ç¾å®Ÿçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚AWSã«ã¯ãƒ¡ãƒ¼ãƒ«è»¢é€ã®ç¨®é¡ãŒ2ã¤ã‚ã£ã¦ã€é€ä¿¡å…ƒã‚’è»¢é€è€…ã«ç½®ãæ›ãˆã‚‹ã€Œè»¢é€ã€ã¨é€ä¿¡å…ƒã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã€Œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€ãŒã‚ã‚Šã¾ã™ã€‚ã€Œè»¢é€ã€ã ã¨å…ƒã®é€ä¿¡å…ƒã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå–ã‚Šã¥ã‚‰ããªã‚‹ä¸€æ–¹ã€ã€Œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€ã ã¨ã™ã¹ã¦ã®é€ä¿¡å…ƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚ã“ã“ã§ã¯èé€šãŒåˆ©ã‹ãªã„ã¨åˆ¤æ–­ã™ã‚‹ã®ã§ã¯ãªãã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã•ã‚ŒãŸå®Ÿè£…ã¨æ‰ãˆã€AWSãŒæä¾›ã—ã¦ã„ã‚‹WorkMailã‚’ç´ ç›´ã«ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚æ…£ã‚Œã‚Œã°ãŸã„ã—ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹è¨˜ãŒçµæœã«ãªã‚Šã¾ã™ã€‚  > beforebefore \n\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç† Amazon Route 53\n- NSãƒ¬ã‚³ãƒ¼ãƒ‰ Amazon Route 53\n- MXãƒ¬ã‚³ãƒ¼ãƒ‰ Cloudflare Email Routing\n- SMTP Amazon SES  > afterafter \n\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç† Amazon Route 53\n- NSãƒ¬ã‚³ãƒ¼ãƒ‰ Amazon Route 53\n- MXãƒ¬ã‚³ãƒ¼ãƒ‰ Amazon WorkMail\n- SMTP Amazon WorkMail"},"name":"[2022-04-12]G Suiteç„¡å„Ÿç‰ˆåœæ­¢ã«ä¼´ã„ã€MXãƒ¬ã‚³ãƒ¼ãƒ‰ç­‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã‚’æ•´ç†ã—ãŸ","tags":["gsuite","google-workspace","cloudflare","amazon-ses","amazon-workmail"],"childPublishedDate":{"published_on":"2022-04-12T00:00:00.000Z","published_on_unix":1649721600}}}]}},"pageContext":{"number":62}},"staticQueryHashes":[]}