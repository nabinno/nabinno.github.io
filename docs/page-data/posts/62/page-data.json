{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/62","result":{"data":{"esaPost":{"number":62,"relative_category":"blog/backend","fields":{"title":"Elixirã§ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯","excerpt":"> PROBLEMPROBLEM \n\n- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆãƒ–ã‚¯ãƒï¼‰ã™ã‚‹ã¨ãƒ•ã‚£ãƒ¼ãƒ‰æ¶ˆåŒ–ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹ ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹ ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„ èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† \n- ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹ ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„ èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã† \n- ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„\n- èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†\n- é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†   > SOLUTIONSOLUTION \n\nã¨ã„ã†ã‚ã‘ã§ã€ä¸‹è¨˜ã®æ–¹é‡ã§ãƒ–ã‚¯ãƒã™ã‚‹ã“ã¨ã«ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯GitHubãƒ¬ãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ã€‚ \n\næ–¹é‡ \n\n- ãƒ•ã‚£ãƒ¼ãƒ‰ã”ã¨ã«ã‚¿ã‚°ã¥ã‘ã™ã‚‹\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ã§é™¤å¤–åˆ¤å®šã™ã‚‹\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã‹ã‚‰æ ¡æ­£ã™ã¹ãã‚‚ã®ã‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã¹ãã‚‚ã®ã‹åˆ¤å®šã™ã‚‹\n- ä¸Šè¨˜è¨­å®šã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\n- ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã‚’éåŒæœŸå‡¦ç†ã§ãã‚‹ã‚ˆã†Elixirã§å®Ÿè£…ã™ã‚‹   > ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³• \n\nä¸‹è¨˜5ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹ã€æ§‹é€ ã¯ãƒãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã®ã¿ã€‚è¨˜äº‹ã‚’èª­ã¿ã™ã™ã‚ã‚‹ä¸­ã§æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ããŸã‚‰éƒ½åº¦ feed.yaml ã‚’æ›´æ–°ã™ã‚‹ã€‚ã¾ãŸã€è¨˜äº‹ã«ãƒã‚¤ã‚ºãŒå¤šã„ã‚ˆã†ã ã£ãŸã‚‰å‚¾å‘ã‚’åˆ†æã—ã¦é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ« feed_excluded_link.yaml feed_excluded_title.yaml ã‚’æ›´æ–°ã—ã¦ã‚‹ã€‚    item description     feed.yaml ãƒ•ã‚£ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã«å¯¾ã™ã‚‹ãƒªãƒ³ã‚¯ã€ã‚¿ã‚°ã®ãƒãƒƒãƒ—   feed_excluded_link.yaml é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆ   feed_excluded_title.yaml é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒªã‚¹ãƒˆ   feed_corrected_link.yaml ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ—   feed_redirected_link.yaml ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒªãƒ³ã‚¯ã®ãƒãƒƒãƒ—      yaml \n\n# feed.yaml nabinno/sports/feed_group_name: tags: - ski links: - http://rss.example.com/ski_feed.rss - http://rss.example.com/snowboard_feed.rss - http://ski-status.example.com/rss # feed_excluded_link.yaml - anti-ski.example.com - awesome-snowboard.example.com # feed_excluded_title.yaml - queer - two-planker - beaver-tail # feed_corrected_link.yaml amazon.com: - ref - ie # feed_redirected_link.yaml ski-status.example.com: - Floki.find(fst, \".post__body a\")     > Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†   > ç›£è¦–æ©Ÿæ§‹ Supervisorç›£è¦–æ©Ÿæ§‹ Supervisor \n\nElixirã«ã¯ç›£è¦–æ©Ÿæ§‹ãŒã‚ã‚Šã€ãã‚ŒãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç®¡ç†ã—ã¦ã„ã‚‹ã€‚ã“ã“ã§ã¯ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã¯åˆ¥ã€…ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å‡¦ç†ã—ã¦ã„ã‚‹ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæš–æ°—å‡¦ç†ã‚’åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚å†èµ·å‹•æˆ¦ç•¥ã¯ã€Œå¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã«ã‚ã‚‹ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã€ï¼ˆ one_for_all ï¼‰ã«ã—ã¦ã‚ã‚‹ã€‚ \n\nä¸‹è¨˜ã®ã‚ˆã†ã« Supervisor.start_link ã‚’ Keshikimi2.Application.start ã«é©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆ mix run ï¼‰ã—ãŸæ™‚ç‚¹ã§ç›£è¦–æ©Ÿæ§‹ãŒèµ·å‹•ã•ã‚Œã‚‹ã€‚   ex \n\nSupervisor.start_link( [ :hackney_pool.child_spec(:hatena_bookmark_pool, timeout: 15_000, max_connections: 100), # @todo å½“è©²ãƒ¯ãƒ¼ã‚«ãƒ¼ã§æš–æ°—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„ã®ã§ `one_for_one` ã«ã—ãŸå ´åˆã€å†èµ·å‹•æ™‚ã«ã»ã‹ã«å½±éŸ¿ã™ã‚‹ supervisor(Cachex, [:feed, []]), supervisor(Keshikimi2Feed.Registry, [prefix]), # ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼å‡¦ç† (PubSub) supervisor(Keshikimi2Feed.Subscriber, [prefix]), worker(Keshikimi2Feed.Worker, [prefix]), worker(Keshikimi2Feed.Publisher, [[prefix: prefix, poll_interval: 3_000]]), # ãƒ–ã‚¯ãƒå‡¦ç† worker(Keshikimi2.HatenaBookmark.AddEntry, [ [prefix: prefix, poll_interval: 3_000] ]) ], strategy: :one_for_all, name: name(prefix) )     > éåŒæœŸå‡¦ç† Task.async_streaméåŒæœŸå‡¦ç† Task.async_stream \n\né…åˆ—ã‚’å¼•ãå›ã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯ Task.async_stream ãŒã†ã£ã¦ã¤ã‘ã§ã‚ã‚‹ã€‚ä¸‹è¨˜ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–ã‚Šå‡ºã—ã€é™¤å¤–å‡¦ç†ã€æ ¡æ­£å‡¦ç†ã‚’åŠ ãˆã¦ã€ãƒ–ã‚¯ãƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã¨ã„ã†æµã‚Œã‚’çµ„ã‚“ã§ã„ã‚‹ã€‚Elixirã§ã¯ã€æµã‚Œã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãéåŒæœŸå‡¦ç†ã—ã¦ãã“ã¨ãŒã§ãã‚‹ã€‚   ex \n\nCachex.keys!(:feed) |> Enum.reject(fn key -> key in [ \"excluded_links\", \"excluded_titles\", \"corrected_links\", \"redirected_links\", \"feed_group\", \"archived_links\" ] end) |> Task.async_stream( fn item_link -> with {:ok, [item_title, feed_tags]} <- Cachex.get(:feed, item_link), :ok <- validate_all(item_link, item_title), corrected_link <- correct_all(item_link), {:ok, payload} <- FormData.create( %{ url: corrected_link, comment: feed_tags |> Enum.map_join(fn tag -> \"[#{tag}]\" end), rks: System.get_env(\"HATENA_BOOKMARK_RKS\"), private: 0, keep_original_url: 1, with_status_op: 1, from: \"inplace\", post_twitter: 0, post_evernote: 0 }, :url_encoded, get: false ) do do_add_entries_to_hb(payload) Logger.info(\"add entry: #{item_link}\") end archive_link(item_link) end, timeout: 15_000 ) |> Stream.run()     > WRAPUPWRAPUP   > ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹ \n\n- æ‰‹å‹•ã§ãƒ–ã‚¯ãƒ: æ°—ã«ãªã£ãŸè¨˜äº‹ãŒã‚ã‚‹ã”ã¨ã«\n- ãƒ–ã‚¯ãƒã®ç¢ºèª: æ°—ã«ãªã‚‹ã‚¿ã‚°ã”ã¨ã«ã¾ã¨ã‚ã¦ç¢ºèª ãŸã¨ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œnabinno/githubã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã€‚ \n- ãŸã¨ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œnabinno/githubã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã€‚","thumbnail":"https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png"},"wip":false,"body_md":"<img alt=thumbnail src=https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png />\r\n\r\n# PROBLEM\r\n- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆãƒ–ã‚¯ãƒï¼‰ã™ã‚‹ã¨ãƒ•ã‚£ãƒ¼ãƒ‰æ¶ˆåŒ–ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹\r\n    - ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹\r\n        - ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„\r\n        - èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†\r\n        - é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†\r\n\r\n# SOLUTION\r\nã¨ã„ã†ã‚ã‘ã§ã€ä¸‹è¨˜ã®æ–¹é‡ã§ãƒ–ã‚¯ãƒã™ã‚‹ã“ã¨ã«ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯[GitHubãƒ¬ãƒã‚¸ãƒˆãƒª](https://github.com/nabinno/keshikimi2)ã‚’å‚ç…§ã€‚\r\n\r\n**æ–¹é‡**\r\n\r\n- ãƒ•ã‚£ãƒ¼ãƒ‰ã”ã¨ã«ã‚¿ã‚°ã¥ã‘ã™ã‚‹\r\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ã§é™¤å¤–åˆ¤å®šã™ã‚‹\r\n- ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã‹ã‚‰æ ¡æ­£ã™ã¹ãã‚‚ã®ã‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã¹ãã‚‚ã®ã‹åˆ¤å®šã™ã‚‹\r\n- ä¸Šè¨˜è¨­å®šã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\r\n- ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã‚’éåŒæœŸå‡¦ç†ã§ãã‚‹ã‚ˆã†Elixirã§å®Ÿè£…ã™ã‚‹\r\n\r\n## ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•\r\nä¸‹è¨˜5ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹ã€æ§‹é€ ã¯ãƒãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã®ã¿ã€‚è¨˜äº‹ã‚’èª­ã¿ã™ã™ã‚ã‚‹ä¸­ã§æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ããŸã‚‰éƒ½åº¦ `feed.yaml` ã‚’æ›´æ–°ã™ã‚‹ã€‚ã¾ãŸã€è¨˜äº‹ã«ãƒã‚¤ã‚ºãŒå¤šã„ã‚ˆã†ã ã£ãŸã‚‰å‚¾å‘ã‚’åˆ†æã—ã¦é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ« `feed_excluded_link.yaml` `feed_excluded_title.yaml` ã‚’æ›´æ–°ã—ã¦ã‚‹ã€‚\r\n\r\n| item                        | description                                              |\r\n|-----------------------------|----------------------------------------------------------|\r\n| `feed.yaml`                 | ãƒ•ã‚£ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã«å¯¾ã™ã‚‹ãƒªãƒ³ã‚¯ã€ã‚¿ã‚°ã®ãƒãƒƒãƒ—           |\r\n| `feed_excluded_link.yaml`   | é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆ                         |\r\n| `feed_excluded_title.yaml`  | é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒªã‚¹ãƒˆ                       |\r\n| `feed_corrected_link.yaml`  | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ— |\r\n| `feed_redirected_link.yaml` | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒªãƒ³ã‚¯ã®ãƒãƒƒãƒ—       |\r\n\r\n```yaml\r\n# feed.yaml\r\nnabinno/sports/feed_group_name:\r\n  tags:\r\n    - ski\r\n  links:\r\n    - http://rss.example.com/ski_feed.rss\r\n    - http://rss.example.com/snowboard_feed.rss\r\n    - http://ski-status.example.com/rss\r\n\r\n# feed_excluded_link.yaml\r\n- anti-ski.example.com\r\n- awesome-snowboard.example.com\r\n\r\n# feed_excluded_title.yaml\r\n- queer\r\n- two-planker\r\n- beaver-tail\r\n\r\n# feed_corrected_link.yaml\r\namazon.com:\r\n  - ref\r\n  - ie\r\n\r\n# feed_redirected_link.yaml\r\nski-status.example.com:\r\n  - Floki.find(fst, \".post__body a\")\r\n```\r\n\r\n## Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†\r\n### ç›£è¦–æ©Ÿæ§‹ Supervisor\r\n\r\nElixirã«ã¯ç›£è¦–æ©Ÿæ§‹ãŒã‚ã‚Šã€ãã‚ŒãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç®¡ç†ã—ã¦ã„ã‚‹ã€‚ã“ã“ã§ã¯ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã¯åˆ¥ã€…ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å‡¦ç†ã—ã¦ã„ã‚‹ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæš–æ°—å‡¦ç†ã‚’åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚å†èµ·å‹•æˆ¦ç•¥ã¯ã€Œå¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã«ã‚ã‚‹ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã€ï¼ˆ `one_for_all` ï¼‰ã«ã—ã¦ã‚ã‚‹ã€‚\r\n\r\nä¸‹è¨˜ã®ã‚ˆã†ã« `Supervisor.start_link` ã‚’ `Keshikimi2.Application.start` ã«é©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆ `mix run` ï¼‰ã—ãŸæ™‚ç‚¹ã§ç›£è¦–æ©Ÿæ§‹ãŒèµ·å‹•ã•ã‚Œã‚‹ã€‚\r\n\r\n```ex\r\nSupervisor.start_link(\r\n  [\r\n    :hackney_pool.child_spec(:hatena_bookmark_pool, timeout: 15_000, max_connections: 100),\r\n    # @todo å½“è©²ãƒ¯ãƒ¼ã‚«ãƒ¼ã§æš–æ°—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„ã®ã§ `one_for_one` ã«ã—ãŸå ´åˆã€å†èµ·å‹•æ™‚ã«ã»ã‹ã«å½±éŸ¿ã™ã‚‹\r\n    supervisor(Cachex, [:feed, []]),\r\n    supervisor(Keshikimi2Feed.Registry, [prefix]),\r\n\r\n    # ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼å‡¦ç† (PubSub)\r\n    supervisor(Keshikimi2Feed.Subscriber, [prefix]),\r\n    worker(Keshikimi2Feed.Worker, [prefix]),\r\n    worker(Keshikimi2Feed.Publisher, [[prefix: prefix, poll_interval: 3_000]]),\r\n\r\n    # ãƒ–ã‚¯ãƒå‡¦ç†\r\n    worker(Keshikimi2.HatenaBookmark.AddEntry, [\r\n      [prefix: prefix, poll_interval: 3_000]\r\n    ])\r\n  ],\r\n  strategy: :one_for_all,\r\n  name: name(prefix)\r\n)\r\n```\r\n\r\n### éåŒæœŸå‡¦ç† Task.async_stream\r\n\r\né…åˆ—ã‚’å¼•ãå›ã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯ `Task.async_stream` ãŒã†ã£ã¦ã¤ã‘ã§ã‚ã‚‹ã€‚ä¸‹è¨˜ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–ã‚Šå‡ºã—ã€é™¤å¤–å‡¦ç†ã€æ ¡æ­£å‡¦ç†ã‚’åŠ ãˆã¦ã€ãƒ–ã‚¯ãƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã¨ã„ã†æµã‚Œã‚’çµ„ã‚“ã§ã„ã‚‹ã€‚Elixirã§ã¯ã€æµã‚Œã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãéåŒæœŸå‡¦ç†ã—ã¦ãã“ã¨ãŒã§ãã‚‹ã€‚\r\n\r\n```ex\r\nCachex.keys!(:feed)\r\n|> Enum.reject(fn key ->\r\n  key in [\r\n    \"excluded_links\",\r\n    \"excluded_titles\",\r\n    \"corrected_links\",\r\n    \"redirected_links\",\r\n    \"feed_group\",\r\n    \"archived_links\"\r\n  ]\r\nend)\r\n|> Task.async_stream(\r\n  fn item_link ->\r\n    with {:ok, [item_title, feed_tags]} <- Cachex.get(:feed, item_link),\r\n         :ok <- validate_all(item_link, item_title),\r\n         corrected_link <- correct_all(item_link),\r\n         {:ok, payload} <-\r\n           FormData.create(\r\n             %{\r\n               url: corrected_link,\r\n               comment: feed_tags |> Enum.map_join(fn tag -> \"[#{tag}]\" end),\r\n               rks: System.get_env(\"HATENA_BOOKMARK_RKS\"),\r\n               private: 0,\r\n               keep_original_url: 1,\r\n               with_status_op: 1,\r\n               from: \"inplace\",\r\n               post_twitter: 0,\r\n               post_evernote: 0\r\n             },\r\n             :url_encoded,\r\n             get: false\r\n           ) do\r\n      do_add_entries_to_hb(payload)\r\n      Logger.info(\"add entry: #{item_link}\")\r\n    end\r\n\r\n    archive_link(item_link)\r\n  end,\r\n  timeout: 15_000\r\n)\r\n|> Stream.run()\r\n```\r\n\r\n# WRAPUP\r\n## ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹\r\n\r\n- **æ‰‹å‹•ã§ãƒ–ã‚¯ãƒ:** æ°—ã«ãªã£ãŸè¨˜äº‹ãŒã‚ã‚‹ã”ã¨ã«\r\n- **ãƒ–ã‚¯ãƒã®ç¢ºèª:** æ°—ã«ãªã‚‹ã‚¿ã‚°ã”ã¨ã«ã¾ã¨ã‚ã¦ç¢ºèª\r\n    - ãŸã¨ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œ[nabinno/github](http://b.hatena.ne.jp/nabinno/github)ã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã€‚\r\n","body_html":"<a href=\"https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img alt=\"thumbnail\" src=\"https://raw.githubusercontent.com/nabinno/keshikimi2/master/priv/img/diagram.png\"></a>\n<h1 data-sourcepos=\"3:1-3:9\" id=\"1-0-0\" name=\"1-0-0\">\n<a class=\"anchor\" id=\"PROBLEM\" name=\"PROBLEM\" href=\"#PROBLEM\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"PROBLEM\"> &gt; PROBLEM</span></a>PROBLEM</h1>\n<ul data-sourcepos=\"4:1-9:0\">\n<li data-sourcepos=\"4:1-9:0\">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆãƒ–ã‚¯ãƒï¼‰ã™ã‚‹ã¨ãƒ•ã‚£ãƒ¼ãƒ‰æ¶ˆåŒ–ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹\n<ul data-sourcepos=\"5:5-9:0\">\n<li data-sourcepos=\"5:5-9:0\">ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ãƒ–ã‚¯ãƒã—ã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®å•é¡ŒãŒã§ã¦ãã‚‹\n<ul data-sourcepos=\"6:9-9:0\">\n<li data-sourcepos=\"6:9-6:52\">ã‚ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„</li>\n<li data-sourcepos=\"7:9-7:61\">èª­ã¿ãŸããªã„è¨˜äº‹ã‚’ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†</li>\n<li data-sourcepos=\"8:9-9:0\">é©åˆ‡ã§ãªã„URLã§ãƒ–ã‚¯ãƒã—ã¦ã—ã¾ã†</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 data-sourcepos=\"10:1-10:10\" id=\"2-0-0\" name=\"2-0-0\">\n<a class=\"anchor\" id=\"SOLUTION\" name=\"SOLUTION\" href=\"#SOLUTION\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SOLUTION\"> &gt; SOLUTION</span></a>SOLUTION</h1>\n<p data-sourcepos=\"11:1-11:170\">ã¨ã„ã†ã‚ã‘ã§ã€ä¸‹è¨˜ã®æ–¹é‡ã§ãƒ–ã‚¯ãƒã™ã‚‹ã“ã¨ã«ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯<a href=\"https://github.com/nabinno/keshikimi2\" target=\"_blank\" rel=\"noopener noreferrer\">GitHubãƒ¬ãƒã‚¸ãƒˆãƒª</a>ã‚’å‚ç…§ã€‚</p>\n<p data-sourcepos=\"13:1-13:10\"><strong>æ–¹é‡</strong></p>\n<ul data-sourcepos=\"15:1-20:0\">\n<li data-sourcepos=\"15:1-15:41\">ãƒ•ã‚£ãƒ¼ãƒ‰ã”ã¨ã«ã‚¿ã‚°ã¥ã‘ã™ã‚‹</li>\n<li data-sourcepos=\"16:1-16:80\">ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ã§é™¤å¤–åˆ¤å®šã™ã‚‹</li>\n<li data-sourcepos=\"17:1-17:122\">ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹è¨˜äº‹ã‚’ãƒªãƒ³ã‚¯ã‹ã‚‰æ ¡æ­£ã™ã¹ãã‚‚ã®ã‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã¹ãã‚‚ã®ã‹åˆ¤å®šã™ã‚‹</li>\n<li data-sourcepos=\"18:1-18:75\">ä¸Šè¨˜è¨­å®šã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹</li>\n<li data-sourcepos=\"19:1-20:0\">ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã‚’éåŒæœŸå‡¦ç†ã§ãã‚‹ã‚ˆã†Elixirã§å®Ÿè£…ã™ã‚‹</li>\n</ul>\n<h2 data-sourcepos=\"21:1-21:27\" id=\"2-1-0\" name=\"2-1-0\">\n<a class=\"anchor\" id=\"ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•\" name=\"%E3%83%96%E3%82%AF%E3%83%9E%E3%81%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95\" href=\"#%E3%83%96%E3%82%AF%E3%83%9E%E3%81%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•\"> &gt; ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•</span></a>ãƒ–ã‚¯ãƒã®ç®¡ç†æ–¹æ³•</h2>\n<p data-sourcepos=\"22:1-22:375\">ä¸‹è¨˜5ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹ã€æ§‹é€ ã¯ãƒãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã®ã¿ã€‚è¨˜äº‹ã‚’èª­ã¿ã™ã™ã‚ã‚‹ä¸­ã§æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ããŸã‚‰éƒ½åº¦ <code>feed.yaml</code> ã‚’æ›´æ–°ã™ã‚‹ã€‚ã¾ãŸã€è¨˜äº‹ã«ãƒã‚¤ã‚ºãŒå¤šã„ã‚ˆã†ã ã£ãŸã‚‰å‚¾å‘ã‚’åˆ†æã—ã¦é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ« <code>feed_excluded_link.yaml</code> <code>feed_excluded_title.yaml</code> ã‚’æ›´æ–°ã—ã¦ã‚‹ã€‚</p>\n<table data-sourcepos=\"24:1-30:115\">\n<thead>\n<tr data-sourcepos=\"24:1-24:90\">\n<th data-sourcepos=\"24:2-24:30\">item</th>\n<th data-sourcepos=\"24:32-24:89\">description</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"26:1-26:113\">\n<td data-sourcepos=\"26:2-26:30\"><code>feed.yaml</code></td>\n<td data-sourcepos=\"26:32-26:112\">ãƒ•ã‚£ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—åã«å¯¾ã™ã‚‹ãƒªãƒ³ã‚¯ã€ã‚¿ã‚°ã®ãƒãƒƒãƒ—</td>\n</tr>\n<tr data-sourcepos=\"27:1-27:106\">\n<td data-sourcepos=\"27:2-27:30\"><code>feed_excluded_link.yaml</code></td>\n<td data-sourcepos=\"27:32-27:105\">é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆ</td>\n</tr>\n<tr data-sourcepos=\"28:1-28:107\">\n<td data-sourcepos=\"28:2-28:30\"><code>feed_excluded_title.yaml</code></td>\n<td data-sourcepos=\"28:32-28:106\">é™¤å¤–ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒªã‚¹ãƒˆ</td>\n</tr>\n<tr data-sourcepos=\"29:1-29:118\">\n<td data-sourcepos=\"29:2-29:30\"><code>feed_corrected_link.yaml</code></td>\n<td data-sourcepos=\"29:32-29:117\">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ—</td>\n</tr>\n<tr data-sourcepos=\"30:1-30:115\">\n<td data-sourcepos=\"30:2-30:30\"><code>feed_redirected_link.yaml</code></td>\n<td data-sourcepos=\"30:32-30:114\">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒªãƒ³ã‚¯ã®ãƒãƒƒãƒ—</td>\n</tr>\n</tbody>\n</table>\n<div class=\"code-block\" data-sourcepos=\"32:1-59:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>yaml</div>\n<div class=\"highlight\"><pre class=\"highlight yaml\"><code><span class=\"c1\"># feed.yaml</span>\n<span class=\"s\">nabinno/sports/feed_group_name</span><span class=\"pi\">:</span>\n  <span class=\"na\">tags</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">ski</span>\n  <span class=\"na\">links</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">http://rss.example.com/ski_feed.rss</span>\n    <span class=\"pi\">-</span> <span class=\"s\">http://rss.example.com/snowboard_feed.rss</span>\n    <span class=\"pi\">-</span> <span class=\"s\">http://ski-status.example.com/rss</span>\n\n<span class=\"c1\"># feed_excluded_link.yaml</span>\n<span class=\"pi\">-</span> <span class=\"s\">anti-ski.example.com</span>\n<span class=\"pi\">-</span> <span class=\"s\">awesome-snowboard.example.com</span>\n\n<span class=\"c1\"># feed_excluded_title.yaml</span>\n<span class=\"pi\">-</span> <span class=\"s\">queer</span>\n<span class=\"pi\">-</span> <span class=\"s\">two-planker</span>\n<span class=\"pi\">-</span> <span class=\"s\">beaver-tail</span>\n\n<span class=\"c1\"># feed_corrected_link.yaml</span>\n<span class=\"s\">amazon.com</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"s\">ref</span>\n  <span class=\"pi\">-</span> <span class=\"s\">ie</span>\n\n<span class=\"c1\"># feed_redirected_link.yaml</span>\n<span class=\"s\">ski-status.example.com</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"s\">Floki.find(fst, \".post__body a\")</span>\n</code></pre></div>\n</div>\n<h2 data-sourcepos=\"61:1-61:33\" id=\"2-2-0\" name=\"2-2-0\">\n<a class=\"anchor\" id=\"Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†\" name=\"Elixir%E3%81%AB%E3%82%88%E3%82%8B%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86\" href=\"#Elixir%E3%81%AB%E3%82%88%E3%82%8B%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†\"> &gt; Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†</span></a>Elixirã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†</h2>\n<h3 data-sourcepos=\"62:1-62:27\" id=\"2-2-1\" name=\"2-2-1\">\n<a class=\"anchor\" id=\"ç›£è¦–æ©Ÿæ§‹ Supervisor\" name=\"%E7%9B%A3%E8%A6%96%E6%A9%9F%E6%A7%8B%20Supervisor\" href=\"#%E7%9B%A3%E8%A6%96%E6%A9%9F%E6%A7%8B%20Supervisor\" data-position=\"2-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ç›£è¦–æ©Ÿæ§‹ Supervisor\"> &gt; ç›£è¦–æ©Ÿæ§‹ Supervisor</span></a>ç›£è¦–æ©Ÿæ§‹ Supervisor</h3>\n<p data-sourcepos=\"64:1-64:414\">Elixirã«ã¯ç›£è¦–æ©Ÿæ§‹ãŒã‚ã‚Šã€ãã‚ŒãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç®¡ç†ã—ã¦ã„ã‚‹ã€‚ã“ã“ã§ã¯ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼ã¨ãƒ–ã‚¯ãƒã¯åˆ¥ã€…ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å‡¦ç†ã—ã¦ã„ã‚‹ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæš–æ°—å‡¦ç†ã‚’åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚å†èµ·å‹•æˆ¦ç•¥ã¯ã€Œå¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã«ã‚ã‚‹ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã€ï¼ˆ <code>one_for_all</code> ï¼‰ã«ã—ã¦ã‚ã‚‹ã€‚</p>\n<p data-sourcepos=\"66:1-66:194\">ä¸‹è¨˜ã®ã‚ˆã†ã« <code>Supervisor.start_link</code> ã‚’ <code>Keshikimi2.Application.start</code> ã«é©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆ <code>mix run</code> ï¼‰ã—ãŸæ™‚ç‚¹ã§ç›£è¦–æ©Ÿæ§‹ãŒèµ·å‹•ã•ã‚Œã‚‹ã€‚</p>\n<div class=\"code-block\" data-sourcepos=\"68:1-89:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>ex</div>\n<div class=\"highlight\"><pre class=\"highlight elixir\"><code><span class=\"no\">Supervisor</span><span class=\"o\">.</span><span class=\"n\">start_link</span><span class=\"p\">(</span>\n  <span class=\"p\">[</span>\n    <span class=\"ss\">:hackney_pool</span><span class=\"o\">.</span><span class=\"n\">child_spec</span><span class=\"p\">(</span><span class=\"ss\">:hatena_bookmark_pool</span><span class=\"p\">,</span> <span class=\"ss\">timeout:</span> <span class=\"mi\">15_000</span><span class=\"p\">,</span> <span class=\"ss\">max_connections:</span> <span class=\"mi\">100</span><span class=\"p\">),</span>\n    <span class=\"c1\"># @todo å½“è©²ãƒ¯ãƒ¼ã‚«ãƒ¼ã§æš–æ°—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„ã®ã§ `one_for_one` ã«ã—ãŸå ´åˆã€å†èµ·å‹•æ™‚ã«ã»ã‹ã«å½±éŸ¿ã™ã‚‹</span>\n    <span class=\"n\">supervisor</span><span class=\"p\">(</span><span class=\"no\">Cachex</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"ss\">:feed</span><span class=\"p\">,</span> <span class=\"p\">[]]),</span>\n    <span class=\"n\">supervisor</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Registry</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]),</span>\n\n    <span class=\"c1\"># ãƒ•ã‚£ãƒ¼ãƒ‰èª­è¾¼å‡¦ç† (PubSub)</span>\n    <span class=\"n\">supervisor</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Subscriber</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]),</span>\n    <span class=\"n\">worker</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Worker</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]),</span>\n    <span class=\"n\">worker</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2Feed</span><span class=\"o\">.</span><span class=\"no\">Publisher</span><span class=\"p\">,</span> <span class=\"p\">[[</span><span class=\"ss\">prefix:</span> <span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"ss\">poll_interval:</span> <span class=\"mi\">3_000</span><span class=\"p\">]]),</span>\n\n    <span class=\"c1\"># ãƒ–ã‚¯ãƒå‡¦ç†</span>\n    <span class=\"n\">worker</span><span class=\"p\">(</span><span class=\"no\">Keshikimi2</span><span class=\"o\">.</span><span class=\"no\">HatenaBookmark</span><span class=\"o\">.</span><span class=\"no\">AddEntry</span><span class=\"p\">,</span> <span class=\"p\">[</span>\n      <span class=\"p\">[</span><span class=\"ss\">prefix:</span> <span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"ss\">poll_interval:</span> <span class=\"mi\">3_000</span><span class=\"p\">]</span>\n    <span class=\"p\">])</span>\n  <span class=\"p\">],</span>\n  <span class=\"ss\">strategy:</span> <span class=\"ss\">:one_for_all</span><span class=\"p\">,</span>\n  <span class=\"ss\">name:</span> <span class=\"n\">name</span><span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">)</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n</div>\n<h3 data-sourcepos=\"91:1-91:37\" id=\"2-2-2\" name=\"2-2-2\">\n<a class=\"anchor\" id=\"éåŒæœŸå‡¦ç† Task.async_stream\" name=\"%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%20Task.async_stream\" href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%20Task.async_stream\" data-position=\"2-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"éåŒæœŸå‡¦ç† Task.async_stream\"> &gt; éåŒæœŸå‡¦ç† Task.async_stream</span></a>éåŒæœŸå‡¦ç† Task.async_stream</h3>\n<p data-sourcepos=\"93:1-93:429\">é…åˆ—ã‚’å¼•ãå›ã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯ <code>Task.async_stream</code> ãŒã†ã£ã¦ã¤ã‘ã§ã‚ã‚‹ã€‚ä¸‹è¨˜ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ–ã‚¯ãƒå¯¾è±¡ã«ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–ã‚Šå‡ºã—ã€é™¤å¤–å‡¦ç†ã€æ ¡æ­£å‡¦ç†ã‚’åŠ ãˆã¦ã€ãƒ–ã‚¯ãƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã¨ã„ã†æµã‚Œã‚’çµ„ã‚“ã§ã„ã‚‹ã€‚Elixirã§ã¯ã€æµã‚Œã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãéåŒæœŸå‡¦ç†ã—ã¦ãã“ã¨ãŒã§ãã‚‹ã€‚</p>\n<div class=\"code-block\" data-sourcepos=\"95:1-137:3\">\n<div class=\"code-filename\">\n<i class=\"fa fa-file-code-o\"></i>ex</div>\n<div class=\"highlight\"><pre class=\"highlight elixir\"><code><span class=\"no\">Cachex</span><span class=\"o\">.</span><span class=\"n\">keys!</span><span class=\"p\">(</span><span class=\"ss\">:feed</span><span class=\"p\">)</span>\n<span class=\"o\">|&gt;</span> <span class=\"no\">Enum</span><span class=\"o\">.</span><span class=\"n\">reject</span><span class=\"p\">(</span><span class=\"k\">fn</span> <span class=\"n\">key</span> <span class=\"o\">-&gt;</span>\n  <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"p\">[</span>\n    <span class=\"s2\">\"excluded_links\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"excluded_titles\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"corrected_links\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"redirected_links\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"feed_group\"</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"archived_links\"</span>\n  <span class=\"p\">]</span>\n<span class=\"k\">end</span><span class=\"p\">)</span>\n<span class=\"o\">|&gt;</span> <span class=\"no\">Task</span><span class=\"o\">.</span><span class=\"n\">async_stream</span><span class=\"p\">(</span>\n  <span class=\"k\">fn</span> <span class=\"n\">item_link</span> <span class=\"o\">-&gt;</span>\n    <span class=\"n\">with</span> <span class=\"p\">{</span><span class=\"ss\">:ok</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">item_title</span><span class=\"p\">,</span> <span class=\"n\">feed_tags</span><span class=\"p\">]}</span> <span class=\"o\">&lt;-</span> <span class=\"no\">Cachex</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"ss\">:feed</span><span class=\"p\">,</span> <span class=\"n\">item_link</span><span class=\"p\">),</span>\n         <span class=\"ss\">:ok</span> <span class=\"o\">&lt;-</span> <span class=\"n\">validate_all</span><span class=\"p\">(</span><span class=\"n\">item_link</span><span class=\"p\">,</span> <span class=\"n\">item_title</span><span class=\"p\">),</span>\n         <span class=\"n\">corrected_link</span> <span class=\"o\">&lt;-</span> <span class=\"n\">correct_all</span><span class=\"p\">(</span><span class=\"n\">item_link</span><span class=\"p\">),</span>\n         <span class=\"p\">{</span><span class=\"ss\">:ok</span><span class=\"p\">,</span> <span class=\"n\">payload</span><span class=\"p\">}</span> <span class=\"o\">&lt;-</span>\n           <span class=\"no\">FormData</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n             <span class=\"p\">%{</span>\n               <span class=\"ss\">url:</span> <span class=\"n\">corrected_link</span><span class=\"p\">,</span>\n               <span class=\"ss\">comment:</span> <span class=\"n\">feed_tags</span> <span class=\"o\">|&gt;</span> <span class=\"no\">Enum</span><span class=\"o\">.</span><span class=\"n\">map_join</span><span class=\"p\">(</span><span class=\"k\">fn</span> <span class=\"n\">tag</span> <span class=\"o\">-&gt;</span> <span class=\"s2\">\"[</span><span class=\"si\">#{</span><span class=\"n\">tag</span><span class=\"si\">}</span><span class=\"s2\">]\"</span> <span class=\"k\">end</span><span class=\"p\">),</span>\n               <span class=\"ss\">rks:</span> <span class=\"no\">System</span><span class=\"o\">.</span><span class=\"n\">get_env</span><span class=\"p\">(</span><span class=\"s2\">\"HATENA_BOOKMARK_RKS\"</span><span class=\"p\">),</span>\n               <span class=\"ss\">private:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n               <span class=\"ss\">keep_original_url:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n               <span class=\"ss\">with_status_op:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n               <span class=\"ss\">from:</span> <span class=\"s2\">\"inplace\"</span><span class=\"p\">,</span>\n               <span class=\"ss\">post_twitter:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n               <span class=\"ss\">post_evernote:</span> <span class=\"mi\">0</span>\n             <span class=\"p\">},</span>\n             <span class=\"ss\">:url_encoded</span><span class=\"p\">,</span>\n             <span class=\"ss\">get:</span> <span class=\"no\">false</span>\n           <span class=\"p\">)</span> <span class=\"k\">do</span>\n      <span class=\"n\">do_add_entries_to_hb</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"p\">)</span>\n      <span class=\"no\">Logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">\"add entry: </span><span class=\"si\">#{</span><span class=\"n\">item_link</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n\n    <span class=\"n\">archive_link</span><span class=\"p\">(</span><span class=\"n\">item_link</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span><span class=\"p\">,</span>\n  <span class=\"ss\">timeout:</span> <span class=\"mi\">15_000</span>\n<span class=\"p\">)</span>\n<span class=\"o\">|&gt;</span> <span class=\"no\">Stream</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span>\n</code></pre></div>\n</div>\n<h1 data-sourcepos=\"139:1-139:8\" id=\"3-0-0\" name=\"3-0-0\">\n<a class=\"anchor\" id=\"WRAPUP\" name=\"WRAPUP\" href=\"#WRAPUP\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"WRAPUP\"> &gt; WRAPUP</span></a>WRAPUP</h1>\n<h2 data-sourcepos=\"140:1-140:57\" id=\"3-1-0\" name=\"3-1-0\">\n<a class=\"anchor\" id=\"ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹\" name=\"%E3%81%93%E3%82%8C%E3%81%8B%E3%82%89%E3%81%AE%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%83%E3%82%AF%E3%83%9E%E3%83%BC%E3%82%AF%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\" href=\"#%E3%81%93%E3%82%8C%E3%81%8B%E3%82%89%E3%81%AE%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%83%E3%82%AF%E3%83%9E%E3%83%BC%E3%82%AF%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹\"> &gt; ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹</span></a>ã“ã‚Œã‹ã‚‰ã®ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä½¿ã„æ–¹</h2>\n<ul data-sourcepos=\"142:1-144:197\">\n<li data-sourcepos=\"142:1-142:65\">\n<strong>æ‰‹å‹•ã§ãƒ–ã‚¯ãƒ:</strong> æ°—ã«ãªã£ãŸè¨˜äº‹ãŒã‚ã‚‹ã”ã¨ã«</li>\n<li data-sourcepos=\"143:1-144:197\">\n<strong>ãƒ–ã‚¯ãƒã®ç¢ºèª:</strong> æ°—ã«ãªã‚‹ã‚¿ã‚°ã”ã¨ã«ã¾ã¨ã‚ã¦ç¢ºèª\n<ul data-sourcepos=\"144:5-144:197\">\n<li data-sourcepos=\"144:5-144:197\">ãŸã¨ãˆã°ã€CIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹é–“ã«æœ€è¿‘ã®GitHubã®å‹•å‘ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€Œ<a href=\"http://b.hatena.ne.jp/nabinno/github\" target=\"_blank\" rel=\"noopener noreferrer\">nabinno/github</a>ã€ã‚’ã¿ã‚‹ã€ã¨ã„ã†æ„Ÿã˜ã€‚</li>\n</ul>\n</li>\n</ul>\n","tags":["elixir","hatena-bookmark"],"updated_at":"2021-01-11T12:45:08+09:00","childPublishedDate":{"published_on":"2019-01-01T00:00:00.000Z"},"updated_by":{"name":"ãªã³ã®ğŸ‘·","screen_name":"nabinno","icon":"https://img.esa.io/uploads/production/members/94286/icon/thumb_m_ef5f024307008aa399b91f87fa5f64e8.jpg"}},"relatedPosts":{"edges":[{"node":{"number":63,"relative_category":"blog/frontend","fields":{"title":"ã‚¤ã‚±ã¦ã‚‹ã—ãƒ¤ãƒã„è¨€èªREBOLã®å¾Œç¶™Redã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚’ã¤ãã£ãŸè©±","excerpt":"Redã¨ã„ã†è¨€èªã¯ã”å­˜ã˜ã§ã—ã‚‡ã†ã‹ã€‚ä¸€åº¦è§¦ã£ãŸã‚‰ç™–ã«ãªã‚‹æ‰‹è§¦ã‚Šã§ä¸€ç›®è¦‹ã¦è™œã«ãªã‚Šã¾ã—ãŸã€‚æ–°å¹´æ—©ã€…ã®æ‹ã«ãªã‚Šã¾ã™ã€‚   > PROBLEMPROBLEM \n\n- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚’ã¤ãã‚‹ã«ã‚ãŸã‚Š é‡ãŸã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå¤šã„ æ±ç”¨çš„ãªè¨€èªã‚’ã¤ã‹ã£ã¦ã‚‹ã‚‚ã®ãŒå¤šãã€ãã®ãŸã‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ç­‰ã®ä¾å­˜é–¢ä¿‚ãŒå¤šããªã‚Šã‚„ã™ã„ \n- é‡ãŸã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå¤šã„\n- æ±ç”¨çš„ãªè¨€èªã‚’ã¤ã‹ã£ã¦ã‚‹ã‚‚ã®ãŒå¤šãã€ãã®ãŸã‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ç­‰ã®ä¾å­˜é–¢ä¿‚ãŒå¤šããªã‚Šã‚„ã™ã„   > SOLUTIONSOLUTION \n\nã¨ã„ã†ã‚ã‘ã§ã€å¹´æ˜ã‘è¦‹ã¤ã‘ãŸRedãŒã‚·ãƒ³ãƒ—ãƒ«ã ã£ãŸã®ã§ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚é¡Œæã¯ä»¥å‰ã¤ãã£ãŸEmacsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€Œesa.elã€ã®ç§»æ¤ã§ã™ã€‚ \n\n- https://github.com/nabinno/esa.red   > ã‚„ã£ãŸã“ã¨ã‚„ã£ãŸã“ã¨   > ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ \n\næ§‹æ–‡ãŒã™ãªãŠãªã®ã§ç‰¹ã«ã‚¨ãƒ‡ã‚£ã‚¿ã¯é–¢ä¿‚ãªã•ãã†ã§ã—ãŸãŒã€æ…£ã‚Œè¦ªã—ã‚“ã§ã‚‹Emacsã«ã€ŒSkrylar/red.elã€ã‚’é©ç”¨ã—ã¾ã—ãŸã€‚ãã®éš›ã€ red-font-lock-keywords ã¨ red-indent-line ã«è¶³ã‚Šãªã„ç®‡æ‰€ãŒã‚ã£ãŸã®ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¾ã—ãŸã€‚   > ç³–è¡£æ§‹æ–‡ã®é©ç”¨ç³–è¡£æ§‹æ–‡ã®é©ç”¨ \n\nRedã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³REPLãŒã¤ã‹ãˆã‚‹ã®ã§ã€doc.red-lang.orgã¨red-by-example.orgã‚’ã¿ãªãŒã‚‰ã²ã¨ã¤ã²ã¨ã¤æŒ™å‹•ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãã®ä¸­ã§ã©ã†ã—ã¦ã‚‚æ…£ã‚Œãªã„è¡¨ç¾ãŒ2ã¤ã‚ã£ãŸã®ã§ç³–è¡£æ§‹æ–‡ã‚’å®Ÿè£…ï¼ˆnabinno/red-elixirï¼‰ã€‚ \n\n1. compose \n\nãƒ–ãƒ­ãƒƒã‚¯å†…ã®å¤‰æ•°ã‚’è©•ä¾¡ã—ãƒ–ãƒ­ãƒƒã‚¯ã¨ã—ã¦è¿”ã™é–¢æ•° compose ã¯ã€VIDã®ãƒ•ã‚§ã‚¤ã‚¹æ›´æ–°ã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚HTML/JavaScripã§ã„ã†ã¨ã“ã‚DOMæ›´æ–°ã«ã‚ãŸã‚‹ã‚‚ã®ã¨ã„ãˆã°åˆ†ã‹ã‚‹ã§ã—ã‚‡ã†ã‹ã€‚é »ç¹ã«ã€Œ compose [foo (bar)] ã€ã®ã‚ˆã†ãªè¡¨ç¾ãŒã¤ã¥ãã¨ã»ã‹ã®å¤‰æ•°ã‚„é–¢æ•°ã¨ã¾ã–ã‚Šå¯èª­æ€§ãŒãŠã¡ã‚‹ã®ã§ã€Elixirã®ã‚·ã‚¸ãƒ«ã‚’å‚è€ƒã« compose é–¢æ•°ã‚’çœç•¥ã—ã¾ã—ãŸã€‚ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚ \n\n;-- before compose [foo (bar)] ;-- after ~c[foo (bar)]  \n\n2. é–¢æ•°ã®å…¥ã‚Œå­ \n\nç´ ã®Redã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãƒ¼æ§‹æ–‡ãªã®ã§ã€é–¢æ•°ã®å…¥ã‚Œå­ã«ã‚ˆã‚‹å¯èª­æ€§ä½ä¸‹ã‚’ãŠã•ãˆã‚‹ãŸã‚å¤‰æ•°å®šç¾©ã‚’ã‚ˆãä½¿ã„ã¾ã™ã€‚å€‹äººçš„ã«ã¯å¤‰æ•°ã¯æ„å‘³ã®ã‚ã‚‹ã‚‚ã®ã ã‘ä½¿ã„ãŸã„æ´¾ãªã®ã§ã€ãƒ‘ã‚¤ãƒ—ã‚’å°å…¥ã—ã¾ã—ãŸã€‚ã¨ã„ã£ã¦ã‚‚ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å ´åˆã€ãƒ‡ãƒ¼ã‚¿åŠ å·¥ã¯ã‚ã¾ã‚Šã‚„ã‚‰ãªã„ã®ã§ã¤ã‹ã†ã‚±ãƒ¼ã‚¹ã¯ã»ã¼ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ã£ã¦ã‚‚ã“ã®ãã‚‰ã„ã§ã™ã€‚   red \n\n;-- before rejoin collect [ foreach d data [ keep rejoin [d \" \"] ] ] ;-- after data .[ |> Series/map 'd [rejoin [d \" \"]] |> rejoin ]     > ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã®ç”¨æ„ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã®ç”¨æ„ \n\nä»Šå›ã¯ä¸Šã§å®Ÿè£…ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€Œred-elixirã€ã®ã»ã‹ã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»JSONãƒ‘ãƒ¼ã‚µãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯git submodulesã§è‰¯ã„ã§ã™ãŒã€å‘¼ã³å‡ºã—ã‚‚è€ƒãˆã‚‹ã¨å®Ÿè£…ãŒå†—é•·çš„ã«ãªã‚‹ã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã¨ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ã‚ã‚ã›ã¦ç”¨æ„ã—ã¾ã—ãŸï¼ˆnabinno/hotã€nabinno/modsï¼‰ã€‚ \n\nã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‹ã‚‰å‘¼ã³å‡ºã—ã¾ã§ã®æµã‚Œ \n\nRedã¯Goã¨ãŠãªã˜ããƒ¯ãƒ³ãƒã‚¤ãƒŠãƒªãƒ¼ãªã®ã§ã€wgetã‚„curlã ã‘ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã™ã€‚   sh \n\n> mkdir -p ~/.local/bin > wget https://github.com/nabinno/hot/releases/download/0.0.3/hot-linux -O ~/.local/bin/hot > chmod 744 ~/.local/bin/hot   \n\nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã¯Elixirã®mixã‚’å‚è€ƒã«ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ç®¡ç†ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«å®šç¾©ã—ã¾ã™ã€‚   sh \n\n> hot cmd/install https://raw.githubusercontent.com/nabinno/mods/master/mods.red > cat hots.red Red [] hots: context [ mods: [ red-elixir #(init: %init.red git: https://github.com/nabinno/red-elixir) json #(init: %json.red git: https://github.com/rebolek/red-tools) http-tools #(init: %http-tools.red git: https://github.com/rebolek/red-tools) ] ] > hot mods/get   \n\nãƒ“ãƒ«ãƒ‰æ™‚ã¯ #include ã‚’ã¤ã‹ã†ã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å‘¼ã³å‡ºã—æ©Ÿèƒ½ã¯ä½¿ãˆãªã„ã§ã™ãŒã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³REPLã§æŒ™å‹•ç¢ºèªã—ã¦ã„ã‚‹éš›ã¯ do/args %require ã‚’ä½¿ã„ã¾ã™ã€‚   sh \n\n> red >> do/args %require [red-elixir] >> 1 .. 10 .[ |> Series/map 'i [i * 2] |> Series/map 'i [i + 1] ] == [3 5 7 9 11 13 15 17 19 21]     > WRAPUPWRAPUP \n\nã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚’ä½œã‚‹ä¸­ã§æ„Ÿã˜ãŸã“ã¨ã¯ã€ã“ã®1ç‚¹ã§ã™ã€‚Redã¯æ—¢å­˜ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨æ¯”ã¹ã‚‹ã¨ã¾ã ã¾ã æ©Ÿèƒ½ä¸è¶³æ„ŸãŒæ‹­ãˆã¾ã›ã‚“ãŒã€ãã‚Œã‚’è£œãˆã‚‹ã ã‘ã®è¡¨ç¾åŠ›ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚æ‰‹è§¦ã‚ŠãŒæœ¬å½“ã«è‰¯ã„è¨€èªã§ã—ãŸã€‚"},"name":"[2019-03-31]ã‚¤ã‚±ã¦ã‚‹ã—ãƒ¤ãƒã„è¨€èªREBOLã®å¾Œç¶™Redã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚’ã¤ãã£ãŸè©±","tags":["red","esa"],"childPublishedDate":{"published_on":"2019-03-31T00:00:00.000Z","published_on_unix":1553990400}}},{"node":{"number":61,"relative_category":"blog/health","fields":{"title":"Elixirã¨Raspberry Piã§PM2.5ãªã©ã®ç’°å¢ƒãƒ‡ãƒ¼ã‚¿ã‚’å®šç‚¹è¦³å¯Ÿã—ã€ç›®ãƒ»å–‰ã®ç—›ã¿ã«å‚™ãˆã‚‹","excerpt":"çš†ã•ã‚“ã¯ä½“èª¿ç®¡ç†ã©ã†ã•ã‚Œã¦ã„ã¾ã™ã‹? ä¸€åº¦ç—›ã„ç›®ã«é­ã†ã¨æ—¥å¸¸ã®ç´°ã‹ã„å·®ç•°ãŒæ°—ã«ãªã£ã¦ãã¦ã€ãã“ã‚’ã©ã†ã«ã‹è§£æ±ºã—ãŸã„ã¨ã„ã†ã®ãŒäººæƒ…ã§ã™ã€‚ä»Šå›ã¯è‡ªåˆ†ã®å’½é ­ç—›ã®è§£æ¶ˆã®ãŸã‚ä¸€ã¤å®Ÿé¨“ã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚   > PROBLEMPROBLEM \n\n- ä»¥å‰ã‹ã‚‰ã‚ªãƒ•ã‚£ã‚¹ã«è¡Œãã¨ç›®ã‚„å–‰ãŒç—›ããªã‚‹ã“ã¨ãŒã‚ã£ãŸã®ã§ã€è‡ªåˆ†ã®ä½“èª¿ãªã®ã‹ç’°å¢ƒãªã®ã‹åŸå› ã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ãŸã‚ã«æ±šæŸ“è¨ˆæ¸¬å™¨ã€ŒDienmern DM106Aã€ã‚’è³¼å…¥ ãŸã ã€DM106Aã®è¨ˆæ¸¬ã¯ãã®æ™‚ãã®æ™‚ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãªã®ã§å‚¾å‘ã‚’èª­ã¿è§£ãã¥ã‚‰ã„ã€ã¾ãŸã€éƒ½åº¦å®Ÿæ–½ã™ã‚‹æ‰‹é–“ãŒã‹ã‹ã‚‹ \n- ãŸã ã€DM106Aã®è¨ˆæ¸¬ã¯ãã®æ™‚ãã®æ™‚ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãªã®ã§å‚¾å‘ã‚’èª­ã¿è§£ãã¥ã‚‰ã„ã€ã¾ãŸã€éƒ½åº¦å®Ÿæ–½ã™ã‚‹æ‰‹é–“ãŒã‹ã‹ã‚‹   > SOLUTIONSOLUTION \n\nã¨ã„ã†ã‚ã‘ã§ã€DM106Aã®ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’Raspberry Piã§å®šæœŸå–å¾—ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚è¨­ç½®æ–¹æ³•ã®è©³ç´°ã¯GitHubãƒ¬ãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ãã ã•ã„ã€‚ä¸‹è¨˜ã€å®Ÿè£…æ¦‚è¦ã«ãªã‚Šã¾ã™ã€‚   > é›»å­éƒ¨å“ã®æ§‹æˆé›»å­éƒ¨å“ã®æ§‹æˆ    item description     Raspberry Pi 3 Model B+    Aosong DHT11 æ°—æ¸©ãƒ»æ¹¿åº¦ã‚»ãƒ³ã‚µãƒ¼ã€GPIO   Nova SDS021 PM2.5ãƒ»PM10ã‚»ãƒ³ã‚µãƒ¼ã€UART   ams CCS811 TVOCãƒ»CO2eã‚»ãƒ³ã‚µãƒ¼ã€I2C    \n\nã¾ãšã€é›»å­å·¥ä½œã¯ç´ äººã‚†ãˆã©ã®ã‚»ãƒ³ã‚µãƒ¼ã‚’è²·ãˆã°ã„ã„ã‹åˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§DM106Aã‚’åˆ†è§£ã—ã¦å„ã‚»ãƒ³ã‚µãƒ¼ã®å‹ç•ªã‚’èª¿ã¹ã¾ã—ãŸã€‚DHT011ã€SDS021ã¯DM106Aã¨ãŠãªã˜ã‚»ãƒ³ã‚µãƒ¼ã€HCHOã‚»ãƒ³ã‚µãƒ¼ã¯ä¿¡é ¼æ€§ãŒã‚ã‚Šæ‰‹ã”ã‚ãªã®ãŒã†ã¾ãè¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚TVOCã‚»ãƒ³ã‚µãƒ¼ã¯AdafruitãŒæ¨ã—ã¦ã„ã‚‹CCS811ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚   > ã‚³ãƒ¼ãƒ‰ã®æ§‹æˆã‚³ãƒ¼ãƒ‰ã®æ§‹æˆ    item description     AirElixir.Application ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†   AirElixir.GoogleSpreadsheets ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²   AirElixirSensor.Publisher ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ç™ºè¡Œãƒ»é€ä¿¡   AirElixirSensor.Subscriber ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿è³¼èª­ãƒ»å—ä¿¡    \n\næ¬¡ã«ã€åŸºæœ¬æ§‹æˆã¯GrovePiã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚ç™ºè¡Œå‡¦ç†ã¯Elixirã§ã†ã¾ãã„ã‹ãªã„ã‚±ãƒ¼ã‚¹ãŒã‚ã£ãŸã®ã§ã¾ãšã¯Python/ErlPortã§è¡Œã„ã¾ã—ãŸã€‚å¾Œã€…Elixirã«ç§»è¡Œã§ãã‚‹ã‚ˆã†ã«ãƒã‚¯ãƒ­ã«ã—ã¾ã—ãŸã€‚   > 5æ—¥ã»ã©ç¨¼åƒã—ã¦ã‚ã‹ã£ãŸã“ã¨ãƒ»è¦‹ç«‹ã¦ã€ä»Šå¾Œã®èª²é¡Œ5æ—¥ã»ã©ç¨¼åƒã—ã¦ã‚ã‹ã£ãŸã“ã¨ãƒ»è¦‹ç«‹ã¦ã€ä»Šå¾Œã®èª²é¡Œ  \n\næœ€å¾Œã«ã€åˆ†ã‹ã£ãŸã“ã¨ã€è¦‹ç«‹ã¦ã§ã™ãŒã€3ç‚¹ã‚ã‚Šã¾ã™ã€‚2ç•ªç›®ã«é–¢ã—ã¦ã¯äºˆæƒ³é€šã‚Šã ã£ãŸã®ã§ã™ãŒã€1ç•ªç›®ã€3ç•ªç›®ã«é–¢ã—ã¦ã¯æ„å¤–ã§ã‚ã‚Šã€ç–‘ã‚Šæ·±ã„ç§ã¨ã—ã¦ã¯ç‰¹ã«ç©ºæ°—æ¸…æµ„æ©ŸãŒãã¡ã‚“ã¨æ©Ÿèƒ½ã—ã¦ã„ãŸã“ã¨ã«é©šãã¾ã—ãŸã€‚ \n\n1. ã‚ªãƒ•ã‚£ã‚¹ã®ç©ºæ°—æ¸…æµ„æ©Ÿã€ŒHitachi EP-LVG110ã€ã¯PMã‚’ãã¡ã‚“ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã—ã¦ã„ãŸ ãŸã ã—ã€ç©ºæ°—æ¸…æµ„æ©Ÿã¯TVOCã«ã¯åŠ¹æœãŒãªãã€ã“ã‚Œã¯Troiaæ°ã‚„åŠ è—¤æ°ãƒ»è‹…éƒ¨æ°ã®è€ƒå¯Ÿã§ã‚‚è¨€åŠã•ã‚Œã¦ã„ã‚‹ \n2. ãŸã ã—ã€ç©ºæ°—æ¸…æµ„æ©Ÿã¯TVOCã«ã¯åŠ¹æœãŒãªãã€ã“ã‚Œã¯Troiaæ°ã‚„åŠ è—¤æ°ãƒ»è‹…éƒ¨æ°ã®è€ƒå¯Ÿã§ã‚‚è¨€åŠã•ã‚Œã¦ã„ã‚‹\n3. äººã®å…¥ã‚ŠãŒå¤šã„æ™‚é–“å¸¯ã«ç©ºæ°—ï¼ˆTVOCã‚„CO2eï¼‰ãŒæ±šã‚Œã‚‹ äººãŒã€Œå‡ºã‚‹ã€æ™‚ã‚ˆã‚Šã‚‚ã€Œå…¥ã‚‹ã€éš›ã«æ¿ƒåº¦ãŒã‚ãŒã‚‹ã®ã¯ã€å¤–ã®VOCãŒæœãªã©ã«ä»˜ç€ã—ã¦ã„ã‚‹ãŸã‚ã¨æ¨å¯Ÿ \n4. äººãŒã€Œå‡ºã‚‹ã€æ™‚ã‚ˆã‚Šã‚‚ã€Œå…¥ã‚‹ã€éš›ã«æ¿ƒåº¦ãŒã‚ãŒã‚‹ã®ã¯ã€å¤–ã®VOCãŒæœãªã©ã«ä»˜ç€ã—ã¦ã„ã‚‹ãŸã‚ã¨æ¨å¯Ÿ\n5. TVOCã‚„CO2eã¯PMã®ã†ã”ãã«é€£å‹•ã—ã¦ã„ã‚‹ï¼ˆã‹ã‚‚ï¼‰ ãƒãƒ£ãƒ¼ãƒˆä¸Šã¯EP-LVG110ãŒPMé™¤å»ã—ã¦ã„ã‚‹ãŸã‚ã‚ã‹ã‚‰ãªã„ãŒã€æ—¥æœ¬æ°—è±¡å”ä¼šã®PM2.5åˆ†å¸ƒäºˆæ¸¬ã«ç…§ã‚‰ã—ã¦ã¿ã‚‹ã¨PMæ¿ƒåº¦ãŒé«˜ã„æ—¥ã«TVOCæ¿ƒåº¦ãŒã‚ãŒã£ã¦ã„ãŸ TODO: PMãŒVOCã‚’é‹ã‚“ã§ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€IQAirãªã©ã®APIã‹ã‚‰å‘¨è¾ºç’°å¢ƒã®PMãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ã—ãŸã„ã¨ã“ã‚ \n6. ãƒãƒ£ãƒ¼ãƒˆä¸Šã¯EP-LVG110ãŒPMé™¤å»ã—ã¦ã„ã‚‹ãŸã‚ã‚ã‹ã‚‰ãªã„ãŒã€æ—¥æœ¬æ°—è±¡å”ä¼šã®PM2.5åˆ†å¸ƒäºˆæ¸¬ã«ç…§ã‚‰ã—ã¦ã¿ã‚‹ã¨PMæ¿ƒåº¦ãŒé«˜ã„æ—¥ã«TVOCæ¿ƒåº¦ãŒã‚ãŒã£ã¦ã„ãŸ TODO: PMãŒVOCã‚’é‹ã‚“ã§ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€IQAirãªã©ã®APIã‹ã‚‰å‘¨è¾ºç’°å¢ƒã®PMãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ã—ãŸã„ã¨ã“ã‚ \n7. TODO: PMãŒVOCã‚’é‹ã‚“ã§ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€IQAirãªã©ã®APIã‹ã‚‰å‘¨è¾ºç’°å¢ƒã®PMãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ã—ãŸã„ã¨ã“ã‚ \n\nèª²é¡Œã¨ã—ã¦ã¯ãã®æ€§è³ªã‹ã‚‰ã—ã¦ä»•æ–¹ãªã„ã®ã§ã™ãŒTVOCã®å¤‰å‹•ãŒå¤§ãã™ãã¦è§£èª­ã‚’é›£ã—ã‹ã£ãŸã§ã™ã€‚è¨ˆæ¸¬æ–¹æ³•ç­‰ã‚’å†åº¦è¦‹ç›´ã™å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚ \n\n- TVOCã®å¤‰å‹•ãŒå¤§ãã™ãã‚‹ ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ»å‡ºåŠ›ã‚’20åˆ†ã”ã¨ã‹ã‚‰ãƒãƒ¼ãƒªãƒ³ã‚°3ç§’ã”ã¨ãƒ»å‡ºåŠ›20åˆ†ã”ã¨ã«å¤‰æ›´ã—ãŸã€å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã¯20åˆ†ã®å¹³å‡ \n- ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ»å‡ºåŠ›ã‚’20åˆ†ã”ã¨ã‹ã‚‰ãƒãƒ¼ãƒªãƒ³ã‚°3ç§’ã”ã¨ãƒ»å‡ºåŠ›20åˆ†ã”ã¨ã«å¤‰æ›´ã—ãŸã€å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã¯20åˆ†ã®å¹³å‡\n- TVOCã®ã‚¹ãƒ‘ã‚¤ã‚¯ã‚’æŠ‘ãˆãŸã„ TODO: ãƒ•ã‚¡ã‚¤ãƒˆãƒ¬ãƒ¡ãƒ‡ã‚£ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹åŠ¹æœã‚’è¦‹ã¦ã„ããŸã„ã¨ã“ã‚ \n- TODO: ãƒ•ã‚¡ã‚¤ãƒˆãƒ¬ãƒ¡ãƒ‡ã‚£ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹åŠ¹æœã‚’è¦‹ã¦ã„ããŸã„ã¨ã“ã‚   > WRAPUPWRAPUP \n\nä»Šå›ã®å®Ÿé¨“ã¯ã“ã‚ŒãŒè¨€ã„ãŸã‹ã£ãŸã ã‘ã¨ã„ã†æŒ‡æ‘˜ã‚’ã•ã‚Œã‚‹ã¨ãã†ã®éŸ³ã‚‚å‡ºã¾ã›ã‚“ãŒã€ã¯ã£ãã‚Šè¨€ã‚ã›ã¦ãã ã•ã„ã€‚ãã†ã€Elixirã¯å¥åº·ç®¡ç†ã«å‘ã„ã¦ã„ã¾ã™ã€‚   txt \n\nã€Œãªã‚“ã‹ä½“èª¿ãŒã™ãã‚Œãªã„ãªã‚...ã€ ã€ŒElixirã¡ã‚‡ã†ã ã„!ã€   \n\nã¨ã„ã†æ„Ÿã˜ã§ã™ã€ã¯ã„ã€‚"},"name":"[2018-12-22]Elixirã¨Raspberry Piã§PM2.5ãªã©ã®ç’°å¢ƒãƒ‡ãƒ¼ã‚¿ã‚’å®šç‚¹è¦³å¯Ÿã—ã€ç›®ãƒ»å–‰ã®ç—›ã¿ã«å‚™ãˆã‚‹","tags":["elixir","raspberry-pi","particulates","physiology"],"childPublishedDate":{"published_on":"2018-12-22T00:00:00.000Z","published_on_unix":1545436800}}},{"node":{"number":64,"relative_category":"blog/backend","fields":{"title":"WSL2æ™‚ä»£ã®Dockeré–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«","excerpt":"6æœˆ13æ—¥ã¯ç‹‚å–œä¹±èˆã—ã¾ã—ãŸã€ä¹…ã—ã¶ã‚Šã«å¾¹å¤œã™ã‚‹ãã‚‰ã„èˆˆå¥®ã—ã¾ã—ãŸã€‚ãã†ã€WSL2ãŒå‡ºãŸã®ã§ã™ã‚ˆã­ã€‚å…ˆæ—¥ã‚„ã£ã¨ç§ã®æ‰‹å…ƒã«å±Šã„ãŸã®ã§æ—©ã€…ã«æ¤œè¨¼ã—ã¾ã—ãŸã€‚   > PROBLEMPROBLEM \n\n- ã‚ãŸã‚‰ã—ãã§ãŸWSL2ã«ã‚ˆã£ã¦ä»¥å‰æ›¸ã„ãŸè¨˜äº‹ã‹ã‚‰ã ã„ã¶çŠ¶æ³ãŒå¤‰ã‚ã£ãŸ ä¸»ãªå¤‰æ›´ç‚¹ WSLã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒ2ç¨®é¡ã«ãªã‚Šã€WSLã¯ãã®2ã¤ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã«å¤‰ã‚ã£ãŸ WSL1 Windows Subsystem for Linuxä¸Šã®Linux (LXCore/Lxss) WSL2 è»½é‡Hyper-Vä¸Šã®Linux (Linux Kernel) /procã‚„/sysãªã©ã®ç‰¹æ®Šãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãµãã‚ãŸå…±æœ‰ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€Œ9Pã€ãŒå®Ÿè£…ã•ã‚ŒãŸ Win32å´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ 9prdr.sys WSLå´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ /init \n- ä¸»ãªå¤‰æ›´ç‚¹ WSLã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒ2ç¨®é¡ã«ãªã‚Šã€WSLã¯ãã®2ã¤ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã«å¤‰ã‚ã£ãŸ WSL1 Windows Subsystem for Linuxä¸Šã®Linux (LXCore/Lxss) WSL2 è»½é‡Hyper-Vä¸Šã®Linux (Linux Kernel) /procã‚„/sysãªã©ã®ç‰¹æ®Šãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãµãã‚ãŸå…±æœ‰ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€Œ9Pã€ãŒå®Ÿè£…ã•ã‚ŒãŸ Win32å´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ 9prdr.sys WSLå´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ /init \n- WSLã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒ2ç¨®é¡ã«ãªã‚Šã€WSLã¯ãã®2ã¤ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã«å¤‰ã‚ã£ãŸ WSL1 Windows Subsystem for Linuxä¸Šã®Linux (LXCore/Lxss) WSL2 è»½é‡Hyper-Vä¸Šã®Linux (Linux Kernel) \n- WSL1 Windows Subsystem for Linuxä¸Šã®Linux (LXCore/Lxss)\n- WSL2 è»½é‡Hyper-Vä¸Šã®Linux (Linux Kernel)\n- /procã‚„/sysãªã©ã®ç‰¹æ®Šãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãµãã‚ãŸå…±æœ‰ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€Œ9Pã€ãŒå®Ÿè£…ã•ã‚ŒãŸ Win32å´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ 9prdr.sys WSLå´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ /init \n- Win32å´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ 9prdr.sys \n- WSLå´ã®9Pã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ /init    > SOLUTIONSOLUTION \n\nã¨ã„ã†ã‚ã‘ã§ã€å‰è¨˜äº‹ã§æ²ã’ã¦ã„ãŸç›®æ¨™ã€ŒWSLã§Dockerã‚’ã¤ã‹ã£ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒã§ãã‚‹ã‹ã©ã†ã‹ã€ã«ã¤ã„ã¦å†ç¢ºèªã—ã¾ã™ã€‚   > å¯¾è±¡ç’°å¢ƒå¯¾è±¡ç’°å¢ƒ \n\n- Windows 10 Pro Version 1903 OS Build 18922.1000 Windows Terminal (Preview) Version 0.2.1715.0 WSL2 Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard) Docker version 19.03.0-rc3, build 27fcb77 WSL1 Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft) \n- Windows Terminal (Preview) Version 0.2.1715.0\n- WSL2 Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard) Docker version 19.03.0-rc3, build 27fcb77 \n- Ubuntu Version 1804.2019.5210 (Linux 4.19.43-microsoft-standard)\n- Docker version 19.03.0-rc3, build 27fcb77\n- WSL1 Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft) \n- Ubuntu 18.04 LTS Version 1804.2019.522.0 (Linux 4.4.0-18922-Microsoft)   > Windowsã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹Windowsã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ \n\nã¾ãšã€Windowsã®é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã§ã™ãŒã€æ—¢çŸ¥ã®æƒ…å ±ã‚’ãµã¾ãˆã¤ã¤TIPSã‚’é †æ¬¡ç´¹ä»‹ã—ã¾ã™ã€‚   > WSLã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«WSLã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« \n\n- WSL2ã‚’ä½¿ã£ã¦ã¿ã‚‹ (InsiderPreview) \n\nWSLã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã¯ä¸‹è¨˜2ã¤ã‚’æŠ¼ã•ãˆã¦ãŠã‘ã°å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚ \n\n1. asdf/anyenv ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«ã‚ã‘ã¦ä½¿ã„ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’ã¤ã‹ã„ã¾ã—ã‚‡ã† é–¢æ•°è¨€èªç•Œéšˆã§ã¯asdfãŒä¸»æµã«ãªã£ã¦ãã¦ã‚‹ã‚ˆã†ã§ã™ã€‚ \n2. ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«ã‚ã‘ã¦ä½¿ã„ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’ã¤ã‹ã„ã¾ã—ã‚‡ã†\n3. é–¢æ•°è¨€èªç•Œéšˆã§ã¯asdfãŒä¸»æµã«ãªã£ã¦ãã¦ã‚‹ã‚ˆã†ã§ã™ã€‚\n4. nix Haskellã®ã‚ˆã†ã«asdf/anyenvã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„ã€ã‚ã‚‹ã„ã¯ã€æ‰±ã‚ã‚Œã„ãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯nixã‚’ã¤ã‹ã„ã¾ã—ã‚‡ã† ã¾ãŸã€aptã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã™ãã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚nixãŒæœ€é©ã§ã™ \n5. Haskellã®ã‚ˆã†ã«asdf/anyenvã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„ã€ã‚ã‚‹ã„ã¯ã€æ‰±ã‚ã‚Œã„ãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯nixã‚’ã¤ã‹ã„ã¾ã—ã‚‡ã†\n6. ã¾ãŸã€aptã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã™ãã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚nixãŒæœ€é©ã§ã™   > ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« \n\nWSLttyã¯WSL2ã«å¯¾å¿œã—ã¦ãŠã‚‰ãšConEmuã¯æç”»ãŒããšã‚Œã‚„ã™ã„ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹Windows TerminalãŒé¸æŠè‚¢ã¨ãªã‚Šã¾ã™ã€‚ \n\nWindows Terminalã¨ConEmuã¨ã®æ¯”è¼ƒ    - Windows Terminal ConEmu     é€éå¯¾è±¡ backgroundImage ConEmuè‡ªä½“   ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰åˆ¶ç´„ Alt+ShiftãŒåŠ¹ã‹ãªã„ ç‰¹ã«ãªã—   WSL2ã®æç”» ç‰¹ã«ãªã— ããšã‚Œã‚‹   ç®¡ç†è€…æ¨©é™ã§å®Ÿè¡Œ åˆå›ã®ã¿ ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã”ã¨      > Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« \n\nWSL1ã§ã¯Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒã¤ã‹ãˆãªã„ã®ã§WSL2ã§Dockerã‚’ã¤ã‹ã†ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚Docker CEã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ \n\nã©ã†ã—ã¦ã‚‚WSL1ã§ã¨ã„ã†ã“ã¨ã§ã‚ã‚Œã°ã€Win32 (WSL1ã‹ã‚‰ã¿ã‚‹ã¨drvfs) å´ã§Docker For Windowsã‚’ç”¨æ„ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯Dockerã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‹ã‚‰æ‰‹é †é€šã‚ŠãŠã“ãªã„ã¾ã™ã€‚\n æ§‹æˆç­‰ã¯å‰å›ã®è¨˜äº‹ã‚’å‚ç…§ãã ã•ã„ã€‚   > ã•ã¦ã€WSL2ã‹ã‚‰Dockerã¯ã©ã®ç¨‹åº¦ã¤ã‹ãˆã‚‹ã®ã‹ã•ã¦ã€WSL2ã‹ã‚‰Dockerã¯ã©ã®ç¨‹åº¦ã¤ã‹ãˆã‚‹ã®ã‹ \n\nWSL2ã¯è»½é‡Hyper-Vä¸Šã«Linuxã‚³ãƒ³ãƒ†ãƒŠã‚’å‹•ã‹ã—ã¦ã„ã‚‹ã®ã§ã€åŸºæœ¬Hyper-Vã¨åŒæ§˜ã«Dockerã‚’ã¤ã‹ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ \n\nãŸã ã—ã€WSL1ã¨é•ã„localhostã«WSL2ãŒãƒã‚¤ãƒ³ãƒ‰ã§ãã¾ã›ã‚“ (2019-07-27è¿½è¨˜: Build Version 18945ã§è§£æ±ºã—ã¾ã—ãŸ )ã€‚\n ã¾ãŸã€WSL1ã¨åŒæ§˜ã«Win32ãƒ»WSLé–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å·®ãŒå¤§ããå‡ºã¦ã„ã¾ã™ã€‚ \n\nã²ã¨ã¤ãšã¤è§£æ±ºæ–¹æ³•ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚   > 1. WSL1ã¨é•ã„localhostã«WSL2ãŒãƒã‚¤ãƒ³ãƒ‰ã§ãã¾ã›ã‚“1. WSL1ã¨é•ã„localhostã«WSL2ãŒãƒã‚¤ãƒ³ãƒ‰ã§ãã¾ã›ã‚“ \n\nWSL2ãŒã¤ã‹ã£ã¦ã„ã‚‹Virtual Switchã¯internal onlyã®ãŸã‚ã€Win32å´ã‹ã‚‰localhostã‚’ã¤ã‹ã£ã¦WSL2ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ç¾åœ¨å¯¾å¿œä¸­ã®ã‚ˆã†ã§ã™ (2019-07-27è¿½è¨˜: Build Version 18945ã§è§£æ±ºã—ã¾ã—ãŸ )ã€‚ \n\nå¯¾å‡¦æ–¹æ³•ã¯2ã¤ã‚ã‚Šã¾ã™ã€‚ \n\na. WSL1ã‚’ã¤ã‹ã† \n\nã“ã‚ŒãŒä¸€ç•ªæ¥½ã§ã™ãŒã€WSL1ã¯æ¬¡é …ã§ã‚ã’ã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã®æ¬ ç‚¹ãŒã‚ã‚‹ã®ã§ã€Webç³»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã«ãŠã‘ã‚‹ãƒ©ã‚¤ãƒ–ãƒªãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã‚’ã¤ã‹ã†ã‚±ãƒ¼ã‚¹ã«é™å®šã™ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚ \n\nb. Hostsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¤ã‹ã† \n\nWin32ã®Hostsãƒ•ã‚¡ã‚¤ãƒ«ã§WSL2ã®eth0ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«é©å½“ãªãƒ›ã‚¹ãƒˆåã‚’å‰²ã‚Šå½“ã¦ã¾ã™ï¼ˆãƒãƒ¼ãƒˆã”ã¨ã«ãƒ›ã‚¹ãƒˆã‚’æŒ¯ã‚Šåˆ†ã‘ãŸã„å ´åˆã¯WSL2å´ã«Proxyã‚’ç”¨æ„ã™ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ï¼‰ã€‚   shell \n\n# C:\\Windows\\System32\\drivers\\etc\\hosts 172.17.72.217 dashboard.local.me   \n\nWSL2ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã‚‹ã”ã¨ã«å¤‰ã‚ã‚‹ã®ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’Win32å´ã®PowerShell $PROFILEã«ç”¨æ„ã—ã¦ãŠãã¨ã„ã„ã§ã—ã‚‡ã†ã€‚WSL2ã ã‘ã§å®Œçµã—ãŸã„æ–¹ã¯ã‚·ã‚§ãƒ«ä¸Šã‹ã‚‰ powershell.exe -Command 'Sync-HostsToWslIp' ã¨æ‰“ã¤ã ã‘ã§ã™ã€‚   powershell \n\n# $PROFILE function Sync-HostsToWslIp { $hosts = \"$env:SystemRoot\\System32\\drivers\\etc\\hosts\"; $pattern = \"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\"; $wslip = bash.exe -c \"ifconfig eth0 | grep 'inet '\"; if ($wslip -match $pattern) { $wslip = $matches[0]; } else { echo \"The Script Exited, the ip address of WSL 2 cannot be found\"; exit; } cat $hosts | %{ $_ -match $pattern } $rc = cat $hosts | %{ $_ -replace $matches[0], $wslip } $rc | Out-File $hosts; }     > 2. WSL1ã¨åŒæ§˜ã«Win32ãƒ»WSLé–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å·®ãŒå¤§ããå‡ºã¦ã„ã¾ã™2. WSL1ã¨åŒæ§˜ã«Win32ãƒ»WSLé–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å·®ãŒå¤§ããå‡ºã¦ã„ã¾ã™ \n\nã„ã‚ã‚“ãªæ–¹ãŒãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å…¬é–‹ã—ã¦ã‚‹ã®ã§ãã‚Œã‚’å‚è€ƒã«ã™ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚ \n\nCf. \n\n- Pythonã§ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\n- ddã€git cloneã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ \n\nã‚ãŸã—ã¯ git status -sb ã‚’ã‚ˆãã¤ã‹ã†ã®ã§ã€ãã®ã‚³ãƒãƒ³ãƒ‰ã§ç°¡å˜ãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ã‚Šã¾ã—ãŸã€‚   shell \n\n# WSLx $ cd ~/nabinno.github.io $ \\time -f %e git status -sb # Win32/WSLx $ cd ~/nabinno.github.io $ \\time -f %e powershell.exe -Command 'git status -sb' # Win32 PS> cd ~/nabinno.github.io PS> (Measure-Command { git status -sb }).TotalMilliseconds / 1000 | %{ [math]::Round($_, 2) }      Subject WSL Win32     WSL1 0.47 0.09   WSL2 0.00 0.61   Win32/WSL1 2.66 1.91   Win32/WSL2 2.81 1.79   Win32 0.51 0.12      > Dockerä»¥å¤–ã§WSLã®èª²é¡Œã¯ãªã„ã®ã‹Dockerä»¥å¤–ã§WSLã®èª²é¡Œã¯ãªã„ã®ã‹   > ãƒ‡ãƒã‚¤ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ‡ãƒã‚¤ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ \n\nä»¥å‰ã‹ã‚‰è¦æœ›ãŒã‚ã£ãŸã‚‚ã®ã ã¨ã€Œãƒ‡ãƒã‚¤ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ããªã„ã€ä»¶ãŒã‚ã‚Šã¾ã™ã€‚ \n\n9På°å…¥å‰ã ã¨ã“ã‚Œã¯Elixirã®IoTãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯Nervesã®ã‚ˆã†ã«ã€WSL Utilitiesã§WSLãƒ‘ã‚¹ã‚’Win32ãƒ‘ã‚¹ã«å¤‰æ›ã—ã¦ã‹ã‚‰Win32ã«ã‚ã‚‹ãƒ‡ãƒã‚¤ã‚¹é–¢é€£ãƒ„ãƒ¼ãƒ«ã‚’ã¤ã‹ã†ã®ãŒç°¡å˜ãªè§£æ±ºç­–ã§ã—ãŸã€‚   sh \n\n$ fwup.exe -a -i $(wslpath -w -a _build/rpi0_dev/nerves/images/hello_nerves.fw) -t complete -d $(fwup.exe -D | sed 's/,.*//')   \n\nãŸã ã—9Pã‚’å°å…¥ã—ãŸWindows 10 Version 1903ä»¥é™ã¯ã€WSL1ã‚‚WSL2ã‚‚ã¨ã‚‚ã«WSLãƒ‘ã‚¹ã‚’å¤‰æ›ã›ãšã«Win32ã«ã‚ã‚‹ãƒ‡ãƒã‚¤ã‚¹é–¢é€£ãƒ„ãƒ¼ãƒ«ã‚’ã¤ã‹ã†ã“ã¨ãŒã§ãã¾ã™ã€‚   sh \n\n$ fwup.exe -a -i _build/rpi0_dev/nerves/images/hello_nerves.fw -t complete -d $(fwup.exe -D | sed 's/,.*//')     > WRAPUPWRAPUP \n\nã‚ãŸã—ã®è¦³æ¸¬ç¯„å›²ã§ã¯èª²é¡Œã¯ã»ã¼å•é¡Œãªã„çŠ¶æ…‹ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚ \n\nãŠã™ã™ã‚é–‹ç™ºç’°å¢ƒã¯ä¸‹è¨˜ã®ã¨ãŠã‚Š    item content     IDE WSLxä¸Šã®ã‚¨ãƒ‡ã‚£ã‚¿   Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º WSL1   Dockeré–¢é€£é–‹ç™º WSL2   dotfiles WSLxã€Win32ã‚’å…±æœ‰ç®¡ç†    \n\nWin32å´ã®IDEã‚’ã¤ã‹ã£ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã®ä¸æº€ãŒã¾ã ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€WSLã§Dockerã‚’ã¤ã‹ã£ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¯ååˆ†ã§ãã‚‹ã€ã¨è¨€ãˆãã†ã§ã™ã€‚ã¤ã¾ã‚Šã€Linuxãƒ»macOSãƒ»Windowsã«ã‚ˆã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¯ååˆ†å…±æœ‰ã§ãã‚‹ã€ã¨ã€‚ \n\nã„ã„æ™‚ä»£ã«ãªã‚Šã¾ã—ãŸã€‚"},"name":"[2019-07-06]WSL2æ™‚ä»£ã®Dockeré–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«","tags":["wsl","wsl2","ubuntu"],"childPublishedDate":{"published_on":"2019-07-06T00:00:00.000Z","published_on_unix":1562371200}}}]}},"pageContext":{"number":62}},"staticQueryHashes":[]}